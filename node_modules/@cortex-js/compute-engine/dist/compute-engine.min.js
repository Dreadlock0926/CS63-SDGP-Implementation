/** CortexJS Compute Engine 0.22.0 */
    (function(global,factory){typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'],factory):(global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.ComputeEngine = {}));})(this, (function (exports) { 'use strict';
var ComputeEngine=(()=>{var $u=Object.create;var Nt=Object.defineProperty;var zu=Object.getOwnPropertyDescriptor;var Uu=Object.getOwnPropertyNames;var Gu=Object.getPrototypeOf,ju=Object.prototype.hasOwnProperty;var Zu=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),Hu=(e,n)=>{for(var i in n)Nt(e,i,{get:n[i],enumerable:!0})},us=(e,n,i,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of Uu(n))!ju.call(e,r)&&r!==i&&Nt(e,r,{get:()=>n[r],enumerable:!(t=zu(n,r))||t.enumerable});return e};var pe=(e,n,i)=>(i=e!=null?$u(Gu(e)):{},us(n||!e||!e.__esModule?Nt(i,"default",{value:e,enumerable:!0}):i,e)),Ju=e=>us(Nt({},"__esModule",{value:!0}),e);var le=Zu((Fr,ls)=>{(function(e){"use strict";var n=Math.cosh||function(l){return Math.abs(l)<1e-9?1-l:(Math.exp(l)+Math.exp(-l))*.5},i=Math.sinh||function(l){return Math.abs(l)<1e-9?l:(Math.exp(l)-Math.exp(-l))*.5},t=function(l){var f=Math.PI/4;if(-f>l||l>f)return Math.cos(l)-1;var d=l*l;return d*(d*(d*(d*(d*(d*(d*(d/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-1/2)},r=function(l,f){var d=Math.abs(l),c=Math.abs(f);return d<3e3&&c<3e3?Math.sqrt(d*d+c*c):(d<c?(d=c,c=l/f):c=f/l,d*Math.sqrt(1+c*c))},o=function(){throw SyntaxError("Invalid Param")};function s(l,f){var d=Math.abs(l),c=Math.abs(f);return l===0?Math.log(c):f===0?Math.log(d):d<3e3&&c<3e3?Math.log(l*l+f*f)*.5:(l=l/2,f=f/2,.5*Math.log(l*l+f*f)+Math.LN2)}var a=function(l,f){var d={re:0,im:0};if(l==null)d.re=d.im=0;else if(f!==void 0)d.re=l,d.im=f;else switch(typeof l){case"object":if("im"in l&&"re"in l)d.re=l.re,d.im=l.im;else if("abs"in l&&"arg"in l){if(!Number.isFinite(l.abs)&&Number.isFinite(l.arg))return u.INFINITY;d.re=l.abs*Math.cos(l.arg),d.im=l.abs*Math.sin(l.arg)}else if("r"in l&&"phi"in l){if(!Number.isFinite(l.r)&&Number.isFinite(l.phi))return u.INFINITY;d.re=l.r*Math.cos(l.phi),d.im=l.r*Math.sin(l.phi)}else l.length===2?(d.re=l[0],d.im=l[1]):o();break;case"string":d.im=d.re=0;var c=l.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),p=1,h=0;c===null&&o();for(var g=0;g<c.length;g++){var E=c[g];E===" "||E==="	"||E===`
`||(E==="+"?p++:E==="-"?h++:E==="i"||E==="I"?(p+h===0&&o(),c[g+1]!==" "&&!isNaN(c[g+1])?(d.im+=parseFloat((h%2?"-":"")+c[g+1]),g++):d.im+=parseFloat((h%2?"-":"")+"1"),p=h=0):((p+h===0||isNaN(E))&&o(),c[g+1]==="i"||c[g+1]==="I"?(d.im+=parseFloat((h%2?"-":"")+E),g++):d.re+=parseFloat((h%2?"-":"")+E),p=h=0))}p+h>0&&o();break;case"number":d.im=0,d.re=l;break;default:o()}return isNaN(d.re)||isNaN(d.im),d};function u(l,f){if(!(this instanceof u))return new u(l,f);var d=a(l,f);this.re=d.re,this.im=d.im}u.prototype={re:0,im:0,sign:function(){var l=this.abs();return new u(this.re/l,this.im/l)},add:function(l,f){var d=new u(l,f);return this.isInfinite()&&d.isInfinite()?u.NAN:this.isInfinite()||d.isInfinite()?u.INFINITY:new u(this.re+d.re,this.im+d.im)},sub:function(l,f){var d=new u(l,f);return this.isInfinite()&&d.isInfinite()?u.NAN:this.isInfinite()||d.isInfinite()?u.INFINITY:new u(this.re-d.re,this.im-d.im)},mul:function(l,f){var d=new u(l,f);return this.isInfinite()&&d.isZero()||this.isZero()&&d.isInfinite()?u.NAN:this.isInfinite()||d.isInfinite()?u.INFINITY:d.im===0&&this.im===0?new u(this.re*d.re,0):new u(this.re*d.re-this.im*d.im,this.re*d.im+this.im*d.re)},div:function(l,f){var d=new u(l,f);if(this.isZero()&&d.isZero()||this.isInfinite()&&d.isInfinite())return u.NAN;if(this.isInfinite()||d.isZero())return u.INFINITY;if(this.isZero()||d.isInfinite())return u.ZERO;l=this.re,f=this.im;var c=d.re,p=d.im,h,g;return p===0?new u(l/c,f/c):Math.abs(c)<Math.abs(p)?(g=c/p,h=c*g+p,new u((l*g+f)/h,(f*g-l)/h)):(g=p/c,h=p*g+c,new u((l+f*g)/h,(f-l*g)/h))},pow:function(l,f){var d=new u(l,f);if(l=this.re,f=this.im,d.isZero())return u.ONE;if(d.im===0){if(f===0&&l>0)return new u(Math.pow(l,d.re),0);if(l===0)switch((d.re%4+4)%4){case 0:return new u(Math.pow(f,d.re),0);case 1:return new u(0,Math.pow(f,d.re));case 2:return new u(-Math.pow(f,d.re),0);case 3:return new u(0,-Math.pow(f,d.re))}}if(l===0&&f===0&&d.re>0&&d.im>=0)return u.ZERO;var c=Math.atan2(f,l),p=s(l,f);return l=Math.exp(d.re*p-d.im*c),f=d.im*p+d.re*c,new u(l*Math.cos(f),l*Math.sin(f))},sqrt:function(){var l=this.re,f=this.im,d=this.abs(),c,p;if(l>=0){if(f===0)return new u(Math.sqrt(l),0);c=.5*Math.sqrt(2*(d+l))}else c=Math.abs(f)/Math.sqrt(2*(d-l));return l<=0?p=.5*Math.sqrt(2*(d-l)):p=Math.abs(f)/Math.sqrt(2*(d+l)),new u(c,f<0?-p:p)},exp:function(){var l=Math.exp(this.re);return this.im,new u(l*Math.cos(this.im),l*Math.sin(this.im))},expm1:function(){var l=this.re,f=this.im;return new u(Math.expm1(l)*Math.cos(f)+t(f),Math.exp(l)*Math.sin(f))},log:function(){var l=this.re,f=this.im;return f===0&&l>0,new u(s(l,f),Math.atan2(f,l))},abs:function(){return r(this.re,this.im)},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var l=this.re,f=this.im;return new u(Math.sin(l)*n(f),Math.cos(l)*i(f))},cos:function(){var l=this.re,f=this.im;return new u(Math.cos(l)*n(f),-Math.sin(l)*i(f))},tan:function(){var l=2*this.re,f=2*this.im,d=Math.cos(l)+n(f);return new u(Math.sin(l)/d,i(f)/d)},cot:function(){var l=2*this.re,f=2*this.im,d=Math.cos(l)-n(f);return new u(-Math.sin(l)/d,i(f)/d)},sec:function(){var l=this.re,f=this.im,d=.5*n(2*f)+.5*Math.cos(2*l);return new u(Math.cos(l)*n(f)/d,Math.sin(l)*i(f)/d)},csc:function(){var l=this.re,f=this.im,d=.5*n(2*f)-.5*Math.cos(2*l);return new u(Math.sin(l)*n(f)/d,-Math.cos(l)*i(f)/d)},asin:function(){var l=this.re,f=this.im,d=new u(f*f-l*l+1,-2*l*f).sqrt(),c=new u(d.re-f,d.im+l).log();return new u(c.im,-c.re)},acos:function(){var l=this.re,f=this.im,d=new u(f*f-l*l+1,-2*l*f).sqrt(),c=new u(d.re-f,d.im+l).log();return new u(Math.PI/2-c.im,c.re)},atan:function(){var l=this.re,f=this.im;if(l===0){if(f===1)return new u(0,1/0);if(f===-1)return new u(0,-1/0)}var d=l*l+(1-f)*(1-f),c=new u((1-f*f-l*l)/d,-2*l/d).log();return new u(-.5*c.im,.5*c.re)},acot:function(){var l=this.re,f=this.im;if(f===0)return new u(Math.atan2(1,l),0);var d=l*l+f*f;return d!==0?new u(l/d,-f/d).atan():new u(l!==0?l/0:0,f!==0?-f/0:0).atan()},asec:function(){var l=this.re,f=this.im;if(l===0&&f===0)return new u(0,1/0);var d=l*l+f*f;return d!==0?new u(l/d,-f/d).acos():new u(l!==0?l/0:0,f!==0?-f/0:0).acos()},acsc:function(){var l=this.re,f=this.im;if(l===0&&f===0)return new u(Math.PI/2,1/0);var d=l*l+f*f;return d!==0?new u(l/d,-f/d).asin():new u(l!==0?l/0:0,f!==0?-f/0:0).asin()},sinh:function(){var l=this.re,f=this.im;return new u(i(l)*Math.cos(f),n(l)*Math.sin(f))},cosh:function(){var l=this.re,f=this.im;return new u(n(l)*Math.cos(f),i(l)*Math.sin(f))},tanh:function(){var l=2*this.re,f=2*this.im,d=n(l)+Math.cos(f);return new u(i(l)/d,Math.sin(f)/d)},coth:function(){var l=2*this.re,f=2*this.im,d=n(l)-Math.cos(f);return new u(i(l)/d,-Math.sin(f)/d)},csch:function(){var l=this.re,f=this.im,d=Math.cos(2*f)-n(2*l);return new u(-2*i(l)*Math.cos(f)/d,2*n(l)*Math.sin(f)/d)},sech:function(){var l=this.re,f=this.im,d=Math.cos(2*f)+n(2*l);return new u(2*n(l)*Math.cos(f)/d,-2*i(l)*Math.sin(f)/d)},asinh:function(){var l=this.im;this.im=-this.re,this.re=l;var f=this.asin();return this.re=-this.im,this.im=l,l=f.re,f.re=-f.im,f.im=l,f},acosh:function(){var l=this.acos();if(l.im<=0){var f=l.re;l.re=-l.im,l.im=f}else{var f=l.im;l.im=-l.re,l.re=f}return l},atanh:function(){var l=this.re,f=this.im,d=l>1&&f===0,c=1-l,p=1+l,h=c*c+f*f,g=h!==0?new u((p*c-f*f)/h,(f*c+p*f)/h):new u(l!==-1?l/0:0,f!==0?f/0:0),E=g.re;return g.re=s(g.re,g.im)/2,g.im=Math.atan2(g.im,E)/2,d&&(g.im=-g.im),g},acoth:function(){var l=this.re,f=this.im;if(l===0&&f===0)return new u(0,Math.PI/2);var d=l*l+f*f;return d!==0?new u(l/d,-f/d).atanh():new u(l!==0?l/0:0,f!==0?-f/0:0).atanh()},acsch:function(){var l=this.re,f=this.im;if(f===0)return new u(l!==0?Math.log(l+Math.sqrt(l*l+1)):1/0,0);var d=l*l+f*f;return d!==0?new u(l/d,-f/d).asinh():new u(l!==0?l/0:0,f!==0?-f/0:0).asinh()},asech:function(){var l=this.re,f=this.im;if(this.isZero())return u.INFINITY;var d=l*l+f*f;return d!==0?new u(l/d,-f/d).acosh():new u(l!==0?l/0:0,f!==0?-f/0:0).acosh()},inverse:function(){if(this.isZero())return u.INFINITY;if(this.isInfinite())return u.ZERO;var l=this.re,f=this.im,d=l*l+f*f;return new u(l/d,-f/d)},conjugate:function(){return new u(this.re,-this.im)},neg:function(){return new u(-this.re,-this.im)},ceil:function(l){return l=Math.pow(10,l||0),new u(Math.ceil(this.re*l)/l,Math.ceil(this.im*l)/l)},floor:function(l){return l=Math.pow(10,l||0),new u(Math.floor(this.re*l)/l,Math.floor(this.im*l)/l)},round:function(l){return l=Math.pow(10,l||0),new u(Math.round(this.re*l)/l,Math.round(this.im*l)/l)},equals:function(l,f){var d=new u(l,f);return Math.abs(d.re-this.re)<=u.EPSILON&&Math.abs(d.im-this.im)<=u.EPSILON},clone:function(){return new u(this.re,this.im)},toString:function(){var l=this.re,f=this.im,d="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(l)<u.EPSILON&&(l=0),Math.abs(f)<u.EPSILON&&(f=0),f===0?d+l:(l!==0?(d+=l,d+=" ",f<0?(f=-f,d+="-"):d+="+",d+=" "):f<0&&(f=-f,d+="-"),f!==1&&(d+=f),d+"i"))},toVector:function(){return[this.re,this.im]},valueOf:function(){return this.im===0?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return this.im===0&&this.re===0},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return!(this.isNaN()||this.isFinite())}},u.ZERO=new u(0,0),u.ONE=new u(1,0),u.I=new u(0,1),u.PI=new u(Math.PI,0),u.E=new u(Math.E,0),u.INFINITY=new u(1/0,1/0),u.NAN=new u(NaN,NaN),u.EPSILON=1e-15,typeof define=="function"&&define.amd?define([],function(){return u}):typeof Fr=="object"?(Object.defineProperty(u,"__esModule",{value:!0}),u.default=u,u.Complex=u,ls.exports=u):e.Complex=u})(Fr)});var Bd={};Hu(Bd,{ADDITION_PRECEDENCE:()=>ue,ARROW_PRECEDENCE:()=>en,ASSIGNMENT_PRECEDENCE:()=>ti,COMPARISON_PRECEDENCE:()=>M,ComputeEngine:()=>Ai,DIVISION_PRECEDENCE:()=>nn,EXPONENTIATION_PRECEDENCE:()=>Wu,MULTIPLICATION_PRECEDENCE:()=>Ve,POSTFIX_PRECEDENCE:()=>_t,isEnvironmentEntry:()=>Pr,isExpressionEntry:()=>Yu,isFunctionEntry:()=>Qu,isInfixEntry:()=>St,isMatchfixEntry:()=>ri,isPostfixEntry:()=>Tt,isPrefixEntry:()=>Pi,isSymbolEntry:()=>Or,version:()=>Td});var M=245,ti=260,en=270,ue=275,Ve=390,nn=600,Wu=700,_t=810;function Yu(e){return!("kind"in e)||e.kind==="expression"}function Or(e){return"kind"in e&&e.kind==="symbol"}function Qu(e){return"kind"in e&&e.kind==="function"}function ri(e){return"kind"in e&&e.kind==="matchfix"}function St(e){return"kind"in e&&e.kind==="infix"}function Pi(e){return"kind"in e&&e.kind==="prefix"}function Tt(e){return"kind"in e&&e.kind==="postfix"}function Pr(e){return"kind"in e&&e.kind==="environment"}var ni=pe(le(),1);var oi=9e15,In=1e9,Lr="0123456789abcdef",Dt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",It="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Rr={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-oi,maxE:oi,crypto:!1},ms,mn,w=!0,wt="[DecimalError] ",Dn=wt+"Invalid argument: ",ps=wt+"Precision limit exceeded",hs=wt+"crypto unavailable",gs="[object Decimal]",Be=Math.floor,ge=Math.pow,Xu=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Ku=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,el=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,xs=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,He=1e7,D=7,nl=9007199254740991,il=Dt.length-1,qr=It.length-1,b={toStringTag:gs};b.absoluteValue=b.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),T(e)};b.ceil=function(){return T(new this.constructor(this),this.e+1,2)};b.clampedTo=b.clamp=function(e,n){var i,t=this,r=t.constructor;if(e=new r(e),n=new r(n),!e.s||!n.s)return new r(NaN);if(e.gt(n))throw Error(Dn+n);return i=t.cmp(e),i<0?e:t.cmp(n)>0?n:new r(t)};b.comparedTo=b.cmp=function(e){var n,i,t,r,o=this,s=o.d,a=(e=new o.constructor(e)).d,u=o.s,l=e.s;if(!s||!a)return!u||!l?NaN:u!==l?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-l:0;if(u!==l)return u;if(o.e!==e.e)return o.e>e.e^u<0?1:-1;for(t=s.length,r=a.length,n=0,i=t<r?t:r;n<i;++n)if(s[n]!==a[n])return s[n]>a[n]^u<0?1:-1;return t===r?0:t>r^u<0?1:-1};b.cosine=b.cos=function(){var e,n,i=this,t=i.constructor;return i.d?i.d[0]?(e=t.precision,n=t.rounding,t.precision=e+Math.max(i.e,i.sd())+D,t.rounding=1,i=tl(t,Ns(t,i)),t.precision=e,t.rounding=n,T(mn==2||mn==3?i.neg():i,e,n,!0)):new t(1):new t(NaN)};b.cubeRoot=b.cbrt=function(){var e,n,i,t,r,o,s,a,u,l,f=this,d=f.constructor;if(!f.isFinite()||f.isZero())return new d(f);for(w=!1,o=f.s*ge(f.s*f,1/3),!o||Math.abs(o)==1/0?(i=_e(f.d),e=f.e,(o=(e-i.length+1)%3)&&(i+=o==1||o==-2?"0":"00"),o=ge(i,1/3),e=Be((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?i="5e"+e:(i=o.toExponential(),i=i.slice(0,i.indexOf("e")+1)+e),t=new d(i),t.s=f.s):t=new d(o.toString()),s=(e=d.precision)+3;;)if(a=t,u=a.times(a).times(a),l=u.plus(f),t=Y(l.plus(f).times(a),l.plus(u),s+2,1),_e(a.d).slice(0,s)===(i=_e(t.d)).slice(0,s))if(i=i.slice(s-3,s+1),i=="9999"||!r&&i=="4999"){if(!r&&(T(a,e+1,0),a.times(a).times(a).eq(f))){t=a;break}s+=4,r=1}else{(!+i||!+i.slice(1)&&i.charAt(0)=="5")&&(T(t,e+1,1),n=!t.times(t).times(t).eq(f));break}return w=!0,T(t,e,d.rounding,n)};b.decimalPlaces=b.dp=function(){var e,n=this.d,i=NaN;if(n){if(e=n.length-1,i=(e-Be(this.e/D))*D,e=n[e],e)for(;e%10==0;e/=10)i--;i<0&&(i=0)}return i};b.dividedBy=b.div=function(e){return Y(this,new this.constructor(e))};b.dividedToIntegerBy=b.divToInt=function(e){var n=this,i=n.constructor;return T(Y(n,new i(e),0,1,1),i.precision,i.rounding)};b.equals=b.eq=function(e){return this.cmp(e)===0};b.floor=function(){return T(new this.constructor(this),this.e+1,3)};b.greaterThan=b.gt=function(e){return this.cmp(e)>0};b.greaterThanOrEqualTo=b.gte=function(e){var n=this.cmp(e);return n==1||n===0};b.hyperbolicCosine=b.cosh=function(){var e,n,i,t,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;i=s.precision,t=s.rounding,s.precision=i+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(e=Math.ceil(r/3),n=(1/Mt(4,e)).toString()):(e=16,n="2.3283064365386962890625e-10"),o=si(s,1,o.times(n),new s(1),!0);for(var u,l=e,f=new s(8);l--;)u=o.times(o),o=a.minus(u.times(f.minus(u.times(f))));return T(o,s.precision=i,s.rounding=t,!0)};b.hyperbolicSine=b.sinh=function(){var e,n,i,t,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(n=o.precision,i=o.rounding,o.precision=n+Math.max(r.e,r.sd())+4,o.rounding=1,t=r.d.length,t<3)r=si(o,2,r,r,!0);else{e=1.4*Math.sqrt(t),e=e>16?16:e|0,r=r.times(1/Mt(5,e)),r=si(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),l=new o(20);e--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(l))))}return o.precision=n,o.rounding=i,T(r,n,i,!0)};b.hyperbolicTangent=b.tanh=function(){var e,n,i=this,t=i.constructor;return i.isFinite()?i.isZero()?new t(i):(e=t.precision,n=t.rounding,t.precision=e+7,t.rounding=1,Y(i.sinh(),i.cosh(),t.precision=e,t.rounding=n)):new t(i.s)};b.inverseCosine=b.acos=function(){var e,n=this,i=n.constructor,t=n.abs().cmp(1),r=i.precision,o=i.rounding;return t!==-1?t===0?n.isNeg()?Ze(i,r,o):new i(0):new i(NaN):n.isZero()?Ze(i,r+4,o).times(.5):(i.precision=r+6,i.rounding=1,n=n.asin(),e=Ze(i,r+4,o).times(.5),i.precision=r,i.rounding=o,e.minus(n))};b.inverseHyperbolicCosine=b.acosh=function(){var e,n,i=this,t=i.constructor;return i.lte(1)?new t(i.eq(1)?0:NaN):i.isFinite()?(e=t.precision,n=t.rounding,t.precision=e+Math.max(Math.abs(i.e),i.sd())+4,t.rounding=1,w=!1,i=i.times(i).minus(1).sqrt().plus(i),w=!0,t.precision=e,t.rounding=n,i.ln()):new t(i)};b.inverseHyperbolicSine=b.asinh=function(){var e,n,i=this,t=i.constructor;return!i.isFinite()||i.isZero()?new t(i):(e=t.precision,n=t.rounding,t.precision=e+2*Math.max(Math.abs(i.e),i.sd())+6,t.rounding=1,w=!1,i=i.times(i).plus(1).sqrt().plus(i),w=!0,t.precision=e,t.rounding=n,i.ln())};b.inverseHyperbolicTangent=b.atanh=function(){var e,n,i,t,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(e=o.precision,n=o.rounding,t=r.sd(),Math.max(t,e)<2*-r.e-1?T(new o(r),e,n,!0):(o.precision=i=t-r.e,r=Y(r.plus(1),new o(1).minus(r),i+e,1),o.precision=e+4,o.rounding=1,r=r.ln(),o.precision=e,o.rounding=n,r.times(.5))):new o(NaN)};b.inverseSine=b.asin=function(){var e,n,i,t,r=this,o=r.constructor;return r.isZero()?new o(r):(n=r.abs().cmp(1),i=o.precision,t=o.rounding,n!==-1?n===0?(e=Ze(o,i+4,t).times(.5),e.s=r.s,e):new o(NaN):(o.precision=i+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=i,o.rounding=t,r.times(2)))};b.inverseTangent=b.atan=function(){var e,n,i,t,r,o,s,a,u,l=this,f=l.constructor,d=f.precision,c=f.rounding;if(l.isFinite()){if(l.isZero())return new f(l);if(l.abs().eq(1)&&d+4<=qr)return s=Ze(f,d+4,c).times(.25),s.s=l.s,s}else{if(!l.s)return new f(NaN);if(d+4<=qr)return s=Ze(f,d+4,c).times(.5),s.s=l.s,s}for(f.precision=a=d+10,f.rounding=1,i=Math.min(28,a/D+2|0),e=i;e;--e)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(w=!1,n=Math.ceil(a/D),t=1,u=l.times(l),s=new f(l),r=l;e!==-1;)if(r=r.times(u),o=s.minus(r.div(t+=2)),r=r.times(u),s=o.plus(r.div(t+=2)),s.d[n]!==void 0)for(e=n;s.d[e]===o.d[e]&&e--;);return i&&(s=s.times(2<<i-1)),w=!0,T(s,f.precision=d,f.rounding=c,!0)};b.isFinite=function(){return!!this.d};b.isInteger=b.isInt=function(){return!!this.d&&Be(this.e/D)>this.d.length-2};b.isNaN=function(){return!this.s};b.isNegative=b.isNeg=function(){return this.s<0};b.isPositive=b.isPos=function(){return this.s>0};b.isZero=function(){return!!this.d&&this.d[0]===0};b.lessThan=b.lt=function(e){return this.cmp(e)<0};b.lessThanOrEqualTo=b.lte=function(e){return this.cmp(e)<1};b.logarithm=b.log=function(e){var n,i,t,r,o,s,a,u,l=this,f=l.constructor,d=f.precision,c=f.rounding,p=5;if(e==null)e=new f(10),n=!0;else{if(e=new f(e),i=e.d,e.s<0||!i||!i[0]||e.eq(1))return new f(NaN);n=e.eq(10)}if(i=l.d,l.s<0||!i||!i[0]||l.eq(1))return new f(i&&!i[0]?-1/0:l.s!=1?NaN:i?0:1/0);if(n)if(i.length>1)o=!0;else{for(r=i[0];r%10===0;)r/=10;o=r!==1}if(w=!1,a=d+p,s=Bn(l,a),t=n?kt(f,a+10):Bn(e,a),u=Y(s,t,a,1),Fi(u.d,r=d,c))do if(a+=10,s=Bn(l,a),t=n?kt(f,a+10):Bn(e,a),u=Y(s,t,a,1),!o){+_e(u.d).slice(r+1,r+15)+1==1e14&&(u=T(u,d+1,0));break}while(Fi(u.d,r+=10,c));return w=!0,T(u,d,c)};b.minus=b.sub=function(e){var n,i,t,r,o,s,a,u,l,f,d,c,p=this,h=p.constructor;if(e=new h(e),!p.d||!e.d)return!p.s||!e.s?e=new h(NaN):p.d?e.s=-e.s:e=new h(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(l=p.d,c=e.d,a=h.precision,u=h.rounding,!l[0]||!c[0]){if(c[0])e.s=-e.s;else if(l[0])e=new h(p);else return new h(u===3?-0:0);return w?T(e,a,u):e}if(i=Be(e.e/D),f=Be(p.e/D),l=l.slice(),o=f-i,o){for(d=o<0,d?(n=l,o=-o,s=c.length):(n=c,i=f,s=l.length),t=Math.max(Math.ceil(a/D),s)+2,o>t&&(o=t,n.length=1),n.reverse(),t=o;t--;)n.push(0);n.reverse()}else{for(t=l.length,s=c.length,d=t<s,d&&(s=t),t=0;t<s;t++)if(l[t]!=c[t]){d=l[t]<c[t];break}o=0}for(d&&(n=l,l=c,c=n,e.s=-e.s),s=l.length,t=c.length-s;t>0;--t)l[s++]=0;for(t=c.length;t>o;){if(l[--t]<c[t]){for(r=t;r&&l[--r]===0;)l[r]=He-1;--l[r],l[t]+=He}l[t]-=c[t]}for(;l[--s]===0;)l.pop();for(;l[0]===0;l.shift())--i;return l[0]?(e.d=l,e.e=Ct(l,i),w?T(e,a,u):e):new h(u===3?-0:0)};b.modulo=b.mod=function(e){var n,i=this,t=i.constructor;return e=new t(e),!i.d||!e.s||e.d&&!e.d[0]?new t(NaN):!e.d||i.d&&!i.d[0]?T(new t(i),t.precision,t.rounding):(w=!1,t.modulo==9?(n=Y(i,e.abs(),0,3,1),n.s*=e.s):n=Y(i,e,0,t.modulo,1),n=n.times(e),w=!0,i.minus(n))};b.naturalExponential=b.exp=function(){return Vr(this)};b.naturalLogarithm=b.ln=function(){return Bn(this)};b.negated=b.neg=function(){var e=new this.constructor(this);return e.s=-e.s,T(e)};b.plus=b.add=function(e){var n,i,t,r,o,s,a,u,l,f,d=this,c=d.constructor;if(e=new c(e),!d.d||!e.d)return!d.s||!e.s?e=new c(NaN):d.d||(e=new c(e.d||d.s===e.s?d:NaN)),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(l=d.d,f=e.d,a=c.precision,u=c.rounding,!l[0]||!f[0])return f[0]||(e=new c(d)),w?T(e,a,u):e;if(o=Be(d.e/D),t=Be(e.e/D),l=l.slice(),r=o-t,r){for(r<0?(i=l,r=-r,s=f.length):(i=f,t=o,s=l.length),o=Math.ceil(a/D),s=o>s?o+1:s+1,r>s&&(r=s,i.length=1),i.reverse();r--;)i.push(0);i.reverse()}for(s=l.length,r=f.length,s-r<0&&(r=s,i=f,f=l,l=i),n=0;r;)n=(l[--r]=l[r]+f[r]+n)/He|0,l[r]%=He;for(n&&(l.unshift(n),++t),s=l.length;l[--s]==0;)l.pop();return e.d=l,e.e=Ct(l,t),w?T(e,a,u):e};b.precision=b.sd=function(e){var n,i=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Dn+e);return i.d?(n=bs(i.d),e&&i.e+1>n&&(n=i.e+1)):n=NaN,n};b.round=function(){var e=this,n=e.constructor;return T(new n(e),e.e+1,n.rounding)};b.sine=b.sin=function(){var e,n,i=this,t=i.constructor;return i.isFinite()?i.isZero()?new t(i):(e=t.precision,n=t.rounding,t.precision=e+Math.max(i.e,i.sd())+D,t.rounding=1,i=ol(t,Ns(t,i)),t.precision=e,t.rounding=n,T(mn>2?i.neg():i,e,n,!0)):new t(NaN)};b.squareRoot=b.sqrt=function(){var e,n,i,t,r,o,s=this,a=s.d,u=s.e,l=s.s,f=s.constructor;if(l!==1||!a||!a[0])return new f(!l||l<0&&(!a||a[0])?NaN:a?s:1/0);for(w=!1,l=Math.sqrt(+s),l==0||l==1/0?(n=_e(a),(n.length+u)%2==0&&(n+="0"),l=Math.sqrt(n),u=Be((u+1)/2)-(u<0||u%2),l==1/0?n="5e"+u:(n=l.toExponential(),n=n.slice(0,n.indexOf("e")+1)+u),t=new f(n)):t=new f(l.toString()),i=(u=f.precision)+3;;)if(o=t,t=o.plus(Y(s,o,i+2,1)).times(.5),_e(o.d).slice(0,i)===(n=_e(t.d)).slice(0,i))if(n=n.slice(i-3,i+1),n=="9999"||!r&&n=="4999"){if(!r&&(T(o,u+1,0),o.times(o).eq(s))){t=o;break}i+=4,r=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(T(t,u+1,1),e=!t.times(t).eq(s));break}return w=!0,T(t,u,f.rounding,e)};b.tangent=b.tan=function(){var e,n,i=this,t=i.constructor;return i.isFinite()?i.isZero()?new t(i):(e=t.precision,n=t.rounding,t.precision=e+10,t.rounding=1,i=i.sin(),i.s=1,i=Y(i,new t(1).minus(i.times(i)).sqrt(),e+10,0),t.precision=e,t.rounding=n,T(mn==2||mn==4?i.neg():i,e,n,!0)):new t(NaN)};b.times=b.mul=function(e){var n,i,t,r,o,s,a,u,l,f=this,d=f.constructor,c=f.d,p=(e=new d(e)).d;if(e.s*=f.s,!c||!c[0]||!p||!p[0])return new d(!e.s||c&&!c[0]&&!p||p&&!p[0]&&!c?NaN:!c||!p?e.s/0:e.s*0);for(i=Be(f.e/D)+Be(e.e/D),u=c.length,l=p.length,u<l&&(o=c,c=p,p=o,s=u,u=l,l=s),o=[],s=u+l,t=s;t--;)o.push(0);for(t=l;--t>=0;){for(n=0,r=u+t;r>t;)a=o[r]+p[t]*c[r-t-1]+n,o[r--]=a%He|0,n=a/He|0;o[r]=(o[r]+n)%He|0}for(;!o[--s];)o.pop();return n?++i:o.shift(),e.d=o,e.e=Ct(o,i),w?T(e,d.precision,d.rounding):e};b.toBinary=function(e,n){return zr(this,2,e,n)};b.toDecimalPlaces=b.toDP=function(e,n){var i=this,t=i.constructor;return i=new t(i),e===void 0?i:(ke(e,0,In),n===void 0?n=t.rounding:ke(n,0,8),T(i,e+i.e+1,n))};b.toExponential=function(e,n){var i,t=this,r=t.constructor;return e===void 0?i=tn(t,!0):(ke(e,0,In),n===void 0?n=r.rounding:ke(n,0,8),t=T(new r(t),e+1,n),i=tn(t,!0,e+1)),t.isNeg()&&!t.isZero()?"-"+i:i};b.toFixed=function(e,n){var i,t,r=this,o=r.constructor;return e===void 0?i=tn(r):(ke(e,0,In),n===void 0?n=o.rounding:ke(n,0,8),t=T(new o(r),e+r.e+1,n),i=tn(t,!1,e+t.e+1)),r.isNeg()&&!r.isZero()?"-"+i:i};b.toFraction=function(e){var n,i,t,r,o,s,a,u,l,f,d,c,p=this,h=p.d,g=p.constructor;if(!h)return new g(p);if(l=i=new g(1),t=u=new g(0),n=new g(t),o=n.e=bs(h)-p.e-1,s=o%D,n.d[0]=ge(10,s<0?D+s:s),e==null)e=o>0?n:l;else{if(a=new g(e),!a.isInt()||a.lt(l))throw Error(Dn+a);e=a.gt(n)?o>0?n:l:a}for(w=!1,a=new g(_e(h)),f=g.precision,g.precision=o=h.length*D*2;d=Y(a,n,0,1,1),r=i.plus(d.times(t)),r.cmp(e)!=1;)i=t,t=r,r=l,l=u.plus(d.times(r)),u=r,r=n,n=a.minus(d.times(r)),a=r;return r=Y(e.minus(i),t,0,1,1),u=u.plus(r.times(l)),i=i.plus(r.times(t)),u.s=l.s=p.s,c=Y(l,t,o,1).minus(p).abs().cmp(Y(u,i,o,1).minus(p).abs())<1?[l,t]:[u,i],g.precision=f,w=!0,c};b.toHexadecimal=b.toHex=function(e,n){return zr(this,16,e,n)};b.toNearest=function(e,n){var i=this,t=i.constructor;if(i=new t(i),e==null){if(!i.d)return i;e=new t(1),n=t.rounding}else{if(e=new t(e),n===void 0?n=t.rounding:ke(n,0,8),!i.d)return e.s?i:e;if(!e.d)return e.s&&(e.s=i.s),e}return e.d[0]?(w=!1,i=Y(i,e,0,n,1).times(e),w=!0,T(i)):(e.s=i.s,i=e),i};b.toNumber=function(){return+this};b.toOctal=function(e,n){return zr(this,8,e,n)};b.toPower=b.pow=function(e){var n,i,t,r,o,s,a=this,u=a.constructor,l=+(e=new u(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new u(ge(+a,l));if(a=new u(a),a.eq(1))return a;if(t=u.precision,o=u.rounding,e.eq(1))return T(a,t,o);if(n=Be(e.e/D),n>=e.d.length-1&&(i=l<0?-l:l)<=nl)return r=ys(u,a,i,t),e.s<0?new u(1).div(r):T(r,t,o);if(s=a.s,s<0){if(n<e.d.length-1)return new u(NaN);if(e.d[n]&1||(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return i=ge(+a,l),n=i==0||!isFinite(i)?Be(l*(Math.log("0."+_e(a.d))/Math.LN10+a.e+1)):new u(i+"").e,n>u.maxE+1||n<u.minE-1?new u(n>0?s/0:0):(w=!1,u.rounding=a.s=1,i=Math.min(12,(n+"").length),r=Vr(e.times(Bn(a,t+i)),t),r.d&&(r=T(r,t+5,1),Fi(r.d,t,o)&&(n=t+10,r=T(Vr(e.times(Bn(a,n+i)),n),n+5,1),+_e(r.d).slice(t+1,t+15)+1==1e14&&(r=T(r,t+1,0)))),r.s=s,w=!0,u.rounding=o,T(r,t,o))};b.toPrecision=function(e,n){var i,t=this,r=t.constructor;return e===void 0?i=tn(t,t.e<=r.toExpNeg||t.e>=r.toExpPos):(ke(e,1,In),n===void 0?n=r.rounding:ke(n,0,8),t=T(new r(t),e,n),i=tn(t,e<=t.e||t.e<=r.toExpNeg,e)),t.isNeg()&&!t.isZero()?"-"+i:i};b.toSignificantDigits=b.toSD=function(e,n){var i=this,t=i.constructor;return e===void 0?(e=t.precision,n=t.rounding):(ke(e,1,In),n===void 0?n=t.rounding:ke(n,0,8)),T(new t(i),e,n)};b.toString=function(){var e=this,n=e.constructor,i=tn(e,e.e<=n.toExpNeg||e.e>=n.toExpPos);return e.isNeg()&&!e.isZero()?"-"+i:i};b.truncated=b.trunc=function(){return T(new this.constructor(this),this.e+1,1)};b.valueOf=b.toJSON=function(){var e=this,n=e.constructor,i=tn(e,e.e<=n.toExpNeg||e.e>=n.toExpPos);return e.isNeg()?"-"+i:i};function _e(e){var n,i,t,r=e.length-1,o="",s=e[0];if(r>0){for(o+=s,n=1;n<r;n++)t=e[n]+"",i=D-t.length,i&&(o+=Tn(i)),o+=t;s=e[n],t=s+"",i=D-t.length,i&&(o+=Tn(i))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function ke(e,n,i){if(e!==~~e||e<n||e>i)throw Error(Dn+e)}function Fi(e,n,i,t){var r,o,s,a;for(o=e[0];o>=10;o/=10)--n;return--n<0?(n+=D,r=0):(r=Math.ceil((n+1)/D),n%=D),o=ge(10,D-n),a=e[r]%o|0,t==null?n<3?(n==0?a=a/100|0:n==1&&(a=a/10|0),s=i<4&&a==99999||i>3&&a==49999||a==5e4||a==0):s=(i<4&&a+1==o||i>3&&a+1==o/2)&&(e[r+1]/o/100|0)==ge(10,n-2)-1||(a==o/2||a==0)&&(e[r+1]/o/100|0)==0:n<4?(n==0?a=a/1e3|0:n==1?a=a/100|0:n==2&&(a=a/10|0),s=(t||i<4)&&a==9999||!t&&i>3&&a==4999):s=((t||i<4)&&a+1==o||!t&&i>3&&a+1==o/2)&&(e[r+1]/o/1e3|0)==ge(10,n-3)-1,s}function Bt(e,n,i){for(var t,r=[0],o,s=0,a=e.length;s<a;){for(o=r.length;o--;)r[o]*=n;for(r[0]+=Lr.indexOf(e.charAt(s++)),t=0;t<r.length;t++)r[t]>i-1&&(r[t+1]===void 0&&(r[t+1]=0),r[t+1]+=r[t]/i|0,r[t]%=i)}return r.reverse()}function tl(e,n){var i,t,r;if(n.isZero())return n;t=n.d.length,t<32?(i=Math.ceil(t/3),r=(1/Mt(4,i)).toString()):(i=16,r="2.3283064365386962890625e-10"),e.precision+=i,n=si(e,1,n.times(r),new e(1));for(var o=i;o--;){var s=n.times(n);n=s.times(s).minus(s).times(8).plus(1)}return e.precision-=i,n}var Y=function(){function e(t,r,o){var s,a=0,u=t.length;for(t=t.slice();u--;)s=t[u]*r+a,t[u]=s%o|0,a=s/o|0;return a&&t.unshift(a),t}function n(t,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(t[a]!=r[a]){u=t[a]>r[a]?1:-1;break}return u}function i(t,r,o,s){for(var a=0;o--;)t[o]-=a,a=t[o]<r[o]?1:0,t[o]=a*s+t[o]-r[o];for(;!t[0]&&t.length>1;)t.shift()}return function(t,r,o,s,a,u){var l,f,d,c,p,h,g,E,S,k,B,W,Le,qe,ii,yt,Oi,Mr,je,Et,vt=t.constructor,Ar=t.s==r.s?1:-1,Te=t.d,X=r.d;if(!Te||!Te[0]||!X||!X[0])return new vt(!t.s||!r.s||(Te?X&&Te[0]==X[0]:!X)?NaN:Te&&Te[0]==0||!X?Ar*0:Ar/0);for(u?(p=1,f=t.e-r.e):(u=He,p=D,f=Be(t.e/p)-Be(r.e/p)),je=X.length,Oi=Te.length,S=new vt(Ar),k=S.d=[],d=0;X[d]==(Te[d]||0);d++);if(X[d]>(Te[d]||0)&&f--,o==null?(qe=o=vt.precision,s=vt.rounding):a?qe=o+(t.e-r.e)+1:qe=o,qe<0)k.push(1),h=!0;else{if(qe=qe/p+2|0,d=0,je==1){for(c=0,X=X[0],qe++;(d<Oi||c)&&qe--;d++)ii=c*u+(Te[d]||0),k[d]=ii/X|0,c=ii%X|0;h=c||d<Oi}else{for(c=u/(X[0]+1)|0,c>1&&(X=e(X,c,u),Te=e(Te,c,u),je=X.length,Oi=Te.length),yt=je,B=Te.slice(0,je),W=B.length;W<je;)B[W++]=0;Et=X.slice(),Et.unshift(0),Mr=X[0],X[1]>=u/2&&++Mr;do c=0,l=n(X,B,je,W),l<0?(Le=B[0],je!=W&&(Le=Le*u+(B[1]||0)),c=Le/Mr|0,c>1?(c>=u&&(c=u-1),g=e(X,c,u),E=g.length,W=B.length,l=n(g,B,E,W),l==1&&(c--,i(g,je<E?Et:X,E,u))):(c==0&&(l=c=1),g=X.slice()),E=g.length,E<W&&g.unshift(0),i(B,g,W,u),l==-1&&(W=B.length,l=n(X,B,je,W),l<1&&(c++,i(B,je<W?Et:X,W,u))),W=B.length):l===0&&(c++,B=[0]),k[d++]=c,l&&B[0]?B[W++]=Te[yt]||0:(B=[Te[yt]],W=1);while((yt++<Oi||B[0]!==void 0)&&qe--);h=B[0]!==void 0}k[0]||k.shift()}if(p==1)S.e=f,ms=h;else{for(d=1,c=k[0];c>=10;c/=10)d++;S.e=d+f*p-1,T(S,a?o+S.e+1:o,s,h)}return S}}();function T(e,n,i,t){var r,o,s,a,u,l,f,d,c,p=e.constructor;e:if(n!=null){if(d=e.d,!d)return e;for(r=1,a=d[0];a>=10;a/=10)r++;if(o=n-r,o<0)o+=D,s=n,f=d[c=0],u=f/ge(10,r-s-1)%10|0;else if(c=Math.ceil((o+1)/D),a=d.length,c>=a)if(t){for(;a++<=c;)d.push(0);f=u=0,r=1,o%=D,s=o-D+1}else break e;else{for(f=a=d[c],r=1;a>=10;a/=10)r++;o%=D,s=o-D+r,u=s<0?0:f/ge(10,r-s-1)%10|0}if(t=t||n<0||d[c+1]!==void 0||(s<0?f:f%ge(10,r-s-1)),l=i<4?(u||t)&&(i==0||i==(e.s<0?3:2)):u>5||u==5&&(i==4||t||i==6&&(o>0?s>0?f/ge(10,r-s):0:d[c-1])%10&1||i==(e.s<0?8:7)),n<1||!d[0])return d.length=0,l?(n-=e.e+1,d[0]=ge(10,(D-n%D)%D),e.e=-n||0):d[0]=e.e=0,e;if(o==0?(d.length=c,a=1,c--):(d.length=c+1,a=ge(10,D-o),d[c]=s>0?(f/ge(10,r-s)%ge(10,s)|0)*a:0),l)for(;;)if(c==0){for(o=1,s=d[0];s>=10;s/=10)o++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,d[0]==He&&(d[0]=1));break}else{if(d[c]+=a,d[c]!=He)break;d[c--]=0,a=1}for(o=d.length;d[--o]===0;)d.pop()}return w&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function tn(e,n,i){if(!e.isFinite())return vs(e);var t,r=e.e,o=_e(e.d),s=o.length;return n?(i&&(t=i-s)>0?o=o.charAt(0)+"."+o.slice(1)+Tn(t):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):r<0?(o="0."+Tn(-r-1)+o,i&&(t=i-s)>0&&(o+=Tn(t))):r>=s?(o+=Tn(r+1-s),i&&(t=i-r-1)>0&&(o=o+"."+Tn(t))):((t=r+1)<s&&(o=o.slice(0,t)+"."+o.slice(t)),i&&(t=i-s)>0&&(r+1===s&&(o+="."),o+=Tn(t))),o}function Ct(e,n){var i=e[0];for(n*=D;i>=10;i/=10)n++;return n}function kt(e,n,i){if(n>il)throw w=!0,i&&(e.precision=i),Error(ps);return T(new e(Dt),n,1,!0)}function Ze(e,n,i){if(n>qr)throw Error(ps);return T(new e(It),n,i,!0)}function bs(e){var n=e.length-1,i=n*D+1;if(n=e[n],n){for(;n%10==0;n/=10)i--;for(n=e[0];n>=10;n/=10)i++}return i}function Tn(e){for(var n="";e--;)n+="0";return n}function ys(e,n,i,t){var r,o=new e(1),s=Math.ceil(t/D+4);for(w=!1;;){if(i%2&&(o=o.times(n),ds(o.d,s)&&(r=!0)),i=Be(i/2),i===0){i=o.d.length-1,r&&o.d[i]===0&&++o.d[i];break}n=n.times(n),ds(n.d,s)}return w=!0,o}function fs(e){return e.d[e.d.length-1]&1}function Es(e,n,i){for(var t,r=new e(n[0]),o=0;++o<n.length;)if(t=new e(n[o]),t.s)r[i](t)&&(r=t);else{r=t;break}return r}function Vr(e,n){var i,t,r,o,s,a,u,l=0,f=0,d=0,c=e.constructor,p=c.rounding,h=c.precision;if(!e.d||!e.d[0]||e.e>17)return new c(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(n==null?(w=!1,u=h):u=n,a=new c(.03125);e.e>-2;)e=e.times(a),d+=5;for(t=Math.log(ge(2,d))/Math.LN10*2+5|0,u+=t,i=o=s=new c(1),c.precision=u;;){if(o=T(o.times(e),u,1),i=i.times(++f),a=s.plus(Y(o,i,u,1)),_e(a.d).slice(0,u)===_e(s.d).slice(0,u)){for(r=d;r--;)s=T(s.times(s),u,1);if(n==null)if(l<3&&Fi(s.d,u-t,p,l))c.precision=u+=10,i=o=a=new c(1),f=0,l++;else return T(s,c.precision=h,p,w=!0);else return c.precision=h,s}s=a}}function Bn(e,n){var i,t,r,o,s,a,u,l,f,d,c,p=1,h=10,g=e,E=g.d,S=g.constructor,k=S.rounding,B=S.precision;if(g.s<0||!E||!E[0]||!g.e&&E[0]==1&&E.length==1)return new S(E&&!E[0]?-1/0:g.s!=1?NaN:E?0:g);if(n==null?(w=!1,f=B):f=n,S.precision=f+=h,i=_e(E),t=i.charAt(0),Math.abs(o=g.e)<15e14){for(;t<7&&t!=1||t==1&&i.charAt(1)>3;)g=g.times(e),i=_e(g.d),t=i.charAt(0),p++;o=g.e,t>1?(g=new S("0."+i),o++):g=new S(t+"."+i.slice(1))}else return l=kt(S,f+2,B).times(o+""),g=Bn(new S(t+"."+i.slice(1)),f-h).plus(l),S.precision=B,n==null?T(g,B,k,w=!0):g;for(d=g,u=s=g=Y(g.minus(1),g.plus(1),f,1),c=T(g.times(g),f,1),r=3;;){if(s=T(s.times(c),f,1),l=u.plus(Y(s,new S(r),f,1)),_e(l.d).slice(0,f)===_e(u.d).slice(0,f))if(u=u.times(2),o!==0&&(u=u.plus(kt(S,f+2,B).times(o+""))),u=Y(u,new S(p),f,1),n==null)if(Fi(u.d,f-h,k,a))S.precision=f+=h,l=s=g=Y(d.minus(1),d.plus(1),f,1),c=T(g.times(g),f,1),r=a=1;else return T(u,S.precision=B,k,w=!0);else return S.precision=B,u;u=l,r+=2}}function vs(e){return String(e.s*e.s/0)}function $r(e,n){var i,t,r;for((i=n.indexOf("."))>-1&&(n=n.replace(".","")),(t=n.search(/e/i))>0?(i<0&&(i=t),i+=+n.slice(t+1),n=n.substring(0,t)):i<0&&(i=n.length),t=0;n.charCodeAt(t)===48;t++);for(r=n.length;n.charCodeAt(r-1)===48;--r);if(n=n.slice(t,r),n){if(r-=t,e.e=i=i-t-1,e.d=[],t=(i+1)%D,i<0&&(t+=D),t<r){for(t&&e.d.push(+n.slice(0,t)),r-=D;t<r;)e.d.push(+n.slice(t,t+=D));n=n.slice(t),t=D-n.length}else t-=r;for(;t--;)n+="0";e.d.push(+n),w&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function rl(e,n){var i,t,r,o,s,a,u,l,f;if(n.indexOf("_")>-1){if(n=n.replace(/(\d)_(?=\d)/g,"$1"),xs.test(n))return $r(e,n)}else if(n==="Infinity"||n==="NaN")return+n||(e.s=NaN),e.e=NaN,e.d=null,e;if(Ku.test(n))i=16,n=n.toLowerCase();else if(Xu.test(n))i=2;else if(el.test(n))i=8;else throw Error(Dn+n);for(o=n.search(/p/i),o>0?(u=+n.slice(o+1),n=n.substring(2,o)):n=n.slice(2),o=n.indexOf("."),s=o>=0,t=e.constructor,s&&(n=n.replace(".",""),a=n.length,o=a-o,r=ys(t,new t(i),o,o*2)),l=Bt(n,i,He),f=l.length-1,o=f;l[o]===0;--o)l.pop();return o<0?new t(e.s*0):(e.e=Ct(l,f),e.d=l,w=!1,s&&(e=Y(e,r,a*4)),u&&(e=e.times(Math.abs(u)<54?ge(2,u):v.pow(2,u))),w=!0,e)}function ol(e,n){var i,t=n.d.length;if(t<3)return n.isZero()?n:si(e,2,n,n);i=1.4*Math.sqrt(t),i=i>16?16:i|0,n=n.times(1/Mt(5,i)),n=si(e,2,n,n);for(var r,o=new e(5),s=new e(16),a=new e(20);i--;)r=n.times(n),n=n.times(o.plus(r.times(s.times(r).minus(a))));return n}function si(e,n,i,t,r){var o,s,a,u,l=1,f=e.precision,d=Math.ceil(f/D);for(w=!1,u=i.times(i),a=new e(t);;){if(s=Y(a.times(u),new e(n++*n++),f,1),a=r?t.plus(s):t.minus(s),t=Y(s.times(u),new e(n++*n++),f,1),s=a.plus(t),s.d[d]!==void 0){for(o=d;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=t,t=s,s=o,l++}return w=!0,s.d.length=d+1,s}function Mt(e,n){for(var i=e;--n;)i*=e;return i}function Ns(e,n){var i,t=n.s<0,r=Ze(e,e.precision,1),o=r.times(.5);if(n=n.abs(),n.lte(o))return mn=t?4:1,n;if(i=n.divToInt(r),i.isZero())mn=t?3:2;else{if(n=n.minus(i.times(r)),n.lte(o))return mn=fs(i)?t?2:3:t?4:1,n;mn=fs(i)?t?1:4:t?3:2}return n.minus(r).abs()}function zr(e,n,i,t){var r,o,s,a,u,l,f,d,c,p=e.constructor,h=i!==void 0;if(h?(ke(i,1,In),t===void 0?t=p.rounding:ke(t,0,8)):(i=p.precision,t=p.rounding),!e.isFinite())f=vs(e);else{for(f=tn(e),s=f.indexOf("."),h?(r=2,n==16?i=i*4-3:n==8&&(i=i*3-2)):r=n,s>=0&&(f=f.replace(".",""),c=new p(1),c.e=f.length-s,c.d=Bt(tn(c),10,r),c.e=c.d.length),d=Bt(f,10,r),o=u=d.length;d[--u]==0;)d.pop();if(!d[0])f=h?"0p+0":"0";else{if(s<0?o--:(e=new p(e),e.d=d,e.e=o,e=Y(e,c,i,t,0,r),d=e.d,o=e.e,l=ms),s=d[i],a=r/2,l=l||d[i+1]!==void 0,l=t<4?(s!==void 0||l)&&(t===0||t===(e.s<0?3:2)):s>a||s===a&&(t===4||l||t===6&&d[i-1]&1||t===(e.s<0?8:7)),d.length=i,l)for(;++d[--i]>r-1;)d[i]=0,i||(++o,d.unshift(1));for(u=d.length;!d[u-1];--u);for(s=0,f="";s<u;s++)f+=Lr.charAt(d[s]);if(h){if(u>1)if(n==16||n==8){for(s=n==16?4:3,--u;u%s;u++)f+="0";for(d=Bt(f,r,n),u=d.length;!d[u-1];--u);for(s=1,f="1.";s<u;s++)f+=Lr.charAt(d[s])}else f=f.charAt(0)+"."+f.slice(1);f=f+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)f="0"+f;f="0."+f}else if(++o>u)for(o-=u;o--;)f+="0";else o<u&&(f=f.slice(0,o)+"."+f.slice(o))}f=(n==16?"0x":n==2?"0b":n==8?"0o":"")+f}return e.s<0?"-"+f:f}function ds(e,n){if(e.length>n)return e.length=n,!0}function sl(e){return new this(e).abs()}function al(e){return new this(e).acos()}function ul(e){return new this(e).acosh()}function ll(e,n){return new this(e).plus(n)}function fl(e){return new this(e).asin()}function dl(e){return new this(e).asinh()}function cl(e){return new this(e).atan()}function ml(e){return new this(e).atanh()}function pl(e,n){e=new this(e),n=new this(n);var i,t=this.precision,r=this.rounding,o=t+4;return!e.s||!n.s?i=new this(NaN):!e.d&&!n.d?(i=Ze(this,o,1).times(n.s>0?.25:.75),i.s=e.s):!n.d||e.isZero()?(i=n.s<0?Ze(this,t,r):new this(0),i.s=e.s):!e.d||n.isZero()?(i=Ze(this,o,1).times(.5),i.s=e.s):n.s<0?(this.precision=o,this.rounding=1,i=this.atan(Y(e,n,o,1)),n=Ze(this,o,1),this.precision=t,this.rounding=r,i=e.s<0?i.minus(n):i.plus(n)):i=this.atan(Y(e,n,o,1)),i}function hl(e){return new this(e).cbrt()}function gl(e){return T(e=new this(e),e.e+1,2)}function xl(e,n,i){return new this(e).clamp(n,i)}function bl(e){if(!e||typeof e!="object")throw Error(wt+"Object expected");var n,i,t,r=e.defaults===!0,o=["precision",1,In,"rounding",0,8,"toExpNeg",-oi,0,"toExpPos",0,oi,"maxE",0,oi,"minE",-oi,0,"modulo",0,9];for(n=0;n<o.length;n+=3)if(i=o[n],r&&(this[i]=Rr[i]),(t=e[i])!==void 0)if(Be(t)===t&&t>=o[n+1]&&t<=o[n+2])this[i]=t;else throw Error(Dn+i+": "+t);if(i="crypto",r&&(this[i]=Rr[i]),(t=e[i])!==void 0)if(t===!0||t===!1||t===0||t===1)if(t)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[i]=!0;else throw Error(hs);else this[i]=!1;else throw Error(Dn+i+": "+t);return this}function yl(e){return new this(e).cos()}function El(e){return new this(e).cosh()}function _s(e){var n,i,t;function r(o){var s,a,u,l=this;if(!(l instanceof r))return new r(o);if(l.constructor=r,cs(o)){l.s=o.s,w?!o.d||o.e>r.maxE?(l.e=NaN,l.d=null):o.e<r.minE?(l.e=0,l.d=[0]):(l.e=o.e,l.d=o.d.slice()):(l.e=o.e,l.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){l.s=1/o<0?-1:1,l.e=0,l.d=[0];return}if(o<0?(o=-o,l.s=-1):l.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;w?s>r.maxE?(l.e=NaN,l.d=null):s<r.minE?(l.e=0,l.d=[0]):(l.e=s,l.d=[o]):(l.e=s,l.d=[o]);return}else if(o*0!==0){o||(l.s=NaN),l.e=NaN,l.d=null;return}return $r(l,o.toString())}else if(u!=="string")throw Error(Dn+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),l.s=-1):(a===43&&(o=o.slice(1)),l.s=1),xs.test(o)?$r(l,o):rl(l,o)}if(r.prototype=b,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=bl,r.clone=_s,r.isDecimal=cs,r.abs=sl,r.acos=al,r.acosh=ul,r.add=ll,r.asin=fl,r.asinh=dl,r.atan=cl,r.atanh=ml,r.atan2=pl,r.cbrt=hl,r.ceil=gl,r.clamp=xl,r.cos=yl,r.cosh=El,r.div=vl,r.exp=Nl,r.floor=_l,r.hypot=Sl,r.ln=Tl,r.log=Bl,r.log10=Il,r.log2=Dl,r.max=kl,r.min=wl,r.mod=Cl,r.mul=Ml,r.pow=Al,r.random=Ol,r.round=Pl,r.sign=Fl,r.sin=Ll,r.sinh=Rl,r.sqrt=ql,r.sub=Vl,r.sum=$l,r.tan=zl,r.tanh=Ul,r.trunc=Gl,e===void 0&&(e={}),e&&e.defaults!==!0)for(t=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<t.length;)e.hasOwnProperty(i=t[n++])||(e[i]=this[i]);return r.config(e),r}function vl(e,n){return new this(e).div(n)}function Nl(e){return new this(e).exp()}function _l(e){return T(e=new this(e),e.e+1,3)}function Sl(){var e,n,i=new this(0);for(w=!1,e=0;e<arguments.length;)if(n=new this(arguments[e++]),n.d)i.d&&(i=i.plus(n.times(n)));else{if(n.s)return w=!0,new this(1/0);i=n}return w=!0,i.sqrt()}function cs(e){return e instanceof v||e&&e.toStringTag===gs||!1}function Tl(e){return new this(e).ln()}function Bl(e,n){return new this(e).log(n)}function Dl(e){return new this(e).log(2)}function Il(e){return new this(e).log(10)}function kl(){return Es(this,arguments,"lt")}function wl(){return Es(this,arguments,"gt")}function Cl(e,n){return new this(e).mod(n)}function Ml(e,n){return new this(e).mul(n)}function Al(e,n){return new this(e).pow(n)}function Ol(e){var n,i,t,r,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:ke(e,1,In),t=Math.ceil(e/D),this.crypto)if(crypto.getRandomValues)for(n=crypto.getRandomValues(new Uint32Array(t));o<t;)r=n[o],r>=429e7?n[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(n=crypto.randomBytes(t*=4);o<t;)r=n[o]+(n[o+1]<<8)+(n[o+2]<<16)+((n[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(n,o):(a.push(r%1e7),o+=4);o=t/4}else throw Error(hs);else for(;o<t;)a[o++]=Math.random()*1e7|0;for(t=a[--o],e%=D,t&&e&&(r=ge(10,D-e),a[o]=(t/r|0)*r);a[o]===0;o--)a.pop();if(o<0)i=0,a=[0];else{for(i=-1;a[0]===0;i-=D)a.shift();for(t=1,r=a[0];r>=10;r/=10)t++;t<D&&(i-=D-t)}return s.e=i,s.d=a,s}function Pl(e){return T(e=new this(e),e.e+1,this.rounding)}function Fl(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Ll(e){return new this(e).sin()}function Rl(e){return new this(e).sinh()}function ql(e){return new this(e).sqrt()}function Vl(e,n){return new this(e).sub(n)}function $l(){var e=0,n=arguments,i=new this(n[e]);for(w=!1;i.s&&++e<n.length;)i=i.plus(n[e]);return w=!0,T(i,this.precision,this.rounding)}function zl(e){return new this(e).tan()}function Ul(e){return new this(e).tanh()}function Gl(e){return T(e=new this(e),e.e+1,1)}b[Symbol.for("nodejs.util.inspect.custom")]=b.toString;b[Symbol.toStringTag]="Decimal";var v=b.constructor=_s(Rr);Dt=new v(Dt);It=new v(It);var Ur=v;function jl(e){let n=[];for(let i=0;i<e.length;i++){let t=e.charCodeAt(i);if(t>=55296&&t<=56319){let r=e.charCodeAt(i+1);if(r>=56320&&r<=57343){let o=t-55296,s=r-56320;t=2**16+o*2**10+s,i++}}n.push(t)}return n}var At=8205,Ss=[127462,127487];function Ts(e){return e===At||e===65038||e===65039||e>=127995&&e<=127995+5||e>=129456&&e<=129456+4||e>=917536&&e<=917536+96}function Zl(e){return e>=Ss[0]&&e<=Ss[1]}function Bs(e){if(/^[\u0020-\u00FF]*$/.test(e))return e;let n=[],i=jl(e),t=0;for(;t<i.length;){let r=i[t++],o=i[t];if(o===At){let s=t-1;for(t+=2;i[t]===At;)t+=2;n.push(String.fromCodePoint(...i.slice(s,2*t-s+1)))}else if(Ts(o)){let s=t-1;for(;Ts(i[t]);)t+=i[t]===At?2:1;n.push(String.fromCodePoint(...i.slice(s,2*t-s-1)))}else Zl(r)?(t+=1,n.push(String.fromCodePoint(...i.slice(t-2,2)))):n.push(String.fromCodePoint(r))}return n}var Gr=class{constructor(n){this.obeyspaces=!1;n=n.replace(/[\u200E\u200F\u2066-\u2069\u202A-\u202E]/g,""),this.s=Bs(n),this.pos=0}end(){return this.pos>=this.s.length}get(){return this.pos<this.s.length?this.s[this.pos++]:""}peek(){return this.s[this.pos]}match(n){let i;return typeof this.s=="string"?i=n.exec(this.s.slice(this.pos)):i=n.exec(this.s.slice(this.pos).join("")),i?.[0]?(this.pos+=i[0].length,i[0]):null}next(){if(this.end())return null;if(!this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]+/))return"<space>";if(this.obeyspaces&&this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]/))return"<space>";let n=this.get();if(n==="\\"){if(!this.end()){let i=this.match(/^[a-zA-Z*]+/);if(i)this.match(/^[ \f\n\r\t\v\xA0\u2028\u2029]*/);else if(i=this.get(),i===" ")return"<space>";return"\\"+i}}else{if(n==="{")return"<{>";if(n==="}")return"<}>";if(n==="^"){if(this.peek()==="^"){this.get();let i=this.match(/^(\^(\^(\^(\^[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f])?[0-9a-f][0-9a-f]/);if(i)return String.fromCodePoint(parseInt(i.slice(i.lastIndexOf("^")+1),16))}return n}else if(n==="#"){if(!this.end()){let i=!1;if(/[0-9?]/.test(this.peek())&&(i=!0,this.pos+1<this.s.length)){let t=this.s[this.pos+1];i=/[^0-9A-Za-z]/.test(t)}return i?"#"+this.get():"#"}}else if(n==="$")return this.peek()==="$"?(this.get(),"<$$>"):"<$>"}return n}};function Hl(e,n){let i=e.next();if(!i)return[];let t=[];if(i!=="\\relax"){if(i==="\\noexpand")i=e.next(),i&&t.push(i);else if(i==="\\obeyspaces")e.obeyspaces=!0;else if(i==="\\space"||i==="~")t.push("<space>");else if(i==="\\bgroup")t.push("<{>");else if(i==="\\egroup")t.push("<}>");else if(i==="\\string")i=e.next(),i&&(i[0]==="\\"?Array.from(i).forEach(r=>t.push(r==="\\"?"\\backslash":r)):i==="<{>"?t.push("\\{"):i==="<space>"?t.push("~"):i==="<}>"&&t.push("\\}"));else if(i==="\\csname"){for(;e.peek()==="<space>";)e.next();let r="",o=!1,s=[];do{if(s.length===0)if(/^#[0-9?]$/.test(e.peek())){let a=e.get().slice(1);s=$(n?.[a]??n?.["?"]??"\\placeholder{}",n),i=s[0]}else i=e.next(),s=i?[i]:[];o=s.length===0,!o&&i==="\\endcsname"&&(o=!0,s.shift()),o||(o=i==="<$>"||i==="<$$>"||i==="<{>"||i==="<}>"||!!i&&i.length>1&&i[0]==="\\"),o||(r+=s.shift())}while(!o);r&&t.push("\\"+r),t=t.concat(s)}else if(i!=="\\endcsname")if(i.length>1&&i[0]==="#"){let r=i.slice(1);t=t.concat($(n?.[r]??n?.["?"]??"\\placeholder{}",n))}else t.push(i)}return t}function $(e,n){let i=e.toString().split(/\r?\n/),t="",r="";for(let a of i){t+=r,r=" ";let u=a.match(/((?:\\%)|[^%])*/);u!==null&&(t+=u[0])}let o=new Gr(t),s=[];do s.push(...Hl(o,n));while(!o.end());return s}function Ot(e){return $(e,[]).length}function N(e){let n="",i="";for(let t of e)t&&(/[a-zA-Z*]/.test(t[0])&&(i+=n),/\\[a-zA-Z]+\*?$/.test(t)?n=" ":n="",i+=t);return i}function rn(e){let n=[];if(Array.isArray(e))for(let t of e)Array.isArray(t)?n=[...n,...t]:n.push(t);else n=[e];return N(n.map(t=>({"<space>":" ","<$$>":"$$","<$>":"$","<{>":"{","<}>":"}"})[t]??t))}var Ds=[{name:"To",latexTrigger:["\\to"],kind:"infix",precedence:270},{latexTrigger:["\\rightarrow"],kind:"infix",precedence:270,parse:"To"}];var Vn=["Error","'missing'"];function $n(e){return e===null?!1:!!(typeof e=="number"||ai(e)||typeof e=="string"&&/^[+-]?[0-9\.]/.test(e))}function ai(e){return e!==null&&typeof e=="object"&&"num"in e}function ui(e){return e!==null&&typeof e=="object"&&"sym"in e}function Cs(e){return e!==null&&typeof e=="object"&&"str"in e}function li(e){return e!==null&&typeof e=="object"&&"fn"in e}var jr;function Ms(e){if(!jr){let i=`^[${["Zyyy","Zinh","Arab","Armn","Beng","Bopo","Cyrl","Deva","Ethi","Geor","Grek","Gujr","Guru","Hang","Hani","Hebr","Hira","Kana","Knda","Khmr","Laoo","Latn","Mlym","Mymr","Orya","Sinh","Taml","Telu","Thaa","Thai","Tibt"].map(t=>`\\p{Script=${t}}`).join("")}]*$`;jr=new RegExp(i,"u")}return jr.test(e)}function xe(e){return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(e)||fi.test(e)?!0:Ms(e)?/^[\p{XIDS}_]\p{XIDC}*$/u.test(e):!1}var Jl="\\u{FE0F}",Wl="\\u{20E3}",Yl="\\u{200D}",Ql="\\p{RI}\\p{RI}",Xl="(?:[\\u{E0020}-\\u{E007E}]+\\u{E007F})",Is=`(?:\\p{EMod}|${Jl}${Wl}?|${Xl})`,Kl="(?:(?=\\P{XIDC})\\p{Emoji})",ks=`(?:${Kl}${Is}*|\\p{Emoji}${Is}+|${Ql})`,As=`(?:${ks})(${Yl}${ks})*`,ef=new RegExp(`(?:${As})+`,"u"),fi=new RegExp(`^(?:${As})+$`,"u");function We(e){return typeof e!="string"?"not-a-string":e===""?"empty-string":e.normalize()!==e?"expected-nfc":/[\u200E\u200F\u2066-\u2069\u202A-\u202E]/.test(e)?"unexpected-bidi-marker":fi.test(e)?"valid":/\p{XIDC}/u.test(e)&&ef.test(e)?"unexpected-mixed-emoji":Ms(e)?xe(e)?"valid":xe(e[0])?"invalid-char":"invalid-first-char":"unexpected-script"}function z(e){return e==null?null:typeof e=="object"&&"str"in e?e.str:typeof e!="string"||e.length<2||e[0]!=="'"||e[e.length-1]!=="'"?null:e.substring(1,e.length-1)}function Hr(e){if(e==null||z(e)!==null)return null;let n=x(e);return n!==null?[n,...(_(e)??[]).map(i=>Hr(i)).filter(i=>i!==null)]:e}function x(e){return e==null?null:Array.isArray(e)?typeof e[0]=="string"&&!xe(e[0])?(console.error(`Invalid identifier "${e[0]}": ${We(e[0])}`),null):e[0]:li(e)?e.fn[0]:null}function Jr(e){let n=x(e);return typeof n=="string"?n:""}function _(e){return e==null?null:Array.isArray(e)?e.slice(1):li(e)?e.fn.slice(1):null}function m(e,n){return e==null?null:Array.isArray(e)?e[n]??null:li(e)?e.fn[n]??null:null}function Se(e){return m(e,1)}function Je(e){return m(e,2)}function G(e){return e==null?0:Array.isArray(e)?Math.max(0,e.length-1):li(e)?Math.max(0,e.fn.length-1):0}function Wr(e){return e==null?null:x(e)==="Hold"?m(e,1):e}function V(e){if(e==null||typeof e=="string"&&(/^[+\-\.0-9]/.test(e)||e.length>=2&&e[0]==="'"&&e[e.length-1]==="'"))return null;let n=ui(e)?e.sym:e;return typeof n!="string"?null:n}function ws(e){let n=x(e);if(n==="KeyValuePair"||n==="Tuple"||n==="Pair"){let i=z(Se(e));return i?[i,Je(e)??"Nothing"]:null}return null}function zn(e){if(e===null)return null;if(typeof e=="object"&&"dict"in e)return e.dict;let n=ws(e);if(n)return{[n[0]]:n[1]};if(x(e)==="Dictionary"){let t={};for(let r=1;r<G(e);r++){let o=ws(m(e,r));o&&(t[o[0]]=o[1])}return t}return null}function nf(e){if(e=e.toLowerCase().replace(/[nd]$/g,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,""),e==="nan")return NaN;if(e==="+infinity")return 1/0;if(e==="-infinity")return-1/0;if(/\([0-9]+\)/.test(e)){let[n,i,t,r]=e.match(/(.+)\(([0-9]+)\)(.*)$/)??[];e=i+t.repeat(Math.ceil(16/t.length))+(r??"")}return parseFloat(e)}function O(e){return e==null?null:typeof e=="number"?e:typeof e=="string"?nf(e):ai(e)?O(e.num):null}function di(e){if(e==null)return null;if(V(e)==="Half")return[1,2];let n=x(e);if(!n)return null;let i=null,t=null;if(n==="Negate"){let r=di(Se(e));if(r)return[-r[0],r[1]]}if((n==="Rational"||n==="Divide")&&(i=O(Se(e))??NaN,t=O(Je(e))??NaN),n==="Power"){let r=O(Je(e));r===1?(i=O(Se(e)),t=1):r===-1&&(i=1,t=O(Se(e)))}return n==="Multiply"&&x(Je(e))==="Power"&&O(Je(Je(e)))===-1&&(i=O(Se(e)),t=O(Se(Je(e)))),i===null||t===null?null:Number.isInteger(i)&&Number.isInteger(t)?[i,t]:null}function Li(e,n){let i=x(e);if(i!==null)return[Li(i,n),...(_(e)??[]).map(o=>Li(o,n))];let t=zn(e);if(t!==null){let o=Object.keys(t),s={};for(let a of o)s[a]=Li(t[a],n);return{dict:s}}let r=V(e);return r&&n[r]?n[r]:e}function Ri(e,n){let i=null;if(Array.isArray(e)&&(i=e),li(e)&&(i=e.fn),i===null)return[];let t=1,r=[];for(;t<i.length;)r.push(n(i[t])),t+=1;return r}function ci(e,n,i,t="both"){if(t==="non")return[e,n,i];let r=x(n),o=x(i);return t==="left"?r===e?[e,..._(n)??[],i]:[e,n,i]:t==="right"?o===e?[e,n,..._(i)??[]]:[e,n,i]:r===e&&o===e?[e,..._(n)??[],..._(i)??[]]:r===e?[e,..._(n)??[],i]:o===e?[e,n,..._(i)??[]]:[e,n,i]}function Pt(e){if(e===null)return null;let n=x(e);if(n==="Delimiter"){if(e=m(e,1),e===null)return[];if(n=x(e),n!=="Sequence")return[e]}return n!=="Sequence"?null:_(e)??[]}function ne(e){return x(e)==="Sequence"&&G(e)===0}function j(e){return ne(e)?Vn:e??Vn}function Zr(e){return e[0]==="Square"?Zr(e.slice(1))+2:e.reduce((n,i)=>n+qi(i),0)}function qi(e){if(e===null)return 0;if(typeof e=="number"||typeof e=="string"||$n(e)||ui(e)||Cs(e))return 1;if(Array.isArray(e))return Zr(e);if("fn"in e)return Zr(e.fn);let n=zn(e);if(n){let i=Object.keys(n);return 1+i.length+i.reduce((t,r)=>t+qi(n[r]),0)}return 0}function Os(e,n){return"paren"}function Ps(e,n){return"paren"}function kn(e,n){return n>2?"solidus":"radical"}function Ft(e,n){if(n>3)return"inline-solidus";if(x(e)==="Divide"){let[i,t]=[qi(Se(e)),qi(Je(e))];if(t<=2&&i>5)return"factor";if(i<=2&&t>5)return"reciprocal"}return"quotient"}function Fs(e,n){return"boolean"}function Ls(e,n){return"solidus"}function Rs(e,n){return"compact"}function tf(e){if(x(e)!=="Multiply")return[[],[]];let n=[],i=[],t=_(e)??[];for(let r of t)if(x(r)==="Power"){let o=m(r,1),s=m(r,2);if(x(s)==="Negate"){let a=m(s,1);o&&a&&i.push(["Power",o,a])}else{let a=O(s)??NaN;a===-1?o&&i.push(o):a<0?o&&i.push(["Power",o,-a]):n.push(r)}}else if(x(r)==="Rational"&&G(r)===2){let o=m(r,1),s=m(r,2);O(o)!==1&&n.push(o),O(s)!==1&&i.push(s)}else{let o=di(r);o!==null?(o[0]!==1&&n.push(o[0]),i.push(o[1])):n.push(r)}return[n,i]}function rf(e){let n=e.parseOptionalGroup(),i=e.parseGroup()??e.parseToken();return i===null||ne(i)?n!==null?["Root",Vn,j(n)]:["Sqrt",Vn]:n!==null?["Root",i,n]:["Sqrt",i]}function Vi(e,n,i,t){return i===null?"\\sqrt{}":(t=t??2,n==="solidus"?e.wrapShort(i)+"^{1\\/"+e.serialize(t)+"}":n==="quotient"?e.wrapShort(i)+"^{\\frac{1}{"+e.serialize(t)+"}}":O(t)===2?"\\sqrt{"+e.serialize(i)+"}":"\\sqrt["+e.serialize(t)+"]{"+e.serialize(i)+"}")}function of(e,n){e.level-=1;let i=x(n),t="",r=m(n,1);if(i==="Negate")t="-"+e.wrap(r,276);else if(i==="Add"){if(e.canonical&&G(n)===2&&e.options.invisiblePlus!=="+"){let[a,u]=[m(n,1),m(n,2)],[l,f]=[a,u],d=O(l),c=di(f);if((d===null||c===null)&&([l,f]=[u,a],d=O(l),c=di(f)),d!==null&&c!==null&&isFinite(d)&&Number.isInteger(d)&&d>=0&&d<=1e3&&isFinite(c[0])&&isFinite(c[1])&&c[0]>0&&c[0]<=100&&c[1]<=100)return t=N([e.serialize(l),e.options.invisiblePlus,e.serialize(f)]),e.level+=1,t}let o=O(r)??NaN;t=e.serialize(r);let s=G(n)+1;for(let a=2;a<s;a++)if(r=m(n,a),o=O(r)??NaN,o<0)t+=e.serialize(r);else if(x(r)==="Negate")t+=e.wrap(r,ue);else{let u=e.wrap(r,ue);u[0]==="-"||u[0]==="+"?t+=u:t+="+"+u}}else if(i==="Subtract"){t=e.wrap(r,ue);let o=m(n,2);if(o!==null){let s=e.wrap(o,ue);s[0]==="-"?t+="+"+s.slice(1):s[0]==="+"?t+="-"+s.slice(1):t=t+"-"+s}}return e.level+=1,t}function Us(e,n){if(n===null)return"";e.level-=1;let i="";if(e.canonical===!0){let[a,u]=tf(n);u.length>0&&(u.length===1&&u[0]===1?a.length===0?i="1":a.length===1?i=e.serialize(a[0]):i=Us(e,["Multiply",...a]):i=e.serialize(["Divide",a.length===1?a[0]:["Multiply",...a],u.length===1?u[0]:["Multiply",...u]]))}if(i)return e.level+=1,i;let t=!1,r=null,o=G(n)+1,s=!1;for(let a=1;a<o;a++){if(r=m(n,a),r===null)continue;let u;if($n(r)){u=e.serialize(r),u==="-1"&&!i?(i="",t=!t):(u[0]==="-"&&(u=u.slice(1),t=!t),i=i?N([i,e.options.multiply,u]):u),s=!0;continue}if(x(r)==="Power"){let l=di(m(r,2));if(l){let[f,d]=l;if(f===1&&d!==null){i+=Vi(e,kn(r,e.level),m(r,1),d),s=!1;continue}}}if(x(r)==="Power"&&!isNaN(O(m(r,1))??NaN)){u=e.serialize(r),i=i?N([i,e.options.multiply,u]):u,s=!0;continue}if(x(r)==="Negate"&&(r=m(r,1),t=!t),u=e.wrap(r,Ve),!i)i=u;else{let l=x(r);s&&(l==="Divide"||l==="Rational")?i=N([i,e.options.multiply,u]):e.options.invisibleMultiply?i=N([i,e.options.invisibleMultiply,u]):i=N([i,u])}s=!1}return e.level+=1,t?"-"+i:i}function sf(e){let n=e.parseGroup(),i=null;if(n===null?(n=e.parseToken(),i=e.parseToken()):i=e.parseGroup(),n=j(n),i=j(i),x(n)==="PartialDerivative"&&(x(i)==="PartialDerivative"||x(i)==="Multiply"&&x(m(i,1))==="PartialDerivative")){let t=m(n,3)??null,r=m(n,1);r===null&&(r=j(e.parseExpression()));let o=[];if(x(i)==="Multiply"){for(let s of _(i)??[])if(x(s)==="PartialDerivative"){let a=m(s,2);a&&o.push(a)}}else{let s=m(i,2);s&&o.push(s)}return o.length>1&&(o=["List",...o]),["PartialDerivative",r,...o,t===null?1:t]}return["Divide",n,i]}function qs(e,n){if(n===null)return"";let i=j(m(n,1)),t=j(m(n,2)),r=e.canonical?Ft(n,e.level):"quotient";if(r==="inline-solidus"||r==="nice-solidus"){let u=e.wrapShort(i),l=e.wrapShort(t);return r==="inline-solidus"?`${u}\\/${l}`:`{}^{${u}}\\!\\!/\\!{}_{${l}}`}else{if(r==="reciprocal")return O(i)===1?e.wrap(t)+"^{-1}":e.wrap(i)+e.wrap(t)+"^{-1}";if(r==="factor")return O(t)===1?e.wrap(i):"\\frac{1}{"+e.serialize(t)+"}{"+e.wrap(i)+"}"}let o="\\frac";r==="block-quotient"?o="\\dfrac":r==="inline-quotient"&&(o="\\tfrac");let s=e.serialize(i),a=e.serialize(t);return`${o}{${s}}{${a}}`}function Yr(e,n){let i=x(n),t=j(m(n,1));if(i==="Sqrt")return Vi(e,kn(n,e.level-1),t,2);let r=j(m(n,2));if(i==="Root")return Vi(e,kn(n,e.level-1),t,r);if(e.canonical){let o=O(r)??1;if(o===-1)return e.serialize(["Divide","1",t]);if(o<0)return e.serialize(["Divide","1",["Power",t,-o]]);if(x(r)==="Divide"||x(r)==="Rational"){if(O(m(r,1))===1){let s=kn(n,e.level);return Vi(e,s,t,m(r,2))}if(O(m(r,2))===2)return`${e.serialize(["Sqrt",t])}^{${e.serialize(m(r,1))}}`}else if(x(r)==="Power"&&O(m(r,2))===-1){let s=kn(n,e.level);return Vi(e,s,t,m(r,1))}}return e.wrapShort(t)+"^{"+e.serialize(r)+"}"}var Gs=[{name:"CatalanConstant",identifierTrigger:"G"},{name:"GoldenRatio",latexTrigger:"\\varphi"},{name:"EulerGamma",latexTrigger:"\\gamma"},{name:"Degrees",latexTrigger:["\\degree"],kind:"postfix",precedence:880,parse:(e,n)=>["Degrees",n],serialize:(e,n)=>N([e.serialize(m(n,1)),"\\degree"])},{latexTrigger:["\\degree"],kind:"postfix",precedence:880,parse:(e,n)=>["Degrees",n]},{latexTrigger:["^","<{>","\\circ","<}>"],kind:"postfix",parse:(e,n)=>["Degrees",n]},{latexTrigger:["^","\\circ"],kind:"postfix",parse:(e,n)=>["Degrees",n]},{latexTrigger:["\xB0"],kind:"postfix",precedence:880,parse:(e,n)=>["Degrees",n]},{latexTrigger:["\\ang"],parse:e=>{let n=e.parseGroup();return n===null?["Degrees"]:["Degrees",n]}},{latexTrigger:["\\infty"],parse:{num:"+Infinity"}},{name:"ComplexInfinity",latexTrigger:["\\tilde","\\infty"],serialize:"\\tilde\\infty"},{latexTrigger:["\\tilde","<{>","\\infty","<}>"],parse:"ComplexInfinity"},{name:"Pi",kind:"symbol",latexTrigger:["\\pi"]},{latexTrigger:["\u03C0"],parse:"Pi"},{name:"ExponentialE",latexTrigger:["\\exponentialE"],parse:"ExponentialE",serialize:"\\exponentialE"},{latexTrigger:"\\operatorname{e}",parse:"ExponentialE"},{latexTrigger:"\\mathrm{e}",parse:"ExponentialE"},{kind:"function",identifierTrigger:"exp",parse:"Exp"},{latexTrigger:"\\exp",parse:"Exp"},{name:"ImaginaryUnit",latexTrigger:["\\imaginaryI"]},{latexTrigger:"\\operatorname{i}",parse:"ImaginaryUnit"},{latexTrigger:"\\mathrm{i}",parse:"ImaginaryUnit"},{name:"Abs",kind:"matchfix",openTrigger:"|",closeTrigger:"|",parse:(e,n)=>ne(n)?null:["Abs",n]},{identifierTrigger:"abs",kind:"function",parse:"Abs"},{name:"Add",latexTrigger:["+"],kind:"infix",associativity:"both",precedence:ue,parse:(e,n,i)=>{if(i&&ue<i.minPrec)return null;let t=e.parseExpression({...i,minPrec:ue});return t===null?null:ci("Add",n,t)},serialize:of},{kind:"prefix",latexTrigger:["+"],precedence:ue,parse:(e,n)=>n&&ue<n.minPrec?null:e.parseExpression({...n,minPrec:400})},{name:"Ceil",kind:"matchfix",openTrigger:"\\lceil",closeTrigger:"\\rceil",parse:(e,n)=>ne(n)?null:["Ceil",n]},{kind:"matchfix",openTrigger:["\u2308"],closeTrigger:["\u2309"],parse:(e,n)=>ne(n)?null:["Ceil",n]},{identifierTrigger:"ceil",kind:"function",parse:"Ceil"},{name:"Chop",identifierTrigger:"chop",kind:"function",parse:"Chop"},{name:"Complex",precedence:ue-1,serialize:(e,n)=>{let i=O(m(n,1)),t=O(m(n,2));if(t===0)return e.serialize(m(n,1));let r=t===1?"\\imaginaryI":t===-1?"-\\imaginaryI":N([e.serialize(m(n,2)),"\\imaginaryI"]);return i===0?r:t!==null&&t<0?N([e.serialize(m(n,1)),r]):N([e.serialize(m(n,1)),"+",r])}},{name:"Divide",latexTrigger:"\\frac",precedence:nn,parse:sf,serialize:qs},{kind:"infix",latexTrigger:"\\over",precedence:nn,parse:"Divide"},{latexTrigger:["\\/"],kind:"infix",associativity:"non",precedence:nn,parse:"Divide"},{latexTrigger:["/"],kind:"infix",associativity:"non",precedence:nn,parse:"Divide"},{latexTrigger:["\\div"],kind:"infix",associativity:"non",precedence:nn,parse:"Divide"},{name:"Exp",serialize:(e,n)=>{let i=m(n,1);return V(i)||O(i)!==null?N(["\\exponentialE^{",e.serialize(i)]):N(["\\exp",e.wrap(j(i))])}},{name:"Factorial",latexTrigger:["!"],kind:"postfix",precedence:_t},{name:"Factorial2",latexTrigger:["!","!"],kind:"postfix",precedence:_t},{name:"Floor",kind:"matchfix",openTrigger:"\\lfloor",closeTrigger:"\\rfloor",parse:(e,n)=>ne(n)?null:["Floor",n]},{kind:"matchfix",openTrigger:["\u230A"],closeTrigger:["\u230B"],parse:(e,n)=>ne(n)?null:["Floor",n]},{identifierTrigger:"floor",kind:"function",parse:"Floor"},{latexTrigger:["\\Gamma"],parse:"Gamma"},{name:"GCD",identifierTrigger:"gcd",kind:"function"},{identifierTrigger:"GCD",kind:"function",parse:"GCD"},{name:"Half",serialize:"\\frac12"},{name:"Lg",latexTrigger:["\\lg"],serialize:(e,n)=>"\\log_{10}"+e.wrapArguments(n),parse:e=>{let n=e.parseArguments("implicit");return n===null?"Lg":["Log",...n,10]}},{name:"Lb",latexTrigger:"\\lb",parse:e=>{let n=e.parseArguments("implicit");return n===null?"Log":["Log",...n,2]}},{name:"Ln",latexTrigger:["\\ln"],serialize:(e,n)=>"\\ln"+e.wrapArguments(n),parse:e=>zs("Ln",e)},{name:"Log",latexTrigger:["\\log"],parse:e=>zs("Log",e),serialize:(e,n)=>{let i=Je(n);return i?N(["\\log_{",i.toString(),"}",e.wrap(Se(n))]):"\\log"+e.wrapArguments(n)}},{name:"LCM",identifierTrigger:"lcm",kind:"function"},{identifierTrigger:"LCM",kind:"function",parse:"LCM"},{identifierTrigger:"max",kind:"function",parse:"Max"},{identifierTrigger:"min",kind:"function",parse:"Min"},{name:"Max",latexTrigger:"\\max",kind:"function"},{name:"Min",latexTrigger:"\\min",kind:"function"},{name:"Supremum",latexTrigger:"\\sup",kind:"function"},{name:"Infimum",latexTrigger:"\\inf",kind:"function"},{name:"Limit",latexTrigger:"\\lim",kind:"expression",parse:e=>{if(!e.match("_"))return;let n=e.parseGroup();if(x(n)!=="To")return;let i=e.parseArguments("implicit");if(i)return["Limit",["Function",i[0],m(n,1)],m(n,2)]},serialize:(e,n)=>{let i=m(n,1),t=m(i,2),r=m(n,2);return N(["\\lim_{",e.serialize(t),"\\to",e.serialize(r),"}",e.serialize(m(i,1))])}},{name:"MinusPlus",latexTrigger:["\\mp"],kind:"infix",associativity:"both",precedence:en},{name:"Multiply",latexTrigger:["\\times"],kind:"infix",associativity:"both",precedence:Ve,serialize:Us},{latexTrigger:["\\cdot"],kind:"infix",associativity:"both",precedence:Ve,parse:(e,n,i)=>{let t=e.parseExpression({...i,minPrec:Ve+2});return t===null?["Multiply",n,Vn]:ci("Multiply",n,t)}},{latexTrigger:["*"],kind:"infix",associativity:"both",precedence:Ve,parse:(e,n,i)=>{let t=e.parseExpression({...i,minPrec:Ve+2});return t===null?["Multiply",n,Vn]:ci("Multiply",n,t)}},{name:"Mod",latexTrigger:"\\bmod",kind:"infix",precedence:nn,serialize:(e,n)=>{if(G(n)!==2)return"";let i=e.serialize(m(n,1)),t=e.serialize(m(n,2));return N([i,"\\bmod",t])}},{latexTrigger:"\\mod",kind:"infix",precedence:nn,parse:"Mod"},{latexTrigger:"\\pmod",kind:"prefix",precedence:M,parse:e=>{let n=e.parseGroup()??e.parseToken();return["Mod",j(n)]}},{name:"Congruent",serialize:(e,n)=>{let i=e.serialize(m(n,1)),t=e.serialize(m(n,2));if(m(n,3)===null)return N([i,"\\equiv",t]);let r=e.serialize(m(n,3));return N([i,"\\equiv",t,"\\pmod{",r,"}"])}},{name:"Negate",latexTrigger:["-"],kind:"prefix",precedence:ue,parse:(e,n)=>{if(/\d/.test(e.peek))return null;let i=e.index;if(e.parseNumber()!==null)return e.index=i,null;let t=e.parseExpression({...n,minPrec:ue+1});return["Negate",j(t)]}},{kind:"matchfix",openTrigger:"||",closeTrigger:"||",parse:(e,n)=>ne(n)?null:["Norm",n]},{name:"Norm",kind:"matchfix",openTrigger:["\\left","\\Vert"],closeTrigger:["\\right","\\Vert"],parse:(e,n)=>ne(n)?null:["Norm",n]},{name:"PlusMinus",latexTrigger:["\\pm"],kind:"infix",associativity:"both",precedence:en,serialize:(e,n)=>{let i=m(n,1);if(i===null)return"\\pm";if(G(n)===1)return N(["\\pm",e.serialize(i)]);let t=m(n,2);return N([e.serialize(i),"\\pm",e.serialize(t)])}},{latexTrigger:["\\pm"],kind:"prefix",precedence:en,parse:(e,n)=>{let i=e.parseExpression({...n,minPrec:400});return["PlusMinus",j(i)]}},{latexTrigger:["\\plusmn"],kind:"infix",associativity:"both",precedence:en,parse:(e,n,i)=>{let t=e.parseExpression({...i,minPrec:400});return["PlusMinus",n,j(t)]}},{latexTrigger:["\\plusmn"],kind:"prefix",precedence:en,parse:(e,n)=>{let i=e.parseExpression({...n,minPrec:400});return["PlusMinus",j(i)]}},{name:"Power",latexTrigger:["^"],kind:"infix",serialize:Yr},{latexTrigger:"\\prod",precedence:Ve,name:"Product",parse:Vs("Product",Ve),serialize:$s("\\prod")},{name:"Rational",precedence:nn,serialize:(e,n)=>n&&G(n)===1?"\\operatorname{Rational}"+e.wrapArguments(n):qs(e,n)},{name:"Root",serialize:Yr},{name:"Round",identifierTrigger:"round",kind:"function"},{name:"Square",precedence:720,serialize:(e,n)=>e.wrapShort(m(n,1))+"^2"},{latexTrigger:["\\sum"],precedence:ue,name:"Sum",parse:Vs("Sum",ue),serialize:$s("\\sum")},{name:"Sign",identifierTrigger:"sgn",kind:"function"},{name:"Sqrt",latexTrigger:["\\sqrt"],parse:rf,serialize:Yr},{name:"Subtract",latexTrigger:["-"],kind:"infix",associativity:"both",precedence:ue,parse:(e,n,i)=>{let t=e.parseExpression({...i,minPrec:ue+2});return["Subtract",n,j(t)]}}];function Vs(e,n){return i=>{i.skipSpace();let t=null,r=null;for(;!(r&&t)&&(i.peek==="_"||i.peek==="^");)i.match("_")?r=i.parseGroup()??i.parseToken():i.match("^")&&(t=i.parseGroup()??i.parseToken()),i.skipSpace();(r==="Nothing"||ne(r))&&(r=null),(t==="Nothing"||ne(t))&&(t=null);let o=null,s=null;x(r)==="Equal"?(o=m(r,1),s=m(r,2)):o=r;let a=i.parseExpression({minPrec:n+1});return a?t?[e,a,["Tuple",o??"Nothing",s??1,t]]:s?[e,a,["Tuple",o??"Nothing",s]]:o?[e,a,["Tuple",o]]:[e,a]:[e]}}function $s(e){return(n,i)=>{if(!m(i,1))return e;let t=m(i,2),r=x(t);r!=="Tuple"&&r!=="Triple"&&r!=="Pair"&&r!=="Single"&&(t=null);let o=m(t,1);o&&x(o)==="Hold"&&(o=m(o,1));let s=m(i,1);if(!t)return m(i,2)?N([e,"_{",n.serialize(m(i,2)),"}",n.serialize(s)]):N([e,n.serialize(s)]);let a=m(t,2),u=[];o&&V(o)!=="Nothing"&&a?u=[n.serialize(o),"=",n.serialize(a)]:o&&V(o)!=="Nothing"?u=[n.serialize(o)]:a&&(u=[n.serialize(a)]),u.length>0&&(u=["_{",...u,"}"]);let l=[];return m(t,3)&&(l=["^{",n.serialize(m(t,3)),"}"]),N([e,...l,...u,n.serialize(s)])}}function zs(e,n){let i=null,t=null;n.match("_")&&(i=n.parseStringGroup()?.trim()??n.nextToken(),t=Number.parseFloat(i??"10"));let r=n.parseArguments("implicit");return r===null?e:t===10?["Log",r[0]]:t===2?["Lb",...r]:i===null?[e,...r]:["Log",...r,i]}function Qr(e,n,i,t,r){if(n.minPrec>=t)return null;let o=i?[i]:["Nothing"],s=!1;for(;!s;){for(s=!0,e.skipSpace();e.match(r);)o.push("Nothing"),e.skipSpace();if(e.atTerminator(n))o.push("Nothing");else{let a=e.parseExpression({...n,minPrec:t});o.push(a??"Nothing"),s=a===null}s||(e.skipSpace(),s=!e.match(r))}return o}function Lt(e=""){return(n,i)=>{if(!i)return"";let t=_(i)??[];if(t.length===0)return"";if(t.length===1)return n.serialize(t[0]);e={"&":"\\&",":":"\\colon","|":"\\mvert","-":"-","\xB7":"\\cdot","\u2012":"-","\u2013":"--","\u2014":"---","\u2015":"-","\u2022":"\\bullet","\u2026":"\\ldots"}[e]??e;let r=t.reduce((o,s)=>(o.push(n.serialize(s),e),o),[]);return r.pop(),N(r)}}var js=[{latexTrigger:["\\placeholder"],kind:"symbol",parse:e=>{for(;e.match("<space>"););if(e.match("["))for(;!e.match("]")&&!e.atBoundary;)e.nextToken();for(;e.match("<space>"););if(e.match("<{>"))for(;!e.match("<}>")&&!e.atBoundary;)e.nextToken();return"Nothing"}},{name:"Function",latexTrigger:["\\mapsto"],kind:"infix",precedence:en,parse:(e,n)=>{let i=[];if(x(n)==="Delimiter"&&(n=m(n,1)??"Nothing"),x(n)==="Sequence")for(let r of _(n)??[]){if(!V(r))return null;i.push(V(r))}else{if(!V(n))return null;i=[V(n)]}let t=e.parseExpression({minPrec:en})??"Nothing";return x(t)==="Delimiter"&&(t=m(t,1)??"Nothing"),x(t)==="Sequence"&&(t=["Block",..._(t)??[]]),["Function",t,...i]},serialize:(e,n)=>{let i=_(n);return i===null||i.length<1?"()\\mapsto()":i.length===1?N(["()","\\mapsto",e.serialize(m(n,1))]):i.length===2?N([e.serialize(m(n,2)),"\\mapsto",e.serialize(m(n,1))]):N([e.wrapString((_(n)?.slice(1)??[]).map(t=>e.serialize(t)).join(", "),"paren"),"\\mapsto",e.serialize(m(n,1))])}},{name:"Apply",kind:"function",identifierTrigger:"apply",serialize:(e,n)=>{if(typeof m(n,1)=="string"){let t=n.slice(1);return e.serialize(t)}return e.serializeFunction(_(n))}},{latexTrigger:"\\lhd",kind:"infix",precedence:20,parse:"Apply"},{latexTrigger:"\\rhd",kind:"infix",precedence:20,parse:(e,n)=>["Apply",e.parseExpression({minPrec:21})??"Nothing",n]},{name:"Assign",latexTrigger:"\\coloneq",kind:"infix",associativity:"right",precedence:ti,serialize:(e,n)=>{let i=Wr(m(n,1));if(x(m(n,2))==="Function"){let t=m(n,2),r=Wr(m(t,1)),o=_(t)?.slice(1)??[];return N([e.serialize(i),e.wrapString(o.map(s=>e.serialize(s)).join(", "),e.options.applyFunctionStyle(n,e.level)),"\\coloneq",e.serialize(r)])}return N([e.serialize(i),"\\coloneq",e.serialize(m(n,2))])},parse:Rt},{latexTrigger:[":","="],kind:"infix",associativity:"right",precedence:ti,parse:Rt},{latexTrigger:"\\colonequals",kind:"infix",associativity:"right",precedence:ti,parse:Rt},{latexTrigger:"\\coloneqq",kind:"infix",associativity:"right",precedence:ti,parse:Rt},{name:"BaseForm",serialize:(e,n)=>{let i=O(m(n,2))??NaN;if(isFinite(i)&&i>=2&&i<=36){let t=O(m(n,1))??NaN;if(isFinite(t)&&Number.isInteger(t)){let r=Number(t).toString(i),o=0;if(i===2||i===10?o=4:i===16?o=2:i>16&&(o=4),o>0){let s=r;r="";for(let a=0;a<s.length;a++)a>0&&a%o===0&&(r="\\, "+r),r=s[s.length-a-1]+r}return`(\\text{${r}}_{${i}}`}}return"\\operatorname{BaseForm}("+e.serialize(m(n,1))+", "+e.serialize(m(n,2))+")"}},{name:"Sequence",serialize:Lt(" ")},{name:"InvisibleOperator",serialize:Lt("")},{name:"Delimiter",serialize:(e,n)=>{let i=m(n,1),t=e.options.groupStyle(n,e.level+1),r=x(i),o={Set:"{,}",List:"[,]",Tuple:"(,)",Single:"(,)",Pair:"(,)",Triple:"(,)",Sequence:"(,)",String:'""'}[typeof r=="string"?r:""]??"(,)";if(G(n)>1){let f=z(m(n,2));typeof f=="string"&&f.length<=3&&(o=f)}let[s,a,u]=["","",""];o.length===3?[s,a,u]=o:o.length===2?[s,u]=o:o.length===1&&(a=o);let l=i?_(i)?Lt(a)(e,i):e.serialize(i):"";return e.wrapString(l,t,s+u)}},{name:"Domain",serialize:(e,n)=>x(n)==="Error"?e.serialize(n):`\\mathbf{${e.serialize(m(n,1))}}`},{latexTrigger:["\\mathtip"],parse:e=>{let n=e.parseGroup();return e.parseGroup(),n}},{latexTrigger:["\\texttip"],parse:e=>{let n=e.parseGroup();return e.parseGroup(),n}},{latexTrigger:["\\error"],parse:e=>["Error",e.parseGroup()]},{name:"Error",serialize:(e,n)=>{let i=m(n,1);if(z(i)==="missing")return`\\error{${e.options.missingSymbol??"\\placeholder{}"}}`;let t=uf(e,n)||"\\blacksquare",r=x(i)==="ErrorCode"?z(m(i,1)):z(i);return r==="incompatible-domain"?V(m(i,3))==="Undefined"?`\\mathtip{\\error{${t}}}{\\notin ${e.serialize(m(i,2))}}`:`\\mathtip{\\error{${t}}}{\\in ${e.serialize(m(i,3))}\\notin ${e.serialize(m(i,2))}}`:typeof r=="string"?`\\error{${t}}`:`\\error{${t}}`}},{name:"ErrorCode",serialize:(e,n)=>{let i=z(m(n,1));return i==="missing"?e.options.missingSymbol??"\\placeholder{}":i==="unexpected-command"||i==="unexpected-operator"||i==="unexpected-token"||i==="invalid-identifier"||i==="unknown-environment"||i==="unexpected-base"||i==="incompatible-domain"||i==="invalid-domain"?"":`\\texttip{\\error{\\blacksquare}}{\\mathtt{${i}}}`}},{name:"FromLatex",serialize:(e,n)=>`\\texttt{${Zs(z(m(n,1)))}}`},{name:"Latex",serialize:(e,n)=>n===null?"":N(Ri(n,i=>z(i)??e.serialize(i)))},{name:"LatexString",serialize:(e,n)=>n===null?"":N(Ri(n,i=>e.serialize(i)))},{name:"LatexTokens",serialize:af},{name:"List",kind:"matchfix",openTrigger:"[",closeTrigger:"]",parse:Hs,serialize:(e,n)=>N(["\\bigl\\lbrack",Lt(", ")(e,n),"\\bigr\\rbrack"])},{kind:"matchfix",openTrigger:"(",closeTrigger:")",parse:lf},{latexTrigger:[","],kind:"infix",precedence:20,parse:(e,n,i)=>{let t=Qr(e,i,n,20,",");return t===null?null:["Delimiter",["Sequence",...t],{str:","}]}},{latexTrigger:[","],kind:"prefix",precedence:20,parse:(e,n)=>{let i=Qr(e,n,null,20,",");return i===null?null:["Delimiter",["Sequence",...i],{str:","}]}},{name:"Range",latexTrigger:[".","."],kind:"infix",precedence:10,parse:ff,serialize:(e,n)=>{let i=_(n);if(i===null)return"";if(i.length===1)return"1.."+e.serialize(m(n,1));if(i.length===2)return e.wrap(m(n,1),10)+".."+e.wrap(m(n,2),10);if(i.length===3){let t=O(m(n,3)),r=O(m(n,1));return t!==null&&r!==null?e.wrap(m(n,1),10)+","+e.wrap(r+t,10)+".."+e.wrap(m(n,2),10):e.wrap(m(n,1),10)+","+(e.wrap(m(n,3),ue)+"+"+e.wrap(m(n,3),ue))+".."+e.wrap(m(n,2),10)}return""}},{latexTrigger:[";"],kind:"infix",precedence:19,parse:(e,n,i)=>{let t=Qr(e,i,n,19,";");return t===null?null:["Delimiter",["Sequence",...t],"';'"]}},{name:"String",latexTrigger:["\\text"],parse:e=>Kr(e),serialize:(e,n)=>{let i=_(n);return i===null||i.length===0?"\\text{}":N(["\\text{",i.map(t=>e.serialize(t)).join(""),"}"])}},{name:"Subscript",latexTrigger:["_"],kind:"infix",serialize:(e,n)=>G(n)===2?e.serialize(m(n,1))+"_{"+e.serialize(m(n,2))+"}":"_{"+e.serialize(m(n,1))+"}"},{name:"Superplus",latexTrigger:["^","+"],kind:"postfix"},{name:"Subplus",latexTrigger:["_","+"],kind:"postfix"},{name:"Superminus",latexTrigger:["^","-"],kind:"postfix"},{name:"Subminus",latexTrigger:["_","-"],kind:"postfix"},{latexTrigger:["^","*"],kind:"postfix",parse:(e,n)=>["Superstar",n]},{latexTrigger:["_","*"],kind:"postfix",parse:(e,n)=>["Substar",n]},{name:"Substar",latexTrigger:["_","\\star"],kind:"postfix"},{name:"Superdagger",latexTrigger:["^","\\dagger"],kind:"postfix"},{latexTrigger:["^","\\dag"],kind:"postfix",parse:(e,n)=>["Superdagger",n]},{name:"Prime",latexTrigger:["^","\\prime"],kind:"postfix",parse:(e,n)=>pn(e,n,1),serialize:(e,n)=>{let i=O(m(n,2))??1,t=e.serialize(m(n,1));return i===1?t+"^\\prime":i===2?t+"^\\doubleprime":i===3?t+"^\\tripleprime":t+"^{("+e.serialize(m(n,2))+")}"}},{latexTrigger:"^{\\prime\\prime}",kind:"postfix",parse:(e,n)=>pn(e,n,2)},{latexTrigger:"^{\\prime\\prime\\prime}",kind:"postfix",parse:(e,n)=>pn(e,n,3)},{latexTrigger:["^","\\doubleprime"],kind:"postfix",parse:(e,n)=>pn(e,n,2)},{latexTrigger:["^","\\tripleprime"],kind:"postfix",parse:(e,n)=>pn(e,n,3)},{latexTrigger:"'",kind:"postfix",precedence:810,parse:(e,n)=>pn(e,n,1)},{latexTrigger:"\\prime",kind:"postfix",precedence:810,parse:(e,n)=>pn(e,n,1)},{latexTrigger:"\\doubleprime",kind:"postfix",precedence:810,parse:(e,n)=>pn(e,n,2)},{latexTrigger:"\\tripleprime",kind:"postfix",precedence:810,parse:(e,n)=>pn(e,n,3)},{latexTrigger:["^","<{>","("],kind:"postfix",parse:(e,n)=>{if(!e.computeEngine?.box(n)?.domain?.isFunction)return null;let i=e.index;e.addBoundary([")"]);let t=e.parseExpression();return!e.matchBoundary()||!e.match("<}>")?(e.index=i,null):["Derivative",n,t]}},{name:"InverseFunction",latexTrigger:"^{-1",kind:"postfix",parse:(e,n)=>{if(!e.computeEngine?.box(n)?.domain?.isFunction)return null;let i=0,t=e.index;for(;!e.atEnd&&!e.match("<}>");)if(e.match("'"))i++;else if(e.match("\\prime"))i++;else if(e.match("\\doubleprime"))i+=2;else if(e.match("\\tripleprime"))i+=3;else return e.index=t,null;return i===1?["Derivative",["InverseFunction",n]]:i>0?["Derivative",["InverseFunction",n],i]:["InverseFunction",n]},serialize:(e,n)=>e.serialize(m(n,1))+"^{-1}"},{name:"Derivative",serialize:(e,n)=>{let i=O(m(n,2))??1,t=e.serialize(m(n,1));return i===1?t+"^{\\prime}":i===2?t+"^{\\doubleprime}":i===3?t+"^{\\tripleprime}":t+"^{("+e.serialize(m(n,2))+")}"}},{kind:"environment",name:"Which",identifierTrigger:"cases",parse:Xr,serialize:(e,n)=>{let i=[],t=_(n);if(t)for(let r=0;r<=t.length-2;r+=2){let o=[];o.push(e.serialize(t[r+1])),o.push(e.serialize(t[r])),i.push(o.join("&"))}return N(["\\begin{cases}",i.join("\\\\"),"\\end{cases}"])}},{kind:"environment",identifierTrigger:"dcases",parse:Xr},{kind:"environment",identifierTrigger:"rcases",parse:Xr}];function Kr(e,n){if(!e.match("<{>"))return"''";let i=[],t="",r=null;for(;!e.atEnd&&!e.match("<}>");)if(e.peek==="<{>")i.push(Kr(e));else if(e.match("\\textbf")&&e.match("<{>"))i.push(Kr(e,{"font-weight":"bold"}));else if(e.match("\\color")){let s=e.parseStringGroup();s!==null&&(r!==null&&t?i.push(["Style",t,{dict:r}]):t&&i.push(["String",t]),t="",r={color:s})}else if(e.match("<space>"))t+=" ";else if(e.match("<$>")){let s=e.index,a=e.parseExpression()??["Sequence"];e.skipSpace(),e.match("<$>")?i.push(a):(t+="$",e.index=s)}else if(e.match("<$$>")){let s=e.index,a=e.parseExpression()??["Sequence"];e.skipSpace(),e.match("<$$>")?i.push(a):(t+="$$",e.index=s)}else{let s=e.matchChar()??e.nextToken();t+={"\\enskip":"\u2002","\\enspace":"\u2002","\\quad":"\u2003","\\qquad":"\u2003\u2003","\\space":"\u2003","\\ ":"\u2003","\\;":"\u2004","\\,":"\u2009","\\:":"\u205F","\\!":"","\\{":"{","\\}":"}","\\$":"$","\\&":"&","\\#":"#","\\%":"%","\\_":"_","\\textbackslash":"\\","\\textasciitilde":"~","\\textasciicircum":"^","\\textless":"<","\\textgreater":">","\\textbar":"|","\\textunderscore":"_","\\textbraceleft":"{","\\textbraceright":"}","\\textasciigrave":"`","\\textquotesingle":"'","\\textquotedblleft":"\u201C","\\textquotedblright":"\u201D","\\textquotedbl":'"',"\\textquoteleft":"\u2018","\\textquoteright":"\u2019","\\textbullet":"\u2022","\\textdagger":"\u2020","\\textdaggerdbl":"\u2021","\\textsection":"\xA7","\\textparagraph":"\xB6","\\textperiodcentered":"\xB7","\\textellipsis":"\u2026","\\textemdash":"\u2014","\\textendash":"\u2013","\\textregistered":"\xAE","\\texttrademark":"\u2122","\\textdegree":"\xB0"}[s]??s}r!==null&&t?i.push(["Style",`'${t}'`,{dict:r}]):t&&i.push(`'${t}'`);let o;return i.length===1?o=i[0]:i.every(s=>z(s)!==null)?o="'"+i.map(s=>z(s)).join()+"'":o=["String",...i],n?["Style",o,{dict:n}]:o}function af(e,n){return n===null?"":N(Ri(n,i=>{let t=z(i);return t===null?e.serialize(i):t==="<{>"?"{":t==="<}>"?"}":t==="<$>"?"$":t==="<$$>"?"$$":t==="<space>"?" ":t}))}function Zs(e){return e===null?"":e.replace(/[{}\[\]\\:\-\$%]/g,n=>({"{":"\\lbrace ","}":"\\rbrace ","[":"\\lbrack ","]":"\\rbrack ",":":"\\colon ","\\":"\\backslash "})[n]??"\\"+n)}function uf(e,n){let i=m(n,2);return i?x(i)==="LatexString"?`\\texttt{${Zs(z(m(i,1))??"")}}`:x(i)==="Hold"?e.serialize(m(i,1)):e.serialize(i):""}function pn(e,n,i){let t=x(n);if(t==="Derivative"||t==="Prime"){let r=O(m(n,2))??1;return[t,j(m(n,1)),r+i]}return e.computeEngine?.box(n)?.domain?.isFunction?i===1?["Derivative",n]:["Derivative",n,i]:i===1?["Prime",j(n)]:["Prime",j(n),i]}function lf(e,n){if(n===null||ne(n))return["Delimiter"];let i=x(n);if(i==="Delimiter"&&m(n,2)){let t=z(m(n,2));if(t?.length===1)return["Delimiter",m(n,1)??["Sequence"],{str:`(${t})`}]}return i==="Sequence"?G(n)===0?["Delimiter"]:["Delimiter",n]:i==="Matrix"&&(z(m(n,2))??"..")===".."?["Matrix",m(n,1)]:["Delimiter",["Sequence",n]]}function Hs(e,n){if(n===null||ne(n))return["List"];let i=x(n);if(i==="Range"||i==="Linspace")return n;if(i==="Sequence")return["List",..._(n)??[]];if(i==="Delimiter"){let t=z(m(n,2))??"...";if(t===";"||t===".;.")return["List",...(_(m(n,1))??[]).map(r=>Hs(e,r))];if(t===","||t===".,.")return n=m(n,1),x(n)==="Sequence"?["List",..._(n)??[]]:["List",n??["Sequence"]]}return["List",n]}function ff(e,n){let i=e.index;if(!n)return null;let t=null,r=null;if(x(n)==="Sequence"){if(G(n)!==2)return null;if(t=m(n,1),r=m(n,2),r===null)return e.index=i,null}else t=m(n,1);if(t===null)return null;let o=e.parseExpression({minPrec:0});if(!o)return e.index=i,null;if(r){let s=O(r),a=O(t);return s!==null&&a!==null?["Range",t,o,s-a]:["Range",t,o,["Subtract",r,t]]}return["Range",t,o]}var mi={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","\u27E6":"\\llbrack","\u27E7":"\\rrbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","\u2016":"\\Vert","\\":"\\backslash","\u2308":"\\lceil","\u2309":"\\rceil","\u230A":"\\lfloor","\u230B":"\\rfloor","\u231C":"\\ulcorner","\u231D":"\\urcorner","\u231E":"\\llcorner","\u231F":"\\lrcorner","\u23B0":"\\lmoustache","\u23B1":"\\rmoustache"};function Rt(e,n){let i=e.index;if(x(n)==="InvisibleOperator"&&G(n)===2&&x(m(n,2))==="Delimiter"&&x(m(m(n,2),1))==="Sequence"){let r=V(m(n,1));if(!r)return null;let o=_(m(m(n,2),1)),s=e.parseExpression({minPrec:0});return s===null?(e.index=i,null):["Assign",r,["Function",s,...o??[]]]}if(typeof x(n)=="string"){let r=x(n),o=_(n)??[],s=e.parseExpression({minPrec:0});return s===null?(e.index=i,null):["Assign",r,["Function",s,...o]]}if(!V(n))return null;let t=e.parseExpression({minPrec:0});return t===null?(e.index=i,null):["Assign",n,t]}function Xr(e){let n=e.parseTabular();if(!n)return["Which"];let i=["Which"];for(let t of n)if(t.length===1)i.push("True"),i.push(t[0]);else if(t.length===2){let r=z(t[1]);i.push(r?"True":Hr(t[1])??"True"),i.push(t[0])}return i}var Js=[{latexTrigger:["\\not","<"],kind:"infix",associativity:"right",precedence:246,parse:"NotLess"},{name:"NotLess",latexTrigger:["\\nless"],kind:"infix",associativity:"right",precedence:246},{latexTrigger:["<"],kind:"infix",associativity:"right",precedence:245,parse:"Less"},{name:"Less",latexTrigger:["\\lt"],kind:"infix",associativity:"right",precedence:245},{latexTrigger:["<","="],kind:"infix",associativity:"right",precedence:241,parse:"LessEqual"},{name:"LessEqual",latexTrigger:["\\le"],kind:"infix",associativity:"right",precedence:241},{latexTrigger:["\\leq"],kind:"infix",associativity:"right",precedence:241,parse:"LessEqual"},{latexTrigger:["\\leqslant"],kind:"infix",associativity:"right",precedence:M+5,parse:"LessEqual"},{name:"LessNotEqual",latexTrigger:["\\lneqq"],kind:"infix",associativity:"right",precedence:M},{name:"NotLessNotEqual",latexTrigger:["\\nleqq"],kind:"infix",associativity:"right",precedence:M},{name:"LessOverEqual",latexTrigger:["\\leqq"],kind:"infix",associativity:"right",precedence:M+5},{name:"GreaterOverEqual",latexTrigger:["\\geqq"],kind:"infix",associativity:"right",precedence:M+5,parse:"GreaterEqual"},{name:"Equal",latexTrigger:["="],kind:"infix",associativity:"right",precedence:M},{latexTrigger:["*","="],kind:"infix",associativity:"right",precedence:M,parse:"StarEqual"},{name:"StarEqual",latexTrigger:["\\star","="],kind:"infix",associativity:"right",precedence:M},{name:"PlusEqual",latexTrigger:["+","="],kind:"infix",associativity:"right",precedence:M},{name:"MinusEqual",latexTrigger:["-","="],kind:"infix",associativity:"right",precedence:M},{name:"SlashEqual",latexTrigger:["/","="],kind:"infix",associativity:"right",precedence:M},{name:"EqualEqual",latexTrigger:["=","="],kind:"infix",associativity:"right",precedence:M},{name:"EqualEqualEqual",latexTrigger:["=","=","="],kind:"infix",associativity:"right",precedence:M+5},{name:"TildeFullEqual",latexTrigger:["\\cong"],kind:"infix",associativity:"right",precedence:M},{name:"NotTildeFullEqual",latexTrigger:["\\ncong"],kind:"infix",associativity:"right",precedence:M},{name:"Approx",latexTrigger:["\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"NotApprox",latexTrigger:["\\not","\\approx"],kind:"infix",associativity:"right",precedence:247},{name:"ApproxEqual",latexTrigger:["\\approxeq"],kind:"infix",associativity:"right",precedence:M},{name:"NotApproxEqual",latexTrigger:["\\not","\\approxeq"],kind:"infix",associativity:"right",precedence:250},{name:"NotEqual",latexTrigger:["\\ne"],kind:"infix",associativity:"right",precedence:255},{name:"Unequal",latexTrigger:["!","="],kind:"infix",associativity:"right",precedence:M},{name:"GreaterEqual",latexTrigger:["\\ge"],kind:"infix",associativity:"right",precedence:242},{latexTrigger:["\\geq"],kind:"infix",associativity:"right",precedence:242,parse:"GreaterEqual"},{latexTrigger:[">","="],kind:"infix",associativity:"right",precedence:243,parse:"GreaterEqual"},{latexTrigger:["\\geqslant"],kind:"infix",associativity:"right",precedence:M+5,parse:"GreaterEqual"},{name:"GreaterNotEqual",latexTrigger:["\\gneqq"],kind:"infix",associativity:"right",precedence:M},{name:"NotGreaterNotEqual",latexTrigger:["\\ngeqq"],kind:"infix",associativity:"right",precedence:M},{latexTrigger:[">"],kind:"infix",associativity:"right",precedence:245,parse:"Greater"},{name:"Greater",latexTrigger:["\\gt"],kind:"infix",associativity:"right",precedence:245},{name:"NotGreater",latexTrigger:["\\ngtr"],kind:"infix",associativity:"right",precedence:244},{latexTrigger:["\\not",">"],kind:"infix",associativity:"right",precedence:244,parse:"NotGreater"},{name:"RingEqual",latexTrigger:["\\circeq"],kind:"infix",associativity:"right",precedence:M},{name:"TriangleEqual",latexTrigger:["\\triangleq"],kind:"infix",associativity:"right",precedence:M},{name:"DotEqual",latexTrigger:["\\doteq"],kind:"infix",associativity:"right",precedence:M+5},{name:"DotEqualDot",latexTrigger:["\\doteqdot"],kind:"infix",associativity:"right",precedence:M+5},{name:"FallingDotEqual",latexTrigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:M+5},{name:"RisingDotEqual",latexTrigger:["\\fallingdotseq"],kind:"infix",associativity:"right",precedence:M+5},{name:"QuestionEqual",latexTrigger:["\\questeq"],kind:"infix",associativity:"right",precedence:M},{name:"MuchLess",latexTrigger:["\\ll"],kind:"infix",associativity:"right",precedence:M},{name:"MuchGreater",latexTrigger:["\\gg"],kind:"infix",associativity:"right",precedence:M},{name:"Precedes",latexTrigger:["\\prec"],kind:"infix",associativity:"right",precedence:M},{name:"Succeeds",latexTrigger:["\\succ"],kind:"infix",associativity:"right",precedence:M},{name:"PrecedesEqual",latexTrigger:["\\preccurlyeq"],kind:"infix",associativity:"right",precedence:M},{name:"SucceedsEqual",latexTrigger:["\\curlyeqprec"],kind:"infix",associativity:"right",precedence:M},{name:"NotPrecedes",latexTrigger:["\\nprec"],kind:"infix",associativity:"right",precedence:M},{name:"NotSucceeds",latexTrigger:["\\nsucc"],kind:"infix",associativity:"right",precedence:M},{name:"Between",latexTrigger:["\\between"],kind:"infix",associativity:"right",precedence:M+5}];var Ys=[{name:"Matrix",serialize:(e,n)=>{let i=_(m(n,1))??[];return Ws(e,i,z(m(n,2)),z(m(n,3)))}},{name:"Vector",serialize:(e,n)=>{let i=_(n)??[];return Ws(e,i.map(t=>["List",t]),z(m(n,2)),z(m(n,3)))}},{kind:"environment",identifierTrigger:"pmatrix",parse:e=>{let n=gn(e),[i,t]=hn(e);return n?[i,t,{str:"()"},{str:n}]:[i,t]}},{kind:"environment",identifierTrigger:"bmatrix",parse:e=>{let n=gn(e),[i,t]=hn(e);return n?[i,t,{str:"[]"},{str:n}]:[i,t,{str:"[]"}]}},{kind:"environment",identifierTrigger:"Bmatrix",parse:e=>{let n=gn(e),[i,t]=hn(e);return n?[i,t,{str:"{}"},{str:n}]:[i,t,{str:"{}"}]}},{kind:"environment",identifierTrigger:"vmatrix",parse:e=>{let n=gn(e),[i,t]=hn(e);return n?[i,t,{str:"||"},{str:n}]:[i,t,{str:"||"}]}},{kind:"environment",identifierTrigger:"Vmatrix",parse:e=>{let n=gn(e),[i,t]=hn(e);return n?[i,t,{str:"\u2016\u2016"},{str:n}]:[i,t,{str:"\u2016\u2016"}]}},{kind:"environment",identifierTrigger:"smallmatrix",parse:e=>{let n=gn(e),[i,t]=hn(e);return n?[i,t,{str:"()"},{str:n}]:[i,t]}},{kind:"environment",identifierTrigger:"array",parse:e=>{let n=gn(e,!1),[i,t]=hn(e);return n?[i,t,{str:".."},{str:n}]:[i,t,{str:".."}]}},{kind:"environment",identifierTrigger:"matrix",parse:e=>{let n=gn(e),[i,t]=hn(e);return n?[i,t,{str:".."},{str:n}]:[i,t,{str:".."}]}},{kind:"environment",identifierTrigger:"matrix*",parse:e=>{let n=gn(e),[i,t]=hn(e);return n?[i,t,{str:".."},{str:n}]:[i,t,{str:".."}]}},{name:"ConjugateTranspose",kind:"postfix",latexTrigger:["^","\\star"]},{kind:"postfix",latexTrigger:["^","\\H"],parse:"ConjugateTranspose"},{kind:"postfix",latexTrigger:["^","\\dagger"],parse:(e,n)=>["ConjugateTranspose",n]},{kind:"postfix",latexTrigger:["^","\\ast"],parse:(e,n)=>["ConjugateTranspose",n]},{kind:"postfix",latexTrigger:["^","\\top"],parse:(e,n)=>["Transpose",n]},{kind:"postfix",latexTrigger:["^","\\intercal"],parse:(e,n)=>["Transpose",n]},{name:"Transpose",kind:"postfix",latexTrigger:["^","T"]},{name:"PseudoInverse",kind:"postfix",latexTrigger:["^","+"]},{name:"Trace",kind:"function",identifierTrigger:"tr"},{name:"Determinant",kind:"function",identifierTrigger:"det"}];function hn(e){let n=e.parseTabular();return n?["Matrix",["List",...n.map(i=>["List",...i])]]:["",null]}function gn(e,n=!0){let i=e.parseStringGroup(n)?.trim();if(!i)return"";let t="";for(let r of i)r==="c"&&(t+="="),r==="l"&&(t+="<"),r==="r"&&(t+=">"),r==="|"&&(t+="|"),r===":"&&(t+=":");return t}function Ws(e,n,i,t){i??(i="()");let[r,o]=["",""];typeof i=="string"&&i.length===2&&([r,o]=i);let s="";if(t)for(let f of t)f==="<"?s+="l":f===">"?s+="r":f==="="?s+="c":f==="|"?s+="|":f===":"&&(s+=":");let a=[];for(let f of n??[]){let d=[];for(let c of _(f)??[])d.push(e.serialize(c));a.push(d.join(" & "))}let u=a.join(`\\\\
`),l=s.length>0?`[${s}]`:"";return r==="("&&o===")"?N(["\\begin{pmatrix}",l,u,"\\end{pmatrix}"]):r==="["&&o==="]"?N(["\\begin{bmatrix}",l,u,"\\end{bmatrix}"]):r==="{"&&o==="}"?N(["\\begin{Bmatrix}",l,u,"\\end{Bmatrix}"]):r==="|"&&o==="|"?N(["\\begin{vmatrix}",l,u,"\\end{vmatrix}"]):r==="\u2016"&&o==="\u2016"?N(["\\begin{Vmatrix}",l,u,"\\end{Vmatrix}"]):r==="{"&&o==="."?N(["\\begin{dcases}",l,u,"\\end{dcases}"]):r==="."&&o==="}"?N(["\\begin{rcases}",l,u,"\\end{rcases}"]):s||r!=="."||o!=="."?N(["\\left",mi[r]??r,"\\begin{array}",`{${s}}`,u,"\\end{array}","\\right",mi[o]??o]):N(["\\begin{matrix}",u,"\\end{matrix}"])}var Qs=[{name:"True",kind:"symbol",latexTrigger:["\\top"]},{kind:"symbol",latexTrigger:"\\mathrm{True}",parse:"True"},{kind:"symbol",latexTrigger:"\\operator{True}",parse:"True"},{kind:"symbol",latexTrigger:"\\mathsf{T}",parse:"True"},{name:"False",kind:"symbol",latexTrigger:["\\bot"]},{kind:"symbol",latexTrigger:"\\operator{False}",parse:"False"},{kind:"symbol",latexTrigger:"\\mathsf{F}",parse:"False"},{name:"And",kind:"infix",latexTrigger:["\\land"],precedence:317},{kind:"infix",latexTrigger:["\\wedge"],parse:"And",precedence:317},{kind:"infix",latexTrigger:"\\&",parse:"And",precedence:317},{kind:"infix",latexTrigger:"\\operatorname{and}",parse:"And",precedence:317},{name:"Or",kind:"infix",latexTrigger:["\\lor"],precedence:310},{kind:"infix",latexTrigger:["\\vee"],parse:"Or",precedence:310},{kind:"infix",latexTrigger:"\\parallel",parse:"Or",precedence:310},{kind:"infix",latexTrigger:"\\operatorname{or}",parse:"Or",precedence:310},{name:"Xor",kind:"infix",latexTrigger:["\\veebar"],precedence:315},{name:"Not",kind:"prefix",latexTrigger:["\\lnot"],precedence:880},{name:"Nand",kind:"infix",latexTrigger:["\\barwedge"],precedence:315},{name:"Nor",kind:"infix",latexTrigger:["\u22BD"],precedence:315},{kind:"function",identifierTrigger:"and",parse:"And"},{kind:"function",identifierTrigger:"or",parse:"Or"},{kind:"function",identifierTrigger:"not",parse:"Not"},{name:"Implies",kind:"infix",precedence:220,associativity:"right",latexTrigger:["\\implies"],serialize:"\\implies"},{latexTrigger:["\\Rightarrow"],kind:"infix",precedence:220,associativity:"right",parse:"Implies"},{name:"Equivalent",latexTrigger:["\\iff"],kind:"infix",associativity:"right",precedence:219},{latexTrigger:["\\Leftrightarrow"],kind:"infix",associativity:"right",precedence:219,parse:"Equivalent"},{latexTrigger:["\\equiv"],kind:"infix",associativity:"right",precedence:219,parse:(e,n,i)=>{let t=e.parseExpression({...i,minPrec:219}),r=e.index,o=e.parseExpression({...i,minPrec:219});return o&&x(o)==="Mod"?["Congruent",n,t,j(m(o,1))]:(e.index=r,["Equivalent",n,j(t)])}},{name:"Proves",kind:"infix",latexTrigger:["\\vdash"],precedence:220,associativity:"right",serialize:"\\vdash"},{name:"Entails",kind:"infix",latexTrigger:["\\vDash"],precedence:220,associativity:"right",serialize:"\\vDash"},{name:"Satisfies",kind:"infix",latexTrigger:["\\models"],precedence:220,associativity:"right",serialize:"\\models"}];function we(e){return n=>{let i=n.parseGroup();return i===null?[e]:[e,i]}}var Xs=[{name:"Overscript",latexTrigger:["\\overset"],kind:"infix",precedence:700},{name:"Underscript",latexTrigger:["\\underset"],kind:"infix",precedence:700},{name:"Increment",latexTrigger:["+","+"],kind:"postfix",precedence:880},{name:"Decrement",latexTrigger:["-","-"],kind:"postfix",precedence:880},{name:"PreIncrement",latexTrigger:["+","+"],kind:"prefix",precedence:880},{name:"PreDecrement",latexTrigger:["-","-"],kind:"prefix",precedence:880},{name:"Ring",latexTrigger:["\\circ"],kind:"infix",precedence:265},{name:"StringJoin",latexTrigger:["\\lt","\\gt"],kind:"infix",precedence:780},{name:"Starstar",latexTrigger:["\\star","\\star"],kind:"infix",precedence:780},{name:"PartialDerivative",latexTrigger:["\\partial"],kind:"prefix",parse:e=>{let n=!1,i="Nothing",t="Nothing";for(;!n;)e.skipSpace(),e.match("_")?t=e.parseGroup()??e.parseToken():e.match("^")?i=e.parseGroup()??e.parseToken():n=!0;let r=Pt(t);if(r&&(t=["List",...r]),t===null||i===null)return null;let o=e.parseGroup()??"Nothing";if(o!=="Nothing"&&!ne(o)){let s=e.parseArguments()??["Nothing"];o=[o,...s]}return["PartialDerivative",o,t,i]},serialize:(e,n)=>{let i="\\partial",t=m(n,1),r=m(n,2),o=m(n,3);return r!==null&&r!=="Nothing"&&(x(r)==="List"?i+="_{"+e.serialize(["Sequence",..._(r)??[]])+"}":i+="_{"+e.serialize(r)+"}"),o!==null&&o!=="Nothing"&&(i+="^{"+e.serialize(o)+"}"),t!==null&&t!=="Nothing"&&(i+=e.serialize(t)),i},precedence:740},{name:"OverBar",latexTrigger:["\\overline"],parse:we("OverBar")},{name:"UnderBar",latexTrigger:["\\underline"],parse:we("UnderBar")},{name:"OverVector",latexTrigger:["\\vec"],parse:we("OverVector")},{name:"OverTilde",latexTrigger:["\\tilde"],parse:we("OverTilde")},{name:"OverHat",latexTrigger:["\\hat"],parse:we("OverHat")},{name:"OverRightArrow",latexTrigger:["\\overrightarrow"],parse:we("OverRightArrow")},{name:"OverLeftArrow",latexTrigger:["\\overleftarrow"],parse:we("OverLeftArrow")},{name:"OverRightDoubleArrow",latexTrigger:["\\Overrightarrow"],parse:we("OverRightDoubleArrow")},{name:"OverLeftHarpoon",latexTrigger:["\\overleftharpoon"],parse:we("OverLeftHarpoon")},{name:"OverRightHarpoon",latexTrigger:["\\overrightharpoon"],parse:we("OverRightHarpoon")},{name:"OverLeftRightArrow",latexTrigger:["\\overleftrightarrow"],parse:we("OverLeftRightArrow")},{name:"OverBrace",latexTrigger:["\\overbrace"],parse:we("OverBrace")},{name:"OverLineSegment",latexTrigger:["\\overlinesegment"],parse:we("OverLineSegment")},{name:"OverGroup",latexTrigger:["\\overgroup"],parse:we("OverGroup")},{latexTrigger:["\\displaystyle"],parse:()=>["Sequence"]},{latexTrigger:["\\textstyle"],parse:()=>["Sequence"]},{latexTrigger:["\\scriptstyle"],parse:()=>["Sequence"]},{latexTrigger:["\\scriptscriptstyle"],parse:()=>["Sequence"]},{latexTrigger:["\\tiny"],parse:()=>["Sequence"]},{latexTrigger:["\\scriptsize"],parse:()=>["Sequence"]},{latexTrigger:["\\footnotesize"],parse:()=>["Sequence"]},{latexTrigger:["\\small"],parse:()=>["Sequence"]},{latexTrigger:["\\normalsize"],parse:()=>["Sequence"]},{latexTrigger:["\\large"],parse:()=>["Sequence"]},{latexTrigger:["\\Large"],parse:()=>["Sequence"]},{latexTrigger:["\\LARGE"],parse:()=>["Sequence"]},{latexTrigger:["\\huge"],parse:()=>["Sequence"]},{latexTrigger:["\\Huge"],parse:()=>["Sequence"]},{name:"Style",serialize:(e,n)=>{let i=e.serialize(m(n,1)),t=zn(m(n,2));if(t===null)return i;z(t.display)==="block"?i=N(["{\\displaystyle",i,"}"]):z(t.display)==="inline"?i=N(["{\\textstyle",i,"}"]):z(t.display)==="script"?i=N(["{\\scriptstyle",i,"}"]):z(t.display)==="scriptscript"&&(i=N(["{\\scriptscriptstyle",i,"}"]));let r=O(t.size);return r!==null&&r>=1&&r<=10&&(i=N(["{",{1:"\\tiny",2:"\\scriptsize",3:"\\footnotesize",4:"\\small",5:"\\normalsize",6:"\\large",7:"\\Large",8:"\\LARGE",9:"\\huge",10:"\\Huge"}[r],i,"}"])),i}},{latexTrigger:["\\!"],parse:()=>["HorizontalSpacing",-3]},{latexTrigger:["\\ "],parse:()=>["HorizontalSpacing",6]},{latexTrigger:["\\:"],parse:()=>["HorizontalSpacing",4]},{latexTrigger:["\\enskip"],parse:()=>["HorizontalSpacing",9]},{latexTrigger:["\\quad"],parse:()=>["HorizontalSpacing",18]},{latexTrigger:["\\qquad"],parse:()=>["HorizontalSpacing",36]},{latexTrigger:["\\,"],parse:()=>["HorizontalSpacing",3]},{latexTrigger:["\\;"],parse:()=>["HorizontalSpacing",5]},{latexTrigger:["\\enspace"],parse:()=>["HorizontalSpacing",9]},{name:"HorizontalSpacing",serialize:(e,n)=>{if(m(n,2))return e.serialize(m(n,1));let i=O(m(n,1));return i===null?"":{"-3":"\\!",6:"\\ ",3:"\\,",4:"\\:",5:"\\;",9:"\\enspace",18:"\\quad",36:"\\qquad"}[i]??""}}];function Z(e){return(n,i)=>{let t={"\\arcsin":"Arcsin","\\arccos":"Arccos","\\arctan":"Arctan","\\arctg":"Arctan","\\arcctg":"Arctan","\\arcsec":"Arcsec","\\arccsc":" Arccsc","\\arsinh":"Arsinh","\\arcosh":"Arcosh","\\artanh":"Artanh","\\arcsech":"Arcsech","\\arccsch":"Arcsch","\\ch":"Cosh","\\cos":"Cos","\\cosec":"Csc","\\cosh":"Csch","\\cot":"Cot","\\cotg":"Cot","\\coth":"Coth","\\csc":"Csc","\\ctg":"Cot","\\cth":"Coth","\\sec":"Sec","\\sin":"Sin","\\sinh":"Sinh","\\sh":"Sinh","\\tan":"Tan","\\tanh":"Tanh","\\tg":"Tan","\\th":"Tanh"}[e??""]??e??"";if(n.atTerminator(i))return t;let r=t;do{let u=n.parsePostfixOperator(r,i);if(u===null)break;r=u}while(!0);let o=null;n.match("^")&&(o=n.parseGroup()??n.parseToken());let s=n.parseArguments("implicit",i),a=s===null?r:typeof r=="string"?[r,...s]:["Apply",r,...s];return o===null?a:["Power",a,o]}}var Ks=[{name:"Arcsin",latexTrigger:["\\arcsin"],parse:Z("Arcsin")},{name:"Arccos",latexTrigger:["\\arccos"],parse:Z("Arccos")},{name:"Arctan",latexTrigger:["\\arctan"],parse:Z("Arctan")},{latexTrigger:["\\arctg"],parse:Z("Arctan")},{name:"Arccot",latexTrigger:["\\arcctg"],parse:Z("Arccot")},{name:"Arcsec",latexTrigger:"arcsec",parse:Z("Arcsec")},{name:"Arccsc",latexTrigger:["\\arccsc"],parse:Z("Arccsc")},{name:"Arsinh",latexTrigger:["\\arsinh"],parse:Z("Arsinh")},{name:"Arcosh",latexTrigger:["\\arcosh"],parse:Z("Arcosh")},{name:"Artanh",latexTrigger:["\\artanh"],parse:Z("Artanh")},{name:"Arsech",latexTrigger:["\\arsech"],parse:Z("Arsech")},{name:"Arcsch",latexTrigger:["\\arcsch"],parse:Z("Arcsch")},{latexTrigger:["\\ch"],parse:Z("Cosh")},{name:"Cosec",latexTrigger:["\\cosec"],parse:Z("Cosec")},{name:"Cosh",latexTrigger:["\\cosh"],parse:Z("Cosh")},{name:"Cot",latexTrigger:["\\cot"],parse:Z("Cot")},{latexTrigger:["\\cotg"],parse:Z("Cot")},{name:"Coth",latexTrigger:["\\coth"],parse:Z("Coth")},{name:"Csc",latexTrigger:["\\csc"],parse:Z("Csc")},{latexTrigger:["\\ctg"],parse:Z("Cot")},{latexTrigger:["\\cth"],parse:Z("Cotanh")},{name:"Sec",latexTrigger:["\\sec"],parse:Z("Sec")},{name:"Sinh",latexTrigger:["\\sinh"],parse:Z("Sinh")},{latexTrigger:["\\sh"],parse:Z("Sinh")},{name:"Tan",latexTrigger:["\\tan"],parse:Z("Tan")},{latexTrigger:["\\tg"],parse:Z("Tan")},{name:"Tanh",latexTrigger:["\\tanh"],parse:Z("Tanh")},{latexTrigger:["\\th"],parse:Z("Tanh")},{name:"Cos",latexTrigger:["\\cos"],parse:Z("Cos")},{name:"Sin",latexTrigger:["\\sin"],parse:Z("Sin")}];var na=[{name:"AlgebraicNumbers",latexTrigger:"\\bar\\Q"},{name:"ComplexNumbers",latexTrigger:["\\C"]},{latexTrigger:"\\mathbb{C}",parse:"ComplexNumbers"},{name:"ImaginaryNumbers",latexTrigger:["\\imaginaryI","\\R"]},{name:"ExtendedComplexNumbers",latexTrigger:["\\bar","\\C"]},{name:"EmptySet",latexTrigger:["\\emptyset"]},{latexTrigger:["\\varnothing"],parse:"EmptySet"},{name:"Integers",latexTrigger:["\\Z"]},{latexTrigger:"\\mathbb{Z}",parse:"Integers"},{name:"RationalNumbers",latexTrigger:["\\Q"]},{name:"RealNumbers",latexTrigger:["\\R"]},{latexTrigger:"\\mathbb{R}",parse:"RealNumbers"},{name:"ExtendedRealNumbers",latexTrigger:["\\bar","\\R"]},{name:"TranscendentalNumberss",latexTrigger:"\\R-\\bar\\Q"},{latexTrigger:"\\R\\backslash\\bar\\Q",parse:"TranscendentalNumbers"},{name:"NegativeNumbers",latexTrigger:"\\R^-"},{latexTrigger:"\\R^{-}",parse:"NegativeNumbers"},{latexTrigger:"\\R_-",parse:"NegativeNumbers"},{latexTrigger:"\\R_{-}",parse:"NegativeNumbers"},{latexTrigger:"\\R^{\\lt}",parse:"NegativeNumbers"},{name:"PositiveNumbers",latexTrigger:"\\R^+"},{latexTrigger:"\\R^{+}",parse:"PositiveNumbers"},{latexTrigger:"\\R_+",parse:"PositiveNumbers"},{latexTrigger:"\\R_{+}",parse:"PositiveNumbers"},{latexTrigger:"\\R^{\\gt}",parse:"PositiveNumbers"},{name:"NonPositiveNumbers",latexTrigger:"\\R^{0-}"},{latexTrigger:"\\R^{-0}",parse:"NonPositiveNumbers"},{latexTrigger:"\\R^{\\leq}",parse:"NonPositiveNumbers"},{name:"NegativeIntegers",latexTrigger:"\\Z^-"},{latexTrigger:"\\Z^-",parse:"NegativeIntegers"},{latexTrigger:"\\Z^{-}",parse:"NegativeIntegers"},{latexTrigger:"\\Z_-",parse:"NegativeIntegers"},{latexTrigger:"\\Z_{-}",parse:"NegativeIntegers"},{latexTrigger:"\\Z^{\\lt}",parse:"NegativeIntegers"},{name:"PositiveIntegers",latexTrigger:"\\Z^+"},{latexTrigger:"\\Z^{+}",parse:"PositiveIntegers"},{latexTrigger:"\\Z_+",parse:"PositiveIntegers"},{latexTrigger:"\\Z_{+}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{\\gt}",parse:"PositiveIntegers"},{latexTrigger:"\\Z^{\\gt0}",parse:"PositiveIntegers"},{latexTrigger:"\\N^+",parse:"PositiveIntegers"},{latexTrigger:"\\N^{+}",parse:"PositiveIntegers"},{latexTrigger:"\\N^*",parse:"PositiveIntegers"},{latexTrigger:"\\N^{*}",parse:"PositiveIntegers"},{latexTrigger:"\\N^\\star",parse:"PositiveIntegers"},{latexTrigger:"\\N^{\\star}",parse:"PositiveIntegers"},{latexTrigger:"\\N_1",parse:"PositiveIntegers"},{latexTrigger:"\\N_{1}",parse:"PositiveIntegers"},{name:"NonNegativeIntegers",latexTrigger:["\\N"]},{latexTrigger:"\\Z^{+0}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{\\geq}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{\\geq0}",parse:"NonNegativeIntegers"},{latexTrigger:"\\Z^{0+}",parse:"NonNegativeIntegers"},{latexTrigger:"\\mathbb{N}",parse:"NonNegativeIntegers"},{latexTrigger:"\\N_0",parse:"NonNegativeIntegers"},{latexTrigger:"\\N_{0}",parse:"NonNegativeIntegers"},{name:"CartesianProduct",latexTrigger:["\\times"],kind:"infix",associativity:"right",precedence:390,parse:(e,n,i)=>{if(390<i.minPrec)return null;let t=e.computeEngine;if(!t||!t.box(n).domain.isCompatible("Sets"))return null;let r=e.index,o=e.parseExpression({...i,minPrec:390});return o===null||t.box(n).domain.isCompatible("Sets")!==!0?(e.index=r,null):["CartesianProduct",n,o]}},{latexTrigger:["^","\\complement"],kind:"postfix",parse:(e,n)=>["Complement",n]},{name:"Complement",latexTrigger:["^","<{>","\\complement","<}>"],kind:"postfix"},{name:"Intersection",latexTrigger:["\\cap"],kind:"infix",precedence:350},{name:"Interval",serialize:ea},{name:"Multiple",serialize:ea},{name:"Union",latexTrigger:["\\cup"],kind:"infix",precedence:350},{name:"Set",kind:"matchfix",openTrigger:"{",closeTrigger:"}",precedence:20,parse:(e,n)=>n===null||ne(n)?"EmptySet":(x(n)=="Delimiter"&&z(m(n,2))===","&&(n=m(n,1)),x(n)!=="Sequence"?["Set",n]:["Set",..._(n)??[]]),serialize:(e,n)=>N(["\\lbrace",(_(n)??[]).map(i=>e.serialize(i)).join(", "),"\\rbrace"])},{name:"SetMinus",latexTrigger:["\\setminus"],kind:"infix",precedence:650},{name:"SymmetricDifference",latexTrigger:["\\triangle"],kind:"infix",precedence:M},{latexTrigger:["\\ni"],kind:"infix",associativity:"right",precedence:160,parse:(e,n,i)=>{let t=e.parseExpression(i);return t===null?null:["Element",t,n]}},{name:"Element",latexTrigger:["\\in"],kind:"infix",precedence:240},{name:"NotElement",latexTrigger:["\\notin"],kind:"infix",precedence:240},{name:"NotSubset",latexTrigger:["\\nsubset"],kind:"infix",associativity:"right",precedence:240},{name:"NotSuperset",latexTrigger:["\\nsupset"],kind:"infix",associativity:"right",precedence:240},{name:"NotSubsetNotEqual",latexTrigger:["\\nsubseteq"],kind:"infix",associativity:"right",precedence:240},{name:"NotSupersetNotEqual",latexTrigger:["\\nsupseteq"],kind:"infix",associativity:"right",precedence:240},{name:"SquareSubset",latexTrigger:["\\sqsubset"],kind:"infix",associativity:"right",precedence:265},{name:"SquareSubsetEqual",latexTrigger:["\\sqsubseteq"],kind:"infix",associativity:"right",precedence:265},{name:"SquareSuperset",latexTrigger:["\\sqsupset"],kind:"infix",associativity:"right",precedence:265},{name:"SquareSupersetEqual",latexTrigger:["\\sqsupseteq"],kind:"infix",associativity:"right",precedence:265},{name:"Subset",latexTrigger:["\\subset"],kind:"infix",associativity:"right",precedence:240},{latexTrigger:["\\subsetneq"],kind:"infix",associativity:"right",precedence:240,parse:"Subset"},{latexTrigger:["\\varsubsetneqq"],kind:"infix",associativity:"right",precedence:240,parse:"Subset"},{name:"SubsetEqual",latexTrigger:["\\subseteq"],kind:"infix",precedence:240},{name:"Superset",latexTrigger:["\\supset"],kind:"infix",associativity:"right",precedence:240},{latexTrigger:["\\supsetneq"],kind:"infix",associativity:"right",precedence:240,parse:"Superset"},{latexTrigger:["\\varsupsetneq"],kind:"infix",associativity:"right",precedence:240,parse:"Superset"},{name:"SupersetEqual",latexTrigger:["\\supseteq"],kind:"infix",associativity:"right",precedence:240}];function ea(e,n){if(n===null)return"";let i=x(n);if(i===null)return"";if(i==="Set")return G(n)===0?"\\emptyset":G(n)===2&&x(m(n,2))==="Condition"?N(["\\left\\lbrace",e.serialize(m(n,1)),"\\middle\\mid",e.serialize(m(n,2)),"\\right\\rbrace"]):N(["\\left\\lbrace",...(_(n)??[]).map(r=>e.serialize(r)+" ,"),"\\right\\rbrace"]);if(i==="Range")return N(["\\mathopen\\lbrack",e.serialize(m(n,1)),", ",e.serialize(m(n,2)),"\\mathclose\\rbrack"]);if(i==="Interval"){let r=m(n,1),o=m(n,2),s=!1,a=!1;return x(r)==="Open"&&(r=m(r,1),s=!0),x(o)==="Open"&&(o=m(o,1),a=!0),N([`\\mathopen${s?"\\rbrack":"\\lbrack"}`,e.serialize(r),", ",e.serialize(o),`\\mathclose${a?"\\lbrack":"\\rbrack"}`])}let t=e.numericSetStyle(n,e.level);return""}function pi(e,n=1){return i=>{i.skipSpace();let t=null,r=null;for(;!(r!==null&&t!==null)&&(i.peek==="_"||i.peek==="^");)i.match("_")?r=i.parseGroup()??i.parseToken():i.match("^")&&(t=i.parseGroup()??i.parseToken()),i.skipSpace();(r==="Nothing"||ne(r))&&(r=null),(t==="Nothing"||ne(t))&&(t=null);let[o,s]=cf(i,n);if(o&&!s){if(x(o)==="Add"||x(o)==="Subtract"){let a=[],u=[];for(let l of _(o)??[])if(s)u.push(l);else{let f;[f,s]=on(l),a.push(f??l)}if(s!==null&&u.length>0)return["Add",ia(i,e,["Add",...a],[{index:s,sub:r,sup:t}]),...u]}else if(x(o)==="Divide"){let a;[a,s]=on(m(o,1)),a!==null&&s!==null&&(o=["Divide",a,m(o,2)])}}return ia(i,e,o,[{index:s,sub:r,sup:t}])}}function ia(e,n,i,t){if(i&&t.length===0)return[n,i];if(i??(i="Nothing"),e.computeEngine){let r=e.computeEngine,o=!1,s={};for(let a of t)a.index&&(o=!0,s[a.index]={domain:"ExtendedRealNumbers"});o&&r.pushScope().declare(s),i=r.box(i).json,o&&r.popScope()}return[n,i,...t.map(r=>df(r))]}function df(e){let n=e.index?["Hold",e.index]:"Nothing";return e.sup!==null?["Tuple",n,e.sub??"Nothing",e.sup]:e.sub!==null?["Tuple",n,e.sub]:n}function cf(e,n=1){let i=e.index,t=!1,r=e.parseExpression({minPrec:266,condition:()=>((e.matchAll(["\\mathrm","<{>","d","<}>"])||e.matchAll(["\\operatorname","<{>","d","<}>"]))&&(t=!0),t)});if(t||(e.index=i,r=e.parseExpression({minPrec:266,condition:()=>(e.match("d")&&(t=!0),t)})),r&&!t)return on(r);let o=mf(e,n);return[r,o[0]??null]}function mf(e,n=1){e.skipSpace();let i=[],t=V(e.parseSymbol());return t===null?[]:(i.push(t),i)}function on(e){let n=x(e),i=m(e,1);if(!i)return[e,null];if(n==="Sequence"&&G(e)===1)return on(i);if(n==="Multiply"||n==="InvisibleOperator"){let t=_(e);if(t&&t.length>1){let r=V(t[t.length-2]);if(r==="d"||r==="d_upright")return t.length===2?[null,V(t[1])]:t.length===3?[t[0],V(t[2])]:[["Multiply",...t.slice(0,-2)],V(t[t.length-1])];let[o,s]=on(t[t.length-1]);if(o)return[["Multiply",...t.slice(0,-1),o],s]}}else if(n==="Delimiter"){let[t,r]=on(i);if(r)return t?[["Delimiter",["Sequence",t],..._(e).slice(1)],r]:[null,r]}else if(n==="Add"){let t=_(e);if(t&&t.length>0){let[r,o]=on(t[t.length-1]);if(o){if(r)return[["Add",...t.slice(0,-1),r],o];if(t.length>2)return[["Add",...t.slice(0,-1)],o];if(t.length>2)return[t[0],o]}}}else if(n==="Negate"){let[t,r]=on(i);if(r)return[t?["Negate",t]:null,r]}else if(n==="Divide"){let[t,r]=on(i);if(r)return[["Divide",t??1,m(e,2)],r]}else{let t=_(e);if(t?.length===1){let[r,o]=on(t[0]);if(o)return[[x(e),r],o]}}return[e,null]}function ta(e){return(n,i)=>{if(!m(i,1))return e;let t=m(i,2),r=x(t),o=null;r==="Tuple"||r==="Triple"||r==="Pair"||r==="Single"?o=m(t,1):r==="Hold"?o=m(t,1):(o=m(t,1)??"x",t=null),x(o)==="Hold"&&(o=m(o,1));let s=o!==null?V(o):null,a=m(i,1);if(x(a)==="Lambda"&&m(a,1)&&(a=Li(m(a,1),{_:s??"x",_1:s??"x"})),!t)return!s||s==="Nothing"?N([e,"\\!",n.serialize(a)]):N([e,"\\!",n.serialize(a),"\\,\\operatorname{d}",n.serialize(s)]);let u=m(t,2)?V(m(t,2)):null,l=t&&u!=="Nothing"?n.serialize(m(t,2)):"";l.length>0&&(l=`_{${l}}`);let f="",d=m(t,3)?V(m(t,3)):null;return m(t,3)&&d!=="Nothing"&&(f=`^{${n.serialize(m(t,3))}}`),N([e,f,l,"\\!",n.serialize(a),...s&&V(s)!=="Nothing"?["\\,\\operatorname{d}",n.serialize(s)]:[]])}}var ra=[{kind:"expression",name:"Integrate",latexTrigger:["\\int"],parse:pi("Integrate"),serialize:ta("\\int")},{kind:"expression",latexTrigger:["\\iint"],parse:pi("Integrate",2)},{kind:"expression",latexTrigger:["\\iiint"],parse:pi("Integrate",3)},{kind:"expression",name:"CircularIntegrate",latexTrigger:["\\oint"],parse:pi("CircularIntegrate"),serialize:ta("\\oint")},{kind:"expression",latexTrigger:["\\oiint"],parse:pi("CircularIntegrate",2)},{kind:"expression",latexTrigger:["\\oiiint"],parse:pi("CircularIntegrate",3)}];var Ye=[["alpha","\\alpha",945],["beta","\\beta",946],["gamma","\\gamma",947],["delta","\\delta",948],["epsilon","\\epsilon",949],["epsilonSymbol","\\varepsilon",1013],["zeta","\\zeta",950],["eta","\\eta",951],["theta","\\theta",952],["thetaSymbol","\\vartheta",977],["iota","\\iota",953],["kappa","\\kappa",954],["kappaSymbol","\\varkappa",1008],["lambda","\\lambda",955],["mu","\\mu",956],["nu","\\nu",957],["xi","\\xi",958],["omicron","\\omicron",959],["pi","\\pi",960],["piSymbol","\\varpi",982],["rho","\\rho",961],["rhoSymbol","\\varrho",1009],["sigma","\\sigma",963],["finalSigma","\\varsigma",962],["tau","\\tau",964],["phi","\\phi",981],["phiLetter","\\varphi",966],["upsilon","\\upsilon",965],["chi","\\chi",967],["psi","\\psi",968],["omega","\\omega",969],["Alpha","\\Alpha",913],["Beta","\\Beta",914],["Gamma","\\Gamma",915],["Delta","\\Delta",916],["Epsilon","\\Epsilon",917],["Zeta","\\Zeta",918],["Eta","\\Eta",919],["Theta","\\Theta",920],["Iota","\\Iota",921],["Kappa","\\Kappa",922],["Lambda","\\Lambda",923],["Mu","\\Mu",924],["Nu","\\Nu",925],["Xi","\\Xi",926],["Omicron","\\Omicron",927],["Rho","\\Rho",929],["Sigma","\\Sigma",931],["Tau","\\Tau",932],["Phi","\\Phi",934],["Upsilon","\\Upsilon",933],["Chi","\\Chi",935],["Psi","\\Psi",936],["Omega","\\Omega",937],["digamma","\\digamma",989],["aleph","\\aleph",8501],["bet","\\beth",8502],["gimel","\\gimel",8503],["dalet","\\daleth",8504],["ell","\\ell",8499],["turnedCapitalF","\\Finv",8498],["turnedCapitalG","\\Game",8513],["weierstrass","\\wp",8472],["eth","\\eth",240],["invertedOhm","\\mho",8487],["hBar","\\hbar",295],["hSlash","\\hslash",8463],["blackClubSuit","\\clubsuit",9827],["whiteHeartSuit","\\heartsuit",9825],["blackSpadeSuit","\\spadesuit",9824],["whiteDiamondSuit","\\diamondsuit",9826],["sharp","\\sharp",9839],["flat","\\flat",9837],["natural","\\natural",9838]],oa=[...Ye.map(([e,n,i])=>({kind:"symbol",name:e,latexTrigger:[n],parse:e})),...Ye.map(([e,n,i])=>({kind:"symbol",latexTrigger:[String.fromCodePoint(i)],parse:e}))];var sa=[{name:"Real",kind:"function",latexTrigger:["\\Re"]},{name:"Imaginary",kind:"function",latexTrigger:["\\Im"]},{name:"Argument",kind:"function",latexTrigger:["\\arg"]},{name:"Conjugate",latexTrigger:["^","\\star"],kind:"postfix"}];var aa=[{name:"Mean",kind:"function",identifierTrigger:"mean"},{name:"Median",kind:"function",identifierTrigger:"median"},{name:"StandarDeviation",kind:"function",identifierTrigger:"stddev"},{latexTrigger:["\\bar"],kind:"expression",parse:(e,n)=>{let i=e.parseGroup()??e.parseToken();return!i||!V(i)?null:["Mean",i]}}];var ua={"(":"(",")":")","[":"\\lbrack","]":"\\rbrack","{":"\\lbrace","}":"\\rbrace","<":"\\langle",">":"\\rangle","|":"\\vert","||":"\\Vert","\\lceil":"\\lceil","\\lfloor":"\\lfloor","\\rceil":"\\rceil","\\rfloor":"\\rfloor"};function la(e,n,i){let t=pf(n,i);if(t===null)return;let r="kind"in n?n.kind:"expression",o=t.latexTrigger;typeof o=="string"&&(e.lookahead=Math.max(e.lookahead,Ot(o)));let s=$(o??"",[]);if(s.length===2&&/[_^]/.test(s[0])&&s[1]!=="<{>"&&r!=="function"&&r!=="environment"&&r!=="matchfix"){let a=n.parse;!a&&n.name&&(r==="postfix"||r==="prefix"?a=(u,l)=>[n.name,l]:a=n.name),la(e,{...n,kind:r,name:void 0,serialize:void 0,parse:a,latexTrigger:[s[0],"<{>",s[1],"<}>"]},i)}e.defs.push(t),t.name!==void 0&&(e.ids.has(t.name)&&i({severity:"warning",message:["invalid-dictionary-entry",t.name,"Duplicate definition. The name (MathJSON identifier) must be unique, but triggers can be shared by multiple definitions."]}),e.ids.set(t.name,t))}function eo(e,n){let i={lookahead:1,ids:new Map,defs:[]};for(let t of e)la(i,t,n);return i}function pf(e,n){if(!xf(e,n))return null;let i={kind:"kind"in e?e.kind:"expression"},t=null;"latexTrigger"in e&&(typeof e.latexTrigger=="string"?t=$(e.latexTrigger,[]):t=e.latexTrigger);let r=null;"identifierTrigger"in e&&(r=e.identifierTrigger),t!==null&&(i.latexTrigger=rn(t)),r!==null&&(i.identifierTrigger=r),e.name&&(i.name=e.name,i.serialize=hf(e,t,r)),i.kind==="matchfix"&&ri(e)&&(i.openTrigger=e.openTrigger,i.closeTrigger=e.closeTrigger),i.kind==="symbol"&&Or(e)&&(i.precedence=e.precedence??1e4),(i.kind==="prefix"||i.kind==="postfix")&&(Pi(e)||Tt(e))&&(t&&(t[0]==="^"||t[0]==="_")?(i.precedence=720,e.precedence):i.precedence=e.precedence??1e4),i.kind==="infix"&&St(e)&&(!t||t[0]!=="^"&&t[0]!=="_"||!e.associativity||e.associativity,i.associativity=e.associativity??"non",i.precedence=e.precedence??1e4);let o=gf(e,t,r);return o&&(i.parse=o),i}function hf(e,n,i){if(typeof e.serialize=="function")return e.serialize;let t=e.kind??"expression";if(t==="environment"){let s=e.identifierTrigger??e.name??"unknown";return(a,u)=>N([`\\begin{${s}}`,a.serialize(m(u,1)),`\\end{${s}}`])}if(ri(e)){let s=typeof e.openTrigger=="string"?ua[e.openTrigger]:rn(e.openTrigger),a=typeof e.closeTrigger=="string"?ua[e.closeTrigger]:rn(e.closeTrigger);return(u,l)=>N([s,u.serialize(m(l,1)),a])}let r=e.serialize;if(r===void 0&&n&&(r=rn(n)),r)return t==="postfix"?(s,a)=>N([s.serialize(m(a,1)),r]):t==="prefix"?(s,a)=>N([r,s.serialize(m(a,1))]):t==="infix"?(s,a)=>N((_(a)??[]).flatMap((u,l)=>l<G(a)-1?[s.serialize(u),r]:[s.serialize(u)])):(s,a)=>x(a)?N([r,s.wrapArguments(a)]):r;let o=i??e.name??"unknown";return t==="postfix"?(s,a)=>N([s.serialize(m(a,1)),s.serializeSymbol(o)]):t==="prefix"?(s,a)=>N([s.serializeSymbol(o),s.serialize(m(a,1))]):t==="infix"?(s,a)=>N([s.serialize(m(a,1)),s.serializeSymbol(o),s.serialize(m(a,2))]):(s,a)=>x(a)?N([s.serializeSymbol(o),s.wrapArguments(a)]):s.serializeSymbol(o)}function gf(e,n,i){if("parse"in e&&typeof e.parse=="function")return e.parse;let t="kind"in e?e.kind:"expression";if(t==="environment"){let r=e.parse??e.name??i;if(r)return(o,s)=>{let a=o.parseTabular();return a===null?null:[r,["List",a.map(u=>["List",...u])]]}}if(t==="function"){let r=e.parse??e.name??i;if(r)return(o,s)=>{let a=o.parseArguments("enclosure",s);return a===null?r:[r,...a]}}if(t==="symbol"){let r=e.parse??e.name??i;if(r)return(o,s)=>r}if(t==="prefix"){let r=e.parse??e.name??i;if(r){let o=e.precedence??1e4;return(s,a)=>{let u=s.parseExpression({...a??[],minPrec:o});return u===null?null:[r,u]}}}if(t==="postfix"){let r=e.parse??e.name;if(r)return(o,s)=>s===null?null:[r,s]}if(t==="infix"){if(/[_^]/.test(n?.[0]??"")){let a=e.name??e.parse;return(u,l)=>[a,j(m(l,1)),j(m(l,2))]}let r=e.parse??e.name??i,o=e.precedence??1e4,s=e.associativity??"non";if(r)return(a,u,l)=>{if(u===null||o<l.minPrec)return null;let f=j(a.parseExpression({...l,minPrec:o}));return typeof r=="string"?ci(r,u,f,s):[r,u,f]}}if(t==="matchfix"){let r=e.parse??e.name;if(r)return(o,s)=>s===null||ne(s)?null:[r,s]}if(t==="expression"){let r=e.parse??e.name??i;if(r)return()=>r}if("parse"in e){let r=e.parse;return()=>r}}function xf(e,n){let i=e.name??e.latexTrigger??e.identifierTrigger??e.openTrigger;if(!i)try{i=JSON.stringify(e)}catch{i="???"}if(Array.isArray(i)&&(i=rn(i)),"trigger"in e&&n({severity:"warning",message:["invalid-dictionary-entry",i,"The 'trigger' property is deprecated. Use 'latexTrigger' or 'identifierTrigger' instead"]}),"kind"in e&&!["expression","symbol","function","infix","postfix","prefix","matchfix","environment"].includes(e.kind)&&n({severity:"warning",message:["invalid-dictionary-entry",i,"The 'kind' property must be one of 'expression', 'symbol', 'function', 'infix', 'postfix', 'prefix', 'matchfix', 'environment'"]}),e.serialize!==void 0&&!e.name)return n({severity:"warning",message:["invalid-dictionary-entry",i,"A 'name' property must be provided if a 'serialize' handler is provided"]}),!1;if("identifierTrigger"in e&&(!("kind"in e)||e.kind!=="environment")&&(typeof e.identifierTrigger!="string"||!xe(e.identifierTrigger))&&n({severity:"warning",message:["invalid-dictionary-entry",i,"The 'identifierTrigger' property must be a valid identifier"]}),"name"in e&&(typeof e.name!="string"?e.name!==void 0&&n({severity:"warning",message:["invalid-dictionary-entry",i,"The 'name' property must be a string"]}):xe(e.name)||n({severity:"warning",message:["invalid-dictionary-entry",e.name,"The 'name' property must be a valid identifier"]})),ri(e)){if("latexTrigger"in e||"identifierTrigger"in Pi)return n({severity:"warning",message:["invalid-dictionary-entry",i,"'matchfix' operators use a 'openTrigger' and 'closeTrigger' instead of a 'latexTrigger' or 'identifierTrigger'. "]}),!1;if(!e.openTrigger||!e.closeTrigger)return n({severity:"warning",message:["invalid-dictionary-entry",i,"Expected `openTrigger` and a `closeTrigger` for matchfix operator"]}),!1;if(typeof e.openTrigger!=typeof e.closeTrigger)return n({severity:"warning",message:["invalid-dictionary-entry",i,"Expected `openTrigger` and `closeTrigger` to both be strings or array of LatexToken"]}),!1}if(St(e)||Tt(e)||Pi(e)){if(Array.isArray(e.latexTrigger)&&(e.latexTrigger[0]==="_"||e.latexTrigger[0]==="^")||typeof e.latexTrigger=="string"&&(e.latexTrigger.startsWith("^")||e.latexTrigger.startsWith("_"))){if(e.precedence!==void 0||e.associativity!==void 0)return n({severity:"warning",message:["invalid-dictionary-entry",i,'Unexpected "precedence" or "associativity" for superscript/subscript operator']}),!1}else if(e.precedence===void 0)return n({severity:"warning",message:["invalid-dictionary-entry",i,`Expected a "precedence" for ${e.kind} operator`]}),!1}else if(e.associativity!==void 0)return n({severity:"warning",message:["invalid-dictionary-entry",i,'Unexpected "associativity" operator']}),!1;return!ri(e)&&!Pr(e)&&!e.latexTrigger&&!e.identifierTrigger&&!e.name?(n({severity:"warning",message:["invalid-dictionary-entry",i,"Expected a 'name', a 'latexTrigger' or a 'identifierTrigger'"]}),!1):e.parse===void 0&&e.name===void 0?(n({severity:"warning",message:["invalid-dictionary-entry",i,"Expected a 'parse' or 'name'"]}),!1):!0}var hi={algebra:Ds,arithmetic:Gs,calculus:ra,complex:sa,core:js,"linear-algebra":Ys,logic:Qs,relop:Js,other:Xs,physics:[{name:"mu0",kind:"symbol",latexTrigger:"\\mu_0"}],sets:na,statistics:aa,symbols:oa,trigonometry:Ks};var bf={"\\mathord":"","\\mathop":"","\\mathbin":"","\\mathrel":"","\\mathopen":"","\\mathclose":"","\\mathpunct":"","\\mathinner":"","\\operatorname":"","\\mathrm":"_upright","\\mathit":"_italic","\\mathbf":"_bold","\\mathscr":"_script","\\mathcal":"_calligraphic","\\mathfrak":"_fraktur","\\mathsf":"_sansserif","\\mathtt":"_monospace","\\mathbb":"_doublestruck"},yf={"\\mathring":"_ring","\\hat":"_hat","\\tilde":"_tilde","\\vec":"_vec","\\overline":"_bar","\\underline":"_underbar","\\dot":"_dot","\\ddot":"_ddot","\\dddot":"_dddot","\\ddddot":"_ddddot","\\acute":"_acute","\\grave":"_grave","\\breve":"_breve","\\check":"_check"};function fa(e,n){if(e.atEnd)return null;let i=e.peek,t={"\\_":"_","\\#":"hash"}[i];if(!t&&!n.toplevel&&(t={"+":"plus","-":"minus","\\plusmn":"pm","\\pm":"pm","\\ast":"ast","\\dag":"dag","\\ddag":"ddag","\\bot":"bottom","\\top":"top","\\bullet":"bullet","\\cir":"circle","\\diamond":"diamond","\\times":"times","\\square":"square","\\star":"star"}[i]),t)return e.nextToken(),t;let r=Ye.findIndex(o=>o[1]===i);return r>=0?(e.nextToken(),Ye[r][0]):e.matchChar()??e.nextToken()}function qt(e){let n=no(e),i=e.index,t=yf[e.peek]??null;if(t){if(e.nextToken(),!e.match("<{>"))return e.index=i,null;let s=qt(e);if(s===null||!e.match("<}>"))return e.index=i,null;n=`${s}${t}`}if(n===null){for(n="";!e.atEnd;){let s=e.peek;if(s==="<}>"||s==="_"||s==="^")break;let a=fa(e,{toplevel:!1});if(a===null)return e.index=i,null;n+=a}for(;!e.atEnd&&/\d/.test(e.peek);)n+=e.nextToken()}for(;!e.atEnd;)if(e.match("\\degree"))n+="_deg";else if(e.matchAll(["^","\\prime"]))n+="_prime";else if(e.matchAll(["^","<{>","\\prime","<}>"]))n+="_prime";else if(e.matchAll(["^","<{>","\\doubleprime","<}>"]))n+="_dprime";else if(e.matchAll(["^","<{>","\\prime","\\prime","<}>"]))n+="_dprime";else break;let r=[],o=[];for(;!e.atEnd;)if(e.match("_")){let s=e.match("<{>"),a=qt(e);if(s&&!e.match("<}>")||a===null)return e.index=i,null;o.push(a)}else if(e.match("^")){let s=e.match("<{>"),a=qt(e);if(s&&!e.match("<}>")||a===null)return e.index=i,null;r.push(a)}else break;return r.length>0&&(n+="__"+r.join("")),o.length>0&&(n+="_"+o.join("")),n}function no(e){let n=e.index,i=bf[e.peek]??null;if(i===null)return null;if(e.nextToken(),e.match("<{>")){let t="",r={0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"}[e.peek]??"";return r&&(t=r,e.nextToken()),t+=qt(e),t===null||!e.match("<}>")?(e.index=n,null):i==="_upright"&&t.length>1?t:t+i}return e.index=n,null}function io(e){let n=e.index,i=no(e);return i===null||xe(i)?(e.index=n,null):e.error(["invalid-identifier",{str:We(i)}],n)}function $i(e){if(/^[a-zA-Z]$/.test(e.peek)||/^\p{XIDS}$/u.test(e.peek))return e.nextToken();let n=e.index,i=no(e);if(!i){for(i="";!e.atEnd&&fi.test(i+e.peek);)i+=e.nextToken();i||(i=null)}return i??(i=fa(e,{toplevel:!0})),i&&(i=i.normalize(),xe(i))?i:(e.index=n,null)}var da={"(":["\\lparen","("],")":["\\rparen",")"],"[":["\\lbrack","\\[","["],"]":["\\rbrack","\\]","]"],"<":["<","\\langle"],">":[">","\\rangle"],"{":["\\{","\\lbrace"],"}":["\\}","\\rbrace"],":":[":","\\colon"],"|":["|","\\|","\\lvert","\\rvert"],"||":["||","\\Vert","\\lVert","\\rVert"],"\\lfloor":["\\lfloor"],"\\rfloor":["\\rfloor"],"\\lceil":["\\lceil"],"\\rceil":["\\rceil"],"\\ulcorner":["\\ulcorner"],"\\urcorner":["\\urcorner"],"\\llcorner":["\\llcorner"],"\\lrcorner":["\\lrcorner"],"\\lgroup":["\\lgroup"],"\\rgroup":["\\rgroup"],"\\lmoustache":["\\lmoustache"],"\\rmoustache":["\\rmoustache"]},Vt={"\\left":"\\right","\\bigl":"\\bigr","\\Bigl":"\\Bigr","\\biggl":"\\biggr","\\Biggl":"\\Biggr","\\big":"\\big","\\Big":"\\Big","\\bigg":"\\bigg","\\Bigg":"\\Bigg"},zi={"(":")","[":"]","|":"|","\\{":"\\}","\\[":"\\]","\\lbrace":"\\rbrace","\\lparen":"\\rparen","\\langle":"\\rangle","\\lfloor":"\\rfloor","\\lceil":"\\rceil","\\vert":"\\vert","\\lvert":"\\rvert","\\Vert":"\\Vert","\\lVert":"\\rVert","\\lbrack":"\\rbrack","\\ulcorner":"\\urcorner","\\llcorner":"\\lrcorner","\\lgroup":"\\rgroup","\\lmoustache":"\\rmoustache"},to={precision:6,positiveInfinity:"\\infty",negativeInfinity:"-\\infty",notANumber:"\\operatorname{NaN}",decimalMarker:".",groupSeparator:"\\,",exponentProduct:"\\cdot",beginExponentMarker:"10^{",endExponentMarker:"}",notation:"auto",truncationMarker:"\\ldots",beginRepeatingDigits:"\\overline{",endRepeatingDigits:"}",imaginaryUnit:"\\imaginaryI",avoidExponentsInRange:[-7,20]},ro={skipSpace:!0,parseArgumentsOfUnknownLatexCommands:!0,parseNumbers:"auto",parseUnknownIdentifier:(e,n)=>n.computeEngine?.lookupFunction(e)!==void 0?"function":"symbol",preserveLatex:!1},$t=class{constructor(n,i,t,r){this.index=0;this._boundaries=[];this._lastPeek="";this._peekCounter=0;this._tokens=n,this.options={...to,...ro,...i},this._dictionary=t,this.computeEngine=r,this._positiveInfinityTokens=$(this.options.positiveInfinity,[]),this._negativeInfinityTokens=$(this.options.negativeInfinity,[]),this._notANumberTokens=$(this.options.notANumber,[]),this._decimalMarkerTokens=$(this.options.decimalMarker,[]),this._groupSeparatorTokens=$(this.options.groupSeparator,[]),this._exponentProductTokens=$(this.options.exponentProduct,[]),this._beginExponentMarkerTokens=$(this.options.beginExponentMarker,[]),this._endExponentMarkerTokens=$(this.options.endExponentMarker,[]),this._truncationMarkerTokens=$(this.options.truncationMarker,[]),this._beginRepeatingDigitsTokens=$(this.options.beginRepeatingDigits,[]),this._endRepeatingDigitsTokens=$(this.options.endRepeatingDigits,[]),this._imaginaryNumberTokens=$(this.options.imaginaryUnit,[])}updateOptions(n){for(let[i,t]of Object.entries(n))if(i in this.options)this.options[i]=t,typeof t=="string"&&(i==="positiveInfinity"&&(this._positiveInfinityTokens=$(t,[])),i==="negativeInfinity"&&(this._negativeInfinityTokens=$(t,[])),i==="notANumber"&&(this._notANumberTokens=$(t,[])),i==="decimalMarker"&&(this._decimalMarkerTokens=$(t,[])),i==="groupSeparator"&&(this._groupSeparatorTokens=$(t,[])),i==="exponentProduct"&&(this._exponentProductTokens=$(t,[])),i==="beginExponentMarker"&&(this._beginExponentMarkerTokens=$(t,[])),i==="endExponentMarker"&&(this._endExponentMarkerTokens=$(t,[])),i==="truncationMarker"&&(this._truncationMarkerTokens=$(t,[])),i==="beginRepeatingDigits"&&(this._beginRepeatingDigitsTokens=$(t,[])),i==="endRepeatingDigits"&&(this._endRepeatingDigitsTokens=$(t,[])),i==="imaginaryNumber"&&(this._imaginaryNumberTokens=$(t,[])));else throw Error(`Unexpected option "${i}"`)}get atEnd(){return this.index>=this._tokens.length}get peek(){let n=this._tokens[this.index];if(n===this._lastPeek?this._peekCounter+=1:this._peekCounter=0,this._peekCounter>=1024){let i=`Infinite loop detected while parsing "${this.latex(0)}" at "${this._lastPeek}" (index ${this.index})`;throw console.error(i),new Error(i)}return this._lastPeek=n,n}nextToken(){return this._tokens[this.index++]}atTerminator(n){return this.atBoundary||((n?.condition&&n.condition(this))??!1)}get atBoundary(){if(this.atEnd)return!0;let n=this.index;for(let i of this._boundaries)if(this.matchAll(i.tokens))return this.index=n,!0;return!1}addBoundary(n){this._boundaries.push({index:this.index,tokens:n})}removeBoundary(){this._boundaries.pop()}matchBoundary(){let n=this._boundaries[this._boundaries.length-1],i=n&&this.matchAll(n.tokens);return i&&this._boundaries.pop(),i}boundaryError(n){let i=this._boundaries[this._boundaries.length-1];return this._boundaries.pop(),this.error(n,i.index)}latex(n,i){return rn(this._tokens.slice(n,i))}latexAhead(n){return this.latex(this.index,this.index+n)}lookAhead(){let n=Math.min(this._dictionary.lookahead,this._tokens.length-this.index);if(n<=0)return[];let i=[];for(;n>0;)i.push([n,this.latexAhead(n--)]);return i}peekDefinitions(n){if(this.atEnd)return[];let i=[],t=[...this.getDefs(n)];for(let r of t)r.latexTrigger===""&&i.push([r,0]);for(let[r,o]of this.lookAhead())for(let s of t)s.latexTrigger===o&&i.push([s,r]);for(let r of t)if(r.identifierTrigger){let o=Ef(this,r.identifierTrigger);o>0&&i.push([r,o])}return i}skipSpaceTokens(){for(;this.match("<space>"););}skipSpace(){if(!this.atEnd&&this.peek==="<{>"){let i=this.index;for(this.nextToken();this.match("<space>"););if(this.nextToken()==="<}>")return this.skipSpace(),!0;this.index=i}if(!this.options.skipSpace)return!1;let n=!1;for(;this.match("<space>");)n=!0;return n&&this.skipSpace(),n}skipVisualSpace(){this.options.skipSpace&&(this.skipSpace(),["\\!","\\,","\\:","\\;","\\enskip","\\enspace","\\space","\\quad","\\qquad"].includes(this.peek)&&(this.nextToken(),this.skipVisualSpace()),this.skipSpace())}match(n){return this._tokens[this.index]===n?(this.index++,!0):!1}matchAll(n){if(Array.isArray(n),n.length===0)return!1;let i=!0,t=0;do i=this._tokens[this.index+t]===n[t++];while(i&&t<n.length);return i&&(this.index+=t),i}matchAny(n){return n.includes(this._tokens[this.index])?this._tokens[this.index++]:""}matchChar(){let n=this.index,i=0;for(;this.match("^");)i+=1;if(i<2&&(this.index=n),i>=2){let t="",r=0;for(;r!=i;){let o=this.matchAny(["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]);if(!o)break;t+=o,r+=1}if(t.length===i)return String.fromCodePoint(Number.parseInt(t,16))}else if(this.match("\\char")){let t=Math.floor(this.matchLatexNumber()??Number.NaN);return(!Number.isFinite(t)||t<0||t>1114111)&&(t=10067),String.fromCodePoint(t)}else if(this.match("\\unicode"))if(this.skipSpaceTokens(),this.match("<{>")){let t=this.matchLatexNumber();if(this.match("<}>")&&t!==null&&t>=0&&t<=1114111)return String.fromCodePoint(t)}else{let t=this.matchLatexNumber();if(t!==null&&t>=0&&t<=1114111)return String.fromCodePoint(t)}return this.index=n,null}matchDelimiter(n,i){if(this.peek==="[")return!1;if(Array.isArray(n))return Array.isArray(i),this.matchAll(n)?(this.addBoundary(i),!0):!1;Array.isArray(i);let t=this.index,r=Vt[this.peek];return r&&this.nextToken(),n==="||"&&this.matchAll(["|","|"])?(this.addBoundary(["|","|"]),!0):(da[n]??[n]).includes(this.peek)?(n=this.nextToken(),i=zi[n]??i,this.addBoundary(r?[r,i]:[i]),!0):(this.index=t,!1)}parseGroup(){let n=this.index;if(this.skipSpaceTokens(),this.match("<{>")){this.addBoundary(["<}>"]);let i=this.parseExpression();if(this.skipSpace(),this.matchBoundary())return i??["Sequence"];for(;!this.matchBoundary()&&!this.atEnd;)this.nextToken();if(x(i)==="Error")return i;let t=this.error("expected-closing-delimiter",n);return i?["InvisibleOperator",i,t]:t}return this.index=n,null}parseToken(){if([...'!"#$%&(),/;:?@[]\\`|~'.split(""),"\\left","\\bigl"].includes(this.peek))return null;if(/^[0-9]$/.test(this.peek))return parseInt(this.nextToken());let i=this.parseGenericExpression()??this.parseSymbol();return i||null}parseOptionalGroup(){let n=this.index;if(this.skipSpaceTokens(),this.match("[")){this.addBoundary(["]"]);let i=this.parseExpression();return this.skipSpace(),this.matchBoundary()?i:this.boundaryError("expected-closing-delimiter")}return this.index=n,null}parseTabular(){let n=[],i=[],t=null;for(;!this.atBoundary;)if(this.skipSpace(),this.match("&"))i.push(t??"Nothing"),t=null;else if(this.match("\\\\")||this.match("\\cr"))this.skipSpace(),this.parseOptionalGroup(),t!==null&&i.push(t),n.push(i),i=[],t=null;else{let r=[],o=this.peek;for(;o!=="&"&&o!=="\\\\"&&o!=="\\cr"&&!this.atBoundary;)t=this.parseExpression({minPrec:0,condition:s=>{let a=s.peek;return a==="&"||a==="\\\\"||a==="\\cr"}}),t?r.push(t):(r.push(["Error",["'unexpected-token'",o]]),this.nextToken()),this.skipSpace(),o=this.peek;r.length>1?t=["Sequence",...r]:t=r[0]??"Nothing"}return t!==null&&i.push(t),i.length>0&&n.push(i),n}parseStringGroup(n){n===void 0&&(n=!1);let i=this.index;for(;this.match("<space>"););if(this.match(n?"[":"<{>")){this.addBoundary([n?"]":"<}>"]);let t=this.parseStringGroupContent();if(this.matchBoundary())return t;this.removeBoundary()}return this.index=i,null}parseEnvironment(n){let i=this.index;if(!this.match("\\begin"))return null;let t=this.parseStringGroup()?.trim();if(!t)return this.error("expected-environment-name",i);this.addBoundary(["\\end","<{>",...t.split(""),"<}>"]);for(let r of this.getDefs("environment"))if(r.identifierTrigger===t){let o=r.parse(this,n);return this.skipSpace(),this.matchBoundary()?o!==null?this.decorate(o,i):(this.index=i,null):this.boundaryError("unbalanced-environment")}return this.parseTabular(),this.skipSpace(),this.matchBoundary()?this.error(["unknown-environment",{str:t}],i):this.boundaryError("unbalanced-environment")}parseOptionalSign(){let n=!!this.matchAny(["-","\u2212"]);for(;this.matchAny(["+","\uFE62"])||this.skipSpace();)this.matchAny(["-","\u2212"])&&(n=!n);return n?"-":"+"}parseDecimalDigits(n){n??(n={}),n.withGrouping??(n.withGrouping=!0);let i=[],t=!1;for(;!t;){for(;/^[0-9]$/.test(this.peek);)i.push(this.nextToken()),this.skipVisualSpace();if(t=!0,n.withGrouping&&this.options.groupSeparator){let r=this.index;this.skipVisualSpace(),this.matchAll(this._groupSeparatorTokens)&&(this.skipVisualSpace(),/^[0-9]$/.test(this.peek)?t=!1:this.index=r)}}return i.join("")}parseSignedInteger(n){n??(n={}),n.withGrouping??(n.withGrouping=!0);let i=this.index,t=this.parseOptionalSign(),r=this.parseDecimalDigits(n);return r?t==="-"?"-"+r:r:(this.index=i,"")}parseExponent(){let n=this.index;if(this.matchAny(["e","E"])){let i=this.parseSignedInteger({withGrouping:!1});if(i)return i}if(this.index=n,this.match("\\times")&&(this.skipSpaceTokens(),this.match("1")&&this.match("0")&&this.match("^"))){if(/^[0-9]$/.test(this.peek))return this.nextToken();if(this.match("<{>")){this.skipSpaceTokens();let i=this.parseSignedInteger();if(this.skipSpaceTokens(),this.match("<}>")&&i)return i}}if(this.index=n,this.skipSpaceTokens(),this.match("\\%"))return"-2";if(this.index=n,this.matchAll(this._exponentProductTokens)&&(this.skipSpaceTokens(),this.matchAll(this._beginExponentMarkerTokens))){this.skipSpaceTokens();let i=this.parseSignedInteger({withGrouping:!1});if(this.skipSpaceTokens(),this.matchAll(this._endExponentMarkerTokens)&&i)return i}return this.index=n,""}parseRepeatingDecimal(){let n=this.index,i="";return this.match("(")?(i=this.parseDecimalDigits(),i&&this.match(")")?"("+i+")":(this.index=n,"")):(this.index=n,this.matchAll(["\\left","("])?(i=this.parseDecimalDigits(),i&&this.matchAll(["\\right",")"])?"("+i+")":(this.index=n,"")):(this.index=n,this.matchAll(["\\overline","<{>"])?(i=this.parseDecimalDigits(),i&&this.match("<}>")?"("+i+")":(this.index=n,"")):(this.index=n,this.matchAll(this._beginRepeatingDigitsTokens)?(i=this.parseDecimalDigits(),i&&this.matchAll(this._endRepeatingDigitsTokens)?"("+i+")":(this.index=n,"")):(this.index=n,""))))}parseNumber(){if(this.options.parseNumbers===!1||this.options.parseNumbers==="never")return null;let n=this.index;this.skipVisualSpace();let i=1;for(;this.peek==="-"||this.peek==="+";)this.match("-")?i*=-1:this.match("+"),this.skipVisualSpace();let t="",r="",o=!1;if(this.match(".")||this.matchAll(this._decimalMarkerTokens)){let f=this.peek;(f==="\\overline"||f===this._beginRepeatingDigitsTokens[0]||/[0-9\(]/.test(f))&&(o=!0,t="0")}else t=this.parseDecimalDigits();if(!t)return this.index=n,null;let s=this.index,a=!1;(o||this.match(".")||this.matchAll(this._decimalMarkerTokens))&&(r=this.parseDecimalDigits(),a=!0);let u=!1;if(a){let f=this.parseRepeatingDecimal();f?(r+=f,u=!0):this.match("\\ldots")||this.matchAll(this._truncationMarkerTokens)}if(a&&!r)return this.index=s,{num:i<0?"-"+t:t};this.skipVisualSpace();let l=this.parseExponent();if(!u&&this.options.parseNumbers==="rational"){let f=parseInt(t,10);if(!r)return l?["Multiply",i*f,["Power",10,l]]:i*f;let d=parseInt(r,10),c=r.length,p=f*Math.pow(10,c)+d,h=Math.pow(10,c);return l?["Multiply",["Rational",i*p,h],["Power",10,l]]:["Rational",i*p,h]}return{num:(i<0?"-":"")+t+(a?"."+r:"")+(l?"e"+l:"")}}matchLatexNumber(n=!0){let i=!1,t=this.peek;for(;t==="<space>"||t==="+"||t==="-";)t==="-"&&(i=!i),this.nextToken(),t=this.peek;let r=10,o=["0","1","2","3","4","5","6","7","8","9"];if(this.match("'"))r=8,o=["0","1","2","3","4","5","6","7"],n=!0;else if(this.match('"')||this.match("x"))r=16,o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],n=!0;else if(this.match("`"))return t=this.nextToken(),t?t.startsWith("\\")&&t.length===2?(i?-1:1)*(t.codePointAt(1)??0):(i?-1:1)*(t.codePointAt(0)??0):null;let s="";for(;o.includes(this.peek);)s+=this.nextToken();if(!n&&this.match("."))for(s+=".";o.includes(this.peek);)s+=this.nextToken();let a=n?Number.parseInt(s,r):Number.parseFloat(s);return Number.isNaN(a)?null:i?-a:a}parsePrefixOperator(n){n||(n={minPrec:0}),n.minPrec||(n={...n,minPrec:0});let i=this.index;for(let[t,r]of this.peekDefinitions("prefix")){this.index=i+r;let o=t.parse(this,n);if(o)return o}return this.index=i,null}parseInfixOperator(n,i){i??(i={minPrec:0}),i.minPrec,i.minPrec===void 0&&(i={...i,minPrec:0});let t=this.index;for(let[r,o]of this.peekDefinitions("infix"))if(r.precedence>=i.minPrec){this.index=t+o;let s=r.parse(this,n,i);if(s)return s}return this.index=t,null}parseArguments(n="enclosure",i){if(this.atTerminator(i))return null;let t=this.index,r=this.parseEnclosure();if(n==="enclosure")return r===null?null:Pt(r)??[];if(n==="implicit"){if(x(r)==="Delimiter"){if(x(Se(r))==="Sequence"){let s=Se(Se(r));return s?[s]:[]}return Se(r)?[Se(r)]:[]}if(r!==null)return[r];let o=this.parseExpression({...i,minPrec:390});return o===null?null:[o]}return this.index=t,null}matchOpenDelimiter(n,i){let t=this.index,r=Vt[this.peek];r&&this.nextToken();let o=da[n]??[n],s=r?[r]:[];return o.includes("||")&&this.matchAll(["|","|"])?(s.push("|"),s.push("|"),s):o.includes(this.peek)?(zi[n]===i?s.push(zi[this.peek]):s.push(i),this.nextToken(),s):(this.index=t,null)}parseEnclosure(){let n=this.getDefs("matchfix"),i=this.index;for(let t of n){if(this.index=i,!this.matchDelimiter(t.openTrigger,t.closeTrigger))continue;let r=this.index;this.skipSpace();let o=this.parseExpression();if(this.skipSpace(),!this.matchBoundary()){let a=this._boundaries[this._boundaries.length-1].tokens;if(this.removeBoundary(),this.index=r,this.skipSpace(),o=this.parseExpression(),this.skipSpace(),!this.matchAll(a)){if(!this.atEnd)continue;return this.index=i,null}}let s=t.parse(this,o??["Sequence"]);if(s!==null)return s}return this.index=i,null}parseGenericExpression(n){if(this.atTerminator(n))return null;let i=this.index,t=null,r=this.peekDefinitions("expression")??[];for(let[o,s]of r)if(this.index=i+s,typeof o.parse=="function"){if(t=o.parse(this,n),t!==null)return t}else return o.name;return this.index=i,null}parseFunction(n){if(this.atTerminator(n))return null;let i=this.index,t=null;for(let[o,s]of this.peekDefinitions("function"))if(this.index=i+s,typeof o.parse=="function"){if(t=o.parse(this,n),t!==null)return t}else{t=o.name;break}if(t===null&&(this.index=i,t=$i(this),!this.isFunctionHead(t)))return this.index=i,null;do{let o=this.parsePostfixOperator(t,n);if(o===null)break;t=o}while(!0);let r=this.parseArguments("enclosure",n);return r===null?t:typeof t=="string"?[t,...r]:["Apply",t,...r]}parseSymbol(n){if(this.atTerminator(n))return null;let i=this.index;for(let[r,o]of this.peekDefinitions("symbol"))if(this.index=i+o,typeof r.parse=="function"){let s=r.parse(this,n);if(s)return s}else return r.name;this.index=i;let t=$i(this);return t===null?null:this.options.parseUnknownIdentifier?.(t,this)==="symbol"?t:(this.index=i,null)}parseSupsub(n){if(this.atEnd)return n;let i=this.index;this.skipSpace();let t=[],r=[],o=i;for(;this.peek==="_"||this.peek==="^";){if(this.match("_"))if(o=this.index,this.match("_")||this.match("^"))r.push(this.error("syntax-error",o));else{let a=this.parseGroup()??this.parseToken()??this.parseStringGroup();if(a===null)return this.error("missing",i);r.push(a)}else if(this.match("^"))if(o=this.index,this.match("_")||this.match("^"))t.push(this.error("syntax-error",o));else{let a=this.parseGroup()??this.parseToken();if(a===null)return this.error("missing",i);t.push(a)}o=this.index,this.skipSpace()}if(t.length===0&&r.length===0)return this.index=i,n;let s=n;if(r.length>0){let a=[...this.getDefs("infix")].filter(u=>u.latexTrigger==="_");if(a){let u=["Subscript",s,r.length===1?r[0]:["List",...r]];for(let l of a)if(typeof l.parse=="function"?s=l.parse(this,u,{minPrec:0}):s=u,s)break}}if(t.length>0){let a=[...this.getDefs("infix")].filter(u=>u.latexTrigger==="^");if(a){let u=t.filter(l=>!(x(l)==="Sequence"&&G(l)===0));if(u.length!==0){let l=u.length===1?u[0]:["List",...u],f=["Superscript",s,l];for(let d of a)if(typeof d.parse=="function"?s=d.parse(this,f,{minPrec:0}):s=f,s)break}}}return s===null&&(this.index=i),s}parsePostfixOperator(n,i){if(n===null||this.atEnd)return null;let t=this.index;for(let[r,o]of this.peekDefinitions("postfix")){this.index=t+o;let s=r.parse(this,n,i);if(s!==null)return s}return this.index=t,null}parseStringGroupContent(){let n=this.index,i="",t=0;for(;!this.atBoundary||t>0;){let r=this.nextToken();if(r==="<$>"||r==="<$$>")return this.index=n,"";r==="<{>"?(t+=1,i+="\\{"):r==="<}>"?(t-=1,i+="\\}"):r==="<space>"?i+=" ":(r[0],i+=r)}return i}parseSyntaxError(){let n=this.index;if(this.peek==="^")return this.index+=1,["Superscript",this.error("missing",n),j(this.parseGroup())];let i=this.peekDefinitions("operator");if(i.length>0){if(i=this.peekDefinitions("postfix"),i.length>0){let[a,u]=i[0];if(this.index+=u,typeof a.parse=="function"){let l=a.parse(this,this.error("missing",n));if(l)return l}return a.name?[a.name,this.error("missing",n)]:this.error("unexpected-operator",n)}if(i=this.peekDefinitions("prefix"),i.length>0){let[a,u]=i[0];if(this.index+=u,typeof a.parse=="function"){let l=a.parse(this,{minPrec:0});if(l)return l}return a.name?[a.name,this.parseExpression()??this.error("missing",n)]:this.error("unexpected-operator",n)}if(i=this.peekDefinitions("infix"),i.length>0){let[a,u]=i[0];this.index+=u;let l=a.parse(this,this.error("missing",n),{minPrec:0});return l||this.error("unexpected-operator",n)}}let t=this.index,r=io(this);if(r)return r;if(r=$i(this),r)return this.error(["unexpected-identifier",r],t);let o=this.peek;if(!o)return this.error("syntax-error",n);if(o[0]!=="\\")return this.error(["unexpected-token",{str:rn(o)}],n);if(vf(this))return this.error("unexpected-delimiter",n);let s=this.nextToken();if(this.skipSpaceTokens(),s==="\\end"){let a=this.parseStringGroup();return a===null?this.error("expected-environment-name",n):this.error(["unbalanced-environment",{str:a}],n)}for(;this.match("[");){let a=0;for(;!this.atEnd&&a===0&&this.peek!=="]";)this.peek==="["&&(a+=1),this.peek==="]"&&(a-=1),this.nextToken();this.match("]")}for(;this.match("<{>");){let a=0;for(;!this.atEnd&&a===0&&this.peek!=="<}>";)this.peek==="<{>"&&(a+=1),this.peek==="<}>"&&(a-=1),this.nextToken();this.match("<}>")}return this.error(["unexpected-command",{str:rn(s)}],n)}parsePrimary(n){if(this.atBoundary||this.atTerminator(n))return null;let i=null,t=this.index;if(this.match("<}>"))return this.error("unexpected-closing-delimiter",t);if(i??(i=this.parseGroup()),i??(i=this.parseNumber()),i??(i=this.parseEnclosure()),i??(i=this.parseEnvironment(n)),i===null&&this.matchAll(this._positiveInfinityTokens)&&(i={num:"+Infinity"}),i===null&&this.matchAll(this._negativeInfinityTokens)&&(i={num:"-Infinity"}),i===null&&this.matchAll(this._notANumberTokens)&&(i={num:"NaN"}),i??(i=this.parseGenericExpression(n)??this.parseFunction(n)??this.parseSymbol(n)??io(this)),i!==null){i=this.decorate(i,t);let r=null,o=this.index;do{if(r=this.parsePostfixOperator(i,n),i=r??i,this.index===o&&r!==null){this.index;break}o=this.index}while(r!==null)}return i!==null&&(i=this.parseSupsub(i)),this.decorate(i,t)}parseExpression(n){this.skipSpace();let i=this.index;if(this.atBoundary)return this.index=i,null;n??(n={minPrec:0}),n.minPrec,n.minPrec===void 0&&(n={...n,minPrec:0});let t=this.parsePrefixOperator({...n,minPrec:0});if(t===null&&(t=this.parsePrimary(n),x(t)==="Sequence"&&G(t)===0&&(t=null)),t){let r=!1;for(;!r&&!this.atTerminator(n);){this.skipSpace();let o=this.parseInfixOperator(t,n);if(o===null&&this.peekDefinitions("operator").length===0){let s=this.parseExpression({...n,minPrec:Ve});s!==null&&(x(t)==="InvisibleOperator"?x(s)==="InvisibleOperator"?o=["InvisibleOperator",..._(t),..._(s)]:o=["InvisibleOperator",..._(t),s]:x(s)==="InvisibleOperator"?o=["InvisibleOperator",t,..._(s)]:o=["InvisibleOperator",t,s])}o!==null?t=o:r=!0}}return this.decorate(t,i)}decorate(n,i){if(n===null)return null;if(!this.options.preserveLatex)return n;let t=this.latex(i,this.index);return Array.isArray(n)?n={latex:t,fn:n}:typeof n=="number"?n={latex:t,num:Number(n).toString()}:typeof n=="string"?n={latex:t,sym:n}:typeof n=="object"&&n!==null&&(n.latex=t),n}error(n,i){let t;typeof n=="string"?(n.startsWith("'"),t={str:n}):(n[0].startsWith("'"),t=["ErrorCode",{str:n[0]},...n.slice(1)]);let r=this.latex(i,this.index);return r?["Error",t,["LatexString",{str:r}]]:["Error",t]}isFunctionHead(n){if(n===null)return!1;let i=V(n);return i?this.computeEngine?.lookupFunction(i)!==void 0||this.options.parseUnknownIdentifier?.(i,this)==="function":!1}*getDefs(n){if(n==="operator")for(let i of this._dictionary.defs)/^prefix|infix|postfix/.test(i.kind)&&(yield i);else for(let i of this._dictionary.defs)i.kind===n&&(yield i)}};function Ef(e,n){let i=e.index,t=$i(e)?.trim();if(t===null)return 0;let r=t!==n?0:e.index-i;return e.index=i,r}function vf(e){let n=e.peek;return Object.values(zi).includes(n)||zi[n]?(e.nextToken(),!0):Vt[n]||Object.values(Vt).includes(n)?(e.nextToken(),e.nextToken(),!0):!1}function ca(e,n){let i=e.length,t=e;if(n.beginRepeatingDigits&&n.endRepeatingDigits){e=e.slice(0,-1);for(let o=0;o<e.length-16;o++){let s=e.substring(0,o);for(let a=0;a<17;a++){let u=e.substring(o,o+a+1),l=Math.floor((e.length-s.length)/u.length);if(l<=3)break;if((s+u.repeat(l+1)).startsWith(e))return u==="0"?s.replace(/(\d{3})/g,"$1"+n.groupSeparator):s.replace(/(\d{3})/g,"$1"+n.groupSeparator)+n.beginRepeatingDigits+u+n.endRepeatingDigits}}}let r=i>n.precision-1;return e=t,r&&(e=e.substring(0,n.precision-1)),n.groupSeparator&&(e=e.replace(/(\d{3})/g,"$1"+n.groupSeparator),e.endsWith(n.groupSeparator)&&(e=e.slice(0,-n.groupSeparator.length))),r?e+n.truncationMarker:e}function ma(e,n){return e?n.beginExponentMarker?n.beginExponentMarker+e+(n.endExponentMarker??""):"10^{"+e+"}":""}function pa(e,n){if(e===null)return"";let i;if(typeof e=="number"||typeof e=="string")i=e;else if(typeof e=="object"&&"num"in e)i=e.num;else return"";if(typeof i=="number"){if(i===1/0)return n.positiveInfinity;if(i===-1/0)return n.negativeInfinity;if(Number.isNaN(i))return n.notANumber;let o;return n.notation==="engineering"?o=zt(i.toExponential(),n,3):n.notation==="scientific"&&(o=zt(i.toExponential(),n)),o??oo(i.toString(),n)}if(i=i.toLowerCase().replace(/[\u0009-\u000d\u0020\u00a0]/g,""),i==="infinity"||i==="+infinity")return n.positiveInfinity;if(i==="-infinity")return n.negativeInfinity;if(i==="nan")return n.notANumber;if(!/^[-+\.]?[0-9]/.test(i))return"";if(i=i.replace(/[nd]$/,""),/\([0-9]+\)/.test(i)){let[o,s,a,u]=i.match(/(.+)\(([0-9]+)\)(.*)$/)??[];i=s+a.repeat(Math.ceil(n.precision/a.length))+u}let t="";for(i[0]==="-"?(t="-",i=i.substring(1)):i[0]==="+"&&(i=i.substring(1));i[0]==="0";)i=i.substring(1);i.length===0?i="0":i[0]==="."&&(i="0"+i);let r;return n.notation==="engineering"?r=zt(i,n,3):n.notation==="scientific"&&(r=zt(i,n)),t+(r??oo(i,n))}function zt(e,n,i=1){let t=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/);if(!t){let f="";if(e[0]==="-"?(f="-",e=e.substring(1)):e[0]==="+"&&(e=e.substring(1)),e.indexOf(".")<0)e.length===1?e=f+e+"e+0":e=f+e[0]+"."+e.slice(1)+"e+"+(e.length-1).toString();else{let[d,c,p]=e.match(/^(.*)\.(.*)$/);for(p||(p="");c.startsWith("0");)c=c.substring(1);c?e=f+c[0]+"."+c.slice(1)+p+"e+"+(c.length-1).toString():e=f+"0."+p+"e+0"}t=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/)}if(!t)return oo(e,n);let r=parseInt(t[2]),o=t[1];if(Math.abs(r)%i!==0){let f=r>0?r%i:-((i+r)%i);r=r>=0?r-f:r+f;let[d,c,p]=o.match(/^(.*)\.(.*)$/)??["",o,""];o=c+(p+"00000000000000000").slice(0,Math.abs(f))+"."+p.slice(Math.abs(f))}let s=n.avoidExponentsInRange;if(s&&r>=s[0]&&r<=s[1])return;let a="",u=o;t=u.match(/^(.*)\.(.*)$/),t&&(u=t[1],a=t[2]);let l=r!==0?ma(Number(r).toString(),n):"";return n.groupSeparator&&(u=u.replace(/\B(?=(\d{3})+(?!\d))/g,n.groupSeparator),a=ca(a,n)),a&&(a=n.decimalMarker+a),l?u==="1"&&!a?l:u+a+n.exponentProduct+l:u+a}function oo(e,n){let i=e.match(/^(.*)[e|E]([-+]?[0-9]+)$/i),t;i?.[1]&&i[2]&&(t=ma(i[2],n));let r=i?.[1]??e,o="";return i=(t?i[1]:e).match(/^(.*)\.(.*)$/),i?.[1]&&i[2]&&(r=i[1],o=i[2]),n.groupSeparator&&(r=r.replace(/\B(?=(\d{3})+(?!\d))/g,n.groupSeparator),o=ca(o,n)),o&&(o=n.decimalMarker+o),t?r==="1"&&!o?t:r+o+n.exponentProduct+t:r+o}var ao={deg:e=>`${e}\\degree`,prime:e=>`${e}^{\\prime}`,dprime:e=>`${e}^{\\doubleprime}`,ring:e=>`\\mathring{${e}}`,hat:e=>`\\hat{${e}}`,tilde:e=>`\\tilde{${e}}`,vec:e=>`\\vec{${e}}`,bar:e=>`\\overline{${e}}`,underbar:e=>`\\underline{${e}}`,dot:e=>`\\dot{${e}}`,ddot:e=>`\\ddot{${e}}`,tdot:e=>`\\dddot{${e}}`,qdot:e=>`\\ddddot{${e}}`,acute:e=>`\\acute{${e}}`,grave:e=>`\\grave{${e}}`,breve:e=>`\\breve{${e}}`,check:e=>`\\check{${e}}`},uo={upright:e=>`\\mathrm{${e}}`,italic:e=>`\\mathit{${e}}`,bold:e=>`\\mathbf{${e}}`,script:e=>`\\mathscr{${e}}`,fraktur:e=>`\\mathfrak{${e}}`,doublestruck:e=>`\\mathbb{${e}}`,blackboard:e=>`\\mathbb{${e}}`,calligraphic:e=>`\\mathcal{${e}}`,gothic:e=>`\\mathfrak{${e}}`,sansserif:e=>`\\mathsf{${e}}`,monospace:e=>`\\mathtt{${e}}`},Ut=class{constructor(n,i,t){this.level=-1;this.options=n,n.invisibleMultiply&&(!/#1/.test(n.invisibleMultiply)||!/#2/.test(n.invisibleMultiply))&&t([{severity:"warning",message:["expected-argument","invisibleMultiply"]}]),this.onError=t,this.dictionary=i,this.canonical=void 0}updateOptions(n){for(let i of Object.keys(this.options))i in n&&(this.options[i]=n[i])}wrap(n,i){if(n===null)return"";if(i===void 0)return this.wrapString(this.serialize(n),this.options.groupStyle(n,this.level+1));if(typeof n=="number"||ai(n)||typeof n=="string"||ui(n))return this.serialize(n);let t=x(n);if(typeof t=="string"&&t!=="Delimiter"&&t!=="Subscript"){let r=this.dictionary.ids.get(t);if(r&&(r.kind==="symbol"||r.kind==="prefix"||r.kind==="infix"||r.kind==="postfix")&&r.precedence<i)return this.wrapString(this.serialize(n),this.options.applyFunctionStyle(n,this.level))}return this.serialize(n)}wrapShort(n){if(n===null)return"";let i=this.serialize(n);if(V(n)!==null||x(n)==="Delimiter"&&G(n)===1||$n(n)&&!/^(-|\.)/.test(i))return i;let r=x(n);return r!=="Add"&&r!=="Negate"&&r!=="Subtract"&&r!=="PlusMinus"&&r!=="Multiply"?i:this.wrapString(i,this.options.groupStyle(n,this.level+1))}wrapString(n,i,t){if(i==="none")return n;t===void 0&&(t="()");let r=t?.[0]??".",o=t?.[1]??".";return(r==="."||o===".")&&i==="paren"&&(i="leftright"),r==='"'?r="``":r==="|"?r="\\lvert":r=mi[r]??r,o==='"'?o="''":o==="|"?o="\\rvert":o=mi[o]??o,r==="."&&o==="."?n:i==="leftright"?`\\left${r}${n}\\right${o}}`:i==="big"?`${r==="."?"":`\\Bigl${r}`}${n}${o==="."?"":`\\Bigr${o}`})`:r+n+o}wrapArguments(n){return this.wrapString((_(n)??[]).map(i=>this.serialize(i)).join(", "),this.options.applyFunctionStyle(n,this.level))}serializeSymbol(n,i){return typeof n=="string"||ui(n),i?.kind==="function"?so(V(n)??"")??"":i?.serialize?.(this,n)??so(V(n))??""}serializeFunction(n,i){if(i?.serialize)return i.serialize(this,n);let t=x(n);if(typeof t=="string")return so(t,"auto")+this.wrapArguments(n);if(x(t)==="InverseFunction"||x(t)==="Derivative")return this.serializeFunction(t,this.dictionary.ids.get(x(t)))+this.wrapArguments(n);let r=_(n)??[];if(r.length===1)return N([this.serialize(r[0]),"\\rhd",this.wrapString(this.serialize(t),this.options.applyFunctionStyle(n,this.level))]);let o=this.options.applyFunctionStyle(n,this.level);return N(["\\operatorname{apply}",this.wrapString(this.serialize(t)+", "+this.serialize(["List",...r]),o)])}serializeDictionary(n){return`\\left\\lbrack\\begin{array}{lll}${Object.keys(n).map(i=>`\\textbf{${i}} & \\rightarrow & ${this.serialize(n[i])}`).join("\\\\")}\\end{array}\\right\\rbrack`}serialize(n,i){if(n==null)return"";i??(i={}),i={...i},"canonical"in i||(i.canonical=!0);let t=this.canonical;this.canonical===void 0&&(this.canonical=i.canonical),this.level+=1;try{let r=(()=>{let o=pa(n,this.options);if(o)return o;let s=z(n);if(s!==null)return`\\text{${s}}`;let a=zn(n);if(a!==null)return this.serializeDictionary(a);let u=V(n);if(u!==null)return this.serializeSymbol(n,this.dictionary.ids.get(u));let l=Jr(n);if(l)return this.serializeFunction(n,this.dictionary.ids.get(l));if(x(n)!==null)return this.serializeFunction(n);this.onError([{severity:"warning",message:["syntax-error",n?JSON.stringify(n):"undefined"]}])})();return this.level-=1,this.canonical=t,r??""}catch{}return this.level-=1,this.canonical=t,""}applyFunctionStyle(n,i){return this.options.applyFunctionStyle(n,i)}groupStyle(n,i){return this.options.groupStyle(n,i)}rootStyle(n,i){return this.options.rootStyle(n,i)}fractionStyle(n,i){return this.options.fractionStyle(n,i)}logicStyle(n,i){return this.options.logicStyle(n,i)}powerStyle(n,i){return this.options.powerStyle(n,i)}numericSetStyle(n,i){return this.options.numericSetStyle(n,i)}};function Nf(e){let n=e.match(/^([^_]+)/)?.[1]??"",i=Ye.findIndex(s=>n===s[0]);if(i>=0)return[Ye[i][1],e.substring(Ye[i][0].length)];let t={zero:"0",one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10"};if(i=Object.keys(t).findIndex(s=>e.startsWith(s)),i>=0){let s=Object.keys(t)[i];return[t[s],e.substring(s.length)]}let r=e.codePointAt(0);if(i=Ye.findIndex(s=>s[2]===r),i>=0)return[Ye[i][1],e.substring(1)];let o={plus:"+",minus:"-",pm:"\\pm",ast:"\\ast",dag:"\\dag",ddag:"\\ddag",hash:"\\#",bottom:"\\bot",top:"\\top",bullet:"\\bullet",circle:"\\circ",diamond:"\\diamond",times:"\\times",square:"\\square",star:"\\star"};if(i=Object.keys(o).findIndex(s=>n===s),i>=0){let s=Object.keys(o)[i];return[o[s],e.substring(s.length)]}return[n,e.substring(n.length)]}function _f(e){let[n,i]=Nf(e),t=[];for(;i.length>0;){let o=i.match(/^_([a-zA-Z]+)(.*)/);if(!o||!ao[o[1]])break;t.push(o[1]),i=o[2]}let r=[];for(;i.length>0;){let o=i.match(/^_([a-zA-Z]+)(.*)/);if(!o||!uo[o[1]])break;r.push(o[1]),i=o[2]}return[n,t,r,i]}function Gt(e,n=!0,i="auto"){let[t,r,o,s]=_f(e);for(let a of r)ao[a]&&(t=ao[a](t));if(n){let a=[],u=[],l=t.match(/^([^\d].*?)(\d+)$/);for(l&&(u.push(l[2]),t=l[1]);s.length>0;)if(s.startsWith("__")){let[f,d]=Gt(s.substring(2),!1,"none");a.push(f),s=d}else if(s.startsWith("_")){let[f,d]=Gt(s.substring(1),!1,"none");u.push(f),s=d}else break;a.length>0&&(t=`${t}^{${a.join(",")}}`),u.length>0&&(t=`${t}_{${u.join(",")}}`)}for(let a of o)uo[a]&&(t=uo[a](t));if(o.length===0&&i!=="none")switch(i){case"auto":Ot(t)>1&&(t=`\\mathrm{${t}}`);break;case"operator":t=`\\operatorname{${t}}`;break;case"italic":t=`\\mathit{${t}}`;break;case"upright":t=`\\mathrm{${t}}`;break}return[t,s]}function so(e,n="auto"){if(e===null)return null;if(fi.test(e))return e;let i=e.match(/^(_+)(.*)/);if(i){let[o,s]=Gt(i[2],!0,"none");return`\\operatorname{${"\\_".repeat(i[1].length)+o+s}}`}let[t,r]=Gt(e,!0,n);return r.length>0?`\\operatorname{${e}}`:t}var Sf={invisibleMultiply:"",invisiblePlus:"",multiply:"\\times",missingSymbol:"\\blacksquare",applyFunctionStyle:Os,groupStyle:Ps,rootStyle:kn,fractionStyle:Ft,logicStyle:Fs,powerStyle:Ls,numericSetStyle:Rs},Ui=class e{constructor(n){let i=r=>{if(typeof window<"u")for(let o of r)console.warn(o.message)};this.onError=n.onError??i,this.computeEngine=n.computeEngine;let t={...n};delete t.dictionary,delete t.onError,this.options={...to,...ro,...Sf,...t},this._dictionaryInput=n.dictionary??e.getDictionary(),this._dictionary=eo(this._dictionaryInput,r=>this.onError([r]))}get dictionary(){return this._dictionaryInput}set dictionary(n){this._dictionaryInput=n,this._dictionary=eo(n,i=>this.onError([i]))}updateOptions(n){for(let i of Object.keys(this.options))i in n&&(this.options[i]=n[i]);this.serializer.updateOptions(n)}static getDictionary(n="all"){if(n==="all"){let i=[];for(let t of Object.keys(hi))hi[t]&&i.push(...hi[t]);return i}return hi[n]?Object.freeze([...hi[n]]):[]}parse(n){let i=new $t($(n,[]),this.options,this._dictionary,this.computeEngine),t=i.parseExpression();if(!i.atEnd){let r=i.parseSyntaxError();for(t=t?["Sequence",t,r]:r;!i.atEnd;)i.nextToken()}return t??(t=["Sequence"]),this.options.preserveLatex&&(Array.isArray(t)?t={latex:n,fn:t}:typeof t=="number"?t={latex:n,num:Number(t).toString()}:typeof t=="string"?t={latex:n,sym:t}:typeof t=="object"&&t!==null&&(t.latex=n)),t??["Sequence"]}serialize(n,i){return this.serializer.serialize(n,i)}get serializer(){return this._serializer?this._serializer:(this._serializer=new Ut(this.options,this._dictionary,this.onError),this._serializer)}};var Ba=pe(le(),1);var bn=pe(le(),1);var jt=pe(le(),1);function lo(e,n,i={}){let{contract:t=.125,step:r=1,power:o=2,atol:s=1e-16,rtol:a=s>0?0:Math.sqrt(Number.EPSILON),maxeval:u=1e6,breaktol:l=2}=i;if(!isFinite(n))return lo(E=>e(1/E),1/n,{rtol:a,atol:s,maxeval:u,contract:Math.abs(t)>1?1/t:t,step:1/r,power:o});let f=r,d=Math.pow(1/t,o),c=e(n+f),p=[c],h=1/0,g=1;for(;g<u;){g+=1,f*=t,p.push(e(n+f));let E=d,S=1/0;for(let k=p.length-2;k>=0;k--){let B=p[k];p[k]=p[k+1]+(p[k+1]-p[k])/(E-1);let W=Math.abs(p[k]-B);S=Math.min(S,W),W<h&&(c=p[k],h=W),E*=d}if(S>l*h||!isFinite(S)||h<=Math.max(a*Math.abs(c),s))break}return[c,h]}var xa=53,Gn=Math.log10(Math.pow(2,xa)),Tf=7,Gm=Math.pow(2,-(xa-Tf)),Gi=Math.pow(10,-10),gi=1e6,Zt=1e6,ji=200;var fo=new Set([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999,2003,2011,2017,2027,2029,2039,2053,2063,2069,2081,2083,2087,2089,2099,2111,2113,2129,2131,2137,2141,2143,2153,2161,2179,2203,2207,2213,2221,2237,2239,2243,2251,2267,2269,2273,2281,2287,2293,2297,2309,2311,2333,2339,2341,2347,2351,2357,2371,2377,2381,2383,2389,2393,2399,2411,2417,2423,2437,2441,2447,2459,2467,2473,2477,2503,2521,2531,2539,2543,2549,2551,2557,2579,2591,2593,2609,2617,2621,2633,2647,2657,2659,2663,2671,2677,2683,2687,2689,2693,2699,2707,2711,2713,2719,2729,2731,2741,2749,2753,2767,2777,2789,2791,2797,2801,2803,2819,2833,2837,2843,2851,2857,2861,2879,2887,2897,2903,2909,2917,2927,2939,2953,2957,2963,2969,2971,2999,3001,3011,3019,3023,3037,3041,3049,3061,3067,3079,3083,3089,3109,3119,3121,3137,3163,3167,3169,3181,3187,3191,3203,3209,3217,3221,3229,3251,3253,3257,3259,3271,3299,3301,3307,3313,3319,3323,3329,3331,3343,3347,3359,3361,3371,3373,3389,3391,3407,3413,3433,3449,3457,3461,3463,3467,3469,3491,3499,3511,3517,3527,3529,3533,3539,3541,3547,3557,3559,3571,3581,3583,3593,3607,3613,3617,3623,3631,3637,3643,3659,3671,3673,3677,3691,3697,3701,3709,3719,3727,3733,3739,3761,3767,3769,3779,3793,3797,3803,3821,3823,3833,3847,3851,3853,3863,3877,3881,3889,3907,3911,3917,3919,3923,3929,3931,3943,3947,3967,3989,4001,4003,4007,4013,4019,4021,4027,4049,4051,4057,4073,4079,4091,4093,4099,4111,4127,4129,4133,4139,4153,4157,4159,4177,4201,4211,4217,4219,4229,4231,4241,4243,4253,4259,4261,4271,4273,4283,4289,4297,4327,4337,4339,4349,4357,4363,4373,4391,4397,4409,4421,4423,4441,4447,4451,4457,4463,4481,4483,4493,4507,4513,4517,4519,4523,4547,4549,4561,4567,4583,4591,4597,4603,4621,4637,4639,4643,4649,4651,4657,4663,4673,4679,4691,4703,4721,4723,4729,4733,4751,4759,4783,4787,4789,4793,4799,4801,4813,4817,4831,4861,4871,4877,4889,4903,4909,4919,4931,4933,4937,4943,4951,4957,4967,4969,4973,4987,4993,4999,5003,5009,5011,5021,5023,5039,5051,5059,5077,5081,5087,5099,5101,5107,5113,5119,5147,5153,5167,5171,5179,5189,5197,5209,5227,5231,5233,5237,5261,5273,5279,5281,5297,5303,5309,5323,5333,5347,5351,5381,5387,5393,5399,5407,5413,5417,5419,5431,5437,5441,5443,5449,5471,5477,5479,5483,5501,5503,5507,5519,5521,5527,5531,5557,5563,5569,5573,5581,5591,5623,5639,5641,5647,5651,5653,5657,5659,5669,5683,5689,5693,5701,5711,5717,5737,5741,5743,5749,5779,5783,5791,5801,5807,5813,5821,5827,5839,5843,5849,5851,5857,5861,5867,5869,5879,5881,5897,5903,5923,5927,5939,5953,5981,5987,6007,6011,6029,6037,6043,6047,6053,6067,6073,6079,6089,6091,6101,6113,6121,6131,6133,6143,6151,6163,6173,6197,6199,6203,6211,6217,6221,6229,6247,6257,6263,6269,6271,6277,6287,6299,6301,6311,6317,6323,6329,6337,6343,6353,6359,6361,6367,6373,6379,6389,6397,6421,6427,6449,6451,6469,6473,6481,6491,6521,6529,6547,6551,6553,6563,6569,6571,6577,6581,6599,6607,6619,6637,6653,6659,6661,6673,6679,6689,6691,6701,6703,6709,6719,6733,6737,6761,6763,6779,6781,6791,6793,6803,6823,6827,6829,6833,6841,6857,6863,6869,6871,6883,6899,6907,6911,6917,6947,6949,6959,6961,6967,6971,6977,6983,6991,6997,7001,7013,7019,7027,7039,7043,7057,7069,7079,7103,7109,7121,7127,7129,7151,7159,7177,7187,7193,7207,7211,7213,7219,7229,7237,7243,7247,7253,7283,7297,7307,7309,7321,7331,7333,7349,7351,7369,7393,7411,7417,7433,7451,7457,7459,7477,7481,7487,7489,7499,7507,7517,7523,7529,7537,7541,7547,7549,7559,7561,7573,7577,7583,7589,7591,7603,7607,7621,7639,7643,7649,7669,7673,7681,7687,7691,7699,7703,7717,7723,7727,7741,7753,7757,7759,7789,7793,7817,7823,7829,7841,7853,7867,7873,7877,7879,7883,7901,7907,7919]),ba=7919;function co(e){if(Number.isInteger(e)&&e>=0&&e<Number.MAX_SAFE_INTEGER,e<=3)return{[e]:1};let n={},i=0;for(;e%2===0;)i+=1,e/=2;for(i>0&&(n[2]=i),i=0;e%3===0;)i+=1,e/=3;i>0&&(n[3]=i);let t=!1;for(;!t;){if(e===1)return n;let r=Math.sqrt(e);t=!0;for(let o=6;o<=r+6;o+=6){if(e%(o-1)===0){n[o-1]=(n[o-1]??0)+1,e/=o-1,t=!1;break}if(e%(o+1)===0){n[o+1]=(n[o+1]??0)+1,e/=o+1,t=!1;break}}}return n[e]!==void 0?n[e]+=1:n[e]=1,n}function xn(e,n){if(e>=Number.MAX_SAFE_INTEGER)return[1,e];Number.isInteger(e)&&e>0&&e<Number.MAX_SAFE_INTEGER;let i=co(e),t=1,r=1;for(let o of Object.keys(i)){let s=parseInt(o);t=t*Math.pow(s,Math.floor(i[o]/n)),r=r*Math.pow(s,i[o]%n)}return[t,r]}function jn(e,n){if(e===0)return n;if(n===0||e===n)return e;if(!Number.isInteger(e)||!Number.isInteger(n))return NaN;for(;n!==0;)[e,n]=[n,e%n];return e<0?-e:e}function Ht(e,n){return e*n/jn(e,n)}function Jt(e){if(!Number.isInteger(e)||e<0)return NaN;let n=1;for(let i=2;i<=e;i++)n=n*i;return n}function ya(e){if(!Number.isInteger(e)||e<0)return NaN;if(e<0)return NaN;if(e<=1)return 1;let n=e;for(;e>2;)e-=2,n*=e;return n}var ha=7,ga=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function Zi(e){if(e<0)return NaN;let n=Math.PI,i=e*e*e;return e*Math.log(e)-e-.5*Math.log(e)+.5*Math.log(2*n)+1/(12*e)-1/(360*i)+1/(1260*i*e*e)}function bi(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*bi(1-e));if(e>100)return Math.exp(Zi(e));e-=1;let n=ga[0];for(let t=1;t<ha+2;t++)n+=ga[t]/(e+t);let i=e+ha+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*n}function y(e){if(e==null)return null;let n=e.numericValue;if(n===null)return null;if(typeof n=="number")return n;if(n instanceof v)return n.toNumber();if(Array.isArray(n)){let[i,t]=n;return typeof i=="number"&&typeof t=="number"?i/t:Number(i)/Number(t)}return!(n instanceof jt.Complex)||n.im,null}function $e(e){if(e==null)return null;let n=e.numericValue;if(n===null)return null;if(n instanceof v)return n;if(typeof n=="number")return e.engine.bignum(n);if(Array.isArray(n)){let[i,t]=n;return typeof i=="number"&&typeof t=="number"?e.engine.bignum(i/t):e.engine.bignum(i).div(t.toString())}return!(n instanceof jt.Complex)||n.im,null}function A(e){if(e==null)return null;let n=e.numericValue;if(n===null)return null;if(typeof n=="number")return Number.isInteger(n)&&n>=-gi&&n<=gi?n:null;if(n instanceof v){if(n.isInteger()){let t=n.toNumber();if(t>=-gi&&t<=gi)return t}return null}if(e.isCanonical)return null;let i=n;if(Array.isArray(i)){let[t,r]=i,o;return typeof t=="number"&&typeof r=="number"?o=t/r:o=Number(t)/Number(r),Number.isInteger(o)&&o>=-gi&&o<=gi?o:null}return null}function Zn(e,n){return typeof e=="number"&&Math.abs(e)<=n||e instanceof v&&e.abs().lte(n)||e instanceof jt.Complex&&Math.abs(e.re)<=n&&Math.abs(e.im)<=n?0:e}function mo(e){let n=.254829592,i=-.284496736,t=1.421413741,r=-1.453152027,o=1.061405429,s=.3275911,a=e<0?-1:1;e=Math.abs(e);let u=1/(1+s*e),l=((((o*u+r)*u+t)*u+i)*u+n)*u;return a*(1-l*Math.exp(-e*e))}function Ea(e){let n=Math.PI,i=n*n,t=i*n,r=e*e,o=e*r,s=o*r,a=s*r;return Math.sqrt(n)/2*(e+n/12*o+7*i/480*s+127*t/40320*a+4369*i*i/5806080*a*r+34807*t*i/182476800*a*r*r)}function va(e,n,i=.1){return(e(n-4*i)/280-4*e(n-3*i)/105+e(n-2*i)/5-4*e(n-i)/5+4*e(n+i)/5-e(n+2*i)/5+4*e(n+3*i)/105-e(n+4*i)/280)/i}function Na(e,n,i,t=1e5){let r=0;if(n===-1/0&&i===1/0)for(let o=0;o<t;o++){let s=Math.random(),a=Math.tan(Math.PI*(s-.5)),u=Math.PI*(1+a*a);r+=e(a)/u}else if(n===-1/0)for(let o=0;o<t;o++){let s=Math.random(),a=i-Math.log(1-s),u=1/(1-s);r+=e(a)/u}else if(i===1/0)for(let o=0;o<t;o++){let s=Math.random(),a=n+Math.log(s),u=1/s;r+=e(a)/u}else for(let o=0;o<t;o++)r+=e(n+Math.random()*(i-n));return r/t*(i-n)}function Un(e,n,i=1){if(i===0){let o=Un(e,n,-1),s=Un(e,n,1);return o===void 0||s===void 0?NaN:Math.abs(o-s)>1e-5?NaN:(o+s)/2}let[t,r]=lo(e,n,{step:i>0?1:-1});return t}function Bf(e){if(e==="N")return[0,""];let n={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3},i=0,t=0;e=e.toUpperCase();for(let r=e.length-1;r>=0;r--){let o=n[e[r]];if(o===void 0)return[i,e.slice(r)];o<t?i-=o:i+=o,t=o}return[i,""]}function xi(e,n){if(e=e.trim(),e.length===0)return[NaN,""];if(e.startsWith("+"))return xi(e.slice(1),n);if(e.startsWith("-")){let[r,o]=xi(e.slice(1),n);return[-r,o]}let i=10;if(typeof n=="string"&&(n=n.toLowerCase()),e.startsWith("0x"))i=16,e=e.slice(2);else if(e.startsWith("0b"))i=2,e=e.slice(2);else{if(n==="roman")return Bf(e);if(n==="base64"||n==="base-64")try{return[parseInt(btoa(e)),""]}catch{return[NaN,""]}else typeof n=="number"?i=n:typeof n=="string"&&(i=parseInt(n))}let t=0;for(let r=0;r<e.length;r++){let o={" ":-1,"\xA0":-1,"\u2000":-1,"\u2001":-1,"\u2002":-1,"\u2003":-1,"\u2004":-1,"\u2005":-1,"\u2006":-1,"\u2007":-1,"\u2008":-1,"\u2009":-1,"\u200A":-1,"\u200B":-1,"\u202F":-1,"\u205F":-1,_:-1,",":-1,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35}[e[r]];if(o!==-1){if(o===void 0)return[t,e.substring(r)];if(o>=i)return[t,e.substring(r)];t=t*i+o}}return[t,""]}function C(e){if(typeof e=="bigint")return e;if(e instanceof Ur)return C(e.toString());let n=e.toString(),i=n.match(/([^\.]+)(?:\.([0-9]+))?e(.+)$/);return i&&(n=i[1]+(i[2]??"")+"0".repeat(parseInt(i[3])-(i[2]?i[2].length:0))),BigInt(n)}function _a(e,n){for(;n!==BigInt(0);)[e,n]=[n,e%n];return e<0?-e:e}var Df=[BigInt(4),BigInt(2),BigInt(4),BigInt(2),BigInt(4),BigInt(6),BigInt(2),BigInt(6)];function If(e){if(e<Number.MAX_SAFE_INTEGER){let f=co(Number(e)),d=new Map;for(let c of Object.keys(f))d.set(C(c),f[c]);return d}let n=e,i=new Map,t=0,r=0,o=0,s=BigInt(10);for(;n%s===BigInt(0);)t+=1,o+=1,n=n/s;for(s=BigInt(5);n%s===BigInt(0);)o+=1,n=n/s;for(s=BigInt(3);n%s===BigInt(0);)r+=1,n=n/s;for(s=BigInt(2);n%s===BigInt(0);)t+=1,n=n/s;t>0&&i.set("2",t),r>0&&i.set("3",r),o>0&&i.set("5",o),s=BigInt(7);let a="",u=0;for(;s*s<n;)n%s===BigInt(0)?(a||(a=s.toString()),i.set(a,(i.get(a)??0)+1),n=n/s):(s=s+Df[u],a="",u=u<7?u+1:0);n!==BigInt(1)&&i.set(n.toString(),(i.get(n.toString())??0)+1);let l=new Map;for(let[f,d]of i)l.set(C(f),d);return l}function Wt(e,n){let i=If(e),t=BigInt(1),r=BigInt(1),o=C(n);for(let[s,a]of i){let u=C(a);t=t*s**(u/o),r=r*s**(u%o)}return[t,r]}function U(e){return e!==null&&Array.isArray(e)}function q(e){return e!==null&&Array.isArray(e)&&typeof e[0]=="number"}function J(e){return e!==null&&Array.isArray(e)&&typeof e[0]=="bigint"}function Ce(e){return e[0]==0}function fe(e){return e[0]===e[1]}function Yt(e){return e[0]===-e[1]}function Ie(e){return Number(e[0])}function Re(e){return Number(e[1])}function po(e){return e[0]<0}function ve(e){return[-e[0],e[1]]}function yn(e){return e[0]<0?[-e[1],-e[0]]:[e[1],e[0]]}function Q(e){let n=e.numericValue;if(n!==null){if(Array.isArray(n))return n;if(typeof n=="number"&&Number.isInteger(n))return[n,1];if(n instanceof v&&n.isInteger())return[C(n),BigInt(1)]}}function Sa(e){return[Number(e[0]),Number(e[1])]}function Hn(e,n){if(Array.isArray(n)||n.numericValue!==null&&n instanceof bn.Complex,typeof e[0]=="number"&&!Number.isFinite(e[0]))return e;let i=Array.isArray(n)?n:n.numericValue;if(i===null)return e;if(Array.isArray(i)){if(J(i))return e=[C(e[0]),C(e[1])],[i[1]*e[0]+i[0]*e[1],i[1]*e[1]];if(!Number.isFinite(i[0]))return i;if(J(e)){let t=[C(i[0]),C(i[1])];return[t[1]*e[0]+t[0]*e[1],t[1]*e[1]]}return[i[1]*e[0]+i[0]*e[1],i[1]*e[1]]}return i instanceof v?i.isNaN()?[Number.NaN,1]:i.isFinite()?(i.isInteger(),q(e)&&(e=[C(e[0]),C(e[1])]),[e[0]+e[1]*C(i.toString()),e[1]]):[i.isNegative()?-1/0:1/0,1]:i instanceof bn.Complex?[Number.NaN,1]:(!Number.isFinite(i)||Number.isInteger(i),Number.isFinite(i)?q(e)?[e[0]+e[1]*i,e[1]]:[e[0]+e[1]*C(i),e[1]]:[i,1])}function de(e,n){if(Array.isArray(n)||n.numericValue!==null&&n instanceof bn.Complex,Array.isArray(n))return q(e)&&q(n)?[e[0]*n[0],e[1]*n[1]]:(q(e)&&(e=[C(e[0]),C(e[1])]),q(n)&&(n=[C(n[0]),C(n[1])]),[e[0]*n[0],e[1]*n[1]]);let i=n.numericValue;return i!==null&&typeof i=="number"?(Number.isInteger(i),q(e)?[e[0]*i,e[1]]:[e[0]*C(i),e[1]]):i instanceof v?(i.isInteger(),q(e)?[C(i.toString())*C(e[0]),C(e[1])]:[C(i.toString())*e[0],e[1]]):Array.isArray(i)?J(i)?[i[0]*C(e[0]),i[1]*C(e[1])]:q(e)?[e[0]*i[0],e[1]*i[1]]:[e[0]*C(i[0]),e[1]*C(i[1])]:e}function kf(e,n){if(Number.isInteger(n),n===0)return[1,1];if(n<0&&(e=yn(e),n=-n),n===1)return e;if(q(e))return[Math.pow(e[0],n),Math.pow(e[1],n)];let i=C(n);return[e[0]**i,e[1]**i]}function En(e){if(q(e)){if(e[0]===1||e[1]===1)return e;if(e[1]<0&&(e=[-e[0],-e[1]]),!Number.isFinite(e[1]))return[0,1];let i=jn(e[0],e[1]);return i<=1?e:[e[0]/i,e[1]/i]}if(e[0]===BigInt(1)||e[1]===BigInt(1))return e;e[1]<0&&(e=[-e[0],-e[1]]);let n=_a(e[0],e[1]);return n<=1?e:[e[0]/n,e[1]/n]}function Ta(e){if(!Number.isFinite(e)||e%1===0)return e;let i=1e-15,t=Math.floor(e),r=1,o=0,s=t,a=1;for(;e-t>i*a*a;){e=1/(e-t),t=Math.floor(e);let u=r;r=s;let l=o;o=a,s=u+t*r,a=l+t*o}return[s,a]}function Qe(e){e.isCanonical;let n=e.engine;if(e.head==="Multiply"){let t=[],r=[1,1];for(let o of e.ops){let s=o.numericValue;s!==null&&(typeof s=="number"&&Number.isInteger(s)||s instanceof v&&s.isInteger()||U(s))?r=de(r,o):t.push(o)}return r=En(r),fe(r)?[[1,1],e]:t.length===0?[r,n.One]:t.length===1?[r,t[0]]:[r,n.mul(t)]}if(e.head==="Divide"){let[t,r]=Qe(e.op1),[o,s]=Qe(e.op2),a=En(de(t,yn(o)));return s.isOne?[a,r]:[a,n.div(r,s)]}if(e.head==="Power"){if(e.op2.numericValue===null)return[[1,1],e];let[t,r]=Qe(e.op1);if(fe(t))return[[1,1],e];let o=e.op2,s=A(o);if(s===-1)return[yn(t),n.inv(r)];if(s!==null)return[kf(t,s),n.pow(r,o)];if(o.numericValue!==null&&Array.isArray(o.numericValue)){let[a,u]=Sa(o.numericValue),[l,f]=Sa(t);if(l>0&&Math.abs(a)===1){let[d,c]=xn(l,u),[p,h]=xn(f,u);return d===1&&p===1?[[1,1],e]:[a===1?[d,p]:[p,d],n.pow(n.mul([n.number([c,h]),r]),o)]}}return[[1,1],e]}if(e.head,e.head==="Negate"){let[t,r]=Qe(e.op1);return[ve(t),r]}let i=e.numericValue;if(i!==null){if(i instanceof v){if(i.isInteger())return[[C(i.toString()),BigInt(1)],n.One];if(i.isNegative())return[[-1,1],n.number(i.neg())]}if(typeof i=="number"){if(Number.isInteger(i))return[[i,1],n.One];if(i<0)return[[-1,1],n.number(-i)]}if(U(i))return[i,n.One];if(i instanceof bn.Complex&&i.re<0)return[[-1,1],n.number(n.complex(-i.re,-i.im))]}return[[1,1],e]}function Jn(e,n,i){if(e===n)return 0;let t=e.N(),r=n.N(),o=t.numericValue,s=r.numericValue;if(o===null||s===null){let l=e.sgn,f=n.sgn;return typeof l!="number"||typeof f!="number"?void 0:l===0&&f===0?0:l<0&&f>0?-1:l>0&&f<0?1:void 0}if(i??(i=e.engine.tolerance),o instanceof bn.Complex&&s instanceof bn.Complex)return Zn(o.re-s.re,i)===0&&Zn(o.im-s.im,i)===0?0:void 0;if(o instanceof bn.Complex||s instanceof bn.Complex||U(o)||U(s))return;if(typeof o=="number"&&typeof s=="number")return Zn(s-o,i)===0?0:o<s?-1:1;let a=e.engine,u=a.bignum(s).sub(a.bignum(o));return Zn(u,i)===0?0:u.isPos()?1:-1}function Da(e){if(typeof e=="number"&&!isNaN(e))return isFinite(e)?Number.isInteger(e)?e>0?"PositiveIntegers":e<0?"NegativeIntegers":"Integers":e>0?"PositiveNumbers":e<0?"NegativeNumbers":"RealNumbers":"ExtendedRealNumbers";if(e instanceof v)return e.isNaN()?"Numbers":e.isFinite()?e.isInteger()?e.isPositive()?"PositiveIntegers":e.isNegative()?"NegativeIntegers":"Integers":e.isPositive()?"PositiveNumbers":e.isNegative()?"NegativeNumbers":"RealNumbers":"ExtendedRealNumbers";if(e instanceof Ba.Complex){let n=e;return n.im,n.re===0?"ImaginaryNumbers":"ComplexNumbers"}if(U(e)){let[n,i]=e;return typeof n!="number"||!Number.isNaN(n)&&Number.isNaN(i),"RationalNumbers"}return"Numbers"}function Hi(e){e.ctor;let n=e.engine,i=e.params,t=[],r=[],o,s=n.domain(i[i.length-1]);for(let a of i.slice(0,-1))if(x(a)==="OptArg"){if(r.length>0)throw Error(`Unexpected multiple OptArg in domain ${e}`);if(o)throw Error(`Unexpected OptArg after VarArg in domain ${e}`);if(G(a)===0)throw Error(`Unexpected empty OptArg in domain ${e}`);for(let u of _(a)){if(x(u)==="OptArg")throw Error(`Unexpected OptArg of OptArg in domain ${e}`);if(x(u)==="VarArg")throw Error(`Unexpected superfluous OptArg of VarArg in domain ${e}`);r.push(n.domain(u))}}else if(x(a)==="VarArg"){let u=_(a);if(u.length!==1)throw Error(`Invalid VarArg in domain ${e}`);if(x(u[0])==="OptArg")throw Error(`Unexpectedf VarArg of OptArg in domain ${e}`);if(x(u[0])==="VarArg")throw Error(`Unexpected VarArg of VarArg in domain ${e}`);o=n.domain(u[0])}else{if(r.length>0)throw Error(`Unexpected required parameter after OptArg in domain ${e}`);if(o)throw Error(`Unexpected required parameter after VarArg in domain ${e}`);t.push(n.domain(a))}return[t,r,o,s]}function Ji(e){let[n,i,t,r]=Hi(e);return{params:n.map(o=>o.json),optParams:i.map(o=>o.json),restParam:t?.json,result:r.json}}function Qt(e,n){let i=[...n.params];return n.optParams.length>0&&i.push(["OptArg",...n.optParams]),n.restParam&&i.push(["VarArg",n.restParam]),typeof n.result=="function"?i.push(n.result(e,[])??e.symbol("Undefined")):i.push(n.result),e.domain(["FunctionOf",...i])}var Ia=pe(le(),1);function yi(e){return typeof e=="string"?e.startsWith("$")&&e.endsWith("$"):!1}function Ei(e){return typeof e!="string"?null:e.startsWith("$$")&&e.endsWith("$$")?e.slice(2,-2):e.startsWith("$")&&e.endsWith("$")?e.slice(1,-1):null}function Kt(e){if(e.symbol==="ImaginaryUnit")return 1;let n=e.numericValue;if(n!==null&&n instanceof Ia.Complex&&n.re===0)return n.im;if(e.head==="Negate"){let i=Kt(e.op1);return i===null?null:-i}if(e.head==="Multiply"&&e.nops===2){if(e.op1.symbol==="ImaginaryUnit")return y(e.op2);if(e.op2.symbol==="ImaginaryUnit")return y(e.op1)}return 0}function Wi(e,n){if(e.symbol){n.add(e.symbol);return}if(e.head&&typeof e.head!="string"&&Wi(e.head,n),e.ops)for(let i of e.ops)Wi(i,n);if(e.keys)for(let i of e.keys)Wi(e.getKey(i),n)}function Yi(e,n){if(e.symbol){let i=e.engine.lookupSymbol(e.symbol);if(i&&i.value!==void 0)return;let t=e.engine.lookupFunction(e.symbol);if(t&&(t.signature.evaluate||t.signature.N))return;n.add(e.symbol);return}if(e.head&&typeof e.head!="string"&&Yi(e.head,n),e.ops)for(let i of e.ops)Yi(i,n);if(e.keys)for(let i of e.keys)Yi(e.getKey(i),n)}function Qi(e,n){if(e.head,e.symbol){let i=e.engine.lookupSymbol(e.symbol);if(i&&i.value!==void 0)return;let t=e.engine.lookupFunction(e.symbol);if(t&&(t.signature.evaluate||t.signature.N))return;n.add(e.symbol);return}if(e.head&&typeof e.head!="string"&&Qi(e.head,n),e.ops)for(let i of e.ops)Qi(i,n);if(e.keys)for(let i of e.keys)Qi(e.getKey(i),n)}function Xt(e,n){let i=!n||e.head===n?[e]:[];if(e.ops)for(let t of e.ops)i.push(...Xt(t,n));else if(e.keys)for(let t of e.keys)i.push(...Xt(e.getKey(t),n));return i}function P(e){return e.numericMode==="bignum"||e.numericMode==="auto"}function K(e){return e.numericMode==="auto"||e.numericMode==="complex"}function he(e){let n=0;for(let i=0;i<e.length;i++)n=Math.imul(31,n)+e.charCodeAt(i)|0;return Math.abs(n)}function ho(e,n){if(n==null)return null;if(typeof n=="number")return Number.isInteger(n)?C(n):null;if($n(n)){let t=(ai(n)?n.num.toString():n).toLowerCase().replace(/[nd]$/g,"").replace(/[\u0009-\u000d\u0020\u00a0]/g,"");if(/\([0-9]+\)/.test(t)){let[r,o,s,a]=t.match(/(.+)\(([0-9]+)\)(.*)$/)??[];t=o+s.repeat(Math.ceil(e.precision/s.length))+(a??"")}return t==="nan"||t==="infinity"||t==="+infinity"||t==="-infinity"||t.includes(".")?null:C(t)}return null}function Xi(e){let n=e.numericValue;return n===null?null:typeof n=="number"&&Number.isInteger(n)?C(n):n instanceof v&&n.isInteger()?C(n):null}function Ki(e,n,i){let t=[];for(let r of n){let o=ka(r,e,i);o!==null&&(t.some(s=>s.isEqual(o))||t.push(o))}return t}function Wn(e,n){let i=new Set;for(let{match:t,replace:r,condition:o,priority:s,id:a}of n){let u;if(typeof o=="string"){let l=Ei(o);if(l){let f=e.pattern(l);u=(d,c)=>f.subs(d).evaluate()?.symbol==="True"}}else u=o;i.add({match:e.pattern(t),replace:typeof r=="function"?r:e.pattern(r),priority:s??0,condition:u,id:a??e.box(t,{canonical:!1}).toString()+(typeof r=="function"?"  ->  function":"  ->  "+e.box(r,{canonical:!1}).toString())})}return i}function ka({match:e,replace:n,condition:i,id:t},r,o,s){let a=e.match(r,{substitution:o,...s});return a===null||typeof i=="function"&&!i(a,r.engine)?null:typeof n=="function"?n(r,a):n.subs(a,{canonical:!0})}function er(e,n,i){let t=i?.iterationLimit??1,r=0,o=i?.once??!1,s=!1,a=!1;try{for(;!s&&r<t;){s=!0;for(let u of n){let l=ka(u,e,{},i);if(l!==null&&l!==e){if(o)return l;s=!1,a=!0,e=l}}r+=1}}catch(u){console.error(u)}return a?e:null}var xo=pe(le(),1);function nt(e){if(e.head==="Power"&&e.op2.numericValue!==null){let n=A(e.op2);return n!==null&&n>0?n:1}if(e.head==="Multiply"){let n=1;for(let i of e.ops){let t=nt(i);t>1&&(n=n+t)}return n}return 1}function go(e){if(e.head==="Power"&&e.op2.numericValue!==null){let n=A(e.op2);return n!==null&&n>0?n:1}if(e.head==="Multiply"){let n=1;for(let i of e.ops)n=Math.max(n,nt(i));return n}return 1}function et(e){return e.symbol?e.symbol:e.ops?(typeof e.head=="string"?e.head:et(e.head))+'"'+e.ops.map(i=>et(i)).filter(i=>i.length>0).join('"'):""}var sn=1e5;function it(e){return e.sort((n,i)=>{let t=et(n),r=et(i);if(!t&&!r)return wn(n,i);if(!t)return 1;if(!r||t<r)return-1;if(t>r)return 1;let o=nt(n),s=nt(i);if(o!==s)return s-o;let a=go(n),u=go(i);return a!==u?a-u:wn(n,i)})}function wn(e,n){if(e===n||e.numericValue!==null&&e.numericValue===n.numericValue)return 0;let i=y(e);if(i!==null){let t=y(n);return t!==null?i-t:-1}if(e.numericValue instanceof xo.Complex)return n.numericValue instanceof xo.Complex?e.numericValue.re===n.numericValue.re?Math.abs(e.numericValue.im)===Math.abs(n.numericValue.im)?e.numericValue.im-n.numericValue.im:Math.abs(e.numericValue.im)-Math.abs(n.numericValue.im):e.numericValue.re-n.numericValue.re:n.numericValue!==null?1:-1;if(e.numericValue)return n.numericValue?1:-1;if(e.head==="Sqrt"&&e.op1.numericValue)return n.head==="Sqrt"&&n.op1.numericValue?wn(e.op1,n.op1):-1;if(e.symbol)return n.symbol?e.symbol===n.symbol?0:e.symbol>n.symbol?1:-1:n.numericValue!==null?1:-1;if(e.ops){if(n.ops){let t=e.functionDefinition?.complexity??sn,r=n.functionDefinition?.complexity??sn;return t===r?typeof e.head=="string"&&typeof n.head=="string"?e.head===n.head?vi(e)-vi(n):e.head<n.head?1:-1:vi(e)-vi(n):t-r}return n.numericValue!==null||n.symbol?1:-1}if(e.string)return n.string?e.string.length!==n.string.length?n.string.length-e.string.length:n.string<e.string?-1:e.string>n.string?1:0:n.keys?-1:1;if(e.keys&&n.keys){if(e.keysCount!==n.keysCount)return n.keysCount-e.keysCount;let t=0,r=0;for(let o of n.keys)t+=n.getKey(o).complexity??sn;for(let o of e.keys)r+=e.getKey(o).complexity??sn;return r-t}return(e.complexity??sn)-(n.complexity??sn)}function bo(e,{recursive:n=!1}){if(e.ops){let i=n?e.ops.map(t=>bo(t,{recursive:n})):e.ops;return e.head==="Add"?e.engine._fn("Add",it(i)):e.engine._fn(e.head,i.sort(wn))}return e}function vi(e){return e.keys!==null?1+e.keysCount:e.ops?(typeof e.head=="string"?1:vi(e.head))+[...e.ops].reduce((n,i)=>n+vi(i),0):1}function ie(e,n){if(!n||e.every(t=>!t.ops||t.head!==n))return e;let i=[];for(let t of e)!t.ops||t.head!==n?i.push(t):i.push(...ie(t.ops,n));return i.length,e.length,i.length===e.length?e:i}function ce(e){if(e.every(i=>i.head!=="Sequence"&&i.head!=="Delimiter"))return e;let n=[];for(let i of e)if(!i.isValid)n.push(i);else if(i.head==="Delimiter"){let t=i.op1.ops??[];t.length===0?n.push(i.engine.box(["Tupple"])):n.push(...ce(t))}else i.head==="Sequence"?i.ops&&n.push(...i.ops):n.push(i);return n}function yo(e,n){return n===void 0?e._fn("Tuple",[]):n.head==="Delimiter"?yo(e,n.op1):n.head==="Sequence"?n:n.ops?e._fn("Tuple",n.ops):n}var Ca=pe(le(),1);function Ni(e){return e.string!==null||(e.symbolDefinition?.value?.string??null)!==null?!0:(e.functionDefinition??e.symbolDefinition?.value?.functionDefinition)?.iterator!==void 0}function _i(e){return e.string!==null||(e.symbolDefinition?.value?.string??null)!==null?!0:(e.functionDefinition??e.symbolDefinition?.value?.functionDefinition)?.at!==void 0}function te(e){if(e.string!==null||(e.symbolDefinition?.value?.string??null)!==null)return!0;let n=e.functionDefinition??e.symbolDefinition?.value?.functionDefinition;return n?n.at!==void 0&&Number.isFinite(n.size?.(e)??1/0):!1}function*H(e){let n=wf(e);if(!n){yield e;return}let i=e.engine.iterationLimit,t=0;for(;;){let{done:r,value:o}=n.next();if(r)return;if(t++>i){yield e.engine.error("iteration-limit-exceeded");return}yield o}}function wf(e){let n=e.functionDefinition??e.symbolDefinition?.value?.functionDefinition;if(n?.iterator)return n.iterator(e);let i=e.string??e.symbolDefinition?.value?.string??null;if(i!==null){if(i.length===0)return{next:()=>({done:!0,value:void 0})};let t=0;return{next:()=>({value:e.engine.string(i.charAt(t++)),done:t>i.length})}}}function wa(e,n){let i=e.functionDefinition??e.symbolDefinition?.value?.functionDefinition;if(i?.at)return i.at(e,n);let t=e.string;if(t)return n<1?e.engine.string(t.charAt(t.length+n)):e.engine.string(t.charAt(n-1))}var tt=class{constructor(n,i,t){this._isCanonical=!0;this._imaginary=0;this._posInfinityCount=0;this._negInfinityCount=0;this._naNCount=0;this._terms=[];if(t??(t={}),"canonical"in t?this._isCanonical=t.canonical:this._isCanonical=!0,this.engine=n,this._rational=P(n)?[BigInt(0),BigInt(1)]:[0,1],this._bignum=n._BIGNUM_ZERO,this._number=0,i)for(let r of i)this.addTerm(r)}get isEmpty(){return this._isCanonical?this._terms.length===0&&Ce(this._rational)&&this._imaginary===0&&this._number===0&&this._bignum.isZero()&&this._negInfinityCount===0&&this._posInfinityCount===0&&this._naNCount===0:this._terms.length===0}addTerm(n,i){if(n.isNothing)return;if(n.isNaN||n.isImaginary&&!K(this.engine)){this._naNCount+=1;return}if(this._isCanonical&&n.numericValue!==null){if(n.isInfinity){n.isPositive?this._posInfinityCount+=1:this._negInfinityCount+=1;return}let o=Q(n);if(o){this._rational=Hn(this._rational,i===void 0?o:de(o,i));return}let s=n.numericValue;if(s!==null&&typeof s=="number"){Number.isInteger(s),P(this.engine)?this._bignum=this._bignum.add(s):this._number+=s;return}if(s!==null&&s instanceof v){s.isInteger(),this._bignum=this._bignum.add(s);return}if(s!==null&&s instanceof Ca.Complex){let a=s.re,u=s.im;if(Number.isInteger(a)?(this._rational=Hn(this._rational,de([a,1],i??[1,1])),a=0):(P(this.engine)?this._bignum=this._bignum.add(a):this._number+=a,a=0),Number.isInteger(u)&&(i===void 0?this._imaginary+=u:q(i)?this._imaginary+=u*i[0]/i[1]:this._imaginary+=this.engine.bignum(i[0]).mul(u).div(this.engine.bignum(i[1])).toNumber(),u=0),a===0&&u===0)return;n=this.engine.number(this.engine.complex(a,u))}}let t;if([t,n]=Qe(n),Ce(t))return;if(i!==void 0&&(t=de(t,i)),n.head==="Negate"){this.addTerm(n.op1,ve(t));return}if(n.head==="Add"){for(let o of n.ops)this.addTerm(o,t);return}let r=!1;if(n.numericValue===null){if(this._terms.length>500){let o=n.hash;for(let s=0;s<this._terms.length;s++)if(this._terms[s].term.numericValue===null&&o===this._terms[s].term.hash&&n.isSame(this._terms[s].term)){this._terms[s].coef=Hn(this._terms[s].coef,t),r=!0;break}}else for(let o=0;o<this._terms.length;o++)if(this._terms[o].term.numericValue===null&&n.isSame(this._terms[o].term)){this._terms[o].coef=Hn(this._terms[o].coef,t),r=!0;break}}r||this._terms.push({term:n,coef:t})}toString(){let n=this.terms("expression");return n.length===0?"0":n.map(i=>i.toString()).join("\\n")}terms(n){let i=this.engine;if(this._naNCount>0)return[i.NaN];if(this._imaginary!==0&&!K(i))return[i.NaN];if(this._posInfinityCount>0&&this._negInfinityCount>0)return[i.NaN];if(this._posInfinityCount>0)return[i.PositiveInfinity];if(this._negInfinityCount>0)return[i.NegativeInfinity];let t=[];for(let{coef:r,term:o}of this._terms)Ce(r)||(fe(r)?t.push(o):Yt(r)?t.push(i.neg(o)):Re(r)===1?t.push(i.mul([i.number(r[0]),o])):Ie(r)===1?t.push(i.div(o,i.number(r[1]))):t.push(i.mul([i.number(r),o])));if(n==="numeric")if(P(this.engine)){let r=this._bignum.add(this._number);Ce(this._rational)||(r=r.add(i.bignum(this._rational[0]).div(i.bignum(this._rational[1])))),this._imaginary!==0?t.push(i.number(i.complex(r.toNumber(),this._imaginary))):r.isZero()||t.push(i.number(r))}else{let r=this._bignum.toNumber()+this._number;Ce(this._rational)||(r+=Ie(this._rational)/Re(this._rational)),this._imaginary!==0?t.push(i.number(i.complex(r,this._imaginary))):r!==0&&t.push(i.number(r))}else{if(Ce(this._rational)||t.push(i.number(this._rational)),this._imaginary!==0){if(!K(i))return[i.NaN];t.push(i.number(i.complex(0,this._imaginary)))}if(P(this.engine)){let r=this._bignum.add(this._number);r.isZero()||t.push(i.number(r))}else this._bignum.isZero()||t.push(i.number(this._bignum)),this._number!==0&&t.push(i.number(this._number))}return ie(t,"Add")}asExpression(n){let i=this.engine,t=this.terms(n);return t.length===0?i.Zero:t.length===1&&!_i(t[0])?t[0]:i._fn("Add",it(t))}};var Si=["InvalidDomain","DictionaryOf","FunctionOf","ListOf","TupleOf","Intersection","Union","OptArg","VarArg"],nr={Functions:["FunctionOf",["VarArg","Anything"],"Anything"],NumericFunctions:["FunctionOf","Numbers",["VarArg","Numbers"],"Numbers"],RealFunctions:["FunctionOf","ExtendedRealNumbers",["VarArg","ExtendedRealNumbers"],"ExtendedRealNumbers"],LogicOperators:["FunctionOf","Booleans",["VarArg","Booleans"],"Booleans"],Predicates:["FunctionOf","Anything",["VarArg","Anything"],"Booleans"],RelationalOperators:["FunctionOf","Anything","Anything","Booleans"]},Cn={Anything:[],Values:"Anything",Domains:"Anything",Void:"NothingDomain",NothingDomain:["Booleans","Strings","Symbols","Tuples","Lists","Dictionaries","ImaginaryNumbers","TranscendentalNumbers","PositiveIntegers","NegativeIntegers","NonPositiveIntegers","NonNegativeIntegers","PositiveNumbers","NegativeNumbers","NonPositiveNumbers","NonNegativeNumbers","LogicOperators","RelationalOperators"],Booleans:"Values",Strings:"Values",Symbols:"Values",Collections:"Values",Lists:"Collections",Dictionaries:"Collections",Sequences:"Collections",Tuples:"Collections",Sets:"Collections",Functions:"Anything",Predicates:"Functions",LogicOperators:"Predicates",RelationalOperators:"Predicates",NumericFunctions:"Functions",RealFunctions:"NumericFunctions",Numbers:"Values",ExtendedComplexNumbers:"Numbers",ComplexNumbers:"ExtendedComplexNumbers",ImaginaryNumbers:"ComplexNumbers",ExtendedRealNumbers:"ExtendedComplexNumbers",RealNumbers:["ComplexNumbers","ExtendedRealNumbers"],PositiveNumbers:"NonNegativeNumbers",NonNegativeNumbers:"RealNumbers",NonPositiveNumbers:"NegativeNumbers",NegativeNumbers:"RealNumbers",TranscendentalNumbers:"RealNumbers",AlgebraicNumbers:"RealNumbers",RationalNumbers:"AlgebraicNumbers",Integers:"RationalNumbers",PositiveIntegers:"NonNegativeIntegers",NonNegativeIntegers:"Integers",NonPositiveIntegers:"NegativeIntegers",NegativeIntegers:"Integers"},rt;function Yn(e){return e?Cn[e]!==void 0:!1}function ze(e){if(rt||(rt={},ze("Void")),rt[e])return Array.from(rt[e]);let n=[];if(typeof e!="string"||!Cn[e]){if(!Array.isArray(e))throw Error(`Unknown domain literal ${e}`);if(!Si.includes(e[0]))throw Error(`Unknown domain constructor ${e[0]}`);return e[0]==="FunctionOf"?ze("Functions"):e[0]==="TupleOf"?ze("Tuples"):e[0]==="ListOf"?ze("Lists"):e[0]==="DictionaryOf"?ze("Dictionaries"):e[0]==="OptArg"||e[0]==="VarArg"?ze(e[1]):e[0]==="Literal"?["Anything"]:e[0]==="Union"?["Anything"]:e[0]==="Intersection"?["Anything"]:["Anything"]}if(typeof Cn[e]=="string")n=[Cn[e],...ze(Cn[e])];else if(Array.isArray(Cn[e]))for(let i of Cn[e])n.push(i),n.push(...ze(i));return rt[e]=new Set(n),n}function Ma(){let e={};for(let n of Object.keys(Cn))e[n]={domain:"Domains",value:["Domain",n]};e.InvalidDomain={signature:{domain:["FunctionOf","Domains","Domains"],canonical:(n,i)=>n.domain(["InvalidDomain",i[0]])}};for(let n of["DictionaryOf","FunctionOf","ListOf","TupleOf"])e[n]={signature:{domain:["FunctionOf",["VarArg","Domains"],"Domains"],canonical:(i,t)=>i.domain([n,...t])}};for(let n of["OptArg","VarArg"])e[n]={signature:{domain:["FunctionOf","Domains","Domains"],canonical:(i,t)=>i.domain([n,t[0]])}};return e}var La=pe(le(),1);var ot=pe(le(),1);function Eo(e){if(e.head==="Negate")return[-1,e.op1];let n=e.numericValue;if(n===null)return[1,e];let i=e.engine;return typeof n=="number"&&n<0?[-1,i.number(-n)]:n instanceof v&&n.isNegative()?[-1,i.number(n.neg())]:n instanceof ot.Complex&&n.re<0?[-1,i.number(i.complex(-n.re,-n.im))]:q(n)&&n[0]<0?[-1,i.number([-n[0],n[1]])]:J(n)&&n[0]<0?[-1,i.number([-n[0],n[1]])]:[1,e]}function Cf(e,n,i,t){let r=e.numericValue,o=e.engine;return typeof r=="number"?P(o)&&i?o.chop(i(o.bignum(r))):o.chop(n(r)):r instanceof v?o.chop(i?.(r)??n(r.toNumber())):q(r)?!P(o)||!i?o.chop(n(r[0]/r[1])):o.chop(i(o.bignum(r[0]).div(r[1]))):J(r)?i?o.chop(i(o.bignum(r[0]).div(o.bignum(r[1])))):o.chop(n(Number(r[0])/Number(r[1]))):r instanceof ot.Complex?!t||!K(o)?NaN:o.chop(t(r)):NaN}function R(e,n,i,t){if((e?.numericValue??null)!==null)return e.engine.number(Cf(e,n,i,t))}function Mf(e,n,i,t,r){e.numericValue!==null&&n.numericValue;let o=e.engine,s=e.numericValue;q(s)&&(s=s[0]/s[1]);let a=n.numericValue;if(q(a)&&(a=a[0]/a[1]),!P(o)&&typeof s=="number"&&typeof a=="number")return i(s,a);let u;s instanceof v?u=s:J(s)?u=o.bignum(s[0]).div(o.bignum(s[1])):s!==null&&typeof s=="number"&&(u=o.bignum(s));let l;return a instanceof v?l=a:J(a)?u=o.bignum(a[0]).div(o.bignum(a[1])):a!==null&&typeof a=="number"&&(l=o.bignum(a)),u&&l?t?.(u,l)??i(u.toNumber(),l.toNumber()):s instanceof ot.Complex||a instanceof ot.Complex?!r||!K(o)?NaN:r(o.complex(s??u?.toNumber()??NaN),o.complex(a??l?.toNumber()??NaN)):NaN}function Mn(e,n,i,t,r){if(!(e.numericValue===null||n.numericValue===null))return e.engine.number(Mf(e,n,i,t,r))}function vn(e,n,i){return e==="all"?!0:e==="none"?!1:e==="first"?i===0:e==="rest"?i!==0:e==="last"?i===n:e==="most"?i!==n:!0}function ee(e){return e.every(n=>n.isCanonical)?e:e.map(n=>n.canonical)}function Ne(e,n,i){if(n=ee(n),n=ce(n),!e.strict||n.length===i)return n;let t=[...n.slice(0,i)],r=Math.min(i,n.length);for(;r<i;)t.push(e.error("missing")),r+=1;for(;r<n.length;)t.push(e.error("unexpected-argument",n[r])),r+=1;return t}function Me(e,n,i){let t=typeof i=="number"?i:i?.count,r=typeof i=="number"||(i?.flatten??!0);if(n=ee(n),r&&(n=ce(n)),typeof r=="string"&&ie(n,r),!e.strict){for(let a of n)te(a)||a.infer(e.Numbers);return n}let o=!0;t??(t=n.length);let s=[];for(let a=0;a<=Math.max(t-1,n.length-1);a++){let u=n[a];if(a>t-1)o=!1,s.push(e.error("unexpected-argument",u));else if(u===void 0)o=!1,s.push(e.error("missing"));else if(u.symbol&&!e.lookupSymbol(u.symbol)&&!e.lookupFunction(u.symbol))s.push(u);else if(u.isNumber||u.domain?.isNumber)s.push(u);else if(!u.isValid)o=!1,s.push(u);else if(!u.domain)s.push(u);else if(te(u)){for(let l of H(u))if(!l.isNumber&&!l.domain?.isNumber){o=!1;break}o?s.push(u):s.push(e.domainError("Numbers",u.domain,u))}else u.symbolDefinition?.inferredDomain&&u.domain.isCompatible(e.Numbers,"contravariant")||u.functionDefinition?.signature.inferredSignature&&u.domain.isCompatible(e.Numbers,"contravariant")?s.push(u):(o=!1,s.push(e.domainError("Numbers",u.domain,u)))}if(o)for(let a of s)if(te(a))for(let u of H(a))u.infer(e.Numbers);else a.infer(e.Numbers);return s}function Ae(e,n,i){return n==null?e.error("missing"):i===void 0?e.error("unexpected-argument",n):(n=n.canonical,n.head==="Sequence"&&(n=n.op1),!n.isValid||!n.domain||n.domain.isCompatible(i)?n:e.domainError(i,n.domain,n))}function Aa(e,n){return n==null?e.error("missing"):(n=n.canonical,!n.isValid||n.isPure?n:e.error("expected-pure-expression",n))}function ir(e,n,i){if(n.length===i.length&&n.every((r,o)=>!r.domain||r.domain.isCompatible(i[o])))return n;let t=[];for(let r=0;r<=i.length-1;r++)t.push(Ae(e,n[r],i[r]));for(let r=i.length;r<=n.length-1;r++)t.push(e.error("unexpected-argument",n[r]));return t}function Oa(e,n,i,t,r,o,s){if(!e.strict)return null;let a=[],u=!0,l=0;for(let f of r){let d=n[l++];if(!d){a.push(e.error("missing")),u=!1;continue}if(vn(i,r.length,l-1)){a.push(d);continue}if(!d.isValid){a.push(d),u=!1;continue}if(!d.domain){a.push(d);continue}if(t&&te(d)){a.push(d);continue}if(d.symbolDefinition?.inferredDomain&&d.domain.isCompatible(f,"contravariant")){a.push(d);continue}if(d.functionDefinition?.signature.inferredSignature&&d.domain.isCompatible(f,"contravariant")){a.push(d);continue}if(!d.domain.isCompatible(f)){a.push(e.domainError(f,d.domain,d)),u=!1;continue}a.push(d)}for(let f of o){let d=n[l];if(!d)break;if(vn(i,r.length,l)){a.push(d);continue}if(!d.isValid){a.push(d),u=!1,l+=1;continue}if(!d.domain){a.push(d),l+=1;continue}if(t&&te(d)){a.push(d);continue}if(d.symbolDefinition?.inferredDomain&&d.domain.isCompatible(f,"contravariant")){a.push(d);continue}if(!d.domain.isCompatible(f)){a.push(e.domainError(f,d.domain,d)),u=!1,l+=1;continue}a.push(d),l+=1}if(s)for(let f of n.slice(l)){if(l+=1,vn(i,r.length,l-1)){a.push(f);continue}if(!f.isValid){a.push(f),u=!1;continue}if(!f.domain){a.push(f);continue}if(t&&te(f)){a.push(f);continue}if(f.symbolDefinition?.inferredDomain&&f.domain.isCompatible(s,"contravariant")){a.push(f);continue}if(!f.domain.isCompatible(s)){a.push(e.domainError(s,f.domain,f)),u=!1;continue}a.push(f)}if(l<n.length)for(let f of n.slice(l))a.push(e.error("unexpected-argument",f)),u=!1;if(!u)return a;l=0;for(let f of r)vn(i,r.length,l)||(!t||!te(n[l]))&&n[l].infer(f),l+=1;for(let f of o)(!t||!te(n[l]))&&n[l]?.infer(f),l+=1;if(s)for(let f of n.slice(l))vn(i,r.length,l)||(!t||!te(f))&&f.infer(s),l+=1;return null}function tr(e){if(!e)return;let n=e.engine,i=null,t=null,r=null;return e.head!=="Tuple"&&e.head!=="Triple"&&e.head!=="Pair"&&e.head!=="Single"?i=e:(i=e.ops[0]??null,t=e.ops[1]?.canonical??null,r=e.ops[2]?.canonical??null),i.head==="Hold"&&(i=i.op1),i.symbol?(n.declare(i.symbol,{domain:"Integers"}),i.bind(),i=n.hold(i)):i=n.domainError("Symbols",i.domain,i),t&&t.isFinite&&(t=Ae(n,t,"Integers")),r&&r.isFinite&&(r=Ae(n,r,"Integers")),t&&r?n.tuple([i,t,r]):r?n.tuple([i,n.One,r]):t?n.tuple([i,t]):i}function An(e){let n=1,i=n+Zt,t,r=!0;if(e&&(e.head==="Tuple"||e.head==="Triple"||e.head==="Pair"||e.head==="Single")){if(t=(e.op1.head==="Hold"?e.op1.op1.symbol:e.op1.symbol)??"Nothing",n=A(e.op2)??1,Number.isFinite(n)||(r=!1),e.op3.isNothing||e.op3.isInfinity)r=!1;else{let o=A(e.op3);o===null?r=!1:(i=o,Number.isFinite(i)||(r=!1))}!r&&Number.isFinite(n)&&(i=n+Zt)}else e&&(t=(e.head==="Hold"?e.op1.symbol:e.symbol)??"Nothing",n=1,i=n+Zt);return[t,n,i,r]}var Af={Add:["+",11],Negate:["-",14],Subtract:["-",11],Multiply:["*",12],Divide:["/",13],Equal:["===",8],NotEqual:["!==",8],LessEqual:["<=",9],GreaterEqual:[">=",9],Less:["<",9],Greater:[">",9],And:["&&",4],Or:["||",3],Not:["!",14]},Of={Abs:"Math.abs",Add:(e,n)=>e.length===1?n(e[0]):`(${e.map(i=>n(i)).join(" + ")})`,Arccos:"Math.acos",Arcosh:"Math.acosh",Arsin:"Math.asin",Arsinh:"Math.asinh",Arctan:"Math.atan",Artanh:"Math.atanh",Ceiling:"Math.ceil",Chop:"_SYS.chop",Cos:"Math.cos",Cosh:"Math.cosh",Exp:"Math.exp",Floor:"Math.floor",Gamma:"_SYS.gamma",GCD:"_SYS.gcd",LCM:"_SYS.lcm",Limit:(e,n)=>`_SYS.limit(${n(e[0])}, ${n(e[1])})`,Ln:"Math.log",List:(e,n)=>`[${e.map(i=>n(i)).join(", ")}]`,Log:(e,n)=>e.length===1?`Math.log(${n(e[0])})`:`(Math.log(${n(e[0])}) / Math.log(${n(e[1])}))`,LogGamma:"_SYS.lngamma",Lb:"Math.log2",Max:"Math.max",Min:"Math.min",Power:(e,n)=>{let i=e[0];if(i===null)throw new Error("Power: no argument");let t=y(e[1]);return t===.5?`Math.sqrt(${n(i)})`:t===1/3?`Math.cbrt(${n(i)})`:t===1?n(i):t===-1?`1 / (${n(i)})`:t===-.5?`1 / Math.sqrt(${n(i)})`:`Math.pow(${n(i)}, ${n(e[1])})`},Range:(e,n)=>{if(e.length===0)return"[]";if(e.length===1)return`Array.from({length: ${n(e[0])}}, (_, i) => i)`;let i=n(e[0]),t=n(e[1]),r=e[2]?n(e[2]):"1";if(i===null)throw new Error("Range: no start");if(t===null&&(t=i,i="1"),r==="0")throw new Error("Range: step cannot be zero");if(parseFloat(r)===1){let o=parseFloat(t),s=parseFloat(i);return o!==null&&s!==null?o-s<50?`[${Array.from({length:o-s+1},(a,u)=>s+u).join(", ")}]`:`Array.from({length: ${o-s+1} 
        }, (_, i) => ${i} + i)`:`Array.from({length: ${t} - ${i} + 1
      }, (_, i) => ${i} + i)`}return`Array.from({length: Math.floor((${t} - ${i}) / ${r}) + 1}, (_, i) => ${i} + i * ${r})`},Root:(e,n)=>{let i=e[0];if(i===null)throw new Error("Root: no argument");let t=e[1];return t===null?`Math.sqrt(${n(i)})`:`Math.pow(${n(i)}, 1 / (${n(t)}))`},Random:"Math.random",Round:"Math.round",Square:(e,n)=>{let i=e[0];if(i===null)throw new Error("Square: no argument");return`Math.pow(${n(i)}, 2)`},Sgn:"Math.sign",Sin:"Math.sin",Sinh:"Math.sinh",Sqrt:"Math.sqrt",Tan:"Math.tan",Tanh:"Math.tanh"},vo=class extends Function{constructor(i){super("_SYS","_",`return ${i}`);this.sys={factorial:Jt,gamma:bi,lngamma:Zi,gcd:jn,lcm:Ht,chop:Zn,limit:Un};return new Proxy(this,{apply:(t,r,o)=>super.apply(r,[this.sys,...o]),get:(t,r)=>r==="toString"?()=>i:t[r]})}};function Pf(e,n){let i=me(e,n);return new vo(i)}function Pa(e){let n=e.unknowns;return Pf(e,{operators:i=>Af[i],functions:i=>Of[i],var:i=>{let t={Pi:"Math.PI",ExponentialE:"Math.E",NaN:"Number.NaN",ImaginaryUnit:"Number.NaN",Half:"0.5",MachineEpsilon:"Number.EPSILON",GoldenRatio:"((1 + Math.sqrt(5)) / 2)",CatalanConstant:"0.91596559417721901",EulerGamma:"0.57721566490153286"}[i];if(t!==void 0)return t;if(n.includes(i))return`_.${i}`},string:i=>JSON.stringify(i),number:i=>i.toString(),indent:0,ws:i=>i??""})}function Fa(e,n,i,t){if(e==="Error")throw new Error("Error");if(e==="Sequence")return n.length===0?"":`(${n.map(o=>me(o,t,i)).join(", ")})`;if(e==="Sum"||e==="Product")return Ff(e,n,t);if(n.every(o=>!Ni(o))){let o=t.operators?.(e);if((e==="NotEqual"||e==="Equal"||e==="Less"||e==="Greater"||e==="LessEqual"||e==="GreaterEqual")&&n.length>2&&o){let s=[];for(let a=0;a<n.length-1;a++)s.push(Fa(e,[n[a],n[a+1]],o[1],t));return`(${s.join(") && (")})`}if(o!==void 0){if(n===null)return"";let s;return n.length===1?s=`${o[0]}${me(n[0],t,o[1])}`:s=n.map(a=>me(a,t,o[1])).join(` ${o[0]} `),o[1]<i?`(${s})`:s}}if(e==="Function"){let o=n.slice(1).map(s=>s.symbol);return`((${o.join(", ")}) => ${me(n[0].canonical,{...t,var:s=>o.includes(s)?s:t.var(s)})})`}if(e==="Declare")return`let ${n[0].symbol}`;if(e==="Assign")return`${n[0].symbol} = ${me(n[1],t)}`;if(e==="Return")return`return ${me(n[0],t)}`;if(e==="If"){if(n.length!==3)throw new Error("If: wrong number of arguments");return`((${me(n[0],t)}) ? (${me(n[1],t)}) : (${me(n[2],t)}))`}if(e==="Block"){let o=[];for(let a of n)a.head==="Declare"&&o.push(a.ops[0].symbol);if(n.length===1&&o.length===0)return me(n[0],t);let s=n.map(a=>me(a,{...t,var:u=>o.includes(u)?u:t.var(u)}));return s[s.length-1]=`return ${s[s.length-1]}`,`(() => {${t.ws(`
`)}${s.join(`;${t.ws(`
`)}`)}${t.ws(`
`)}})()`}let r=t.functions?.(e);if(!r)throw new Error(`Unknown function ${e}`);if(typeof r=="function"){if(n.length===1&&te(n[0])){let o=Ti();return`(${me(n[0],t)}).map((${o}) => ${r(n[0].engine.box(o),s=>me(s,t))})`}return r(n,o=>me(o,t))}if(n===null)return`${r}()`;if(n.length===1&&te(n[0])){let o=Ti();return`(${me(n[0],t)}).map((${o}) => ${r}(${me(n[0].engine.box(o),t)}))`}return`${r}(${n.map(o=>me(o,t)).join(", ")})`}function me(e,n,i=0){if(e===void 0)return"";if(!e.isValid)throw new Error("Invalid expression");let t=y(e);if(t!==null)return n.number(t);let r=e.symbol;if(r!==null)return n.var?.(r)??r;if(e.string!==null)return n.string(r);let s=e.keys;if(s!==null){let u=[];for(let l of s){let f=e.getKey(l);f&&u.push(`${l}: ${me(f,n,0)}`)}return`{${u.join(", ")}}`}let a=e.head;return typeof a=="string"?Fa(a,e.ops,i,n):""}function Ff(e,n,i){if(n===null)throw new Error("Sum/Product: no arguments");if(!n[0])throw new Error("Sum/Product: no body");let[t,r,o,s]=An(n[1]),a=e==="Sum"?"+":"*";if(!t){let d=Ti(),c=Ti();return`${me(n[0],i)}.reduce((${c}, ${d}) => ${c} ${a} ${d}, ${a==="+"?"0":"1"})`}let u=me(n[0],{...i,var:d=>d===t?t:i.var(d)}),l=Ti(),f=Ti();return`(() => {
  let ${f} = ${a==="+"?"0":"1"};
  let ${t} = ${r};
  const _fn = () => ${u};
  while (${l} <= ${o}) {
    ${f} ${a}= _fn();
    ${l}++;
  }
  return ${f};
})()`}function Ti(){return`_${Math.random().toString(36).substring(2)}`}var L=class{constructor(n,i){this.engine=n,i?.latex!==void 0&&(this._latex=i.latex)}valueOf(){return this.symbol==="True"?!0:this.symbol==="False"?!1:this.head&&typeof this.head=="string"&&["List","Set","Sequence","Tuple","Pair","Single","Triple"].includes(this.head)?this.ops?.map(n=>n.valueOf()):y(this)??this.string??this.symbol??JSON.stringify(this.json)}toString(){if(this.symbol)return this.symbol;if(this.string)return this.string;let n=this.numericValue;if(n!==null){if(typeof n=="number")return n.toString();if(q(n))return`(${n[0].toString()}/${n[1].toString()})`;if(J(n))return`(${n[0].toString()}/${n[1].toString()})`;if(n instanceof La.Complex){let i=n.im===1?"":n.im===-1?"-":n.im.toString();return n.re===0?i+"i":n.im<0?`${n.re.toString()}${i}i`:`(${n.re.toString()}+${i}i)`}}return JSON.stringify(this.json)}print(){this.toString()}[Symbol.toPrimitive](n){if(n==="number"){let i=this.valueOf();return typeof i=="number"?i:null}return this.toString()}toJSON(){return this.json}get rawJson(){return this.json}get scope(){return null}is(n){return n==null?!1:this.isSame(this.engine.box(n))}get latex(){return this._latex??this.engine.serialize(this)}set latex(n){this._latex=n}get symbol(){return null}get isNothing(){return!1}get string(){return null}getSubexpressions(n){return Xt(this,n)}get subexpressions(){return this.getSubexpressions("")}get symbols(){let n=new Set;return Wi(this,n),Array.from(n)}get unknowns(){let n=new Set;return Yi(this,n),Array.from(n)}get freeVariables(){let n=new Set;return Qi(this,n),Array.from(n)}get errors(){return this.getSubexpressions("Error")}get ops(){return null}get nops(){return 0}get op1(){return this.engine.Nothing}get op2(){return this.engine.Nothing}get op3(){return this.engine.Nothing}get isValid(){return!0}get isPure(){return!1}get isExact(){return!0}get isConstant(){return!1}get canonical(){return this}subs(n,i){return i?.canonical?this.canonical:this}solve(n){return null}replace(n){return null}has(n){return!1}get isNaN(){}get isZero(){}get isNotZero(){}get isOne(){}get isNegativeOne(){}get isInfinity(){}get isFinite(){}get isEven(){}get isOdd(){}get isPrime(){}get isComposite(){}get numericValue(){return null}get shape(){return[]}get rank(){return 0}get sgn(){return null}isLess(n){}isLessEqual(n){}isGreater(n){}isGreaterEqual(n){}get isPositive(){}get isNonNegative(){}get isNegative(){}get isNonPositive(){}isCompatible(n,i){return!1}get description(){if(this.baseDefinition&&this.baseDefinition.description)return typeof this.baseDefinition.description=="string"?[this.baseDefinition.description]:this.baseDefinition.description}get url(){return this.baseDefinition?.url??void 0}get wikidata(){return this.baseDefinition?.wikidata??void 0}get complexity(){}get baseDefinition(){}get symbolDefinition(){}get functionDefinition(){}infer(n){return!1}bind(){}reset(){}get keys(){return null}get keysCount(){return 0}getKey(n){}hasKey(n){return!1}get value(){return this.N().valueOf()}set value(n){throw new Error(`Can't change the value of \\(${this.latex}\\)`)}get domain(){}set domain(n){throw new Error(`Can't change the domain of \\(${this.latex}\\)`)}get isNumber(){}get isInteger(){}get isRational(){}get isAlgebraic(){return!1}get isReal(){}get isExtendedReal(){}get isComplex(){}get isImaginary(){}get isExtendedComplex(){}simplify(n){return this}evaluate(n){return this.simplify()}N(n){return this.evaluate({numericMode:!0})}compile(n="javascript",i){if(n!=="javascript")return;i??(i={optimize:["simplify"]});let t=this;return i.optimize.includes("simplify")&&(t=t.simplify()),i.optimize.includes("evaluate")&&(t=t.evaluate()),Pa(t)}};var Nn=class e extends L{constructor(i,t,r){t instanceof e;super(i,r);if(typeof t=="string"){if(!Yn(t))throw Error(`Unknown domain literal "${t}"`);this.base=t,this.ctor=null,this.params=[];return}if(!Array.isArray(t))throw Error("Expected a domain expression");if(!Si.includes(t[0]))throw Error(`Unknown domain constructor "${t[0]}`);let o=t[0];if(this.ctor=o,o==="OptArg"||o==="VarArg")throw Error(`Unexpected domain constructor "${o}" outside of FunctionOf`);if(this.params=t.slice(1).map(s=>s instanceof L?s.json:s),o==="FunctionOf"&&(this.base="Functions",i.strict&&Hi(this)),o==="DictionaryOf"&&(this.base="Dictionaries"),o==="ListOf"&&(this.base="Lists"),o==="TupleOf"&&(this.base="Tuples"),o==="Covariant"||o==="Contravariant"||o==="Bivariant"||o==="Invariant"){let s=i.domain(t[1]);if(this.ctor=o,this.base=s.base,this.params=[s.json],t.length!==2)throw Error(`Invalid "${o}" in domain "${t}"`)}if(o==="Union"||o==="Intersection"){let s;if(o==="Union")for(let a of this.params)s=On(s,i.domain(a));else for(let a of this.params)s=st(s,i.domain(a));this.base=s.base}}get isCanonical(){return!0}get canonical(){return this}get isValid(){return!0}get json(){return this.ctor?[this.ctor,...this.params]:this.base}get hash(){return this._hash===void 0&&(this._hash=he(JSON.stringify(this.json))),this._hash}isCompatible(i,t="covariant"){let r=this.json,o=i instanceof e?i.json:i,s=Array.isArray(o)?o[0]:null;if(s){let a=o[1];if(s==="Covariant")return be(r,a);if(s==="Contravariant")return be(a,r);if(s==="Invariant")return!be(a,r)&&!be(r,a);if(s==="Bivariant")return be(r,a)&&be(a,r)}return t==="covariant"?be(r,o):t==="contravariant"?be(o,r):t==="bivariant"?be(o,r)&&be(r,o):!be(o,r)&&!be(r,o)}isEqual(i){return i instanceof e?this===i?!0:this.isCompatible(i,"invariant"):!1}isSame(i){return this.isEqual(i)}match(i,t){return i instanceof e&&this.isCompatible(i,"invariant")?{}:null}get head(){return"Domain"}get domain(){return this.engine.domain("Domains")}get isFunction(){return this.base==="Functions"}get isNumeric(){return this.isCompatible(this.engine.domain("Numbers"))}};function an(e){if(e instanceof Nn)return!0;if(e instanceof L&&(e=e.json),typeof e=="string")return Yn(e);if(!Array.isArray(e)||e.length<=1)return!1;let n=e[0];return typeof n!="string"||!Si.includes(n)?!1:n==="ListOf"||n==="OptArg"||n==="VarArg"?e.length===2&&an(e[1]):n==="FunctionOf"||n==="TupleOf"||n==="Intersection"||n==="Union"?e.slice(1).every(an):e.every(i=>i!==null)}function be(e,n){let[i,t]=rr([e],n);return!!(i&&t.length===0)}function rr(e,n){let i=e.shift(),t=typeof n=="string"?n:null;if(t==="Anything")return[!0,e];let r=typeof i=="string"?i:null;if(r&&t)return r===t?[!0,e]:[ze(r).includes(t),e];if(t){let s=i[0];return s==="FunctionOf"?[t==="Functions",e]:s==="DictionaryOf"?[t==="Dictionaries",e]:s==="ListOf"?[t==="Lists",e]:s==="TupleOf"?[t==="Tuples",e]:[!0,e]}let o=n[0];if(o==="FunctionOf"){if(r==="Functions")return[!0,e];if(r)return[!1,e];if(i[0]!=="FunctionOf")return[!1,e];if(i.length===1&&n.length===1)return[!0,e];if(!be(i[i.length-1],n[n.length-1]))return[!1,e];let s=i.slice(1,-1),a=n.slice(1,-1);for(let u=0;u<=s.length-1;u++){if(a.length===0)return(Array.isArray(s[u])?s[u][0]:null)!=="OptArg"?[!1,e]:[!0,e];{let l=!1;if([l,a]=rr(a,s[u]),!l)return[!1,e]}}return[a.length===0,e]}if(o==="Intersection")return[n.slice(1,-1).every(s=>be(i,s)),e];if(o==="Union")return[n.slice(1,-1).some(s=>be(i,s)),e];if(o==="OptArg")return r==="NothingDomain"?[!0,e]:rr([i,...e],n[1]);if(o==="VarArg"){let s=n[1];if(!be(i,s))return[!1,e];i=e.shift();let a=!0;for(;e.length>0&&a;)[a,e]=rr(e,s),i=e.shift();return[!0,e]}if(o==="TupleOf"){if(!Array.isArray(i)||i[0]!=="TupleOf")return[!1,e];if(i.length>n.length)return[!1,e];for(let s=1;s<=n.length-1;s++)if(!i[s]||!be(i[s],n[s]))return[!1,e];return[!0,e]}return console.error("Unexpected domain constructor "+o),[!1,e]}function On(e,n){if(e==null)return n;if(n==null)return e;let i=[e.base,...ze(e.base)],t=[n.base,...ze(n.base)];for(;!t.includes(i[0]);)i.shift();return e.engine.domain(i[0])}function st(e,n){return e===void 0?n:n===void 0||be(e.base,n.base)?e:be(n.base,e.base)?n:e.engine.Void}function or(e,n){if(n.every(i=>i.isCanonical),n=n.filter(i=>i.numericValue===null||!i.isZero),n.length===0)return e.Zero;if(n.length===1&&!_i(n[0]))return n[0];if(n.length===2){let i=0,t=0;if(t=y(n[0]),t!==null&&t!==0?i=Kt(n[1]):(i=Kt(n[0]),i!==0&&n[1].numericValue!==null&&(t=y(n[1]))),t!==null&&i!==null&&i!==0)return e.number(e.complex(t,i))}return n.length>1&&(n=it(n)),e._fn("Add",n)}function Ra(e,n){let i=null;for(let t of n){if(!t?.isNumeric)return null;i=On(i,t)}return i}function sr(e,n){let i=new tt(e);for(let t of n){if(t=t.simplify(),t.isImaginary&&t.isInfinity)return e.ComplexInfinity;if(t.isNaN||t.symbol==="Undefined")return e.NaN;t.isZero||i.addTerm(t)}return i.asExpression("expression")}function Lf(e){let n=0;for(let i of e){let t=i.numericValue;if(typeof t=="number")n+=t;else return null}return n}function No(e,n,i="evaluate"){if(i==="N"&&e.numericMode==="machine"){n=n.map(r=>r.N());let t=Lf(n);if(t!==null)return e.number(t)}for(let t of n){if(t.isImaginary&&t.isInfinity)return e.ComplexInfinity;if(t.isNaN||t.symbol==="Undefined")return e.NaN;t.isExact||(i="N")}return i==="N"?n=n.map(t=>t.N()):n=n.map(t=>t.evaluate()),new tt(e,n).asExpression(i==="N"?"numeric":"expression")}function qa(e,n,i){e.pushScope(),n??(n=e.error("missing")),i=tr(i);let t=i?e._fn("Sum",[n.canonical,i]):e._fn("Sum",[n.canonical]);return e.popScope(),t}function ar(e,n,i,t){let r=null;if(!i){let d=t==="simplify"?n.simplify():n.evaluate({numericMode:t==="N"});if(P(e)){let c=e.bignum(0);for(let p of H(d)){let h=$e(p);if(h===null){r=void 0;break}if(!h.isFinite()){c=h;break}c=c.add(h)}r===null&&(r=e.number(c))}else{let c=0;for(let p of H(d)){let h=y(p);if(h===null){r=void 0;break}if(h===null||!Number.isFinite(h)){c=h;break}c+=h}r===null&&(r=e.number(c))}return r??void 0}let[o,s,a,u]=An(i.evaluate());if(!o)return;let l=n;if(s>=a||t==="simplify"&&a-s>=ji)return;t==="evaluate"&&a-s>=ji&&(t="N");let f=e.swapScope(l.scope);if(e.pushScope(),l.bind(),t==="simplify"){let d=[];for(let c=s;c<=a;c++)e.assign(o,c),d.push(l.simplify());r=e.add(d).simplify()}if(t==="evaluate"){let d=[];for(let c=s;c<=a;c++)e.assign(o,c),d.push(l.evaluate());r=e.add(d).evaluate()}if(t==="N"){if(r===null&&u)if(P(e)){let d=e.bignum(0);for(let c=s;c<=a;c++){e.assign(o,c);let p=$e(l.N());if(p===null){r=void 0;break}if(!p.isFinite()){d=p;break}d=d.add(p)}r===null&&(r=e.number(d))}else{let d=e.numericMode,c=e.precision;e.numericMode="machine";let p=0;for(let h=s;h<=a;h++){e.assign(o,h);let g=y(l.N());if(g===null){r=void 0;break}if(!Number.isFinite(g)){p=g;break}p+=g}e.numericMode=d,e.precision=c,r===null&&(r=e.number(p))}else if(r===null){e.assign(o,1e3);let d=l.N();e.assign(o,999);let c=l.N(),p=y(e.div(d,c).N());if(p!==null&&Number.isFinite(p)&&Math.abs(p)>1)r=e.PositiveInfinity;else{let h=0,g=e.numericMode,E=e.precision;e.numericMode="machine";for(let S=s;S<=a;S++){e.assign(o,S);let k=y(l.N());if(k===null){r=void 0;break}if(Math.abs(k)<Number.EPSILON||!Number.isFinite(k))break;h+=k}e.numericMode=g,e.precision=E,r===null&&(r=e.number(h))}}}return e.popScope(),e.swapScope(f),r??void 0}var Va=pe(le(),1);function Rf(e,n){let i=e.numericValue;return i===null?null:(typeof i=="number"?i=-i:i instanceof v||i instanceof Va.Complex?i=i.neg():Array.isArray(i)&&(i=ve(i)),e.engine.number(i,{metadata:n}))}function re(e,n){if(e.head==="Negate")return e.op1;if(e.numericValue!==null)return Rf(e,n);if(e.head==="Add"){let i=e.ops.map(t=>re(t));return i=ie(i,"Add"),e.engine.add(i,n)}return e.head==="Multiply"?qf(e.engine,e.ops):e.head==="Divide"?e.engine._fn("Divide",[re(e.op1),e.op2]):(e.head,e.engine._fn("Negate",[e],n))}function qf(e,n){let i=[],t=!1;for(let r of n)!t&&r.head==="Negate"?(t=!0,i.push(r.op1)):i.push(r);if(t)return e.mul(i);i=[];for(let r of n)t||r.numericValue===null||!r.isInteger?i.push(r):(t=!0,i.push(re(r)));if(t)return e.mul(i);i=[];for(let r of n)t||r.numericValue===null||!r.isNumber?i.push(r):(t=!0,i.push(re(r)));return t?e.mul(i):e._fn("Negate",[e._fn("Multiply",n)])}function ur(e,n,i="simplify"){return re(n)}function un(e,n){if(e.head==="Negate"&&n.head==="Negate")return un(e.op1,n.op1);if(e.head==="Negate")return re(un(e.op1,n));if(n.head==="Negate")return re(un(e,n.op1));let i=e.engine;if(e.head==="Divide"&&n.head==="Divide"){let t=i.mul([e.op2,n.op2]);return i.div(un(e.op1,n.op1),t)}return e.head==="Divide"?i.div(un(e.op1,n),e.op2):n.head==="Divide"?i.div(un(e,n.op1),n.op2):e.head==="Add"?i.add(e.ops.map(t=>un(t,n))):n.head==="Add"?i.add(n.ops.map(t=>un(e,t))):i.mul([e,n])}function Bi(e){return e.length===1?e[0]:e.length===2?un(e[0],e[1]):un(e[0],Bi(e.slice(1)))}var at=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]];function Vf(e,n){for(;e>=at.length;){let i=at.length,t=[1],r=at[i-1];for(let o=1;o<i;o++)t[o]=r[o-1]+r[o];t[i]=1,at.push(t)}return at[e][n]}function $f(e){let n=e.reduce((t,r)=>t+r,0),i=1;for(let t=0;t<e.length;t+=1)i*=Vf(n,e[t]),n-=e[t];return i}function*$a(e,n){if(e===1){yield[n];return}for(let i=0;i<=n;i+=1)for(let t of $a(e-1,n-i))yield[i,...t]}function za(e){if(e.head!=="Power")return null;let n=A(e.op2);if(n===null||n<0)return null;if(n===0)return e.engine.One;if(n===1)return e.op1;let i=e.engine;if(e.op1.head==="Negate"){let s=n%2===0?1:-1,a=za(i.pow(e.op1.op1,e.op2));return a===null?null:s>0?a:i.neg(a)}if(e.op1.head,e.op1.head!=="Add")return null;let t=e.op1.ops,r=$a(t.length,n),o=[];for(let s of r){let a=[i.number($f(s))];for(let u=0;u<s.length;u+=1)s[u]!==0&&(s[u]===1?a.push(t[u]):a.push(i.pow(t[u],s[u])));o.push(i.mul(a))}return i.add(o)}function zf(e){if(e.head!=="Divide")return null;let n=_n(e.op1);if(n===null)return null;let i=e.engine;return n.head==="Add"?i.add(n.ops.map(t=>i.div(t,e.op2))):e.engine.div(n,e.op2)}function _n(e){if(!e)return null;let n=zf(e);if(n!==null||e.head==="Multiply"&&(n=Bi(e.ops),n!==null))return n;if(e.head==="Add"){let i=e.ops.map(t=>_n(t)??t);return sr(e.engine,i)}return e.head==="Negate"&&(n=_n(e.op1),n!==null)?e.engine.neg(n):e.head==="Power"&&(n=za(e),n!==null)?n:null}var Uf=[{match:["Multiply","_x","__a"],replace:0,id:"ax",condition:({__a:e})=>!e.has("_x")},{match:["Add",["Divide","_a","_x"],"__b"],replace:1/0,condition:({_a:e,__b:n})=>!e.has("_x")&&!n.has("_x")},{match:["Add",["Multiply","_x","__a"],"__b"],replace:["Divide",["Negate","__b"],"__a"],condition:({__a:e,__b:n})=>!e.has("_x")&&!n.has("_x")},{match:["Add",["Multiply","_a",["Power","_x","_n"]],"__b"],replace:["Divide",["Power",["Negate","__b"],["Divide",1,"_n"]],"_a"],condition:({_a:e,__b:n,_n:i})=>!e.has("_x")&&!n.has("_x")&&!i.isZero},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"],"__c"],replace:["Divide",["Add",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","__c"]]]],["Multiply",2,"__a"]],condition:({__a:e,__b:n,__c:i})=>!e.has("_x")&&!n.has("_x")&&!i.has("_x")},{match:["Add",["Multiply","__a",["Power","_x",2]],["Multiply","__b","_x"],"__c"],replace:["Divide",["Subtract",["Negate","__b"],["Sqrt",["Subtract",["Square","__b"],["Multiply",4,"__a","__c"]]]],["Multiply",2,"__a"]],condition:({__a:e,__b:n,__c:i})=>!e.has("_x")&&!n.has("_x")&&!i.has("_x")},{match:["Add",["Multiply","__a",["Exp",["Multiply","__b","_x"]]],"__c"],replace:["Divide",["Ln",["Negate",["Divide","__c","__a"]]],"__b"],condition:({__a:e,__c:n},i)=>((!e.isZero&&i.div(n,e).isNegative)??!1)&&!e.has("_x")&&!n.has("_x")},{match:["Add",["Multiply","__a",["Exp","_x"]],"__c"],replace:["Ln",["Negate",["Divide","__c","__a"]]],condition:({__a:e,__c:n},i)=>((!e.isZero&&i.div(n,e).isNegative)??!1)&&!e.has("_x")&&!n.has("_x")}];function lr(e,n){let i=e.engine;e.head==="Equal"&&(e=i.add([e.op1.canonical,i.neg(e.op2.canonical)]).simplify());let t=i.cache("univariate-roots-rules",()=>Wn(i,Uf)),r=[e.subs({[n]:"_x"},{canonical:!1})],o=r.flatMap(s=>Ki(s,t,{_x:i.symbol("_x")}));return o.length===0&&(r=r.flatMap(s=>Ua(s)),o=r.flatMap(s=>Ki(s,t,{_x:i.symbol(n)}))),o.length===0&&(r=r.flatMap(s=>_n(s.canonical)).filter(s=>s!==null),r=r.flatMap(s=>Ua(s)),o=r.flatMap(s=>Ki(s,t,{_x:i.symbol(n)}))),o.map(s=>s.evaluate())}var Gf=[{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Add",["Multiply","__a","_x"],"__b","__c"]},{match:["Add",["Abs",["Add",["Multiply","__a","_x"],"__b"]],"__c"],replace:["Add",["Negate",["Multiply","__a","_x"]],["Negate","__b"],"__c"]},{match:["Multiply","__a",["Power","_b","_n"]],replace:"_b",condition:({__a:e,_b:n,_n:i})=>!e.has("_x")&&n.has("_x")&&!i.isZero},{match:["Multiply","__a",["Sqrt","_b"]],replace:["Multiply",["Square","_a"],"__b"],condition:({_b:e})=>e.has("_x")},{match:["Divide","_a","_b"],replace:"_a",condition:({_a:e,_b:n})=>e.has("_x")&&!n.isZero},{match:["Multiply","__a","_b"],replace:"_b",condition:({__a:e,_b:n})=>!e.has("_x")&&n.has("_x")},{match:["Add",["Ln","_a"],["Ln","_b"],"__c"],replace:["Add",["Ln",["Multiply","_a","_b"]],"__c"]},{match:["Multiply",["Exp","__a"],["Exp","__b"],"__c"],replace:["Multiply",["Exp",["Add","_a","_b"]],"__c"]},{match:["Ln","_a"],replace:["Subtract","_a",1],condition:({_a:e})=>e.has("_x")},{match:["Sin","_a"],replace:"_a",condition:({_a:e})=>e.has("_x")},{match:["Cos","_a"],replace:["Subtract","_a",["Divide","Pi",2]],condition:({_a:e})=>e.has("_x")},{match:["Tan","_a"],replace:"_a",condition:({_a:e})=>e.has("_x")},{match:["Add",["Sin","_a"],["Cos","_a"]],replace:1,condition:({_a:e})=>e.has("_x")},{match:["Subtract",["Square",["Sin","_a"]],["Square",["Cos","_a"]]],replace:["PlusMinus",["Sin","_a"],["Divide",["Sqrt",2],2]],condition:({_a:e})=>e.has("_x")}];function Ua(e){let n=e.engine,i=n.cache("univariate-roots-rules",()=>Wn(n,Gf));return Ki(e,i,{_x:n.symbol("_x")})}function Ga(e){return e.head==="Element"?Hf(e):e.head==="Equal"?jf(e):Yf(e)?Zf(e):"not-a-predicate"}function jf(e){e.head;let n=e.unknowns;if(n.length===0){let r=e.evaluate();return r.symbol==="True"?"tautology":r.symbol==="False"?"contradiction":(e.canonical.evaluate(),"not-a-predicate")}let i=e.engine,t=e.op1.symbol;if(t&&!Wf(i,t)&&!e.op2.has(t)){let r=e.op2.evaluate();if(!r.isValid)return"not-a-predicate";let o=i.lookupSymbol(t);return o?o.domain&&!r.domain?.isCompatible(o.domain)?"contradiction":(o.value=r,"ok"):(i.defineSymbol(t,{value:r,domain:r.domain}),"ok")}if(n.length===1){let r=n[0],o=lr(e,r);o.length===0&&i.assumptions.set(i.fn("Equal",[i.add([e.op1.canonical,i.neg(e.op2.canonical)]).simplify(),0]),!0);let s=o.length===1?o[0]:i.fn("List",o),a=i.lookupSymbol(r);return a?a.domain&&!o.every(u=>!u.domain||s.domain?.isCompatible(u.domain))?"contradiction":(a.value=s,"ok"):(i.defineSymbol(r,{value:s,domain:s.domain}),"ok")}return i.assumptions.set(e,!0),"ok"}function Zf(e){let n=e.engine;if(e.op1.symbol&&!_o(n,e.op1.symbol))return e.op2.evaluate().isZero?e.head==="Less"?n.defineSymbol(e.op1.symbol,{domain:n.domain("NegativeNumbers")}):e.head==="LessEqual"?n.defineSymbol(e.op1.symbol,{domain:n.domain("NonPositiveNumbers")}):e.head==="Greater"?n.defineSymbol(e.op1.symbol,{domain:n.domain("PositiveNumbers")}):e.head==="GreaterEqual"&&n.defineSymbol(e.op1.symbol,{domain:n.domain("NonNegativeNumbers")}):(n.defineSymbol(e.op1.symbol,{domain:n.domain("ExtendedRealNumbers")}),n.assumptions.set(e,!0)),"ok";let i="",t,r;if(e.head==="Less"?(t=e.op1,r=e.op2,i="<"):e.head==="LessEqual"?(t=e.op1,r=e.op2,i="<="):e.head==="Greater"?(t=e.op2,r=e.op1,i="<"):e.head==="GreaterEqual"&&(t=e.op2,r=e.op1,i="<="),!i)return"internal-error";let o=n.add([t.canonical,n.neg(r.canonical)]).simplify(),s=n.box([i==="<"?"Less":"LessEqual",o,0]).evaluate();if(s.symbol==="True")return"tautology";if(s.symbol==="False")return"contradiction";let a=s.unknowns;return a.length===0?"not-a-predicate":(a.length===1&&(n.lookupSymbol(a[0])||n.defineSymbol(a[0],{domain:"ExtendedRealNumbers"})),s.head==="Less"||s.head,n.assumptions.set(s,!0),"ok")}function Hf(e){e.head;let n=e.engine,i=Jf(e.op1);if(i.length===1){let r=n.domain(e.op2.evaluate().json);return r.isValid?(n.declare(i[0],r),"ok"):"not-a-predicate"}if(e.op1.symbol&&_o(n,e.op1.symbol)){let r=n.domain(e.op2.evaluate().json);if(!r.isValid)return"not-a-predicate";n.context?.ids?.has(e.op1.symbol)||n.declare(e.op1.symbol,r);let o=n.lookupSymbol(e.op1.symbol);if(o)return o.domain&&!r.isCompatible(o.domain)?"contradiction":(o.domain=r,"ok");let s=n.lookupFunction(e.op1.symbol);return s?r.isCompatible(Qt(n,s.signature))?"ok":"contradiction":"not-a-predicate"}if(i.length>0)return n.assumptions.set(e,!0),"ok";let t=e.evaluate();return t.symbol==="True"?"tautology":t.symbol==="False"?"contradiction":"not-a-predicate"}function _o(e,n){return(e.lookupSymbol(n)??e.lookupFunction(n))!==void 0}function Jf(e){return e.symbols.filter(n=>!_o(e.engine,n))}function Wf(e,n){return e.lookupFunction(n)?!1:e.lookupSymbol(n)?.value!==void 0}function Yf(e){let n=e.head;return typeof n!="string"?!1:["Less","Greater","LessEqual","GreaterEqual"].includes(n)}var xr=pe(le(),1);var wo=pe(le(),1);function So(e,n){for(e.isInteger()&&n.isInteger();!n.isZero();)[e,n]=[n,e.modulo(n)];return e.abs()}function Za(e,n){return e.mul(n).div(So(e,n))}function To(e,n){if(!n.isInteger()||n.isNegative())return e._BIGNUM_NAN;if(n.lessThan(10))return e.bignum([1,1,2,6,24,120,720,5040,40320,362880,3628800][n.toNumber()]);if(n.gt(Number.MAX_SAFE_INTEGER)){let o=e._BIGNUM_ONE,s=e._BIGNUM_TWO;for(;s.lessThan(n);)o=o.mul(s),s=s.add(1);return o}if(n.modulo(2).eq(1))return n.times(To(e,n.minus(1)));let i=n.toNumber(),t=n,r=n;for(;i>2;)i-=2,t=t.add(i),r=r.mul(t);return r}function Ha(e,n){if(!n.isInteger()||n.isNegative())return e._BIGNUM_NAN;if(n.lessThan(1))return e._BIGNUM_ONE;let i=n;for(;n.greaterThan(2);)n=n.minus(2),i=i.mul(n);return i}var ja=7;function Bo(e,n){if(n.isNegative())return e._BIGNUM_NAN;let i=e.cache("gamma-p-ln",()=>["0.99999999999999709182","57.156235665862923517","-59.597960355475491248","14.136097974741747174","-0.49191381609762019978","0.33994649984811888699e-4","0.46523628927048575665e-4","-0.98374475304879564677e-4","0.15808870322491248884e-3","-0.21026444172410488319e-3","0.2174396181152126432e-3","-0.16431810653676389022e-3","0.84418223983852743293e-4","-0.2619083840158140867e-4","0.36899182659531622704e-5"].map(s=>e.bignum(s))),t=i[0];for(let s=i.length-1;s>0;--s)t=t.add(i[s].div(n.add(s)));let r=e.cache("gamma-g-ln",()=>e.bignum(607).div(128)),o=n.add(r).add(e._BIGNUM_HALF);return e._BIGNUM_NEGATIVE_ONE.acos().mul(e._BIGNUM_TWO).log().mul(e._BIGNUM_HALF).add(o.log().mul(n.add(e._BIGNUM_HALF)).minus(o).add(t.log()).minus(n.log()))}function Do(e,n){if(n.lessThan(e._BIGNUM_HALF)){let o=e._BIGNUM_NEGATIVE_ONE.acos();return o.div(o.mul(n).sin().mul(Do(e,e._BIGNUM_ONE.sub(n))))}if(n.greaterThan(100))return Bo(e,n).exp();n=n.sub(1);let i=e.cache("lanczos-7-c",()=>["0.99999999999980993227684700473478","676.520368121885098567009190444019","-1259.13921672240287047156078755283","771.3234287776530788486528258894","-176.61502916214059906584551354","12.507343278686904814458936853","-0.13857109526572011689554707","9.984369578019570859563e-6","1.50563273514931155834e-7"].map(o=>e.bignum(o))),t=i[0];for(let o=1;o<ja+2;o++)t=t.add(i[o].div(n.add(o)));let r=n.add(ja).add(e._BIGNUM_HALF);return e._BIGNUM_NEGATIVE_ONE.acos().times(e._BIGNUM_TWO).sqrt().mul(t.mul(r.neg().exp()).mul(r.pow(n.add(e._BIGNUM_HALF))))}function fr(e){return e.isFinite()?e.d.length>3||e.d.length===3&&e.d[0]>=90?!1:(e.precision()<=16,e.e<308&&e.e>-306):!0}var ko=pe(le(),1);var Xe=class{constructor(n,i,t){this.options=t;this._terms=[];this._hasInfinity=!1;this._hasZero=!1;this._isCanonical=!0;if(t=t?{...t}:{},"canonical"in t||(t.canonical=!0),this._isCanonical=t.canonical,this.engine=n,this._sign=1,this._rational=P(n)?[BigInt(1),BigInt(1)]:[1,1],this._complex=ko.Complex.ONE,this._bignum=n._BIGNUM_ONE,this._number=1,i)for(let r of i)this.addTerm(r)}get isEmpty(){return this._isCanonical?this._terms.length===0&&this._hasInfinity===!1&&this._hasZero===!1&&this._sign===1&&fe(this._rational)&&this._complex.re===1&&this._complex.im===0&&this._bignum.eq(this.engine._BIGNUM_ONE)&&this._number===1:this._terms.length===0}addTerm(n){if(n.isCanonical,n.head==="Multiply"){for(let o of n.ops)this.addTerm(o);return}if(this._isCanonical){if(n.isNothing)return;if(n.numericValue!==null){if(n.isOne)return;if(n.isZero){this._hasZero=!0;return}if(n.isNegativeOne){this._sign*=-1;return}if(n.isInfinity){this._hasInfinity=!0,n.isNegative&&(this._sign*=-1);return}let o=n.numericValue;if(typeof o=="number"){o<0&&(this._sign*=-1,o=-o),Number.isInteger(o)?this._rational=de(this._rational,[o,1]):P(this.engine)?this._bignum=this._bignum.mul(o):this._number*=o;return}if(o instanceof v){o.isNegative()&&(this._sign*=-1,o=o.neg()),o.isInteger()?this._rational=de(this._rational,[C(o),BigInt(1)]):P(this.engine)?this._bignum=this._bignum.mul(o):this._number*=o.toNumber();return}if(o instanceof ko.Complex){this._complex=this._complex.mul(o);return}if(U(o)){this._rational=de(this._rational,o),po(this._rational)&&(this._sign*=-1,this._rational=ve(this._rational));return}}}let i=n;if(this._isCanonical){let o;[o,i]=Qe(n),this._rational=de(this._rational,o),po(this._rational)&&(this._sign*=-1,this._rational=ve(this._rational))}if(i.numericValue!==null&&i.isOne)return;let t=[1,1];if(i.head==="Power"){let o=Q(i.op2);o&&(t=o,i=i.op1)}else i.head==="Divide"&&(this.addTerm(i.op1),t=[-1,1],i=i.op2);let r=!1;for(let o of this._terms)if(o.term.isSame(i)){o.exponent=Hn(o.exponent,t),r=!0;break}r||this._terms.push({term:i,exponent:t})}unitTerms(n){let i=this.engine;if(n==="numeric"){if(!K(i)&&this._complex.im!==0)return null;if(P(i)){let u=i._BIGNUM_ONE;if(fe(this._rational)||(J(this._rational)?u=i.bignum(this._rational[0].toString()).div(i.bignum(this._rational[1].toString())):u=i.bignum(this._rational[0]).div(this._rational[1])),u=u.mul(this._bignum).mul(this._sign*this._number),this._complex.im!==0){let l=this._complex.mul(u.toNumber());return l.equals(1)?[]:[{exponent:[1,1],terms:[i.number(l)]}]}return u=u.mul(this._complex.re),u.equals(1)?[]:[{exponent:[1,1],terms:[i.number(u)]}]}let a=1;if(fe(this._rational)||(J(this._rational)?a=Number(this._rational[0])/Number(this._rational[1]):a=this._rational[0]/this._rational[1]),a*=this._sign*this._number*this._bignum.toNumber(),this._complex.im!==0){let u=this._complex.mul(a);return u.equals(1)?[]:[{exponent:[1,1],terms:[i.number(u)]}]}return a*=this._complex.re,a===1?[]:[{exponent:[1,1],terms:[i.number(a)]}]}let t=[],r=[];this._hasInfinity&&r.push(i.PositiveInfinity),this._rational=En(this._rational),(this._complex.re!==1||this._complex.im!==0)&&(this._complex.im===0&&(this._number*=Math.abs(this._complex.re)),this._complex.re<0?this._rational=ve(this._rational):r.push(i.number(this._complex)));let o=this._sign*this._number,s=this._bignum;return fe(this._rational)||(n==="rational"?(Ie(this._rational)!==1&&(J(this._rational)?s=s.mul(i.bignum(this._rational[0])):o*=this._rational[0]),Re(this._rational)!==1&&t.push({exponent:[-1,1],terms:[i.number(this._rational[1])]})):o===-1?(r.push(i.number(ve(this._rational))),o=1):r.push(i.number(this._rational))),s.equals(i._BIGNUM_ONE)?o!==1&&r.push(i.number(o)):r.push(i.number(s.mul(o))),r.length>0&&t.push({exponent:[1,1],terms:r}),t}groupedByDegrees(n){n??(n={}),"mode"in n||(n.mode="expression");let i=this.engine;if(n.mode==="numeric"){if(this._complex.im!==0&&!K(i))return null;if(this._hasInfinity)return[{exponent:[1,1],terms:[i.PositiveInfinity]}]}let t=this.unitTerms(n.mode??"expression");if(t===null)return null;for(let r of this._terms){let o=En(r.exponent);if(o[0]===0)continue;let s=!1;for(let a of t)if(o[0]===a.exponent[0]&&o[1]===a.exponent[1]){a.terms.push(r.term),s=!0;break}s||t.push({exponent:o,terms:[r.term]})}return t}asExpression(n="evaluate"){let i=this.engine;if(this._hasInfinity){if(this._hasZero)return i.NaN;if(this._terms.length===0)return Ie(this._rational)>0?i.PositiveInfinity:i.NegativeInfinity}if(this._hasZero)return i.Zero;let t=this.groupedByDegrees({mode:n==="N"?"numeric":"expression"});if(t===null)return i.NaN;let r=Io(i,t);return r.length===0?i.One:r.length===1?r[0]:this.engine._fn("Multiply",r)}asNumeratorDenominator(){let n=this.groupedByDegrees({mode:"rational"});if(n===null)return[this.engine.NaN,this.engine.NaN];let i=[],t=[];for(let l of n)l.exponent[0]>=0?i.push(l):t.push({exponent:ve(l.exponent),terms:l.terms});let r=this.engine,o=Io(r,i),s=r.One;o.length===1?s=o[0]:o.length>0&&(s=r._fn("Multiply",o));let a=Io(r,t),u=r.One;return a.length===1?u=a[0]:a.length>0&&(u=r._fn("Multiply",a)),[s,u]}asRationalExpression(){let[n,i]=this.asNumeratorDenominator();if(i.numericValue!==null){if(i.isOne)return n;if(i.isNegativeOne)return this.engine.neg(n)}return this.engine._fn("Divide",[n,i])}};function Ja(e){if(fe(e))return 0;let[n,i]=[Ie(e),Re(e)];return n>0&&Number.isInteger(n/i)?1:n>0?2:Number.isInteger(n/i)?3:4}function Qf(e,n){let i=Ja(e.exponent),t=Ja(n.exponent);if(i!==t)return i-t;let[r,o]=[Ie(e.exponent),Re(e.exponent)],[s,a]=[Ie(n.exponent),Re(n.exponent)];return r/o-s/a}function Io(e,n){let i=n.sort(Qf).map(t=>{let r=ie(t.terms,"Multiply"),o=r.length<=1?r[0]:e._fn("Multiply",r.sort(wn));return e.pow(o,t.exponent)});return ie(i,"Multiply")??i}function Wa(e,n,i,t){if(n.numericValue!==null){if(U(n.numericValue))return Ie(n.numericValue)<0?F(e,"Subtract",[i,e.number(ve(n.numericValue))],t):null;let r=A(n);if(r!==null&&r<0)return F(e,"Subtract",[i,e.number(-r)],t)}return n.head==="Negate"?F(e,"Subtract",[i,n.op1],t):null}function Qa(e,n,i,t){let r=e.jsonSerializationOptions.exclude;if(n==="Add"&&i.length===2&&!r.includes("Subtract")){let o=Wa(e,i[0],i[1],t)??Wa(e,i[1],i[0],t);if(o)return o}if(n==="Divide"&&i.length===2&&r.includes("Divide"))return F(e,"Multiply",[i[0],e._fn("Power",[i[1],e.NegativeOne])],t);if(n==="Multiply"&&!r.includes("Negate")&&y(i[0])===-1)return i.length===2?F(e,"Negate",[i[1]]):F(e,"Negate",[e._fn("Multiply",i.slice(1))],t);if(n==="Multiply"&&!r.includes("Divide")){let o=new Xe(e,i,{canonical:!1}).asRationalExpression();if(o.head==="Divide")return F(e,o.head,o.ops,t)}if(n==="Power"){if(!r.includes("Exp")&&i[0]?.symbol==="ExponentialE")return F(e,"Exp",[i[1]],t);if(i[1]?.numericValue!==null){let o=A(i[1]);if(o===2&&!r.includes("Square"))return F(e,"Square",[i[0]],t);if(o!==null&&o<0&&!r.includes("Divide"))return F(e,"Divide",[e.One,o===-1?i[0]:e.pow(i[0],-o)],t);let s=i[1].numericValue;if(!r.includes("Sqrt")&&s===.5)return F(e,"Sqrt",[i[0]],t);if(!r.includes("Sqrt")&&s===-.5)return F(e,"Divide",[e.One,e._fn("Sqrt",[i[0]])],t);if(U(s)){let a=Ie(s),u=Re(s);if(a===1){if(!r.includes("Sqrt")&&u===2)return F(e,"Sqrt",[i[0]],t);if(!r.includes("Root"))return F(e,"Root",[i[0],e.number(s[1])],t)}if(a===-1){if(!r.includes("Sqrt")&&u===2)return F(e,"Divide",[e.One,e._fn("Sqrt",[i[0]])],t);if(!r.includes("Root"))return F(e,"Divide",[e.One,e._fn("Root",[i[0],e.number(s[1])])],t)}}}}return F(e,n,i,t)}function F(e,n,i,t){let r=e.jsonSerializationOptions.exclude;if((n==="Rational"||n==="Divide")&&i.length===2&&A(i[0])===1&&A(i[1])===2&&!r.includes("Half"))return ut(e,"Half",{...t,wikidata:"Q39373172"});if(i.length===1){let u=i[0]?.numericValue;if(n==="Negate"&&u!==null){if(typeof u=="number")return Qn(e,-u);if(u instanceof v||u instanceof wo.Complex)return Qn(e,u.neg());if(U(u))return Qn(e,ve(u))}}if(typeof n=="string"&&r.includes(n)){if(n==="Rational"&&i.length===2)return F(e,"Divide",i,t);if(n==="Complex"&&i.length===2)return F(e,"Add",[i[0],e._fn("Multiply",[i[1]??e.symbol("Undefined"),e.I])],t);if(n==="Sqrt"&&i.length===1)return F(e,"Power",[i[0],r.includes("Half")?e.number([1,2]):e.Half],t);if(n==="Root"&&i.length===2&&i[1]?.numericValue!==null){let u=A(i[1]);if(u===2)return F(e,"Sqrt",[i[0]]);if(u!==null)return u<0?F(e,"Divide",[e.One,e._fn("Power",[i[0]??e.symbol("Undefined"),e.number([1,-u])])],t):F(e,"Power",[i[0],e.number([1,-u])],t)}if(n==="Square"&&i.length===1)return F(e,"Power",[i[0],e.number(2)],t);if(n==="Exp"&&i.length===1)return F(e,"Power",[e.E,i[0]],t);if(n==="Subtract"&&i.length===2)return F(e,"Add",[i[0],e._fn("Negate",[i[1]??e.symbol("Undefined")])],t);if(n==="Subtract"&&i.length===1)return F(e,"Negate",i,t)}if(n==="Add"&&i.length===2&&!r.includes("Subtract")){if(i[1]?.numericValue!==null){let u=A(i[1]);if(u!==null&&u<0)return F(e,"Subtract",[i[0],e.number(-u)],t)}if(i[1]?.head==="Negate")return F(e,"Subtract",[i[0],i[1].op1],t)}if(n==="Tuple"){if(i.length===1&&!r.includes("Single"))return F(e,"Single",i,t);if(i.length===2&&!r.includes("Pair"))return F(e,"Pair",i,t);if(i.length===3&&!r.includes("Triple"))return F(e,"Triple",i,t)}let s=[typeof n=="string"?n:n.json,...i.map(u=>u?.json??"Undefined")],a={...t??{}};return e.jsonSerializationOptions.metadata.includes("latex")?a.latex=a.latex??e.serialize({fn:s}):a.latex="",e.jsonSerializationOptions.metadata.includes("wikidata")||(a.wikidata=""),!a.latex&&!a.wikidata&&e.jsonSerializationOptions.shorthands.includes("function")?s:a.latex&&a.wikidata?{fn:s,latex:a.latex,wikidata:a.wikidata}:a.latex?{fn:s,latex:a.latex}:a.wikidata?{fn:s,wikidata:a.wikidata}:{fn:s}}function Xa(e,n){return n=n,e.jsonSerializationOptions.shorthands.includes("string")?`'${n}'`:{str:n}}function ut(e,n,i){if(n==="Half"&&e.jsonSerializationOptions.exclude.includes("Half"))return Qn(e,[1,2],i);if(i={...i},e.jsonSerializationOptions.metadata.includes("latex")?(i.latex=i.latex??e.serialize({sym:n}),i.latex!==void 0&&(i.latex=i.latex)):i.latex=void 0,e.jsonSerializationOptions.metadata.includes("wikidata")){if(i.wikidata===void 0){let t=e.lookupSymbol(n)?.wikidata;t!==void 0&&(i.wikidata=t)}}else i.wikidata=void 0;return n=n,i.latex===void 0&&i.wikidata===void 0&&e.jsonSerializationOptions.shorthands.includes("symbol")?n:i.latex!==void 0&&i.wikidata!==void 0?{sym:n,latex:i.latex,wikidata:i.wikidata}:i.latex!==void 0?{sym:n,latex:i.latex}:i.wikidata!==void 0?{sym:n,wikidata:i.wikidata}:{sym:n}}function Qn(e,n,i){i={...i},e.jsonSerializationOptions.metadata.includes("latex")||(i.latex=void 0);let t=i.latex===void 0&&i.wikidata===void 0&&!e.jsonSerializationOptions.metadata.includes("latex")&&e.jsonSerializationOptions.shorthands.includes("number"),r=e.jsonSerializationOptions.exclude,o="";if(n instanceof v){if(n.isNaN())o="NaN";else if(!n.isFinite())o=n.isPositive()?"+Infinity":"-Infinity";else{if(t&&fr(n))return n.toNumber();if(n.isInteger()&&n.e<n.precision()+4)o=n.toFixed(0);else{let s=e.jsonSerializationOptions.precision,a=s==="max"?n.toString():n.toPrecision(s==="auto"?e.precision:s);if(o=Ya(e,a),t){let u=n.toNumber();if(u.toString()===o)return u}}}return e.jsonSerializationOptions.metadata.includes("latex")&&(i.latex=i.latex??e.serialize({num:o})),i.latex!==void 0?{num:o,latex:i.latex}:t?o:{num:o}}if(n instanceof wo.Complex)return n.isInfinite()?ut(e,"ComplexInfinity",i):n.isNaN()?(o="NaN",e.jsonSerializationOptions.metadata.includes("latex")&&(i.latex=i.latex??e.serialize({num:o})),i.latex!==void 0?{num:o,latex:i.latex}:{num:o}):F(e,"Complex",[e.number(n.re),e.number(n.im)],{...i,wikidata:"Q11567"});if(U(n)){let s=!r.includes("Rational");return t&&e.jsonSerializationOptions.shorthands.includes("function")&&q(n)?n[0]===1&&n[1]===2&&!r.includes("Half")?ut(e,"Half",i):[s?"Rational":"Divide",n[0],n[1]]:F(e,s?"Rational":"Divide",[e.number(n[0]),e.number(n[1])],{...i})}if(Number.isNaN(n))o="NaN";else if(!Number.isFinite(n))o=n>0?"+Infinity":"-Infinity";else{if(t)return n;o=Ya(e,n.toString())}return e.jsonSerializationOptions.metadata.includes("latex")&&(i.latex=i.latex??e.serialize({num:o})),i.latex!==void 0?{num:o,latex:i.latex}:{num:o}}function Ya(e,n){if(!e.jsonSerializationOptions.repeatingDecimals)return n;let[i,t,r,o]=n.match(/^(.*)\.([0-9]+)([e|E][-+]?[0-9]+)?$/)??[];if(!r)return n.toLowerCase();let s=r[r.length-1];r=r.slice(0,-1);let a=16,u="";for(let l=0;l<r.length-a;l++){u=r.substring(0,l);for(let f=0;f<=a;f++){let d=r.substring(l,l+f+1),c=Math.floor((r.length-u.length)/d.length);if(c<3)break;if((u+d.repeat(c+1)).startsWith(r))return d==="0"?s==="0"?t+"."+u+(o??""):n:t+"."+u+"("+d+")"+(o??"")}}for(r+=s;r.endsWith("0");)r=r.slice(0,-1);return o?`${t}.${r}${o.toLowerCase()}`:`${t}.${r}`}var Di=class e extends L{constructor(i,t,r){r??(r={});super(i,r.metadata);this._value=new Map;let o=r.canonical??!0;if(t instanceof Map)for(let[s,a]of t)this._value.set(s,i.box(a,{canonical:o}));else for(let s of Object.keys(t))this._value.set(s,i.box(t[s],{canonical:o}));i._register(this)}bind(){for(let[i,t]of this._value)t.bind()}reset(){for(let[i,t]of this._value)t.reset()}get hash(){let i=he("Dictionary");for(let[t,r]of this._value)i^=he(t)^r.hash;return i}get complexity(){return 97}get head(){return"Dictionary"}get isPure(){return!1}getKey(i){return this._value.get(i)}hasKey(i){return this._value.has(i)}get keys(){return this._value.keys()}get keysCount(){return this._value.size}has(i){for(let[t,r]of this._value)if(r.has(i))return!0;return!1}get domain(){return this.engine.domain("Dictionaries")}get json(){if(this.engine.jsonSerializationOptions.shorthands.includes("dictionary")){let t={};for(let r of this._value.keys())t[r]=this._value.get(r).json;return{dict:t}}let i=[];for(let t of this._value.keys())i.push(this.engine._fn("KeyValuePair",[this.engine.string(t),this._value.get(t)]));return F(this.engine,"Dictionary",i,{latex:this._latex})}isSame(i){if(this===i)return!0;if(!(i instanceof e)||this._value.size!==i._value.size)return!1;for(let[t,r]of this._value){let o=i.getKey(t);if(!o||!r.isSame(o))return!1}return!0}match(i,t){if(!(i instanceof e)||this._value.size!==i._value.size)return null;let r={};for(let[o,s]of this._value){let a=i.getKey(o);if(!a)return null;let u=s.match(a);if(u===null)return null;r={...r,...u}}return r}isEqual(i){if(this===i)return!0;if(!(i instanceof e)||!i.keys||this._value.size!==i._value.size)return!1;for(let[t,r]of this._value){let o=i.getKey(t);if(!o||!r.isEqual(o))return!1}return!0}evaluate(i){return this}get isCanonical(){return this._isCanonical}set isCanonical(i){this._isCanonical=i}get canonical(){return this.isCanonical?this:new e(this.engine,this._value,{canonical:!0})}simplify(i){return this}N(i){return this}replace(i,t){let r=0,o={};for(let s of this.keys){let a=this.getKey(s),u=a.replace(i,t);u!==null&&(r+=1),o[s]=u??a}return r===0?null:new e(this.engine,o)}subs(i,t){let r={};for(let o of this.keys)r[o]=this.getKey(o).subs(i,t);return new e(this.engine,r,t)}};var nu=pe(le(),1);var Ka=[];function Co(e){if(e.head==="N"&&typeof e.op1.head=="string"){let o={Integrate:"NIntegrate",Limit:"NLimit"}[e.op1.head];o&&(e=e.engine._fn(o,e.op1.ops))}if(e.head==="Function")return e;let n=e.unknowns;n.includes("_")&&(e=e.subs({_:"_1"}),n=e.unknowns);let i=0;for(let o of n)if(o.startsWith("_")){let s=Number(o.slice(1));s>i&&(i=s)}let t=e.engine;return t._fn("Function",[e,...Array.from({length:i},(o,s)=>t.symbol(`_${s+1}`))])}function Mo(e){let n=e.engine,i=e.symbol?n.lookupFunction(e.symbol):void 0;if(i){let a=i.signature.N??i.signature.evaluate;return a?u=>a(n,u)??n._fn(e,u):u=>n._fn(e,u)}let t=Co(e);if(!t)return;t.head;let r=t.ops.slice(1).map(a=>a.symbol??"Nothing");n.pushScope();for(let a of r)n.declare(a,{inferred:!0,domain:void 0});let o=t.op1.canonical;o.bind(),n.popScope();let s=o.scope;return r.length===0?()=>{let a=n.swapScope(s);n.resetContext();let u=o.N()??o.evaluate();return n.swapScope(a),u}:a=>{if(n.strict&&(a=Ne(n,a,r.length),!a.every(d=>d.isValid)))return;a=a.map(d=>d.evaluate());let u=n.swapScope(s);n.resetContext();let l=0;for(let d of r)n.assign(d,a[l++]);let f=o.N()??o.evaluate();if(n.swapScope(u),!!f.isValid)return f}}function Xn(e,n){return Mo(e)?.(n)??e.engine._fn(e,n)}function Kn(e){return Mo(e)??(n=>e.engine._fn(e.N(),n).N())}function Ao(e){let n=e.engine,i=Mo(e);return i?t=>i([n.number(t)])?.value??NaN:t=>n._fn(e.evaluate(),[n.number(t)]).value}function Oo(e){let n=e.match(/(.+)\((.*)\)/);if(!n)return[e,void 0];let i=n[1],t=n[2].split(",").map(r=>r.trim());return[i,t]}var ye=class e extends L{constructor(i,t,r,o){o??(o={}),o.canonical??(o.canonical=!1);super(i,o.metadata);this._result=void 0;this._head=t,this._ops=r,o.canonical&&(this._canonical=this,this.bind()),i._register(this)}get hash(){if(this._hash!==void 0)return this._hash;let i=0;for(let t of this._ops)i=i<<1^t.hash|0;return typeof this._head=="string"?i=i^he(this._head)|0:i=i^this._head.hash|0,this._hash=i,i}infer(i){let t=this._def;return!t||!t.signature.inferredSignature?!1:(typeof t.signature.result!="function"&&(t.signature.result=st(t.signature.result,i)),!0)}bind(){this._def=void 0,this._scope=this.engine.context;let i=this._head;if(typeof i!="string"){i.bind();return}this._def=this.engine.lookupFunction(i);for(let t of this._ops)t.bind()}reset(){}get isCanonical(){return this._canonical===this}set isCanonical(i){this._canonical=i?this:void 0}get isPure(){if(this._isPure!==void 0)return this._isPure;if(!this.isCanonical)return this._isPure=!1,!1;let i=this.functionDefinition?.pure??!1;return i&&(i=this._ops.every(t=>t.isPure)),this._isPure=i,i}get json(){return this.isValid&&this._canonical===this?Qa(this.engine,this._head,this._ops,{latex:this._latex,wikidata:this.wikidata}):F(this.engine,this._head,this._ops,{latex:this._latex,wikidata:this.wikidata})}get rawJson(){return[typeof this._head=="string"?this._head:this._head.rawJson,...this.ops.map(t=>t.rawJson)]}get scope(){return this._scope}get head(){return this._head}get ops(){return this._ops}get nops(){return this._ops.length}get op1(){return this._ops[0]??this.engine.Nothing}get op2(){return this._ops[1]??this.engine.Nothing}get op3(){return this._ops[2]??this.engine.Nothing}get isValid(){return this._head==="Error"||typeof this._head!="string"&&!this._head.isValid?!1:this._ops.every(i=>i?.isValid)}get canonical(){return this._canonical??(this._canonical=this.isValid?dr(this.engine,this._head,this._ops):this),this._canonical}*map(i){let t=0;for(;t<this._ops.length;)yield i(this._ops[t++])}subs(i,t){t=t?{...t}:{},"canonical"in t||(t.canonical=!0);let r=this._ops.map(o=>o.subs(i,t));return t.canonical&&r.every(o=>o.isValid)?dr(this.engine,this._head,r):new e(this.engine,this._head,r,{canonical:!1})}replace(i,t){return er(this,i,t)}has(i){if(typeof this._head=="string"){if(typeof i=="string"){if(this._head===i)return!0}else if(i.includes(this._head))return!0}for(let t of this._ops)if(t.has(i))return!0;return!1}isSame(i){if(this===i)return!0;if(!(i instanceof e)||this.nops!==i.nops)return!1;if(typeof this.head=="string"){if(this.head!==i.head)return!1}else if(typeof i.head=="string"||!i.head||!this.engine.box(this.head).isSame(this.engine.box(i.head)))return!1;let t=this._ops,r=i._ops;for(let o=0;o<t.length;o++)if(!t[o].isSame(r[o]))return!1;return!0}match(i,t){if(!(i instanceof e))return null;let r={};if(typeof this.head=="string"){if(this.head!==i.head)return null}else{if(typeof i.head=="string")return null;{if(!i.head)return null;let a=this.head.match(i.head,t);if(a===null)return null;r={...r,...a}}}let o=this._ops,s=i._ops;for(let a=0;a<o.length;a++){let u=o[a].match(s[a],t);if(u===null)return null;r={...r,...u}}return r}get complexity(){if(this.isCanonical)return this.functionDefinition?.complexity??sn}get baseDefinition(){return this.functionDefinition}get functionDefinition(){return this._def}isEqual(i){if(this===i)return!0;let t=Jn(this,i);return t===0?!0:t!==void 0?!1:this.engine.add([this,this.engine.neg(i)]).simplify().isZero?!0:this.isSame(i)}get isNumber(){return this.domain?.isCompatible("Numbers")}get isInteger(){return this.domain?.isCompatible("Integers")}get isRational(){return this.domain?.isCompatible("RationalNumbers")}get isAlgebraic(){return this.domain?.isCompatible("AlgebraicNumbers")}get isReal(){return this.domain?.isCompatible("RealNumbers")}get isExtendedReal(){return this.domain?.isCompatible("ExtendedRealNumbers")}get isComplex(){return this.domain?.isCompatible("ComplexNumbers")}get isImaginary(){return this.domain?.isCompatible("ImaginaryNumbers")}get domain(){if(this._result!==void 0)return this._result;if(!this.canonical)return;let i=this.engine,t;if(typeof this._head!="string")t=this._head.domain;else if(this._def){let r=this._def.signature;typeof r.result=="function"?t=r.result(i,this._ops):t=r.result}return t??(t=void 0),this._result=t,t}simplify(i){if(!this.isValid)return this;if(!this.isCanonical){let f=this.canonical;return!f.isCanonical||!f.isValid?this:f.simplify(i)}let t=i?.recursive??!0,r;if(t&&(r=_n(this),r!==null))return r=r.simplify({...i,recursive:!1}),lt(this,r);let o=this.functionDefinition,s=t?eu(this._ops,o?.hold??"none",o?.associative?o.name:"",f=>f.simplify(i)):this._ops;if(typeof this._head!="string"){let f=Xn(this._head,s);return typeof f.head!="string"?f:f.simplify(i)}if(o)if(o.inert)r=s[0]?.canonical??this;else{let f=o.signature;f?.simplify&&(r=f.simplify(this.engine,s))}r?r=lt(this.engine.fn(this._head,s),r):r=this.engine.fn(this._head,s),r=lt(this,r);let a=i?.rules??this.engine.cache("standard-simplification-rules",()=>Wn(this.engine,Ka),f=>{for(let[d,c,p,h]of f)d.reset(),c.reset();return f}),u=0,l=!1;do{let f=r.replace(a);f!==null?(r=lt(r,f),r===f&&(l=!0)):l=!0,u+=1}while(!l&&u<this.engine.iterationLimit);return lt(this,r)}evaluate(i){if(!this.isValid)return this;if(i?.numericMode){let a=this.head;if(a==="Integrate"||a==="Limit")return this.engine.box(["N",this],{canonical:!0}).evaluate(i)}if(!this.isCanonical){this.engine.pushScope();let a=this.canonical;return this.engine.popScope(),!a.isCanonical||!a.isValid?this:a.evaluate(i)}let t=this.functionDefinition;if(t?.threadable&&this.ops.some(a=>te(a))){let a=Math.max(...this._ops.map(l=>l.functionDefinition?.size?.(l)??0)),u=[];for(let l=0;l<=a-1;l++){let f=this._ops.map(d=>te(d)?wa(d,l%a+1)??this.engine.Nothing:d);u.push(this.engine._fn(this.head,f).evaluate(i))}return u.length===0?this.engine.box(["Sequence"]):u.length===1?u[0]:this.engine._fn("List",u)}let r=eu(this._ops,t?.hold??"none",t?.associative?t.name:"",a=>a.evaluate(i));if(t?.inert)return r[0]??this;let o;typeof this._head!="string"&&(o=Xn(this._head,r));let s=t?.signature;if(!o&&s){let a=i?.numericMode??!1,u=this.engine.swapScope(this.scope);a&&s.N&&(o=s.N(this.engine,r)),!o&&s.evaluate&&(o=s.evaluate(this.engine,r)),this.engine.swapScope(u)}if(o){let a=o.numericValue;a!==null&&(!K(this.engine)&&a instanceof nu.Complex?o=this.engine.NaN:!P(this.engine)&&a instanceof v&&(o=this.engine.number(a.toNumber())))}return o??this.engine.fn(this._head,r)}N(i){return this.evaluate({...i,numericMode:!0})}solve(i){return i.length!==1?null:lr(this.simplify(),i[0])}};function Xf(e,n,i,t){let r=[];if(n==="Add"||n==="Multiply")r=Me(e,e.canonical(i),{flatten:n});else if(n==="Negate"||n==="Square"||n==="Sqrt"||n==="Exp"||n==="Ln")r=Me(e,e.canonical(i),1);else if(n==="Divide"||n==="Power")r=Me(e,e.canonical(i),2);else return null;if(!r.every(o=>o.isValid))return e._fn(n,r,t);if(n==="Add")return e.add(r,t);if(n==="Negate")return e.neg(r[0],t);if(n==="Multiply")return e.mul(r,t);if(n==="Divide")return e.div(r[0],r[1],t);if(n==="Exp")return e.pow(e.E,r[0],t);if(n==="Power")return e.pow(r[0],r[1],t);if(n==="Square")return e.pow(r[0],2,t);if(n==="Sqrt"){let o=r[0].canonical;return U(o.numericValue)?e._fn("Sqrt",[o],t):e.pow(o,e.Half,t)}return n==="Ln"?e._fn("Ln",r,t):null}function dr(e,n,i,t){if(typeof n!="string"&&(e.pushScope(),n=n.evaluate().symbol??n,e.popScope()),typeof n=="string"){let u=Xf(e,n,i,t);if(u)return u}else if(!n.isValid)return new ye(e,n,i.map(u=>e.box(u,{canonical:!1})),{metadata:t,canonical:!1});let r=e.lookupFunction(n);if(!r)return new ye(e,n,ce(i.map(u=>e.box(u))),{metadata:t,canonical:!0});let o=[];for(let u=0;u<i.length;u++)if(!vn(r.hold,i.length-1,u))o.push(e.box(i[u]));else{let l=e.box(i[u],{canonical:!1});l.head==="ReleaseHold"?o.push(l.op1.canonical):o.push(l)}let s=r.signature;if(s.canonical){try{let u=s.canonical(e,o);if(u)return u}catch(u){console.error(u)}return new ye(e,n,o,{metadata:t,canonical:!1})}o=ce(o),r.associative&&(o=ie(o,n));let a=Oa(e,o,r.hold,r.threadable,s.params,s.optParams,s.restParam);if(a)return e._fn(n,a,t);if(o.length===1&&o[0].head===n){if(r.involution)return o[0].op1;r.idempotent&&(o=o[0].ops)}return o.length>1&&r.commutative===!0&&(o=o.sort(wn)),e._fn(n,o,t)}function eu(e,n,i,t){if(e.length===0)return[];if(e=ie(e,i),n==="all")return e;if(n==="none"){let o=[];for(let s of e){let a=s.head;if(a==="Hold")o.push(s);else{let u=a==="ReleaseHold"?s.op1:s;if(u){let l=t(u);l!==null&&o.push(l)}}}return ie(o,i)}let r=[];for(let o=0;o<e.length;o++)if(e[o].head==="Hold")r.push(e[o]);else{let s;if(e[o].head==="ReleaseHold"?s=e[o].op1:vn(n,e.length-1,o)?r.push(e[o]):s=e[o],s){let a=t(s);a!==null&&r.push(a)}}return ie(r,i)}function lt(e,n){if(n==null||e===n)return e;let i=e.engine,t=i.box(n);return i.costFunction(t)<=1.2*i.costFunction(e)?t:e}var Oe=pe(le(),1);var Kf=0x3ffffffffffe5;function Pn(e){if(!Number.isInteger(e)||!Number.isFinite(e)||Number.isNaN(e)||e<=1)return!1;if(e<=ba)return fo.has(e);for(let n of fo)if(e%n===0)return!1;return e>=Kf?nd(e,30)?void 0:!1:e===ed(e)}function ed(e){if(e===1)return 1;if(e%2===0)return 2;if(e%3===0)return 3;if(e%5===0)return 5;let n=Math.floor(Math.sqrt(e)),i=7;for(;i<=n;){if(e%i===0)return i;if(e%(i+4)===0)return i+4;if(e%(i+6)===0)return i+6;if(e%(i+10)===0)return i+10;if(e%(i+12)===0)return i+12;if(e%(i+16)===0)return i+16;if(e%(i+22)===0)return i+22;if(e%(i+24)===0)return i+24;i+=30}return e}function nd(e,n){let i=0,t=e-1;for(;t%2===0;)t/=2,++i;e:do{let r=Math.pow(2+Math.floor(Math.random()*(e-3)),t)%e;if(!(r===1||r===e-1)){for(let o=i-1;o--;){if(r=r*r%e,r===1)return!1;if(r===e-1)continue e}return!1}}while(--n);return!0}var oe=class e extends L{constructor(i,t,r){super(i,r?.metadata);if(typeof t=="number"){this._value=t,this._isCanonical=!0;return}if(U(t)){let[o,s]=t;typeof o!="number"||Number.isInteger(o)&&Number.isInteger(s),!(typeof o=="bigint"&&typeof s=="bigint")||s!==o&&BigInt(1),r?.canonical??!0?(this._value=Po(i,t),this._isCanonical=!0):(this._value=t,this._isCanonical=!1)}else!(t instanceof Oe.Complex)||!Number.isNaN(t.re)&&!Number.isNaN(t.im)&&i.chop(t.im),this._value=Po(i,t),this._isCanonical=!0}get hash(){if(this._hash!==void 0)return this._hash;let i=0;return typeof this._value=="number"?i=he(this._value.toString()):this._value instanceof Oe.Complex?i=he(this._value.re.toString()+" +i "+this._value.im.toString()):this._value instanceof v?i=he(this._value.toString()):i=he(this._value[0].toString()+" / "+this._value[1].toString()),this._hash=i,i}get head(){return"Number"}get isPure(){return!0}get isExact(){return typeof this._value=="number"?Number.isInteger(this._value):this._value instanceof v?this._value.isInteger():this._value instanceof Oe.Complex?Number.isInteger(this._value.re)&&Number.isInteger(this._value.im):U(this._value)}get isCanonical(){return this._isCanonical}set isCanonical(i){this._isCanonical=i}get complexity(){return 1}get numericValue(){return this._value}get domain(){return this._domain??(this._domain=this.engine.domain(Da(this._value))),this._domain}get json(){return Qn(this.engine,this._value,{latex:this._latex})}get sgn(){if(this._value===0)return 0;if(typeof this._value=="number")return this._value<0?-1:this._value>0?1:null;if(this._value instanceof v)return this._value.isZero()?0:this._value.isNegative()?-1:this._value.isPositive()?1:null;if(Array.isArray(this._value)){let[i,t]=this._value;return i===0&&t!==0?0:i<0?-1:i>0?1:null}return null}isSame(i){if(this===i)return!0;if(!(i instanceof e))return!1;if(typeof this._value=="number")return typeof i._value!="number"?!1:this._value===i._value;if(this._value instanceof v)return i._value instanceof v?this._value.eq(i._value):!1;if(Array.isArray(this._value)){if(!Array.isArray(i._value))return!1;let[t,r]=i._value;return this._value[0]===t&&this._value[1]===r}return this._value instanceof Oe.Complex&&i._value instanceof Oe.Complex?this._value.equals(i._value):!1}isEqual(i){return this===i||Jn(this,i)===0}match(i,t){return this.isEqualWithTolerance(i,t?.numericTolerance??0)?{}:null}isEqualWithTolerance(i,t){return i instanceof e&&Jn(this,i,t)===0}isLess(i){let t=Jn(this,i);if(t!==void 0)return t<0}isLessEqual(i){let t=Jn(this,i);if(t!==void 0)return t<=0}isGreater(i){return i.isLessEqual(this)}isGreaterEqual(i){return i.isLess(this)}get isPositive(){if(typeof this._value=="number")return this._value>0;let i=this.sgn;if(i!=null)return i>0}get isNonNegative(){if(typeof this._value=="number")return this._value>=0;let i=this.sgn;if(i!=null)return i>=0}get isNegative(){if(typeof this._value=="number")return this._value<0;let i=this.sgn;if(i!=null)return i<0}get isNonPositive(){if(typeof this._value=="number")return this._value<=0;let i=this.sgn;if(i!=null)return i<=0}get isZero(){return this._value===0?!0:this._value instanceof v?this._value.isZero():this._value instanceof Oe.Complex?this._value.isZero():!1}get isNotZero(){return this._value===0?!1:this._value instanceof v?!this._value.isZero():this._value instanceof Oe.Complex?!this._value.isZero():!0}get isOne(){return this._value===1?!0:typeof this._value=="number"?!1:this._value instanceof v?this._value.equals(this.engine._BIGNUM_ONE):this._value instanceof Oe.Complex?this._value.im===0&&this._value.re===1:fe(this._value)}get isNegativeOne(){return this._value===-1?!0:typeof this._value=="number"?!1:this._value instanceof v?this._value.equals(this.engine._BIGNUM_NEGATIVE_ONE):this._value instanceof Oe.Complex?this._value.im===0&&this._value.re===-1:Yt(this._value)}get isOdd(){if(this.isOne||this.isNegativeOne)return!0;if(this.isZero||!this.isInteger)return!1;if(typeof this._value=="number")return this._value%2!==0;if(this._value instanceof v)return!this._value.mod(2).isZero()}get isEven(){if(this.isOne||this.isNegativeOne)return!1;if(this.isZero)return!0;if(!this.isInteger)return!1;if(typeof this._value=="number")return this._value%2===0;if(this._value instanceof v)return this._value.mod(2).isZero()}get isPrime(){if(!this.isInteger||!this.isFinite||this.isNonPositive||this.isOne||this.isZero)return!1;if(typeof this._value=="number")return Pn(this._value);if(this._value instanceof v)return Pn(this._value.toNumber())}get isComposite(){if(!this.isInteger||!this.isFinite||this.isNonPositive||this.isOne||this.isZero)return!1;if(typeof this._value=="number")return!Pn(this._value);if(this._value instanceof v)return!Pn(this._value.toNumber())}get isInfinity(){return typeof this._value=="number"?!Number.isFinite(this._value)&&!Number.isNaN(this._value):this._value instanceof v?!this._value.isFinite()&&!this._value.isNaN():this._value instanceof Oe.Complex?!this._value.isFinite()&&!this._value.isNaN():!1}get isNaN(){return typeof this._value=="number"?Number.isNaN(this._value):this._value instanceof v?this._value.isNaN():this._value instanceof Oe.Complex?this._value.isNaN():!1}get isFinite(){return!this.isInfinity&&!this.isNaN}get isNumber(){return!0}get isInteger(){return typeof this._value=="number"?Number.isInteger(this._value):this._value instanceof v?this._value.isInteger():!1}get isRational(){return Array.isArray(this._value)?!0:this.isInteger}get isAlgebraic(){if(this.isRational)return!0}get isReal(){return this.isFinite?this._value instanceof Oe.Complex?this.engine.chop(this._value.im)===0:!0:!1}get isExtendedReal(){return this.isInfinity||this.isReal}get isComplex(){return!this.isNaN}get isImaginary(){return this._value instanceof Oe.Complex?(this._value.im,!0):!1}get isExtendedComplex(){return this.isInfinity||!this.isNaN}get canonical(){return this._isCanonical?this:this.engine.number(Po(this.engine,this._value))}simplify(i){return this.canonical}evaluate(i){return i?.numericMode?this.N(i):this}N(i){if(!Array.isArray(this._value))return this;let t=this.engine,[r,o]=this._value;return typeof r=="number"&&typeof o=="number"&&!P(t)?t.number(r/o):t.number(t.bignum(r).div(t.bignum(o)))}};function Po(e,n){if(n instanceof v&&fr(n))return n.toNumber();if(!U(n))return n;if(n=En(n),J(n)){let[r,o]=n;if(r>Number.MIN_SAFE_INTEGER&&r<Number.MAX_SAFE_INTEGER&&o>Number.MIN_SAFE_INTEGER&&o<Number.MAX_SAFE_INTEGER)n=[Number(r),Number(o)];else return o<0&&([r,o]=[-r,-o]),o===BigInt(1)?e.bignum(r):o===BigInt(0)?r===o?NaN:r<0?-1/0:1/0:[r,o]}let[i,t]=n;return Number.isNaN(i)||Number.isNaN(t)?NaN:(t<0&&([i,t]=[-i,-t]),t===1?i:t===0?i===0||!Number.isFinite(i)?NaN:i<0?-1/0:1/0:i===0?i:[i,t])}var ln=class e extends L{constructor(i,t,r){super(i,r);this._string=t.normalize(),i._register(this)}get hash(){return he("String"+this._string)}get json(){return Xa(this.engine,this._string)}get head(){return"String"}get isPure(){return!0}get isCanonical(){return!0}set isCanonical(i){}get domain(){return this.engine.Strings}get complexity(){return 19}get string(){return this._string}isEqual(i){return i.string===this._string}isSame(i){return i.string===this._string}match(i,t){return i instanceof e&&this._string===i._string?{}:null}};var qo=pe(le(),1);function cr(e,n){switch(n){case"float64":case"float32":case"int32":case"uint8":return new Fo(e);case"complex128":case"complex64":return new Ro(e);case"bool":case"string":case"expression":return new Lo(e)}throw new Error(`Unknown dtype ${n}`)}var Fo=class{constructor(n){this.ce=n;this.one=1;this.zero=0;this.nan=NaN}cast(n,i){let t=this.ce;switch(i){case"float64":case"float32":case"int32":case"uint8":return n;case"complex128":case"complex64":return Array.isArray(n)?n.map(r=>t.complex(r)):this.ce.complex(n);case"bool":return Array.isArray(n)?n.map(r=>r!==0):n!==0;case"string":return Array.isArray(n)?n.map(r=>Number(r).toString()):Number(n).toString();case"expression":return Array.isArray(n)?n.map(r=>t.number(r)):t.number(n)}throw new Error(`Cannot cast ${n} to ${i}`)}expression(n){return this.ce.number(n)}isZero(n){return n===0}isOne(n){return n===1}equals(n,i){return n===i}add(n,i){return n+i}addn(...n){return n.reduce((i,t)=>i+t,0)}neg(n){return-n}sub(n,i){return n-i}mul(n,i){return n*i}muln(...n){return n.reduce((i,t)=>i*t,1)}div(n,i){return n/i}pow(n,i){return n**i}conjugate(n){return n}},Lo=class{constructor(n){this.one=n.number(1),this.zero=n.number(0),this.nan=n.number(NaN),this.ce=n}cast(n,i){if(Array.isArray(n))return n.map(r=>this.cast(r,i));let t=n.value;switch(i){case"float64":case"float32":return typeof t=="number"?t:void 0;case"int32":return typeof t=="number"?Math.round(t):void 0;case"uint8":if(typeof t!="number")return;let r=Math.round(t);return r>=0&&r<=255?r:void 0;case"complex128":case"complex64":if(typeof t=="number")return this.ce.complex(t);let o=n.numericValue;return o instanceof qo.default?o:void 0;case"bool":return typeof t=="boolean"?t:void 0;case"string":return typeof t=="string"?t:void 0;case"expression":return n}throw new Error(`Cannot cast ${n} to ${i}`)}expression(n){return n}isZero(n){return n.isZero??!1}isOne(n){return n.isOne??!1}equals(n,i){return n.isEqual(i)}add(n,i){return this.ce.add([n,i])}addn(...n){return this.ce.add(n)}neg(n){return this.ce.neg(n)}sub(n,i){return this.ce.add([n,this.ce.neg(i)])}mul(n,i){return this.ce.mul([n,i])}muln(...n){return this.ce.mul(n)}div(n,i){return this.ce.div(n,i)}pow(n,i){return this.ce.pow(n,i)}conjugate(n){return this.ce.box(["Conjugate",n])}},Ro=class{constructor(n){this.ce=n,this.one=n.complex(1),this.zero=n.complex(0),this.nan=n.complex(NaN)}cast(n,i){if(Array.isArray(n))return n.map(t=>this.cast(t,i));switch(i){case"float64":return n.im===0?n.re:void 0;case"float32":return n.im===0?n.re:void 0;case"int32":return n.im===0?Math.round(n.re):void 0;case"uint8":if(n.im!==0)return;let t=Math.round(n.re);return t>=0&&t<=255?t:void 0;case"complex128":return n;case"complex64":return n;case"bool":return!(n.im===0&&n.re===0);case"string":return n.toString();case"expression":return this.ce.number(n)}throw new Error(`Cannot cast ${n} to ${i}`)}expression(n){return this.ce.number(n)}isZero(n){return n.isZero()}isOne(n){return n.re===1&&n.im===0}equals(n,i){return n.equals(i)}add(n,i){return n.add(i)}addn(...n){return n.reduce((i,t)=>i.add(t),this.zero)}neg(n){return n.neg()}sub(n,i){return n.sub(i)}mul(n,i){return n.mul(i)}muln(...n){return n.reduce((i,t)=>i.mul(t),this.one)}div(n,i){return n.div(i)}pow(n,i){return n.pow(i)}conjugate(n){return n.conjugate()}};function mr(e,n){return e===n?e:e==="string"||n==="string"||e==="expression"||n==="expression"?"expression":e==="complex128"||n==="complex128"?"complex128":e==="complex64"||n==="complex64"?"complex64":e==="float64"||n==="float64"?"float64":e==="float32"||n==="float32"?"float32":e==="int32"||n==="int32"?"int32":e==="uint8"||n==="uint8"?"uint8":e==="bool"||n==="bool"?"bool":"expression"}function Vo(e){let n=e.value;if(typeof n=="number")return Number.isInteger(n)?n>=0&&n<=255?"uint8":"int32":"float64";let i=e.numericValue;return i!==null&&i instanceof qo.default?"complex128":e.string?"string":"expression"}var Fn=class e{constructor(n,i){this.ce=n;this.shape=i.shape,this.rank=this.shape.length,this._strides=id(this.shape),this.field=cr(n,i.dtype)}static align(n,i){if(n.dtype===i.dtype)return[n,i];let t=mr(n.dtype,i.dtype);return n.dtype===t?[n,i.upcast(t)]:[n.upcast(t),i]}static broadcast(n,i,t){if(!(t instanceof e))return i.map1(n,t);let[r,o]=e.align(i,t),s=r.data.map((a,u)=>n(a,o.data[u]));return fn(r.ce,{dtype:r.dtype,shape:r.shape,data:s})}get expression(){let n=this.shape,i=this.rank,t=this.data,r=this._index.bind(this),o=this.field.expression.bind(this.field),s=a=>{if(a.length===i-1){let u=r(a),l=this.ce._fn("List",t.slice(u,u+n[i-1]).map(f=>o(f)));return l.isCanonical=l.ops.every(f=>f.isCanonical),l}else{let u=[];for(let f=0;f<=n[a.length]-1;f++)u.push(s([...a,f+1]));let l=this.ce._fn("List",u);return l.isCanonical=l.ops.every(f=>f.isCanonical),l}};return s([])}get array(){let n=this.shape,i=this.rank,t=this.data;if(i===1)return t;if(i===2){let[s,a]=n,u=new Array(s);for(let l=0;l<s;l++)u[l]=t.slice(l*a,(l+1)*a);return u}let r=this._index.bind(this),o=s=>{if(s.length===i-1){let a=r(s);return t.slice(a,a+n[i-1])}else{let a=[];for(let u=0;u<n[s.length];u++)a.push(o([...s,u+1]));return a}};return o([])}_index(n){let i=this._strides;return n.reduce((t,r,o)=>t+(r-1)*i[o],0)}get isSquare(){let n=this.shape;return n.length===2&&n[0]===n[1]}get isSymmetric(){if(!this.isSquare)return!1;let n=this.shape[0],i=this.data,t=this.field.equals.bind(this.field);for(let r=0;r<n;r++)for(let o=r+1;o<n;o++)if(!t(i[r*n+o],i[o*n+r]))return!1;return!0}get isSkewSymmetric(){if(!this.isSquare)return!1;let n=this.shape[0],i=this.data,t=this.field.equals.bind(this.field),r=this.field.neg.bind(this.field);for(let o=0;o<n;o++)for(let s=o+1;s<n;s++)if(!t(i[o*n+s],r(i[s*n+o])))return!1;return!0}get isUpperTriangular(){if(!this.isSquare)return!1;let n=this.shape[0],i=this.data,t=this.field.isZero.bind(this.field);for(let r=1;r<n;r++)for(let o=0;o<r;o++)if(t(i[r*n+o]))return!1;return!0}get isLowerTriangular(){if(!this.isSquare)return!1;let n=this.shape[0],i=this.data,t=this.field.isZero.bind(this.field);for(let r=0;r<n-1;r++)for(let o=r+1;o<n;o++)if(!t(i[r*n+o]))return!1;return!0}get isTriangular(){if(!this.isSquare)return!1;let n=this.shape[0],i=this.data,t=this.field.isZero.bind(this.field);for(let r=0;r<n;r++)for(let o=0;o<n;o++)if(r<o&&!t(i[r*n+o])||r>o&&!t(i[r*n+o]))return!1;return!0}get isDiagonal(){if(!this.isSquare)return!1;let n=this.shape[0],i=this.data,t=this.field.isZero.bind(this.field);for(let r=0;r<n;r++)for(let o=0;o<n;o++)if(r===o&&!t(i[r*n+o])||r!==o&&!t(i[r*n+o]))return!1;return!0}get isIdentity(){if(!this.isSquare)return!1;let[n,i]=this.shape,t=this.data,r=this.field.isOne.bind(this.field),o=this.field.isZero.bind(this.field);for(let s=0;s<i;s++)for(let a=0;a<i;a++)if(s===a&&!r(t[s*i+a])||s!==a&&!o(t[s*i+a]))return!1;return!0}get isZero(){let n=this.field.isZero.bind(this.field);return this.data.every(i=>n(i))}at(...n){let i=this.data.length;return this.data[this._index(n)%i]}diagonal(n,i){if(n??(n=1),i??(i=2),n===i||n<=0||n>this.shape.length||this.shape[n-1]!==this.shape[i-1])return;let t=new Array(this.shape[n-1]),r=this.data,o=this.shape[n-1];for(let s=0;s<o;s++)t[s]=r[s*o+s];return t}trace(n,i){if(this.rank!==2)return;let[t,r]=this.shape;if(t!==r)return;let o=this.data,s=new Array(t);for(let a=0;a<t;a++)s[a]=o[a*t+a];return this.field.addn(...s)}reshape(...n){return fn(this.ce,{dtype:this.dtype,shape:n,data:this.data})}flatten(){return this.data}upcast(n){let i=this.field.cast(this.data,n);if(i===void 0)throw Error(`Cannot cast tensor to ${n}`);return fn(this.ce,{dtype:n,shape:this.shape,data:i})}transpose(n,i,t){if(this.rank!==2)return;if(n??(n=1),i??(i=2),n===i)return this;if(n<=0||n>2||i<=0||i>2)return;let[r,o]=this.shape,s=this.data;t&&(s=s.map(f=>t(f)));let a=0,u=new Array(r*o),l=o;for(let f=0;f<o;f++)for(let d=0;d<r;d++)u[a++]=s[d*l+f];return fn(this.ce,{dtype:this.dtype,shape:[o,r],data:u})}conjugateTranspose(n,i){let t=this.field.conjugate.bind(this.field);return this.transpose(n,i,t)}determinant(){if(this.rank!==2)return;let[n,i]=this.shape;if(n!==i)return;if(n===1)return this.data[0];let t=this.field.add.bind(this.field),r=this.field.mul.bind(this.field),o=this.field.neg.bind(this.field);if(n===2){let[g,E,S,k]=this.data;return t(r(g,k),o(r(E,S)))}let s=this.field.addn.bind(this.field),a=this.field.muln.bind(this.field);if(n===3){let[g,E,S,k,B,W,Le,qe,ii]=this.data;return s([a(g,B,ii),a(E,W,Le),a(S,k,qe),o(a(S,B,Le)),o(a(E,k,ii)),o(a(g,W,qe))])}let u=this.shape[0],l=!1,f=this.field.div.bind(this.field),d=this.field.sub.bind(this.field),c=new Array(u).fill(0).map((g,E)=>E),p=[...this.data];for(let g=0;g<u;g++){let E=c[g-1];if(this.at(E,g)===0){let B;for(B=g+1;B<u;B++)if(this.at(c[B],g)!==0){E=c[B],c[B-1]=c[g-1],c[g-1]=E,l=!l;break}if(B===u)return this.at(E,g)}let S=this.at(E,g),k=g===0?1:this.at(c[g-2],g-2);for(let B=g+1;B<u;B++){let W=c[B-1];for(let Le=g+1;Le<u;Le++)p[W][Le]=f(d(r(p[W][Le],S),r(p[W][g],p[E][Le])),k)}}let h=p[c[u-1]][u-1];return l?this.field.neg(h):h}inverse(){if(this.rank!==2)return;let[n,i]=this.shape;if(n!==i)return;if(n===2){let[c,p,h,g]=this.data,E=this.determinant();if(E===void 0||this.field.isZero(E))return;let S=this.field.div.bind(this.field),k=this.field.neg.bind(this.field),B=[S(g,E),k(S(p,E)),k(S(h,E)),S(c,E)];return fn(this.ce,{dtype:this.dtype,shape:[i,i],data:B})}let t=this.shape[0],r=this.field.div.bind(this.field),o=this.field.sub.bind(this.field),s=this.field.mul.bind(this.field),a=this.array,u=new Array(t).fill(0).map((c,p)=>{let h=new Array(t).fill(0);return h[p]=1,h}),l=a.map((c,p)=>[...c,...u[p]]),f=new Array(t).fill(0).map((c,p)=>p);for(let c=0;c<t;c++){let p=f[c-1];if(this.at(p,c)===0){let E;for(E=c+1;E<t;E++)if(this.at(f[E],c)!==0){p=f[E],f[E-1]=f[c-1],f[c-1]=p;break}if(E===t)return}let h=this.at(p,c),g=c===0?1:this.at(f[c-2],c-2);for(let E=c+1;E<t;E++){let S=f[E-1];for(let k=c+1;k<t*2;k++)l[S][k]=o(l[S][k],s(r(s(l[S][c],l[p][k]),h),g))}}for(let c=t-1;c>=0;c--){let p=l[f[c],c];for(let h=0;h<c;h++){let g=f[h];for(let E=t;E<t*2;E++)l[g][E]=o(l[g][E],s(r(s(l[g][c],l[c][E]),p),p))}for(let h=t;h<t*2;h++)l[c][h]=r(l[c][h],p)}let d=l.map(c=>c.slice(t));return fn(this.ce,{dtype:this.dtype,shape:[i,i],data:d})}pseudoInverse(){}adjugateMatrix(){}minor(n,i){}map1(n,i){return fn(this.ce,{dtype:this.dtype,shape:this.shape,data:this.data.map(t=>n(t,i))})}map2(n,i){let t=i.data;return fn(this.ce,{dtype:this.dtype,shape:this.shape,data:this.data.map((r,o)=>n(r,t[o]))})}add(n){return e.broadcast(this.field.add.bind(this.field),this,n)}subtract(n){return e.broadcast(this.field.sub.bind(this.field),this,n)}multiply(n){return e.broadcast(this.field.mul.bind(this.field),this,n)}divide(n){return e.broadcast(this.field.div.bind(this.field),this,n)}power(n){return e.broadcast(this.field.pow.bind(this.field),this,n)}equals(n){if(this.rank!==n.rank||!this.shape.every((o,s)=>o===n.shape[s]))return!1;let i=this.field.equals.bind(this.field),t=this.field.cast.bind(this.field),r=this.dtype;return this.dtype!==n.dtype?!!this.data.every((o,s)=>i(o,t(n.data[s],r))):this.data.every((o,s)=>i(o,n.data[s]))}};function id(e){let n=new Array(e.length);for(let i=e.length-1,t=1;i>=0;i--)n[i]=t,t*=e[i];return n}var $o=class extends Fn{constructor(i,t){super(i,t);this.dtype="float64";this.data=t.data}get isZero(){return this.data.every(i=>i===0)}},zo=class extends Fn{constructor(i,t){super(i,t);this.dtype="complex128";this.data=t.data}},Uo=class extends Fn{constructor(i,t){super(i,t);this.dtype="bool";this.data=t.data}},Go=class extends Fn{constructor(i,t){super(i,t);this.dtype="expression";this.data=t.data}};function fn(e,n){let i=n.dtype;return i==="float64"||i==="float32"||i==="uint8"||i==="int32"?new $o(e,n):i==="bool"?new Uo(e,n):i==="complex64"||i==="complex128"?new zo(e,n):new Go(e,n)}var ft=class e extends L{constructor(i,t,r){r??(r={}),r.canonical??(r.canonical=!0);super(i,r.metadata);t instanceof Fn?this._tensor=t:(this._head=t.head??"List",this._ops=r.canonical?i.canonical(t.ops):t.ops,this._expression=i._fn(this._head,this._ops),this.expression.isCanonical=r.canonical),i._register(this)}get expression(){return this._expression??(this._expression=this._tensor.expression),this._expression}get tensor(){if(this._tensor===void 0){this._head,this._ops;let i=td(this._head,this._ops);if(i===void 0)throw new Error("Invalid tensor");this._tensor=fn(this.engine,i)}return this._tensor}get baseDefinition(){return this.expression.baseDefinition}get functionDefinition(){return this.expression.functionDefinition}bind(){this.expression.bind()}reset(){}get hash(){return he("BoxedTensor")}get canonical(){return this.expression.canonical}get isCanonical(){return this._tensor?!0:this.expression.isCanonical}set isCanonical(i){this._tensor||(this.expression.isCanonical=i)}get isPure(){return this._tensor?!0:this.expression.isPure}get isValid(){return this._tensor?!0:this.expression.isValid}get complexity(){return 97}get head(){return this._tensor?"List":this._head}get nops(){return this._tensor?this._tensor.shape[0]:this.expression.nops}get ops(){return this.expression.ops}get op1(){if(this._tensor){let i=this._tensor.data;return i.length===0?this.engine.Nothing:this.engine.box(i[0])}return this.expression.op1}get op2(){if(this._tensor){let i=this._tensor.data;return i.length<2?this.engine.Nothing:this.engine.box(i[1])}return this.expression.op2}get op3(){if(this._tensor){let i=this._tensor.data;return i.length<3?this.engine.Nothing:this.engine.box(i[2])}return this.expression.op3}get shape(){return this.tensor.shape}get rank(){return this.tensor.rank}get domain(){return this._tensor?this.engine.domain("Lists"):this.expression.domain}get json(){return this.expression.json}get rawJson(){return this.expression.rawJson}isSame(i){return this===i?!0:i instanceof e?this.tensor.equals(i.tensor):this.expression.isSame(i)}isEqual(i){return this===i?!0:i instanceof e?this.tensor.equals(i.tensor):this.expression.isEqual(i)}match(i,t){return this.expression.match(i,t)}evaluate(i){return this._tensor?this:this.expression.evaluate(i)}simplify(i){return this._tensor?this:this.expression.simplify(i)}N(i){return this._tensor?this:this.expression.N(i)}};function Pe(e){return e instanceof ft}function jo(e,n){let i,t=[],r=!0,o=(s,a=0)=>{if(s.length!==0){s.length>1&&t[a]!==void 0?r=r&&t[a]===s.length:t[a]=Math.max(t[a]??0,s.length);for(let u of s)if(u.head===e?o(u.ops,a+1):i===void 0?i=Vo(u):i=mr(i,Vo(u)),!r)return}};if(o(n),!!r)return{shape:t,dtype:i}}function td(e,n){let{shape:i,dtype:t}=jo(e,n)??{shape:[],dtype:void 0};if(t===void 0)return;let r=!0,o=[],s=cr(n[0].engine,"expression"),a=s.cast.bind(s),u=l=>{for(let f of l)if(f.head===e)u(f.ops);else{let d=a(f,t);if(d===void 0){r=!1;return}o.push(d)}};if(u(n),!!r)return{shape:i,data:o,dtype:t}}function Ke(e,n,i){if(!n.isValid||!i.isValid)return e._fn("Divide",[n,i]);if(n.head==="Negate"&&i.head==="Negate"&&(n=n.op1,i=i.op1),n.numericValue!==null&&i.numericValue!==null){if(i.isOne)return n;if(i.isNegativeOne)return e.neg(n);if(n.isOne)return e.inv(i);if(n.isNegativeOne)return e.neg(e.inv(i));let p=Q(n),h=Q(i);if(p&&h&&!Ce(h))return e.number(de(p,yn(h)))}if(n.head==="Divide"&&i.head==="Divide")return Ke(e,e.mul([n.op1,i.op2]),e.mul([n.op2,i.op1]));if(n.head==="Divide")return Ke(e,e.mul([n.op1,i]),n.op2);if(i.head==="Divide")return Ke(e,e.mul([n,i.op2]),i.op1);let t=n.numericValue;if(t!==null){if(q(t)){let[p,h]=t;return Ke(e,e.number(p),e.mul([e.number(h),i]))}if(J(t)){let[p,h]=t;return Ke(e,e.number(p),e.mul([e.number(h),i]))}}let r=i.numericValue;if(r!==null){if(q(r)){let[p,h]=r;return Ke(e,e.mul([n,e.number(h)]),e.number(p))}if(J(r)){let[p,h]=r;return Ke(e,e.mul([n,e.number(h)]),e.number(p))}}let[o,s]=Qe(n),[a,u]=Qe(i);if(!fe(o)||!fe(a)){let[p,h]=de(o,yn(a)),g=e.mul([e.number(p),s]);if(g.isZero)return e.Zero;let E=e.mul([e.number(h),u]);return E.isOne?g:e._fn("Divide",[g,E])}let[l,f]=Eo(n),[d,c]=Eo(i);return f=f.canonical,c=c.canonical,c.numericValue!==null&&c.isOne?l*d<0?re(f):f:l*d>0?e._fn("Divide",[f,c]):f.numericValue?e._fn("Divide",[re(f),c]):re(e._fn("Divide",[f,c]))}function Zo(e,n,i){if(n.numericValue!==null&&i.numericValue!==null){let t=Q(n),r=Q(i);if(t&&r&&!Ce(r))return e.number(de(t,yn(r)))}return new Xe(e,[n,e.inv(i)]).asRationalExpression()}var Ii=pe(le(),1);function dt(e,n,i,t){if(i.symbol==="ComplexInfinity")return e.NaN;if(i.isZero)return e.One;if(i.isOne)return n;if(i.isNegativeOne)return e.inv(n);if(i.numericValue!==null&&n.numericValue!==null){let r=y(n);if(r===1)return e.One;if(r===0){if(i.isPositive)return e.Zero;if(i.isNegative)return e.ComplexInfinity}if(i.isNegativeOne)return e.inv(n);let o=y(i);if(o===.5||o===-.5){let s=A(n);if(s!==null&&s>0){let[a,u]=xn(s,2);return u===1&&a===1?e.One:a!==1?u===1?e.number(o>=0?a:[1,a]):e.mul([e.number(a),e._fn("Sqrt",[e.number(u)])]):o>0?e._fn("Sqrt",[n],t):e.inv(e._fn("Sqrt",[n]),t)}return o>0?e._fn("Power",[n,e.Half],t):e._fn("Power",[n,e.number([-1,2])],t)}if(n.isInfinity){if(i.numericValue instanceof Ii.Complex){let s=i.numericValue.re;if(s===0)return e.NaN;if(s<0)return e.Zero;if(s>0)return e.ComplexInfinity}if(n.isNegative){if(i.isInfinity)return e.NaN}else if(n.isPositive){if(i.isNegativeOne)return e.Zero;if(i.isInfinity)return i.isNegative?e.Zero:e.PositiveInfinity}}if(i.isInfinity&&(n.isOne||n.isNegativeOne))return e.NaN}if(n.head==="Power"&&n.op1.isReal){let r=A(i);if(r!==null){let o=A(n.op2);if(o!==null)return e.pow(n.op1,e.number(r*o))}if(n.op1.isNonNegative){let o=Q(i);if(o){let s=Q(n.op2);if(s)return e.pow(n.op1,e.number(de(o,s)))}}}return n.head==="Multiply"&&A(i)!==null?e._fn("Multiply",n.ops.map(o=>e.pow(o,i))):e._fn("Power",[n,i],t)}function Ho(e,n){let i=n.numericValue;if(typeof i=="number")return e.number(i*i);if(i instanceof v||i instanceof Ii.Complex)return e.number(i.pow(2));if(q(i))return e.number([i[1]*i[1],i[0]*i[0]]);if(J(i))return e.number([i[1]*i[1],i[0]*i[0]]);if(n.head==="Multiply")return e._fn("Multiply",n.ops.map(t=>Ho(e,t)));if(n.head==="Power"){let t=A(n.op2);return t!==null?e.pow(n.op1,e.number(t*2)):e.pow(n.op1,e.mul([e.number(2),n.op2]))}return e.pow(n,e.number(2))}function iu(e,n,i){if(n.numericValue===null||i.numericValue===null)return;if(n.numericValue instanceof Ii.Complex)return i.numericValue instanceof Ii.Complex?e.number(n.numericValue.pow(i.numericValue)):e.number(n.numericValue.pow(y(i)??NaN));if(i.numericValue instanceof Ii.Complex){let s=y(n)??null;return s!==null?e.number(e.complex(s).pow(i.numericValue)):void 0}let t=rd(i);if(P(e)||n.numericValue instanceof v||i.numericValue instanceof v){let s=$e(n),a=$e(i);if(!s||!a)return;if(t===2)return s.isNeg()?K(e)?e.number(e.complex(0,s.neg().sqrt().toNumber())):e.NaN:e.number(s.sqrt());if(!a.isInteger()&&s.isNeg()){if(!K(e))return e.NaN;let u=e.complex(s.toNumber()),l=e.complex(a.toNumber());return e.number(u.pow(l))}return e.number(s.pow(a))}let r=y(i)??NaN,o=y(n)??NaN;if(t===2)return o<0?K(e)?e.mul([e.I,e.number(Math.sqrt(-o))]):e.NaN:e.number(Math.sqrt(o));if(!Number.isInteger(r)&&o<0){if(!K(e))return e.NaN;let s=e.complex(o),a=e.complex(r);return e.number(s.pow(a))}return e.number(Math.pow(o,r))}function ct(e,n,i,t){if(n.head==="Multiply"){let r=P(e)?[BigInt(1),BigInt(1)]:[1,1],o=[];for(let s of n.ops){let a=Q(s);a?r=de(r,a):o.push(s)}if(!fe(r))return e.mul([mt(e,e.number(r),t)??e.One,e.pow(ct(e,e.mul(o),i,t)??e.mul(o),i)])}if(n.head==="Power"){if(A(n.op2)===-1&&A(i)===-1)return n.op1;let r=Q(n.op2),o=Q(i);if(r&&o){let s=de(r,o);return e.pow(n.op1,s)}if(t==="N"){let s=y(n.op2),a=y(i);if(s!==null&&a!==null){let u=s*a;return u===0?e.One:u===1?n.op1:e.pow(n.op1,u)}}}if(t!=="N"&&n.numericValue!==null&&n.isInteger){if(A(i))return iu(e,n,i);let o=Q(i);if(o){let[s,a]=[Ie(o),Re(o)];if((s===1||s===-1)&&(a===2||a===3)){if(P(e)||n.numericValue instanceof v){let u=Xi(n);if(a%2===0&&u<0&&!K(e))return e.NaN;let l=u<0?a%2===0?e.I:e.NegativeOne:e.One,[f,d]=Wt(u>0?u:-u,a);if(d===BigInt(1)&&f===BigInt(1))return l;if(f!==BigInt(1))return d===BigInt(1)?e.mul([l,e.number(s>=0?f:[BigInt(1),f])]):e.mul([l,e.number(f),e.pow(e.number(d),i)])}else if(typeof n.numericValue=="number"){if(n.numericValue<0&&a%2===0&&!K(e))return e.NaN;let[u,l]=xn(Math.abs(n.numericValue),a),f=n.numericValue<0?a%2===0?e.I:e.NegativeOne:e.One;if(l===1&&u===1)return f;if(u!==1)return l===1?e.mul([f,e.number(s>=0?u:[1,u])]):e.mul([f,e.number(u),e.pow(e.number(l),i)])}}return n.isNegative?K?e.mul([e.I,e.fn("Sqrt",[e.neg(n)])]):e.NaN:void 0}}if(t!=="simplify"&&n.numericValue!==null&&i.numericValue!==null)return iu(e,n,i)}function mt(e,n,i){if(n.isOne)return e.One;if(n.isZero)return e.Zero;if(n.isNegativeOne)return K(e)?e.I:e.NaN;if(n.isNegative&&!K(e))return e.NaN;let t=Q(n);if(i==="N"||i==="evaluate"&&!t)return R(n,o=>o<0?e.complex(o).sqrt():Math.sqrt(o),o=>o.isNeg()?e.complex(o.toNumber()).sqrt():o.sqrt(),o=>o.sqrt());let r=A(n);if(r!==null){let[o,s]=xn(Math.abs(r),2);return r<0?(s===1&&e.mul([e.number(e.complex(0,o))]),e.mul([e.number(e.complex(0,o)),e.sqrt(e.number(s))])):s===1?e.number(o):e.mul([e.number(o),e.sqrt(e.number(s))])}if(t){if(q(t)&&!P(e)){let[o,s]=t;if(Math.abs(o)<Number.MAX_SAFE_INTEGER&&s<Number.MAX_SAFE_INTEGER){let[a,u]=xn(Math.abs(o),2),[l,f]=xn(s,2);return o<0?e.mul([e.number([a,l]),e.sqrt(e.number([u,f])),e.I]):e.mul([e.number([a,l]),e.sqrt(e.number([u,f]))])}}if(J(t)||P(e)){let o=C(t[0]),[s,a]=Wt(o>0?o:-o,2),[u,l]=Wt(C(t[1]),2);return o<0?e.mul([e.number([s,u]),e.sqrt(e.number([a,l])),e.I]):e.mul([e.number([s,u]),e.sqrt(e.number([a,l]))])}}}function rd(e){if(typeof e.numericValue=="number"){let t=1/e.numericValue;return Number.isInteger(t)?t:null}if(e.numericValue instanceof v){let t=e.engine._BIGNUM_ONE.div(e.numericValue);return t.isInt()?t.toNumber():null}if(!U(e.numericValue))return null;let[n,i]=[Ie(e.numericValue),Re(e.numericValue)];return n!==1&&n!==-1?null:n*i}function pt(e,n){if(n.every(t=>t.isCanonical),n.length===0)return e.One;if(n.length===1)return n[0];if(n.length===2)return ru(n[0],n[1]);let i=new Xe(e);for(let t of n){if(t.isNaN||t.symbol==="Undefined")return e.NaN;i.addTerm(t)}return i.asExpression()}function tu(e,n){n.every(t=>t.head!=="Multiply");let i=new Xe(e);for(let t of n){if(t=t.simplify(),t.isNaN||t.symbol==="Undefined")return e.NaN;i.addTerm(t)}return i.asExpression()}function Jo(e,n,i="evaluate"){if(n.length>1,i==="N"&&(n=n.map(t=>t.N()),(e.numericMode==="machine"||e.numericMode==="auto")&&n.every(t=>typeof t.numericValue=="number"))){let t=1;for(let r of n)t*=r.numericValue;return e.number(t)}for(let t of n){if(t.isNaN||t.symbol==="Undefined")return e.NaN;t.isExact||(i="N")}return n.every(t=>t.head!=="Multiply"),i==="N"?n=n.map(t=>t.N()):n=n.map(t=>t.evaluate()),new Xe(e,n).asExpression(i)}function ru(e,n,i){e.isCanonical,n.isCanonical;let t=e.engine;if(e.symbol==="ImaginaryUnit"){let u=y(n);if(u!==null)return t.number(t.complex(0,u))}if(n.symbol==="ImaginaryUnit"){let u=y(e);if(u!==null)return t.number(t.complex(0,u))}if(e.numericValue!==null&&n.numericValue!==null){let u=y(e),l=y(n);if(u!==null&&t.isComplex(n))return t.number(t.complex(u*n.re,u*n.im));if(l!==null&&t.isComplex(e))return t.number(t.complex(l*e.re,l*e.im))}if(e.numericValue!==null&&n.numericValue!==null&&e.isInteger&&n.isInteger)return Mn(e,n,(u,l)=>u*l,(u,l)=>u.mul(l))??t.NaN;if(e.isNaN||n.isNaN||e.symbol==="Undefined"||n.symbol==="Undefined")return t.NaN;if(e.isNothing)return n;if(n.isNothing)return e;if(e.numericValue!==null){if(e.isOne)return n;if(e.isNegativeOne)return re(n)}if(n.numericValue!==null){if(n.isOne)return e;if(n.isNegativeOne)return re(e)}let r=1,[o,s]=e.numericValue!==null?[e,n]:[n,e];if(o.head,o.head==="Negate"&&(o=o.op1,r=-r),s.numericValue!==null){let u=Q(s);if(u){if(fe(u))return o;if(Ce(u))return t.Zero;if(o.head==="Add")return r<0&&(s=re(s)),t.add(o.ops.map(f=>ru(s,f)),i);let l=Q(o);if(l){let f=de(u,l);return t.number(r<0?ve(f):f,{metadata:i})}return r<0?t._fn("Multiply",[re(s),o],i):t._fn("Multiply",[s,o],i)}}if(s.hash===o.hash&&s.isSame(o))return Ho(t,s);let a=new Xe(t,[s,o]);return r>0?a.asExpression():re(a.asExpression(),i)}function ou(e,n,i){e.pushScope(),n??(n=e.error("missing")),i=tr(i);let t=i?e._fn("Product",[n.canonical,i]):e._fn("Product",[n.canonical]);return e.popScope(),t}function pr(e,n,i,t){let r=null,o=t==="simplify"?n.simplify():n.evaluate({numericMode:t==="N"});if(!i){if(P(e)){let c=e.bignum(1);for(let p of H(o)){let h=$e(p);if(h===null){r=void 0;break}if(!h.isFinite()){c=h;break}c=c.mul(h)}r===null&&(r=e.number(c))}else{let c=1;for(let p of H(o)){let h=y(p);if(h===null){r=void 0;break}if(h===null||!Number.isFinite(h)){c=h;break}c*=h}r===null&&(r=e.number(c))}return r??void 0}let[s,a,u,l]=An(i);if(!s)return;let f=n;if(t!=="N"&&(a>=u||u-a>=ji))return;let d=e.swapScope(f.scope);if(e.pushScope(),f.bind(),t==="simplify"){let c=[];for(let p=a;p<=u;p++)e.assign({[s]:p}),c.push(f.simplify());r=e.mul(c).simplify()}if(t==="evaluate"){let c=[];for(let p=a;p<=u;p++)e.assign({[s]:p}),c.push(f.evaluate());r=e.mul(c).evaluate()}if(t==="N"){if(r===null&&l){if(P(e)){let g=e.bignum(1);for(let E=a;E<=u;E++){e.assign({[s]:E});let S=$e(f.N());if(S===null||!S.isFinite()){r=S!==null?e.number(S):void 0;break}g=g.mul(S)}r===null&&(r=e.number(g))}let c=1,p=e.numericMode,h=e.precision;e.numericMode="machine";for(let g=a;g<=u;g++){e.assign({[s]:g});let E=y(f.N());if(E===null||!Number.isFinite(E)){r=E!==null?e.number(E):void 0;break}c*=E}e.numericMode=p,e.precision=h,r===null&&(r=e.number(c))}if(r===null){e.assign({[s]:1e3});let c=f.N();e.assign({[s]:999});let p=f.N(),h=y(e.div(c,p).N());if(h!==null&&Number.isFinite(h)&&Math.abs(h)>1)r=e.PositiveInfinity;else{let g=1,E=e.numericMode,S=e.precision;e.numericMode="machine";for(let k=a;k<=u;k++){e.assign({[s]:k});let B=y(f.N());if(B===null){r=void 0;break}if(Math.abs(1-B)<Number.EPSILON||!Number.isFinite(B))break;g*=B}r===null&&(r=e.number(g)),e.numericMode=E,e.precision=S}}}return e.popScope(),e.swapScope(d),r??void 0}function ht(e){return e[Math.floor(Math.random()*e.length)]}function su(e,n){if(e==="Add"||e==="Multiply"){let i=[],t=1+Math.floor(Math.random()*12);for(;t>0;)i.push(dn(n+1)),t-=1;return[e,...i]}return e==="Divide"||e==="Power"?[e,dn(n+1),dn(n+1)]:e==="Root"?[e,dn(n+1),dn(10)]:e==="trig"?od():[e,dn(n+1)]}function od(){return[ht(["Cos","Sin","Tan","Sinh","Arccos","Arsinh"]),ht(["Pi","-1","0","1",["Divide","Pi",-5],["Multiply",-2,["Divide","Pi",11]],["Multiply","Half","Pi"],["Multiply",5,"Pi"],["Multiply",12,"Pi"],["Divide","Pi",5],["Divide","Pi",9],["Multiply",5,["Divide","Pi",9]],["Multiply",2,["Divide","Pi",11]],["Multiply",2,["Divide","Pi",3]]])]}function dn(e){if(e??(e=1),e===1){let n=ht([["Sqrt",["Multiply",6,["Sum",["Divide",1,["Power","n",2]],["Triple",["Hold","n"],1,{num:"+Infinity"}]]]],"Add","Add","Add","Add","Add","Multiply","Multiply","Multiply","Multiply","Divide","Divide","Divide","Root","Sqrt","Subtract","Negate","trig"]);return typeof n=="string"?su(n,1):n}if(e===2){let n=Math.random();if(n>.75)return dn(1);if(n>.5)return dn(3);let i=ht(["Multiply","Multiply","Add","Power","trig","Ln","Exp"]);return su(i,2)}return ht([-12345e-9,-2,-2,-2,-3,-5,-6,-12,-1654e-60,0,0,12345e-8,1654e-60,1,2,2,2,2,3,3,5,5,6,6,1234.5678,5678.1234,10,15,18,30,60,1234e54,"123456789.12345678912345e200","987654321.12345678912345",["Rational",-6,10],["Rational",-12,15],["Rational",-15,12],["Rational",3,5],["Rational",12,15],["Rational",15,12],"ExponentialE",["Sqrt",3],["Sqrt",5],["Sqrt",15],["Sqrt",25],["Complex",-1.1,1.1],["Complex",4,5],"x","x","x","x",["Add","x",1],["Divide","x",3],["Square","x"],["Power","x",3],["Power","x",4],["Subtract","x",1],["Add","x",1],"Pi"])}var au=[{Nothing:{domain:"NothingDomain"}},{InvisibleOperator:{complexity:9e3,hold:"all",signature:{restParam:"Anything",result:(e,n)=>n.length===0?e.domain("NothingDomain"):n.length===1?n[0].domain:e.Anything,canonical:hr}},Sequence:{hold:"all",signature:{restParam:"Anything",result:(e,n)=>n.length===0?e.domain("NothingDomain"):n.length===1?n[0].domain:e.Anything,canonical:(e,n)=>{let i=ee(ce(n));return i.length===0?e._fn("Sequence",[]):i.length===1?i[0]:e._fn("Sequence",i)}}},Delimiter:{complexity:9e3,hold:"all",signature:{params:["Anything"],optParams:["Strings"],result:(e,n)=>n[0].domain,canonical:(e,n)=>{if(n.length===0)return e._fn("Tuple",[]);let i=n[0];return i.ops,i.head==="Sequence"&&(i=e._fn("Sequence",e.canonical(i.ops))),n=[i,...n.slice(1)],n.length===1?e._fn("Delimiter",n):n.length>2?e._fn("Delimiter",Ne(e,n,2)):(n[1].string?.length??0)>3?e._fn("Delimiter",[n[0],e.error("invalid-delimiter",n[1])]):e._fn("Delimiter",[n[0],Ae(e,n[1],"Strings")])},evaluate:(e,n)=>{if(n.length===0)return e.Nothing;let i=n[0];return(i.head==="Sequence"||i.head==="Delimiter")&&(n=ce(n[0].ops)),e._fn("Tuple",n.map(t=>t.evaluate()))},N:(e,n)=>{if(n.length===0)return e.Nothing;let i=n[0];return(i.head==="Sequence"||i.head==="Delimiter")&&(n=ce(n[0].ops)),e._fn("Tuple",n.map(t=>t.N()))}}},Error:{hold:"all",complexity:500,signature:{domain:["FunctionOf","Anything",["OptArg","Anything"],"Void"],canonical:(e,n)=>e._fn("Error",n)}},ErrorCode:{complexity:500,hold:"all",signature:{domain:["FunctionOf","Strings",["VarArg","Anything"],"Anything"],canonical:(e,n)=>{let i=Ae(e,n[0],e.Strings).string;return i==="incompatible-domain"?e._fn("ErrorCode",[e.string(i),n[1],n[2]]):e._fn("ErrorCode",n)}}},Hold:{hold:"all",signature:{domain:["FunctionOf","Anything","Anything"],result:(e,n)=>{let i=n[0];return i.symbol?e.domain("Symbols"):i.string?e.domain("Strings"):i.head==="Numbers"?e.domain("Numbers"):i.domain},canonical:(e,n)=>n.length!==1?null:e.hold(n[0]),evaluate:(e,n)=>n[0]}},HorizontalSpacing:{signature:{domain:"Functions",canonical:(e,n)=>n.length===2?n[0].canonical:e.box(["Sequence"])}},Style:{complexity:9e3,inert:!0,signature:{domain:["FunctionOf","Anything",["OptArg","Dictionaries"],"Anything"]}}},{About:{signature:{domain:"Functions"}},Head:{hold:"all",signature:{domain:"Functions",canonical:(e,n)=>{if(n.length!==1)return null;let i=n[0];return i.head?e.box(i.head):e._fn("Head",ee(n))},evaluate:(e,n)=>{let i=n[0];return typeof i?.head=="string"?e.symbol(i.head):i?.head??e.Nothing}}},Tail:{hold:"all",signature:{domain:"Functions",canonical:(e,n)=>{if(n.length!==1)return null;let i=n[0];return i.ops?e._fn("Sequence",i.ops):e._fn("Tail",ee(n))},evaluate:(e,n)=>{let i=n[0];return i?.ops?e.fn("Sequence",i.ops):e.box(["Sequence"])}}},Identity:{signature:{domain:["FunctionOf","Anything","Anything"],result:(e,n)=>n[0].domain,evaluate:(e,n)=>n[0]}}},{Apply:{signature:{domain:"Functions",canonical:(e,n)=>n[0].symbol?e.box([n[0].symbol,...n.slice(1)]):e._fn("Apply",n),evaluate:(e,n)=>Xn(n[0],n.slice(1))}},Assign:{hold:"all",pure:!1,signature:{domain:["FunctionOf","Anything","Anything","Anything"],canonical:(e,n)=>{if(n.length!==2)return null;let i=n[0];if(!i.symbol)return null;let t=n[1];return e._fn("Assign",[i,t])},evaluate:(e,n)=>{let i=n[0],t=n[1];if(!i.symbol)return e.Nothing;let r=t.evaluate();return e.assign(i.symbol,r),r}}},Assume:{hold:"all",pure:!1,signature:{domain:["FunctionOf","Anything","Anything"],evaluate:(e,n)=>e.string(e.assume(n[0]))}},Declare:{hold:"all",pure:!1,signature:{domain:["FunctionOf","Symbols","Anything"],canonical:(e,n)=>{if(n.length!==2)return null;let i=n[0],t=n[1];return i.symbol?t.symbol?e._fn("Declare",n):e._fn("Declare",[i,e._fn("Hold",[t])]):null},evaluate:(e,n)=>{let i=n[0],t=n[1];if(!i.symbol)return e.Nothing;let r=t.evaluate();if(an(r))return e.declare(i.symbol,r),r}}},Domain:{signature:{domain:["FunctionOf","Anything","Domains"],evaluate:(e,n)=>n[0].domain}},Evaluate:{hold:"all",signature:{domain:["FunctionOf","Anything","Anything"],result:(e,n)=>n[0].domain,canonical:(e,n)=>e._fn("Evaluate",Ne(e,n,1)),evaluate:(e,n)=>n[0].evaluate()}},Function:{complexity:9876,hold:"all",signature:{domain:["FunctionOf","Anything",["VarArg","Symbols"],"Functions"],canonical:(e,n)=>n.length===0?e.box(["Sequence"]):(n.length===1?Co(n[0]):e._fn("Function",n))??null,evaluate:(e,n)=>{}}},Simplify:{hold:"all",signature:{domain:["FunctionOf","Anything","Anything"],result:(e,n)=>n[0].domain,canonical:(e,n)=>e._fn("Simplify",Ne(e,n,1)),evaluate:(e,n)=>n[0].simplify()}},CanonicalForm:{complexity:8200,hold:"all",signature:{domain:["FunctionOf","Anything",["VarArg","Symbols"],"Anything"],canonical:(e,n)=>{if(n.length===1)return n[0].canonical;let i=n.slice(1).map(t=>t.symbol??t.string).filter(t=>t!=null);return cn(n[0],i)}}},N:{hold:"all",signature:{domain:["FunctionOf","Anything","Anything"],result:(e,n)=>n[0].domain,canonical:(e,n)=>{if(n.length!==1)return e._fn("N",Ne(e,n,1));let i=n[0].head;if(i==="N")return n[0].canonical;if(i==="Integrate"){let[t,r,o]=An(n[0].op2);if(!t||r===void 0||o===void 0)return null;let s=n[0].op1;return e._fn("NIntegrate",[e.box(["Function",s,t]),e.number(r),e.number(o)])}return i==="Limit"?e._fn("NLimit",n[0].ops):e._fn("N",n)},evaluate:(e,n)=>n[0].N()}},Signatures:{signature:{domain:["FunctionOf","Symbols",["ListOf","Domains"]],canonical:(e,n)=>(n=Ne(e,n,1),n[0].symbol?e._fn("Signatures",n):e._fn("Signatures",[e.domainError("Symbols",n[0].domain,n[0])])),evaluate:(e,n)=>{let i=n[0].symbol;if(!i)return e.Nothing;let t=e.lookupFunction(i);if(!t)return e.fn("List",[]);let r=t.signature,o=[...r.params];return r.optParams.length>0&&o.push(e._fn("OptArg",r.optParams)),r.restParam&&o.push(e._fn("VarArg",[r.restParam])),typeof r.result=="function"?o.push(r.result(e,[])??e.symbol("Undefined")):o.push(r.result),e.fn("List",o)}}},Subscript:{hold:"last",signature:{domain:["FunctionOf","Anything","Anything","Anything"],result:(e,n)=>{let i=n[0],t=n[1];if(i.string&&A(t)!==null)return e.domain("Integers");if(i.symbol){let r=i.evaluate()?.head;if(r)return e.lookupFunction(r)?.at?void 0:e.domain("Symbols")}},canonical:(e,n)=>{let i=n[0],t=n[1];if(i.string){let r=A(t);if(r!==null&&r>1&&r<=36){let[o,s]=xi(i.string,r);return s?e.error(["unexpected-digit",{str:s[0]}],["LatexString",e.string(i.string)]):e.number(o)}}if(i.symbol){let r=i.evaluate()?.head;if(r&&e.lookupFunction(r)?.at)return e._fn("At",[i.canonical,t.canonical]);let o=t.string??t.symbol??A(t)?.toString();if(o)return e.symbol(i.symbol+"_"+o)}return t.head==="Sequence"&&e._fn("Subscript",[i,e._fn("List",t.ops)]),e._fn("Subscript",n)}}},Symbol:{complexity:500,description:"Construct a new symbol with a name formed by concatenating the arguments",threadable:!0,hold:"all",signature:{domain:["FunctionOf",["VarArg","Anything"],"Anything"],canonical:(e,n)=>{if(n.length===0)return e.Nothing;let i=n.map(t=>t.symbol??t.string??A(t)?.toString()??"").join("");return i.length>0?e.symbol(i):e.Nothing}}},Timing:{description:"`Timing(expr)` evaluates `expr` and return a `Pair` of the number of second elapsed for the evaluation, and the value of the evaluation",signature:{domain:["FunctionOf","Values",["OptArg","Integers"],["TupleOf","Values","Numbers"]],evaluate:(e,n)=>{if(n[1].symbol==="Nothing"){let u=globalThis.performance.now(),l=n[0].evaluate(),f=1e3*(globalThis.performance.now()-u);return e.pair(e.number(f),l)}let i=Math.max(3,Math.round(A(n[1])??3)),t=[],r;for(;i>0;){let u=globalThis.performance.now();r=n[0].evaluate(),t.push(1e3*(globalThis.performance.now()-u)),i-=1}let o=Math.max(...t),s=Math.min(...t);t=t.filter(u=>u>s&&u<o);let a=t.reduce((u,l)=>u+l,0);return a===0?e.pair(e.number(o),r):e.pair(e.number(a/t.length),r)}}}},{LatexString:{inert:!0,signature:{domain:["FunctionOf","Strings","Strings"]}},Latex:{signature:{domain:["FunctionOf",["VarArg","Anything"],"Strings"],evaluate:(e,n)=>e.fn("LatexString",[e.string(N(n.map(i=>i.latex)))])}},Parse:{description:"Parse a LaTeX string and evaluate to a corresponding expression",signature:{domain:["FunctionOf","Anything","Anything"],evaluate:(e,n)=>{if(n.length===0)return e.box(["Sequence"]);let i=n[0],t=i.string??i.head==="LatexString"?i.op1.string:"";return e.parse(t)??e.box(["Sequence"])}}}},{RandomExpression:{signature:{domain:"Functions",evaluate:(e,n)=>e.box(dn())}}}];function hr(e,n){if(n.length===0)return null;let i=n[0];if(n.length===1)return hr(e,[i.canonical]);if(n.length===2){let t=y(i);if(t!==null&&Number.isInteger(t)){let o=n[1];if(o.head==="Divide"||o.head==="Rational"){let[s,a]=[y(o.op1),y(o.op2)];if(s!==null&&a!==null&&s>0&&s<=1e3&&a>1&&a<=1e3&&Number.isInteger(s)&&Number.isInteger(a))return e.add([i.canonical,o.canonical])}}let r=n[1];if(i.symbol&&r.head==="Delimiter"&&!e.lookupSymbol(i.symbol))return e.lookupFunction(i.symbol)||e.declare(i.symbol,"Functions"),r.nops===0?e.box([i.symbol]):(r=r.op1,r.head==="Sequence"?e.box([i.symbol,...e.canonical(r.ops)]):e.box([i.symbol,r.canonical]))}return n=ee(ce(n)),n.every(t=>t.isValid&&(!t.domain||t.domain.isNumeric||_i(t)&&!t.string))?e._fn("Multiply",ie(n,"Multiply")):e._fn("Tuple",n)}function cn(e,n){if(n===!1)return e;if(n===!0)return e.canonical;typeof n=="string"&&(n=[n]);for(let i of n)switch(i){case"InvisibleOperator":e=Wo(e);break;case"Number":e=lu(e);break;case"Multiply":e=fu(e);break;case"Add":e=gr(e);break;case"Power":e=ki(e);break;case"Divide":e=du(e);break;case"Flatten":e=uu(e);break;case"Order":e=bo(e,{recursive:!0});break;default:throw Error("Invalid canonical form")}return e}function uu(e){if(!e.ops)return e;let n=e.ops.map(uu);e.head==="Delimiter"&&(n=[yo(e.engine,e.op1)]);let i=e.engine,t=e.head==="Add"||e.head==="Multiply";return t||i.lookupFunction(e.head)?.commutative&&(t=!0),t&&typeof e.head=="string"&&(e=i._fn(e.head,ie(n,e.head))),e}function Wo(e){return e.ops?e.head==="InvisibleOperator"?hr(e.engine,e.ops.map(Wo))??e:e.engine._fn(e.head,e.ops.map(Wo)):e}function lu(e){return e.numericValue?e.canonical:e.ops?e.engine._fn(e.head,e.ops.map(lu)):e}function fu(e){if(!e.ops)return e;let n=e.ops.map(fu);return e.head==="Multiply"?pt(e.engine,n):e.head==="Negate"?pt(e.engine,[e.op1,e.engine.NegativeOne]):e}function gr(e){if(!e.ops)return e;let n=e.ops.map(gr);return e.head==="Add"?or(e.engine,n):e.head==="Subtract"?e.engine._fn("Add",[gr(e.op1),gr(e.engine.neg(e.op2))]):e.engine._fn(e.head,n)}function ki(e){return e.ops?e.head==="Power"?dt(e.engine,ki(e.op1),ki(e.op2)):e.ops?e.engine._fn(e.head,e.ops.map(ki)):e:e}function du(e){return e.head==="Divide"?Ke(e.engine,ki(e.op1),ki(e.op2)):e.ops?e.engine._fn(e.head,e.ops.map(du)):e}function br(e,n,i){if(typeof n=="number"||n instanceof v)return new oe(e,n,i);if(i=i?{...i}:{},"canonical"in i||(i.canonical=!0),Array.isArray(n)&&n.length===2&&n[0]instanceof v&&n[1]instanceof v){if(!n[0].isInteger()||!n[1].isInteger())throw new Error("Array argument to `boxNumber()` should be two integers");n=[C(n[0].toString()),C(n[1].toString())]}if(U(n)){if(n.length!==2)throw new Error("Array argument to `boxNumber()` should be two integers or two bignums");let[r,o]=n;if(typeof r=="bigint"&&typeof o=="bigint")return r===o?o===BigInt(0)?e.NaN:e.One:r===BigInt(0)?e.Zero:o===BigInt(1)?e.number(r,i):o===BigInt(-1)?e.number(-r,i):r===BigInt(1)&&o===BigInt(2)?e.Half:new oe(e,[r,o],i);if(typeof r!="number"||typeof o!="number")throw new Error("Array argument to `boxNumber()` should be two integers or two bignums");if(!Number.isInteger(r)||!Number.isInteger(o))throw new Error("Array argument to `boxNumber()` should be two integers");return o===r?o===0?e.NaN:e.One:r===0?e.Zero:o===1?e.number(r,i):o===-1?e.number(-r,i):r===1&&o===2?e.Half:new oe(e,[r,o],i)}if(n instanceof xr.Complex)return n.isNaN()?e.NaN:n.isZero()?e.Zero:n.isInfinite()?e.ComplexInfinity:e.chop(n.im)===0?e.number(n.re,i):new oe(e,n,i);let t="";if(typeof n=="string")t=n;else if(typeof n=="object"&&"num"in n){if(typeof n.num=="number")return e.number(n.num,i);if(typeof n.num!="string")throw new Error("MathJSON `num` property should be a string of digits");t=n.num}if(t){if(t=t.toLowerCase(),/[0-9][nd]$/.test(t)&&(t=t.slice(0,-1)),t=t.replace(/[\u0009-\u000d\u0020\u00a0]/g,""),t==="nan")return e.NaN;if(t==="infinity"||t==="+infinity")return e.PositiveInfinity;if(t==="-infinity")return e.NegativeInfinity;if(t==="0")return e.Zero;if(t==="1")return e.One;if(t==="-1")return e.NegativeOne;if(/\([0-9]+\)/.test(t)){let[r,o,s,a]=t.match(/(.+)\(([0-9]+)\)(.+)?$/)??[];t=o+s.repeat(Math.ceil(e.precision/s.length))+(a??"")}return br(e,e.bignum(t),i)}return null}function Yo(e,n,i){if(n===null)return e.error("missing");if(typeof n=="object"&&n instanceof L)return n;if(n=j(n),typeof n=="string")return De(e,n,i);if(Array.isArray(n)){let t=n.map(r=>Yo(e,r,i));return new ye(e,t[0],t.slice(1))}if(typeof n=="object"){if("dict"in n)return new Di(e,n.dict);if("fn"in n)return Yo(e,n.fn,i);if("str"in n)return new ln(e,n.str);if("sym"in n)return De(e,n.sym,i);if("num"in n)return De(e,n.num,i)}return De(e,n,i)}function gt(e,n,i,t){if(n==="Hold")return new ye(e,"Hold",[Yo(e,i[0],t)],{...t,canonical:!0});if(n==="Error"||n==="ErrorCode")return e._fn(n,i.map(r=>e.box(r,{canonical:!1})),t.metadata);if(n==="Domain")return e.domain(i[0],t.metadata);if(n==="Number"&&i.length===1)return De(e,i[0],t);if(n==="String")return i.length===0?new ln(e,"",t.metadata):new ln(e,i.map(r=>cu(r)??"").join(""),t.metadata);if(n==="Symbol"&&i.length>0)return e.symbol(i.map(r=>cu(r)??"").join(""),t);if(t.canonical&&(n==="Divide"||n==="Rational")&&i.length===2){if(i[0]instanceof L&&i[1]instanceof L){if(e.numericMode==="machine"){let[s,a]=[y(i[0]),y(i[1])];if(s!==null&&Number.isInteger(s)&&a!==null&&Number.isInteger(a))return e.number([s,a],t)}let[r,o]=[Xi(i[0]),Xi(i[1])];if(r!==null&&o!==null)return e.number([r,o],t)}else{let[r,o]=[ho(e,i[0]),ho(e,i[1])];if(r!==null&&o!==null)return e.number([r,o],t)}n="Divide"}if(t.canonical&&n==="Complex"){if(i.length===1){let r=De(e,i[0],t),o=y(r);return o!==null&&o!==0?e.number(e.complex(0,o),t):e.mul([r,e.I])}if(i.length===2){let r=De(e,i[0],t),o=De(e,i[1],t),s=y(r),a=y(o);return a!==null&&s!==null?a===0&&s===0?e.Zero:a!==null&&a!==0?e.number(e.complex(s,a),t):r:e.add([r,e.mul([o,e.I])],t.metadata)}}if(t.canonical&&n==="Negate"&&i.length===1){let r=i[0];if(typeof r=="number")return e.number(-r,t);if(r instanceof v)return e.number(r.neg(),t);let o=e.box(r,t).numericValue;if(o!==null){if(typeof o=="number")return e.number(-o,t);if(o instanceof v)return e.number(o.neg(),t);if(o instanceof xr.Complex)return e.number(o.neg());if(U(o))return e.number(ve(o))}}if(n==="Dictionary"){let r={};for(let o of i){let s=e.box(o,{canonical:t.canonical}),a=s.head;if(a==="KeyValuePair"||a==="Pair"||a==="Tuple"&&s.nops===2){let u=s.op1;if(u.isValid&&!u.isNothing){let l=s.op2,f=u.symbol??u.string;if(!f&&(u.numericValue!==null||u.string)){let d=typeof u.numericValue=="number"?u.numericValue:A(u);d&&Number.isFinite(d)&&Number.isInteger(d)&&(f=d.toString())}f&&(r[f]=l)}}}return new Di(e,r,t)}if(n==="List"&&t.canonical){let r=i.map(a=>De(e,a)),{shape:o,dtype:s}=jo("List",r)??{};return s&&o?new ft(e,{head:n,ops:r}):e._fn(n,r)}return t.canonical?dr(e,n,i,t.metadata):new ye(e,n,i.map(r=>De(e,r,{canonical:!1})),t)}function De(e,n,i){if(n==null)return e._fn("Sequence",[]);if(n instanceof L)return cn(n,i?.canonical??!0);i=i?{...i}:{},"canonical"in i||(i.canonical=!0);let t=i.canonical===!0;if(Array.isArray(n)){if(q(n))return Number.isInteger(n[0])&&Number.isInteger(n[1])?e.number(n):cn(gt(e,"Divide",n,{canonical:t}),i.canonical);if(J(n))return e.number(n);if(typeof n[0]=="string")return cn(gt(e,n[0],n.slice(1),{canonical:t}),i.canonical);Array.isArray(n[0]);let r=n.slice(1).map(s=>De(e,s,i)),o=De(e,n[0],{canonical:!1});return cn(new ye(e,o,r),i.canonical)}if(typeof n=="number"||n instanceof xr.Complex||n instanceof v)return e.number(n);if(typeof n=="string")return n.startsWith("'")&&n.endsWith("'")?new ln(e,n.slice(1,-1)):/^[+-]?[0-9]/.test(n)?e.number(n):Yn(n)?e.domain(n):xe(n)?e.symbol(n,{canonical:t}):e.error("invalid-identifier",{str:n});if(typeof n=="object"){let r={latex:n.latex,wikidata:n.wikidata};if("dict"in n)return cn(new Di(e,n.dict,{canonical:!0,metadata:r}),i.canonical);if("fn"in n)return typeof n.fn[0]=="string"?cn(gt(e,n.fn[0],n.fn.slice(1),{canonical:t}),i.canonical):cn(new ye(e,De(e,n.fn[0],i),n.fn.slice(1).map(o=>De(e,o,i)),{metadata:r}),i.canonical);if("str"in n)return new ln(e,n.str,r);if("sym"in n)return e.symbol(n.sym,{canonical:t});if("num"in n)return e.number(n,{canonical:t})}return e.symbol("Undefined")}function cu(e){if(typeof e=="string")return e;if(e instanceof L)return e.string??e.symbol??e.toString();if(typeof e=="object"){if("str"in e)return e.str;if("fn"in e&&e.fn[0]==="String"&&typeof e.fn[1]=="string")return e.fn[1]}return Array.isArray(e)&&e[0]==="String"&&typeof e[1]=="string"?e[1]:null}var Xo=pe(le(),1);var pu=[{Abs:{wikidata:"Q3317982",threadable:!0,idempotent:!0,complexity:1200,signature:{domain:["FunctionOf","Numbers","NonNegativeNumbers"],simplify:(e,n)=>Qo(e,n[0],"simplify"),evaluate:(e,n)=>Qo(e,n[0],"evaluate"),N:(e,n)=>Qo(e,n[0],"N")}},Add:{wikidata:"Q32043",associative:!0,commutative:!0,threadable:!0,idempotent:!0,complexity:1300,hold:"all",signature:{domain:"NumericFunctions",result:(e,n)=>Ra(e,n.map(i=>i.domain)),simplify:(e,n)=>sr(e,n),evaluate:(e,n)=>No(e,n),N:(e,n)=>No(e,n,"N")}},Ceil:{description:"Rounds a number up to the next largest integer",complexity:1250,threadable:!0,signature:{domain:["FunctionOf","Numbers","Integers"],evaluate:(e,n)=>R(n[0],Math.ceil,i=>i.ceil(),i=>i.ceil(0))}},Chop:{associative:!0,threadable:!0,idempotent:!0,complexity:1200,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>R(n[0],i=>e.chop(i),i=>e.chop(i),i=>e.chop(i))}},Divide:{wikidata:"Q1226939",complexity:2500,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers","Numbers"],canonical:(e,n)=>{if(n=Me(e,n,2),n.length!==2)return e._fn("Divide",n);let[i,t]=n;return e.div(i,t)},simplify:(e,n)=>Zo(e,n[0],n[1]),evaluate:(e,n)=>Mn(n[0],n[1],(i,t)=>i/t,(i,t)=>i.div(t),(i,t)=>i.div(t))}},Exp:{wikidata:"Q168698",threadable:!0,complexity:3500,signature:{domain:["FunctionOf","Numbers","Numbers"],canonical:(e,n)=>(n=Me(e,n,1),n.length!==1?e._fn("Power",[e.E,...n]):e.pow(e.E,n[0]))}},Factorial:{description:"Factorial Function",wikidata:"Q120976",threadable:!0,complexity:9e3,signature:{domain:["FunctionOf","Numbers","Numbers"],canonical:(e,n)=>{let i=n[0];return i instanceof oe&&i.isNegative?e.neg(e._fn("Factorial",[e.neg(i)])):e._fn("Factorial",[i])},evaluate:(e,n)=>{let i=A(n[0]);if(i!==null&&i>=0)return P(e)?e.number(To(e,e.bignum(i))):e.number(Jt(i));let t=n[0].numericValue;if(t!==null&&t instanceof Xo.Complex)return e.number(t.add(1));let r=y(n[0]);if(r!==null)return e.number(bi(1+r))}}},Factorial2:{description:"Double Factorial Function",complexity:9e3,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>{let i=A(n[0]);if(i!==null)return P(e)?e.number(Ha(e,e.bignum(i))):e.number(ya(i))}}},Floor:{wikidata:"Q56860783",complexity:1250,threadable:!0,signature:{domain:["FunctionOf","Numbers","ExtendedRealNumbers"],evaluate:(e,n)=>R(n[0],Math.floor,i=>i.floor(),i=>i.floor(0))}},Gamma:{wikidata:"Q190573",complexity:8e3,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],N:(e,n)=>R(n[0],i=>bi(i),i=>Do(e,i),i=>i)}},GammaLn:{complexity:8e3,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],N:(e,n)=>R(n[0],i=>Zi(i),i=>Bo(e,i),i=>i)}},Ln:{description:"Natural Logarithm",wikidata:"Q204037",complexity:4e3,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],N:(e,n)=>R(n[0],i=>i>=0?Math.log(i):e.complex(i).log(),i=>i.isNeg()?e.complex(i.toNumber()).log():i.ln(),i=>i.log())}},Log:{description:"Log(z, b = 10) = Logarithm of base b",wikidata:"Q11197",complexity:4100,threadable:!0,signature:{domain:["FunctionOf","Numbers",["OptArg","Numbers"],"Numbers"],canonical:(e,n)=>{if(n.length===1)return e._fn("Log",[Ae(e,n[0],"Numbers")]);if(n=Me(e,n,2),n.length!==2)return e._fn("Log",n);let[i,t]=n;return t.numericValue===10?e._fn("Log",[i]):e._fn("Log",[i,t])},N:(e,n)=>n[1]===void 0?R(n[0],i=>i>=0?Math.log10(i):e.complex(i).log().div(Math.LN10),i=>i.isNeg()?e.complex(i.toNumber()).log().div(Math.LN10):v.log10(i),i=>i.log().div(Math.LN10)):Mn(n[0],n[1],(i,t)=>Math.log(i)/Math.log(t),(i,t)=>i.log(t),(i,t)=>i.log().div(typeof t=="number"?Math.log(t):t.log()))}},Lb:{description:"Base-2 Logarithm",wikidata:"Q581168",complexity:4100,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],N:(e,n)=>R(n[0],i=>i>=0?Math.log2(i):e.complex(i).log().div(Math.LN2),i=>i.isNeg()?v.log10(i):e.complex(i.toNumber()).log().div(Math.LN2),i=>i.log().div(Math.LN2))}},Lg:{description:"Base-10 Logarithm",wikidata:"Q966582",complexity:4100,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],N:(e,n)=>R(n[0],i=>i>=0?Math.log10(i):e.complex(i).log().div(Math.LN10),i=>i.isNeg()?e.complex(i.toNumber()).log().div(Math.LN10):v.log10(i),i=>i.log().div(Math.LN10))}},Mod:{description:"Modulo",wikidata:"Q1799665",complexity:2500,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers","Numbers"],evaluate:(e,n)=>{if(n.length!==2)return;let[i,t]=n,r=i.value,o=t.value;if(typeof r=="number"&&typeof o=="number")return e.number((r%o+o)%o)}}},Multiply:{wikidata:"Q40276",associative:!0,commutative:!0,idempotent:!0,complexity:2100,hold:"all",threadable:!0,signature:{domain:"NumericFunctions",simplify:(e,n)=>tu(e,n),evaluate:(e,n)=>Jo(e,n),N:(e,n)=>Jo(e,n,"N")}},Negate:{description:"Additive Inverse",wikidata:"Q715358",complexity:2e3,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],result:(e,n)=>{let i=n[0].domain;if(!i?.base)return i;let t={PositiveNumbers:"NegativeNumbers",NonNegativeNumbers:"NonPositiveNumbers",NonPositiveNumbers:"NonNegativeNumbers",NegativeNumbers:"PositiveNumbers",PositiveIntegers:"NegativeIntegers",NonNegativeIntegers:"NonPositiveIntegers",NonPositiveIntegers:"NonNegativeIntegers",NegativeIntegers:"PositiveIntegers"}[i.base];return t?e.domain(t):i},canonical:(e,n)=>(n=Me(e,n),n.length!==1?e._fn("Negate",n):e.neg(n[0])),simplify:(e,n)=>ur(e,n[0],"simplify"),evaluate:(e,n)=>ur(e,n[0],"evaluate"),N:(e,n)=>ur(e,n[0],"N"),sgn:(e,n)=>{let i=n[0].sgn;if(i!=null){if(i===0)return 0;if(i>0)return-1;if(i<0)return 1}}}},PlusMinus:{description:"Plus or Minus",wikidata:"Q120812",complexity:1200,involution:!0,signature:{domain:["FunctionOf","Values","Tuples"],evaluate:(e,n)=>{if(n.length===1)return e.fn("Pair",[n[0],e.neg(n[0])])}}},Power:{wikidata:"Q33456",commutative:!1,threadable:!0,complexity:3500,signature:{domain:["FunctionOf","Numbers","Numbers","Numbers"],canonical:(e,n)=>{if(n=Me(e,n,2),n.length!==2)return e._fn("Power",n);let[i,t]=n;return i instanceof oe&&i.isNegative?e.neg(e.pow(i,t)):e.pow(i,t)},simplify:(e,n)=>ct(e,n[0],n[1],"simplify"),evaluate:(e,n)=>ct(e,n[0],n[1],"evaluate"),N:(e,n)=>e.numericMode==="machine"&&typeof n[0].numericValue=="number"&&typeof n[1].numericValue=="number"?e.number(Math.pow(n[0].numericValue,n[1].numericValue)):ct(e,n[0],n[1],"N")}},Rational:{complexity:2400,signature:{domain:["FunctionOf","Numbers",["OptArg","Numbers"],"RationalNumbers"],canonical:(e,n)=>(n=ee(ce(n)),n.length===0?e._fn("Rational",[e.error("missing")]):n.length===1?e._fn("Rational",[Ae(e,n[0],"ExtendedRealNumbers")]):(n=ir(e,n,["Integers","Integers"]),n.length!==2||!n[0].isValid||!n[1].isValid?e._fn("Rational",n):e.div(n[0],n[1]))),simplify:(e,n)=>{if(n.length===2)return Zo(e,n[0],n[1])},evaluate:(e,n)=>{if(n.length===2){let[t,r]=[A(n[0]),A(n[1])];return t!==null&&r!==null?e.number([t,r]):void 0}let i=y(n[0].N());if(i!==null)return e.number(Ta(i))},N:(e,n)=>n.length===1?n[0]:Mn(n[0],n[1],(i,t)=>i/t,(i,t)=>i.div(t),(i,t)=>i.div(t))}},Root:{complexity:3200,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers","Numbers"],canonical:(e,n)=>{n=Me(e,n,2);let[i,t]=n;return n.length!==2||!i.isValid||!t.isValid?e._fn("Root",n):e.pow(i,e.inv(t))}}},Round:{complexity:1250,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>R(n[0],Math.round,i=>i.round(),i=>i.round(0))}},Sign:{complexity:1200,threadable:!0,signature:{domain:["FunctionOf","Numbers","Integers"],simplify:(e,n)=>{let i=n[0].sgn;if(i===0)return e.Zero;if(i===1)return e.One;if(i===-1)return e.NegativeOne},evaluate:(e,n)=>{let i=n[0].sgn;if(i===0)return e.Zero;if(i===1)return e.One;if(i===-1)return e.NegativeOne},N:(e,n)=>{let i=n[0].sgn;if(i===0)return e.Zero;if(i===1)return e.One;if(i===-1)return e.NegativeOne}}},Sqrt:{description:"Square Root",wikidata:"Q134237",complexity:3e3,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],canonical:(e,n)=>(n=ee(ce(n)),n.length!==1?e._fn("Sqrt",n):e.pow(n[0],e.Half)),simplify:(e,n)=>mt(e,n[0],"simplify"),evaluate:(e,n)=>mt(e,n[0],"evaluate"),N:(e,n)=>mt(e,n[0],"N")}},Square:{wikidata:"Q3075175",complexity:3100,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],canonical:(e,n)=>(n=ee(ce(n)),n.length!==1?e._fn("Square",n):e.pow(n[0],e.number(2)))}},Subtract:{wikidata:"Q40754",complexity:1350,threadable:!0,signature:{domain:["FunctionOf","Numbers",["OptArg","Numbers"],"Numbers"],canonical:(e,n)=>{if(n.length===1){let r=Ae(e,n[0],"Numbers");if(r.isValid)return e.neg(r)}n=Me(e,n,2);let[i,t]=n;return n.length!==2||!i.isValid||!t.isValid?e._fn("Subtract",n):e.add([i,e.neg(t)])}}}},{e:{domain:"TranscendentalNumbers",constant:!0,holdUntil:"never",value:"ExponentialE"},i:{domain:"ImaginaryNumbers",constant:!0,holdUntil:"never",flags:{imaginary:!0},value:"ImaginaryUnit"},MachineEpsilon:{domain:"RealNumbers",holdUntil:"N",constant:!0,flags:{real:!0},value:{num:Number.EPSILON.toString()}},Half:{domain:"RationalNumbers",constant:!0,holdUntil:"evaluate",value:["Rational",1,2]},ImaginaryUnit:{domain:"ImaginaryNumbers",constant:!0,holdUntil:"evaluate",wikidata:"Q193796",flags:{imaginary:!0},value:["Complex",0,1]},ExponentialE:{domain:"TranscendentalNumbers",flags:{algebraic:!1,real:!0},wikidata:"Q82435",constant:!0,holdUntil:"N",value:e=>P(e)?e._BIGNUM_ONE.exp():Math.exp(1)},GoldenRatio:{domain:"AlgebraicNumbers",wikidata:"Q41690",constant:!0,flags:{algebraic:!0},holdUntil:"simplify",value:["Divide",["Add",1,["Sqrt",5]],2]},CatalanConstant:{domain:"RealNumbers",flags:{algebraic:void 0},wikidata:"Q855282",constant:!0,holdUntil:"N",value:{num:`0.91596559417721901505460351493238411077414937428167
                  21342664981196217630197762547694793565129261151062
                  48574422619196199579035898803325859059431594737481
                  15840699533202877331946051903872747816408786590902
                  47064841521630002287276409423882599577415088163974
                  70252482011560707644883807873370489900864775113225
                  99713434074854075532307685653357680958352602193823
                  23950800720680355761048235733942319149829836189977
                  06903640418086217941101917532743149978233976105512
                  24779530324875371878665828082360570225594194818097
                  53509711315712615804242723636439850017382875977976
                  53068370092980873887495610893659771940968726844441
                  66804621624339864838916280448281506273022742073884
                  31172218272190472255870531908685735423498539498309
                  91911596738846450861515249962423704374517773723517
                  75440708538464401321748392999947572446199754961975
                  87064007474870701490937678873045869979860644874974
                  64387206238513712392736304998503539223928787979063
                  36440323547845358519277777872709060830319943013323
                  16712476158709792455479119092126201854803963934243
                  `}},EulerGamma:{domain:"RealNumbers",flags:{algebraic:void 0},wikidata:"Q273023",holdUntil:"N",constant:!0,value:{num:`0.57721566490153286060651209008240243104215933593992359880576723488486772677766
          467093694706329174674951463144724980708248096050401448654283622417399764492353
          625350033374293733773767394279259525824709491600873520394816567085323315177661
          152862119950150798479374508570574002992135478614669402960432542151905877553526
          733139925401296742051375413954911168510280798423487758720503843109399736137255
          306088933126760017247953783675927135157722610273492913940798430103417771778088
          154957066107501016191663340152278935867965497252036212879226555953669628176388
          792726801324310104765059637039473949576389065729679296010090151251959509222435
          014093498712282479497471956469763185066761290638110518241974448678363808617494
          551698927923018773910729457815543160050021828440960537724342032854783670151773
          943987003023703395183286900015581939880427074115422278197165230110735658339673`}}},{PreIncrement:{signature:{domain:["FunctionOf","Numbers","Numbers"]}},PreDecrement:{signature:{domain:["FunctionOf","Numbers","Numbers"]}}},{GCD:{description:"Greatest Common Divisor",complexity:1200,threadable:!1,signature:{domain:["FunctionOf",["VarArg","Anything"],"Numbers"],evaluate:(e,n)=>mu(e,n,"GCD")}},LCM:{description:"Least Common Multiple",complexity:1200,threadable:!1,signature:{domain:["FunctionOf",["VarArg","Anything"],"Numbers"],evaluate:(e,n)=>mu(e,n,"LCM")}},Numerator:{description:"Numerator of an expression",complexity:1200,threadable:!0,hold:"all",signature:{domain:["FunctionOf","Anything","Numbers"],canonical:(e,n)=>{if(n.length===0)return e.box(["Sequence"]);let i=n[0];if(i.head==="Rational"||i.head==="Divide")return i.op1;let t=Q(i);return t!==void 0?e.number(t[0]):e._fn("Numerator",ee(n))},evaluate:(e,n)=>{if(n.length===0)return e.box(["Sequence"]);let i=n[0];if(i.head==="Rational"||i.head==="Divide")return i.op1;let t=Q(i);return t!==void 0?e.number(t[0]):e._fn("Numerator",ee(n))}}},Denominator:{description:"Denominator of an expression",complexity:1200,threadable:!0,hold:"all",signature:{domain:["FunctionOf","Anything","Numbers"],canonical:(e,n)=>{if(n.length===0)return e.box(["Sequence"]);let i=n[0];if(i.head==="Rational"||i.head==="Divide")return i.op2;let t=Q(i);return t!==void 0?e.number(t[1]):e._fn("Denominator",ee(n))},evaluate:(e,n)=>{if(n.length===0)return e.box(["Sequence"]);let i=n[0];if(i.head==="Rational"||i.head==="Divide")return i.op2;let t=Q(i);return t!==void 0?e.number(t[1]):e._fn("Denominator",ee(n))}}},NumeratorDenominator:{description:"Sequence of Numerator and Denominator of an expression",complexity:1200,threadable:!0,hold:"all",signature:{domain:["FunctionOf","Anything","Anything"],canonical:(e,n)=>{if(n.length===0)return e.box(["Sequence"]);let i=n[0];if(i.head==="Rational"||i.head==="Divide")return e._fn("Sequence",i.ops);let t=Q(i);return t!==void 0?e._fn("Sequence",[e.number(t[0]),e.number(t[1])]):e._fn("NumeratorDenominator",ee(n))},evaluate:(e,n)=>{if(n.length===0)return e.box(["Sequence"]);let i=n[0];if(i.head==="Rational"||i.head==="Divide")return e._fn("Sequence",i.ops);let t=Q(i);return t!==void 0?e._fn("Sequence",[e.number(t[0]),e.number(t[1])]):e._fn("NumeratorDenominator",ee(n))}}}},{Max:{description:"Maximum of two or more numbers",complexity:1200,threadable:!1,signature:{domain:["FunctionOf",["VarArg","Values"],"Numbers"],simplify:(e,n)=>n.length===0?e.NegativeInfinity:n.length===1?n[0]:e.fn("Max",n),evaluate:(e,n)=>yr(e,n,"Max")}},Min:{description:"Minimum of two or more numbers",complexity:1200,threadable:!1,signature:{domain:["FunctionOf",["VarArg","Values"],"Numbers"],simplify:(e,n)=>n.length===0?e.PositiveInfinity:n.length===1?n[0]:e.fn("Min",n),evaluate:(e,n)=>yr(e,n,"Min")}},Supremum:{description:"Like Max, but defined for open sets",complexity:1200,threadable:!1,signature:{domain:["FunctionOf",["VarArg","Values"],"Numbers"],simplify:(e,n)=>n.length===0?e.NegativeInfinity:n.length===1?n[0]:e.fn("Min",n),evaluate:(e,n)=>yr(e,n,"Supremum")}},Infimum:{description:"Like Min, but defined for open sets",complexity:1200,threadable:!1,signature:{domain:["FunctionOf",["VarArg","Values"],"Numbers"],simplify:(e,n)=>n.length===0?e.PositiveInfinity:n.length===1?n[0]:e.fn("Min",n),evaluate:(e,n)=>yr(e,n,"Infimum")}},Product:{wikidata:"Q901718",complexity:1e3,hold:"all",threadable:!1,signature:{domain:["FunctionOf","Anything",["OptArg","Tuples"],"Numbers"],canonical:(e,n)=>ou(e,n[0],n[1]),simplify:(e,n)=>pr(e,n[0],n[1],"simplify"),evaluate:(e,n)=>pr(e,n[0],n[1],"evaluate"),N:(e,n)=>pr(e,n[0],n[1],"N")}},Sum:{wikidata:"Q218005",complexity:1e3,hold:"all",threadable:!1,signature:{domain:["FunctionOf",["Union","Collections","Functions"],["OptArg","Tuples"],"Numbers"],canonical:(e,n)=>qa(e,n[0],n[1]),simplify:(e,n)=>ar(e,n[0],n[1],"simplify"),evaluate:(e,n)=>ar(e,n[0],n[1],"evaluate"),N:(e,n)=>ar(e,n[0],n[1],"N")}}},{BaseForm:{description:"`BaseForm(expr, base=10)`",complexity:9e3,inert:!0,signature:{domain:["FunctionOf","Values",["OptArg","Integers"],"Values"],result:(e,n)=>n[0].domain}},FromDigits:{description:"`FromDigits(s, base=10)`       return an integer representation of the string `s` in base `base`.",signature:{domain:["FunctionOf","Strings",["OptArg","Anything"],"Integers"],evaluate:(e,n)=>{let i=n[0]?.string;if(!i)return e.domainError("Strings",n[0]?.domain,n[0]);if(i=i.trim(),i.startsWith("0x"))return e.number(parseInt(i.slice(2),16));if(i.startsWith("0b"))return e.number(parseInt(i.slice(2),2));let t=n[1]??e.Nothing;if(t.isNothing)return e.number(Number.parseInt(i,10));let r=y(t);if(r&&(!Number.isInteger(r)||r<2||r>36))return e.error(["unexpected-base",r],t);let[o,s]=xi(i,t.string??t.symbol??10);return s?e.error(["unexpected-digit",{str:s[0]}],{str:s}):e.number(o)}}},IntegerString:{description:"`IntegerString(n, base=10)`       return a string representation of the integer `n` in base `base`.",threadable:!0,signature:{domain:["FunctionOf","Integers",["OptArg","Integers"],"Strings"],evaluate:(e,n)=>{let i=n[0],t=y(i)??NaN;if(Number.isNaN(t)||!Number.isInteger(t))return e.domainError("Integers",i.domain,i);let r=n[1]??e.Nothing;if(r.isNothing){let s=i.numericValue;return typeof s=="number"?e.string(Math.abs(s).toString()):s instanceof v?e.string(s.abs().toString()):e.string(Math.abs(Math.round(y(i)??NaN)).toString())}if(A(r)===null)return e.domainError("Integers",r.domain,r);let o=A(r);return o<2||o>36?e.error(["out-of-range",2,36,o],r):e.string(Math.abs(t).toString(o))}}}}];function Qo(e,n,i){if(i!=="simplify"){let t=n.numericValue;if(t!==null){if(typeof t=="number")return e.number(Math.abs(t));if(t instanceof v||t instanceof Xo.Complex)return e.number(t.abs());if(q(t))return e.number(i==="N"?Math.abs(t[0]/t[1]):[Math.abs(t[0]),t[1]]);if(J(t)){let[r,o]=t;return e.number(i==="N"?e.bignum(r).div(e.bignum(o)).abs():[r>0?r:-r,o])}}}if(n.isNonNegative)return n;if(n.isNegative)return e.neg(n)}function hu(e,n){let i=e.engine,t=n==="Max"||n==="Supremum";if(e.head==="Interval"){let r=t?e.op2:e.op1;return!r.isNumber||r.numericValue===void 0?[void 0,[e]]:[r,[]]}if(e.head==="Range"){if(e.nops===1)e=t?e.op1:i.One;else if(!t)e=e.op1;else{let r=e.nops===2?1:y(e.op3);if(r===null||!isFinite(r))return[void 0,[e]];let[o,s]=[y(e.op1),y(e.op2)];if(o===null||s===null)return[void 0,[e]];let a=Math.floor((s-o)/r);e=i.number(o+r*a)}return[e,[]]}if(e.head==="Linspace")return e.nops===1?e=t?e.op1:i.One:t?e=e.op2:e=e.op1,[e,[]];if(Ni(e)){let r,o=[];for(let s of H(e)){let[a,u]=hu(s,n);a&&(r?(t&&a.isGreater(r)||!t&&a.isLess(r))&&(r=a):r=a),o.push(...u)}return[r,o]}return!e.isNumber||e.numericValue===void 0?[void 0,[e]]:[e,[]]}function yr(e,n,i){let t=i==="Max"||i==="Supremum";if(n.length===0)return t?e.NegativeInfinity:e.PositiveInfinity;let r,o=[];for(let s of n){let[a,u]=hu(s,i);a&&(r?(t&&a.isGreater(r)||!t&&a.isLess(r))&&(r=a):r=a),o.push(...u)}return o.length>0?e.box(r?[i,r,...o]:[i,...o]):r??(t?e.NegativeInfinity:e.PositiveInfinity)}function mu(e,n,i){let t=i==="LCM"?Ht:jn,r=i==="LCM"?Za:So,o=[];if(P(e)){let a=null;for(let u of n)if(a===null)a=$e(u),(a===null||!a.isInteger())&&o.push(u);else{let l=$e(u);l&&l.isInteger()?a=r(a,l):o.push(u)}return o.length===0?a===null?e.One:e.number(a):a===null?e._fn(i,o):e._fn(i,[e.number(a),...o])}let s=null;for(let a of n)if(s===null)s=y(a),(s===null||!Number.isInteger(s))&&o.push(a);else{let u=y(a);u&&Number.isInteger(u)?s=t(s,u):o.push(a)}return o.length===0?s===null?e.One:e.number(s):s===null?e._fn(i,o):e._fn(i,[e.number(s),...o])}var sd={Sin:["Cos","_"],Cos:["Negate",["Sin","_"]],Tan:["Power",["Sec","_"],2],Sec:["Multiply",["Tan","_"],["Sec","_"]],Csc:["Multiply",["Negate",["Cot","_"]],["Csc","_"]],Cot:["Negate",["Power",["Csc","_"],2]],Arcsin:["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],Arccos:["Negate",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]]],Arctan:["Power",["Add",1,["Power","_",2]],-1],Arcsec:["Multiply",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],["Negate",["Power","_",2]]],Arccsc:["Multiply",["Power",["Subtract",1,["Power","_",2]],["Negate","Half"]],["Negate",["Power","_",2]]],Arccot:["Negate",["Power",["Add",1,["Power","_",2]],-1]],Sinh:["Cosh","_"],Cosh:["Sinh","_"],Tanh:["Power",["Sech","_"],2],Sech:["Multiply",["Tanh","_"],"Sech"],Csch:["Multiply",["Coth","_"],"Csch"],Coth:["Negate",["Power",["Csch","_"],2]],Arcsinh:["Power",["Add",["Power","_",2],1],["Negate","Half"]],Arccosh:["Power",["Subtract",["Power","_",2],1],["Negate","Half"]],Arctanh:["Power",["Subtract",1,["Power","_",2]],-1],Arcsech:["Negate",["Power",["Multiply","2","Subtract",["Power","_",2]],["Negate","Half"]]],Arccsch:["Negate",["Power",["Multiply","2","Add",["Power","_",2]],["Negate","Half"]]],Arccoth:["Negate",["Power",["Subtract",1,["Power","_",2]],-1]],Exp:["Exp","_"],Ln:["Power","_",-1],Log:["Power",["Multiply","_",["Ln","10"]],-1],Sqrt:["Multiply",["Power","_",["Negate","Half"]],"Half"],Abs:["Piecewise",["Tuple",["Multiply","_",["Power","_",-1]],["Greater","_",0]]],Erf:["Multiply",["Divide","2",["Sqrt","Pi"]],["Exp",["Negate",["Square","_"]]]],Gamma:["Multiply",["Gamma","_"],["Digamma","_"]],Digamma:["Add",["Multiply",["Digamma","_"],["Gamma","_"]],["Multiply",["Power","_",-1],["Gamma","_"]]],Zeta:["Multiply",["Multiply",-1,["Zeta","_"]],["Digamma","_"]],PolyGamma:["Add",["Multiply",["PolyGamma","_"],["Gamma","_"]],["Multiply",["Power","_",-1],["Gamma","_"]]],Beta:["Multiply",["Add",["Multiply",["Beta","_"],["Digamma","_"]],["Multiply",["Power","_",-1],["Beta","_"]]],["Beta","_"]],Erfc:["Multiply",["Negate",["Erfc","_"]],["Exp",["Negate",["Power","_",2]]],["Power","_",-1]],LambertW:["Multiply",["Power","_",-1],["Multiply",["Add","_",["LambertW","_"]],["Add",["LambertW","_"],1]]],AiryAi:["Multiply",["AiryAi","_"],["AiryBi","_"]],AiryBi:["Multiply",["AiryAi","_"],["AiryBi","_"]],BesselJ:["Multiply",["BesselJ","_"],["BesselY","_"]],BesselY:["Multiply",["BesselJ","_"],["BesselY","_"]],BesselI:["Multiply",["BesselI","_"],["BesselK","_"]],BesselK:["Multiply",["BesselI","_"],["BesselK","_"]],FresnelS:["Multiply",["FresnelS","_"],["FresnelC","_"]],FresnelC:["Multiply",["FresnelS","_"],["FresnelC","_"]],Erfi:["Multiply",["Erfi","_"],["Erf","_"]]};function Ue(e,n){let i=e.engine;if(!(e.string||e.keys)){if(e.numericValue!==null)return e.engine.Zero;if(e.symbol===n)return e.engine.One;if(e.symbol)return e.engine.Zero;if(e.head&&typeof e.head=="string"){if(e.head==="Negate"){let s=Ue(e.op1,n);return s?i.neg(s):i.neg(i._fn("D",[e.op1,i.symbol(n)]))}if(e.head==="Add"){let s=e.ops.map(a=>Ue(a,n));return s.some(a=>a===void 0)?void 0:i.add(s)}if(e.head==="Multiply"){let s=e.ops.map((a,u)=>{let l=e.ops.slice();l.splice(u,1);let f=i.mul(l),d=Ue(a,n)??i._fn("D",[a,i.symbol(n)]);return i.mul([d,f])});return s.some(a=>a===void 0)?void 0:i.add(s)}if(e.head==="Power"){let[s,a]=e.ops;if(s.symbol===n)return i.mul([a,i.pow(s,i.add([a,i.NegativeOne]))])}if(e.head==="Divide"){let[s,a]=e.ops,u=Ue(s,n)??i._fn("D",[s,i.symbol(n)]),l=Ue(a,n)??i._fn("D",[a,i.symbol(n)]);return i.div(i.add([i.mul([u,a]),i.neg(i.mul([l,s]))]),i.pow(a,2))}let t=sd[e.head];if(!t){let s=i._fn("Derivative",[i.symbol(e.head),i.number(1)]),a=e.ops[0],u=Ue(a,n)??i._fn("D",[a,i.symbol(n)]);return i.mul([i._fn("Apply",[s,a]),u])}if(e.nops>1)return i._fn("D",[e,i.symbol(n)]);let r=e.ops[0],o=Ue(r,n)??i._fn("D",[r,i.symbol(n)]);return i.mul([Xn(i.box(t),[r]),o])}}}var gu=[{Derivative:{hold:"all",threadable:!1,signature:{domain:["FunctionOf","Functions",["OptArg","Numbers"],"Functions"],canonical:(e,n)=>n[0].functionDefinition?Ue(e._fn(n[0].canonical,[e.symbol("_")]),"_")?.canonical??e._fn("Derivative",n):e._fn("Derivative",n),simplify:(e,n)=>{let i=n[0].simplify();return n[1]?e._fn("Derivative",[i,n[1]]):e._fn("Derivative",[i])},evaluate:(e,n)=>{let i=n[0].evaluate();if(i.functionDefinition)return Ue(e._fn(i,[e.symbol("_")]),"_")?.canonical??void 0;let t=Ue(i,"_");if(t)return t.canonical}}},D:{hold:"all",threadable:!1,signature:{domain:["FunctionOf","Anything","Symbols",["VarArg","Symbols"],"Anything"],canonical:(e,n)=>{let i=n[0];if(!i)return null;e.pushScope();let t=n.slice(1);i.bind(),i=i.canonical;let r=e._fn("D",[i,...t]);return e.popScope(),r},evaluate:(e,n)=>{let i=n[0].canonical,t=e.swapScope(i.scope);i=i.evaluate();let r=n.slice(1);r.length===0&&(i=void 0);for(let o of r){if(!o.symbol){i=void 0;break}if(i=Ue(i,o.symbol),i===void 0)break}return e.swapScope(t),i=i?.canonical,i?.head==="D"?i:i?.evaluate()}}},ND:{hold:"first",threadable:!1,signature:{domain:["FunctionOf","Anything","Numbers","Functions"],N:(e,n)=>{let i=n[1]?.value;if(typeof i!="number")return;let t=Ao(e.box(n[0]));return e.number(va(t,i))}}},Integrate:{wikidata:"Q80091",hold:"all",threadable:!1,signature:{domain:["FunctionOf","Functions",["OptArg",["Union","Tuples","Symbols"]],"Numbers"],canonical:(e,n)=>{let i=n[1],t=null,r=null,o=null;i&&i.head!=="Tuple"&&i.head!=="Triple"&&i.head!=="Pair"&&i.head!=="Single"?t=i:i&&(t=i.ops?.[0]??null,r=i.ops?.[1]?.canonical??null,o=i.ops?.[2]?.canonical??null),t&&t.head==="Hold"&&(t=t.op1),t&&t.head==="ReleaseHold"&&(t=t.op1.evaluate()),t??(t=e.Nothing),t.symbol||(t=e.domainError("Symbols",t.domain,t)),r&&(r=Ae(e,r,e.Numbers)),o&&(o=Ae(e,o,e.Numbers)),r&&o?i=e.tuple([t,r,o]):o?i=e.tuple([t,e.NegativeInfinity,o]):r?i=e.tuple([t,r]):i=t;let s=n[0]??e.error("missing");return s=s.canonical,s.head==="Delimiter"&&s.op1.head==="Sequence"&&(s=s.op1.op1),e._fn("Integrate",[s,i])}}},NIntegrate:{hold:"first",threadable:!1,signature:{domain:["FunctionOf","Functions","Numbers","Numbers","Numbers"],evaluate:(e,n)=>{let i=e.numericMode,t=e.precision;e.numericMode="machine";let r=Ao(n[0]),[o,s]=n.slice(1).map(u=>u.value),a;return typeof o=="number"&&typeof s=="number"&&(a=e.number(Na(r,o,s))),e.numericMode=i,e.precision=t,a}}}},{Limit:{description:"Limit of a function",complexity:5e3,hold:"all",threadable:!1,signature:{domain:["FunctionOf","Anything","Numbers",["OptArg","Numbers"],"Numbers"],N:(e,n)=>{let[i,t,r]=n,o=y(t.N());if(o===null)return;let s=Kn(i);return e.number(Un(a=>{let u=s([e.number(a)])?.value;return typeof u=="number"?u:Number.NaN},o,r?y(r)??1:1))}}},NLimit:{description:"Numerical approximation of the limit of a function",complexity:5e3,hold:"all",threadable:!1,signature:{domain:["FunctionOf","Anything","Numbers",["OptArg","Numbers"],"Numbers"],evaluate:(e,n)=>{let[i,t,r]=n,o=y(t.N());if(o===null)return;let s=Kn(i);return e.number(Un(a=>{let u=s([e.number(a)])?.value;return typeof u=="number"?u:Number.NaN},o,r?y(r)??1:1))}}}}];var Er=50,bu={List:{complexity:8200,hold:"all",signature:{domain:["FunctionOf",["VarArg","Anything"],"Lists"],canonical:ud},size:e=>e.nops,iterator:(e,n,i)=>{let t=n??1;return i=Math.min(i??e.nops,e.nops),i<=0?{next:()=>({value:void 0,done:!0})}:{next:()=>i>0?(i--,{value:e.ops[t++-1],done:!1}):{value:void 0,done:!0}}},at:(e,n)=>{if(typeof n=="number"&&!(n<1||n>e.nops))return e.ops[n-1]},indexOf:(e,n,i)=>{if(i??(i=1),i<0){if(i<-e.nops)return;i=e.nops+i+1;let r=i;for(let o=r;o>=1;o--)if(e.ops[o-1].isEqual(n))return o;return}let t=i;for(let r=t;r<=e.nops;r++)if(e.ops[r-1].isEqual(n))return r}},Range:{complexity:8200,signature:{domain:["FunctionOf","Numbers",["OptArg","Numbers","Numbers"],"Values"]},size:e=>{let[n,i,t]=_r(e);return!isFinite(n)||!isFinite(i)?1/0:1+Math.max(0,Math.floor((i-n)/t))},at:(e,n)=>{if(typeof n!="number")return;let[i,t,r]=_r(e);if(!(n<1||n>1+(t-i)/r))return e.engine.number(i+r*(n-1))},iterator:(e,n,i)=>{let[t,r,o]=_r(e),s=n??1;return i=Math.min(i??r,r),i<=0?{next:()=>({value:void 0,done:!0})}:{next:()=>i>0?(i--,{value:e.engine.number(t+o*(s++-1)),done:!1}):{value:void 0,done:!0}}}},Linspace:{complexity:8200,signature:{domain:["FunctionOf","Numbers",["OptArg","Numbers","Numbers"],"Values"]},size:e=>{let n=y(e.op3)??Er;return Math.max(0,Math.floor(n))},at:(e,n)=>{if(typeof n!="number")return;let i=y(e.op1),t=y(e.op2),r=y(e.op3)??Er;if(!(i===void 0||t===void 0)&&!(n<1||n>r))return e.engine.number(i+(t-i)*(n-1)/r)},iterator:(e,n,i)=>{let t=y(e.op1),r=y(e.op2),o;r===void 0?(r=t,t=1,o=Er):o=Math.max(0,y(e.op3)??Er);let s=n??1;return i=Math.min(i??o,o),i<=0?{next:()=>({value:void 0,done:!0})}:{next:()=>i>0?(i--,{value:e.engine.number(t+(r-t)*(s++-1)/o),done:!1}):{value:void 0,done:!0}}}},KeyValuePair:{description:"A key/value pair",complexity:8200,signature:{domain:["FunctionOf","Strings","Anything","Tuples"],canonical:(e,n)=>{let[i,t]=ir(e,n,[e.Strings,"Values"]);return!i.isValid||!t.isValid?e._fn("KeyValuePair",[i,t]):e.tuple([i,t])}},size:e=>1},Single:{description:"A tuple with a single element",complexity:8200,signature:{domain:["FunctionOf","Anything","Tuples"],canonical:(e,n)=>e.tuple(Ne(e,n,1))},size:e=>e.nops,at:(e,n)=>{if(!(typeof n!="number"||n!==1))return e.ops[0]}},Pair:{description:"A tuple of two elements",complexity:8200,signature:{domain:["FunctionOf","Anything","Anything","Tuples"],canonical:(e,n)=>e.tuple(Ne(e,n,2))},size:e=>e.nops,at:(e,n)=>typeof n=="number"?e.ops[n-1]:void 0},Triple:{description:"A tuple of three elements",complexity:8200,signature:{domain:["FunctionOf","Anything","Anything","Anything","Tuples"],canonical:(e,n)=>e.tuple(Ne(e,n,3))},size:e=>e.nops,at:(e,n)=>typeof n=="number"?e.ops[n-1]:void 0},Tuple:{description:"A fixed number of heterogeneous elements",complexity:8200,signature:{domain:["FunctionOf","Anything",["VarArg","Anything"],"Tuples"],canonical:(e,n)=>e.tuple(ee(n))},size:e=>e.nops,at:(e,n)=>typeof n=="number"?e.ops[n-1]:void 0},String:{threadable:!0,signature:{domain:["FunctionOf",["OptArg","Anything"],"Strings"],evaluate:(e,n)=>n.length===0?e.string(""):e.string(n.map(i=>i.string??i.toString()).join(""))}},Length:{complexity:8200,signature:{domain:["FunctionOf","Values","Numbers"],evaluate:(e,n)=>{let i=n[0].functionDefinition;if(i?.size)return e.number(i.size(n[0]));let t=n[0].string;return t!==null?e.number(t.length):e.Zero}}},IsEmpty:{complexity:8200,signature:{domain:["FunctionOf","Values","Numbers"],evaluate:(e,n)=>{let i=n[0].functionDefinition,t;if(i?.size)t=i.size(n[0]);else{let r=n[0].string;r!==null&&(t=r.length)}if(t!==void 0)return t===0?e.True:e.False}}},Take:{complexity:8200,signature:{domain:["FunctionOf","Values",["VarArg","Values"],"Values"],evaluate:(e,n)=>{if(n.length<2)return;let i=n[0].string;if(i!==null){let o=n.slice(1).map(s=>vr(s,i.length));return e.string(ad(i,o))}let r=n[0].functionDefinition?.size?.(n[0]);return Nr(n[0],n.slice(1).map(o=>vr(o,r)))}}},Drop:{complexity:8200,signature:{domain:["FunctionOf","Values",["VarArg","Values"],"Values"],evaluate:(e,n)=>{if(n.length<2)return;let i=n[0].string;if(i!==null){let a=xu(n.slice(1).map(u=>vr(u,i.length)));return e.string(i.split("").filter((u,l)=>!a.includes(l+1)).join(""))}let t=n[0].functionDefinition,r=t?.size?.(n[0]);if(!r||!t?.at)return e.Nothing;let o=xu(n.slice(1).map(a=>vr(a,r))),s=[];for(let a=1;a<=r;a++)if(!o.includes(a)){let u=t.at(n[0],a);u&&s.push(u)}return e.fn("List",s)}}},At:{complexity:8200,signature:{domain:["FunctionOf","Values","Values","Values"],evaluate:(e,n)=>{let i=n[0],t=i.functionDefinition;if(!t?.at)return;if(n[1].string!==null)return t.at(i,1)??e.Nothing;let o=y(n[1]);if(!(o===null||!Number.isInteger(o)))return t.at(i,o)??e.Nothing}}},First:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0],t=i.functionDefinition;return t?.at?t.at(i,1)??e.Nothing:e.Nothing}}},Second:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0],t=i.functionDefinition;return t?.at?t.at(i,2)??e.Nothing:e.Nothing}}},Last:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0],t=i.functionDefinition;return t?.at?t.at(i,-1)??e.Nothing:e.Nothing}}},Rest:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>Nr(n[0],[[2,-1,1]])}},Most:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>Nr(n[0],[[1,-2,1]])}},Reverse:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>Nr(n[0],[[-1,2,1]])}},Ordering:{complexity:8200,signature:{domain:["FunctionOf","Values",["OptArg","Functions"],"Values"],evaluate:(e,n)=>{}}},Sort:{complexity:8200,signature:{domain:["FunctionOf","Values",["OptArg","Functions"],"Values"],evaluate:(e,n)=>{}}},Shuffle:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{}}},Map:{complexity:8200,signature:{domain:["FunctionOf","Collections","Functions","Collections"],evaluate:(e,n)=>{}}},Filter:{complexity:8200,signature:{domain:["FunctionOf","Values","Functions","Values"],evaluate:(e,n)=>{}}},Reduce:{complexity:8200,signature:{domain:["FunctionOf","Values","Functions",["OptArg","Values"],"Values"],evaluate:(e,n)=>{}}},Tabulate:{complexity:8200,signature:{domain:["FunctionOf","Functions","Integers",["VarArg","Integers"],"Values"],evaluate:(e,n)=>{}}},Tally:{complexity:8200,signature:{domain:["FunctionOf","Values","Tuples"],evaluate:(e,n)=>{}}},Unique:{complexity:8200,signature:{domain:["FunctionOf","Values","Tuples"],evaluate:(e,n)=>{}}},Zip:{complexity:8200,signature:{domain:["FunctionOf","Values",["VarArg","Values"],"Values"],evaluate:(e,n)=>{}}},RotateLeft:{complexity:8200,signature:{domain:["FunctionOf","Values",["OptArg","Integers"],"Values"],evaluate:(e,n)=>{}}},RotateRight:{complexity:8200,signature:{domain:["FunctionOf","Values",["OptArg","Integers"],"Values"],evaluate:(e,n)=>{}}},Join:{complexity:8200,signature:{domain:["FunctionOf",["VarArg","Values"],"Values"],evaluate:(e,n)=>{}}},Iterate:{complexity:8200,signature:{domain:["FunctionOf","Values",["OptArg","Values"],"Values"],evaluate:(e,n)=>{}}},Repeat:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{}}},Cycle:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{}}},Fill:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{}}}};function _r(e){let n=y(e.op1)??1,i=y(e.op2);if(i===void 0)return[1,n,1];let t=y(e.op3)??1;return[n,i,t]}function vr(e,n){if(!e)return[0,0,0];let i=y(e);if(i!==null){if(i=Math.round(i),i<0){if(n===void 0)return[0,0,0];i=n+i+1}return[i,i,1]}let t=e.head;if(!t||typeof t!="string"||!/^(Single|Pair|Triple|Tuple|)$/.test(t))return[0,0,0];let[r,o,s]=_r(e);return(r<0||o<0)&&n===void 0?[0,0,0]:(r<0&&(r=n+r+1),o<0&&(o=n+o+1),s=Math.abs(Math.round(s)),s===0?[0,0,0]:(r>o&&(s=-s),[r,o,s]))}function Nr(e,n){let i=e.engine,t=e.functionDefinition;if(!t?.at)return i.Nothing;let r=[];for(let o of n){let[s,a,u]=o;if(u!==0)if(u<0)for(let l=s;l>=a;l+=u){let f=t.at(e,l);f&&r.push(f)}else for(let l=s;l<=a;l+=u){let f=t.at(e,l);f&&r.push(f)}}return i.fn("List",r)}function ad(e,n){let i="";for(let t of n){let[r,o,s]=t;if(s===1)i+=e.slice(r-1,o);else if(s<0)for(let a=r;a>=o;a+=s)i+=e[a-1];else for(let a=r;a<=o;a+=s)i+=e[a-1]}return i}function xu(e){let n=[];for(let i of e){let[t,r,o]=i;if(o!==0)if(o<0)for(let s=t;s>=r;s+=o)n.push(s);else for(let s=t;s<=r;s+=o)n.push(s)}return n}function ud(e,n){let i=n[0];if(n.length===1&&i.head==="Matrix"){let[t,r,o]=i.ops;if(!r||r.string==="..")return o?e._fn("Matrix",[t,e.string("[]"),o]):e._fn("Matrix",[t,r])}return n=n.map(t=>t.head==="Delimiter"?t.op1.head==="Sequence"?e.box(["List",...ee(t.op1.ops)]):e.box(["List",t.op1?.canonical??e.Nothing]):t.canonical),e.box(["List",...n])}var yu=[{Block:{hold:"all",signature:{domain:"Functions",canonical:cd,evaluate:dd}},If:{hold:"rest",signature:{domain:"Functions",result:(e,n)=>On(n[0],n[1]),evaluate:(e,n)=>{let i=n[0];return i&&i.symbol==="True"?n[1]?n[1].evaluate():e.Nothing:n[2]?n[2].evaluate():e.Nothing}}},Loop:{hold:"all",signature:{domain:"Functions",evaluate:(e,n)=>{let i=n[0]??e.Nothing;if(i.isNothing)return i;let t=n[1];if(t&&Ni(t)){let o,s=Kn(i),a=0;for(let u of H(t)){if(o=s([u])??e.Nothing,o.head==="Break")return o.op1;if(o.head==="Return")return o;if(a++>e.iterationLimit)return e.error("iteration-limit-exceeded")}}let r=0;for(;;){let o=i.evaluate();if(o.head==="Break")return o.op1;if(o.head==="Return")return o;if(r++>e.iterationLimit)return e.error("iteration-limit-exceeded")}}}},Which:{hold:"all",signature:{domain:"Functions",result:(e,n)=>ld(e,n),evaluate:(e,n)=>fd(e,n,"evaluate")}},FixedPoint:{hold:"all",signature:{domain:"Functions"}}}];function ld(e,n){let i=null;for(let t=1;t<=n.length-1;t+=2)i=On(i,n[t].domain);return i??e.domain("NothingDomain")}function fd(e,n,i){let t=0;for(;t<n.length-1;){if(n[t].evaluate().symbol==="True")return n[t+1]?i==="N"?n[t+1].N():n[t+1].evaluate():e.symbol("Undefined");t+=2}return e.symbol("Undefined")}function dd(e,n){if(n.length===0)return e.Nothing;e.resetContext();let i;for(let t of n){let r=t.head;if(r==="Return"){i=t.op1.evaluate();break}if(r==="Break"||r==="Continue"){i=e.fn(r,[t.op1.evaluate()]);break}i=t.evaluate()}return i??e.Nothing}function cd(e,n){if(n.length===0)return null;e.pushScope();let i=[],t=[];for(let o of n)o.head==="Declare"?i.push(o):t.push(Eu(o));let r=e._fn("Block",[...i,...t]);return e.popScope(),r}function Eu(e){return e.head==="Declare"&&e.engine.error("unexpected-declare"),e.ops?e.engine._fn(e.head,e.ops.map(Eu)):e}var vu=[{Real:{threadable:!0,complexity:1200,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>{let i=n[0].numericValue;if(i!==null)return e.isComplex(i)?e.number(i.re):n[0]}}},Imaginary:{threadable:!0,complexity:1200,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>{let i=n[0].numericValue;if(i!==null)return e.isComplex(i)?e.number(i.im):e.Zero}}},Argument:{threadable:!0,complexity:1200,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>{let i=n[0].numericValue;if(i===null)return;if(e.isComplex(i))return e.number(i.arg());let t=y(n[0]);if(t!==null)return t>=0?e.Zero:e.number(Math.PI)}}},AbsArg:{threadable:!0,complexity:1200,signature:{domain:["FunctionOf","Numbers","Tuples"],evaluate:(e,n)=>{let i=n[0].numericValue;if(i===null)return;if(e.isComplex(i))return e.tuple([e.number(i.abs()),e.number(i.arg())]);let t=y(n[0]);if(t!==null)return e.tuple([e.number(Math.abs(t)),e.number(t>=0?0:Math.PI)])}}},Conjugate:{threadable:!0,complexity:1200,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>{let i=n[0].numericValue;if(!(i===null||!e.isComplex(i)))return e.number(i.conjugate())}}},ComplexRoots:{threadable:!0,complexity:1200,signature:{domain:["FunctionOf","Numbers","Numbers","Lists"],evaluate:(e,n)=>{let i=y(n[0]),t=y(n[1]);if(i===null||t===null||!Number.isInteger(t)||t<=0)return;let r=[],[o,s]=e.isComplex(i)?[i.re,i.im]:[i,0],a=Math.atan2(s,o),u=Math.sqrt(o*o+s*s);for(let l=0;l<t;l++){let f=(a+2*Math.PI*l)/t,d=Math.pow(u,1/t);r.push([d*Math.cos(f),d*Math.sin(f)])}return e.box(["List",...r.map(l=>e.number(l[1]!==0?e.complex(l[0],l[1]):l[0]))])}}}}];var Nu=[{Matrix:{complexity:9e3,hold:"all",signature:{params:["Lists"],optParams:["Strings","Strings"],result:"Lists",canonical:md,evaluate:(e,n)=>n[0].evaluate(),N:(e,n)=>n[0].N()}},Vector:{complexity:9e3,hold:"all",signature:{restParam:"Anything",result:"Lists",canonical:(e,n)=>e._fn("Matrix",[e.box(["List",...e.canonical(n).map(i=>e.box(["List",i]))])])}}},{Shape:{complexity:8200,signature:{domain:["FunctionOf","Values","Tuples"],evaluate:(e,n)=>{let i=n[0];return Pe(i)?e.tuple(i.tensor.shape):e.tuple([])}}},Rank:{complexity:8200,signature:{domain:["FunctionOf","Values","Numbers"],evaluate:(e,n)=>{let i=n[0];return Pe(i)?e.number(i.tensor.rank):e.number(0)}}},Reshape:{complexity:8200,signature:{domain:["FunctionOf","Values","Tuples","Values"],evaluate:(e,n)=>{let i=n[0],t=n[1].ops?.map(r=>r.value)??[];if(!Pe(i)&&te(i)&&(i=e.box(["List",...H(i)])),Pe(i))return i.tensor.reshape(...t).expression}}},Flatten:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0];if(Pe(i))return e.box(["List",...i.tensor.flatten().map(t=>e.box(t))]);if(te(i))return e.box(["List",...H(i)])}}},Transpose:{complexity:8200,signature:{domain:["FunctionOf","Values",["OptArg","Numbers","Numbers"],"Values"],evaluate:(e,n)=>{let i=n[0],t=1,r=2;if(n.length===3&&(t=n[1].value,r=n[2].value,t>0&&r>0),t!==r&&(!Pe(i)&&te(i)&&(i=e.box(["List",...H(i)])),Pe(i)))return t===1&&r===2?i.tensor.transpose()?.expression:i.tensor.transpose(t,r)?.expression}}},ConjugateTranspose:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0],t=1,r=2;if(n.length===3&&(t=n[1].value,r=n[2].value,t>0&&r>0),t!==r&&Pe(i))return i.tensor.conjugateTranspose(t,r)?.expression}}},Determinant:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0];if(Pe(i))return i.tensor.determinant()}}},Inverse:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0];if(Pe(i))return i.tensor.inverse()?.expression}}},PseudoInverse:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0];if(Pe(i))return i.tensor.pseudoInverse()?.expression}}},AdjugateMatrix:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0];if(Pe(i))return i.tensor.adjugateMatrix()?.expression}}},Trace:{complexity:8200,signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0];if(Pe(i))return i.tensor.trace()}}}}];function md(e,n,i="Matrix"){if(n.length===0)return e._fn(i,[]);let t=n[0].head==="Vector"?n[0].canonical.ops[0]:n[0].canonical,r=n[1]?.canonical,o=n[2]?.canonical;return n.length>3?e._fn(i,Ne(e,n,3)):o?e._fn(i,[t,r,o]):r?e._fn(i,[t,r]):e._fn(i,[t])}var Iu={True:{wikidata:"Q16751793",domain:"Booleans",constant:!0},False:{wikidata:"Q5432619",domain:"Booleans",constant:!0},And:{wikidata:"Q191081",threadable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:{domain:"LogicOperators",simplify:_u,evaluate:_u}},Or:{wikidata:"Q1651704",threadable:!0,associative:!0,commutative:!0,idempotent:!0,complexity:1e4,signature:{domain:"LogicOperators",simplify:Su,evaluate:Su}},Not:{wikidata:"Q190558",threadable:!0,involution:!0,complexity:10100,signature:{domain:"LogicOperators",simplify:Tu,evaluate:Tu}},Equivalent:{wikidata:"Q220433",threadable:!0,complexity:10200,signature:{domain:"LogicOperators",canonical:(e,n)=>{let i=n[0].symbol,t=n[1].symbol;return i==="True"&&t==="True"||i==="False"&&t==="False"?e.True:i==="True"&&t==="False"||i==="False"&&t==="True"?e.False:e._fn("Equivalent",n)},simplify:Bu,evaluate:Bu}},Implies:{wikidata:"Q7881229",threadable:!0,complexity:10200,signature:{domain:"LogicOperators",simplify:Du,evaluate:Du}},Exists:{signature:{domain:"Functions"}}};function _u(e,n){if(n.length===0)return e.True;let i=[];for(let t of n){if(t.symbol==="False")return e.False;if(t.symbol!=="True"){let r=!1;for(let o of i)if(o.isSame(t))r=!0;else if(t.head==="Not"&&t.op1.isSame(o)||o.head==="Not"&&o.op1.isSame(t))return e.False;r||i.push(t)}}return i.length===0?e.True:i.length===1?i[0]:e._fn("And",i)}function Su(e,n){if(n.length===0)return e.True;let i=[];for(let t of n){if(t.symbol==="True")return e.True;if(t.symbol!=="False"){let r=!1;for(let o of i)if(o.isSame(t))r=!0;else if(t.head==="Not"&&t.op1.isSame(o)||o.head==="Not"&&o.op1.isSame(t))return e.True;r||i.push(t)}}return i.length===0?e.True:i.length===1?i[0]:e._fn("Or",i)}function Tu(e,n){let i=n[0]?.symbol;if(i==="True")return e.False;if(i==="False")return e.True}function Bu(e,n){let i=n[0].symbol,t=n[1].symbol;if(i==="True"&&t==="True"||i==="False"&&t==="False")return e.True;if(i==="True"&&t==="False"||i==="False"&&t==="True")return e.False}function Du(e,n){let i=n[0].symbol,t=n[1].symbol;if(i==="True"&&t==="True"||i==="False"&&t==="False"||i==="False"&&t==="True")return e.True;if(i==="True"&&t==="False")return e.False}var ku=[{Expand:{description:"Expand out products and positive integer powers",signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>_n(n[0])??n[0]}},Distribute:{description:"Distribute multiplication over addition",signature:{domain:["FunctionOf","Values","Values"],evaluate:(e,n)=>{let i=n[0].head;if(i==="Multiply")return Bi(n[0].ops)??n[0];if(i==="Negate")return Bi([e.NegativeOne,...n[0].ops])??n[0];if(i==="Divide"&&n[0].ops[0].head==="Multiply"){let t=Bi(n[0].ops),r=n[0].ops[1];if(t)return t.head==="Add"?e.add(t.ops.map(o=>e.div(o,r))).evaluate():e.div(t,r).evaluate()}return n[0]}}}}];var wu={Congruent:{commutative:!1,complexity:11e3,numeric:!0,signature:{simplify:(e,n)=>{if(!(n.length<3))return e._fn("Equal",[e.box(["Mod",n[0],n[2]]).simplify(),e.box(["Mod",n[1],n[2]]).simplify()]).simplify()},evaluate:(e,n)=>{if(n.length<3)return;let[i,t,r]=n,o=i.value,s=t.value,a=r.value;if(typeof o=="number"&&typeof s=="number"&&typeof a=="number")return o%a===s%a?e.True:e.False}}},IsSame:{description:"Compare two expressions for structural equality",hold:"all",signature:{domain:"RelationalOperators",evaluate:(e,n)=>{if(n.length!==2)return;let[i,t]=n;return i.isSame(t)===!0?e.True:e.False}}},Equal:{commutative:!0,complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"Equal",n),evaluate:(e,n)=>{if(n.length<2)return e.True;let i;for(let t of n)if(!i)i=t;else if(i.isEqual(t)!==!0)return e.False;return e.True}}},NotEqual:{wikidata:"Q28113351",commutative:!0,complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"NotEqual",n),evaluate:(e,n)=>{if(n.length<2)return e.False;let i;for(let t of n)if(!i)i=t;else if(i.isEqual(t)===!0)return e.False;return e.True}}},Less:{complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"Less",n),evaluate:(e,n)=>{if(n.length<2)return e.True;let i;for(let t of n){if(!t.isNumber)return;if(!i)i=t;else{let r=e.fn("Subtract",[t,i]).N().sgn;if(r==null)return;if(r<=0)return e.False;i=t}}return e.True}}},NotLess:{complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"Less",n)])}},Greater:{complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"Less",n.reverse()),evaluate:(e,n)=>{if(n.length<2)return e.True;let i;for(let t of n){if(!t.isNumber)return;if(!i)i=t;else{let r=e.fn("Subtract",[t,i]).N().sgn;if(r==null)return;if(r>=0)return e.False;i=t}}return e.True}}},NotGreater:{complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[e._fn("Greater",n)])}},LessEqual:{complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"LessEqual",n),evaluate:(e,n)=>{if(n.length<2)return e.True;let i;for(let t of n){if(!t.isNumber)return;if(!i)i=t;else{let r=e.fn("Subtract",[t,i]).N().sgn;if(r==null)return;if(r<0)return e.False;i=t}}return e.True}}},NotLessNotEqual:{complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"LessEqual",n)])}},GreaterEqual:{complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"LessEqual",n.reverse()),evaluate:(e,n)=>{if(n.length<2)return e.True;let i;for(let t of n){if(!t.isNumber)return;if(!i)i=t;else{let r=e.fn("Subtract",[t,i]).N().sgn;if(r==null)return;if(r>0)return e.False;i=t}}return e.True}}},NotGreaterNotEqual:{complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"GreaterEqual",n)])}},TildeFullEqual:{description:"Indicate isomorphism, congruence and homotopic equivalence",signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"TildeFullEqual",n)}},NotTildeFullEqual:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"TildeFullEqual",n)])}},TildeEqual:{description:"Approximately or asymptotically equal",complexity:11e3,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"TildeEqual",n)}},NotTildeEqual:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"TildeEqual",n)])}},Approx:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"Approx",n)}},NotApprox:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"Approx",n)])}},ApproxEqual:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"ApproxEqual",n)}},NotApproxEqual:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"ApproxEqual",n)])}},ApproxNotEqual:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"ApproxNotEqual",n)}},NotApproxNotEqual:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"ApproxNotEqual",n)])}},Precedes:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"Precedes",n)}},NotPrecedes:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"Precedes",n)])}},Succeeds:{signature:{domain:"RelationalOperators",canonical:(e,n)=>se(e,"Succeeds",n)}},NotSucceeds:{complexity:11100,signature:{domain:"RelationalOperators",canonical:(e,n)=>e._fn("Not",[se(e,"Succeeds",n)])}}};function se(e,n,i){i=ie(ce(ee(i)),n);let t=[],r=[];for(let o of i)pd(o)?(t.push(o),r.push(o.ops[o.ops.length-1])):r.push(o);return r=r.map(o=>Aa(e,o)),t.length===0?e._fn(n,r):e._fn("And",[e._fn(n,r),...t])}function pd(e){return typeof e.head=="string"&&/Equal|NotEqual|Less|NotLess|Greater|NotGreater|LessEqual|NotLessNotEqual|GreaterEqual|NotGreater|NotEqual|TildeFullEqual|NotTildeFullEqual|TildeEqual|NotTildeEqual|Approx|NotApprox|ApproxEqual|NotApproxEqual|ApproxNotEqual|NotApproxNotEqual|Precedes|NotPrecedes|Succeeds|NotSucceeds/.test(e.head)}var Cu={EmptySet:{domain:"Sets",constant:!0,wikidata:"Q226183"},Element:{complexity:11200,hold:"all",signature:{domain:"Predicates",canonical:(e,n)=>(n=Ne(e,n,2),n.length===2&&n[0].isValid&&an(n[1])?e._fn("Element",[n[0],e.domain(n[1])]):e._fn("Element",n)),evaluate:(e,n)=>bd(e,n)}},NotElement:{complexity:11200,hold:"all",signature:{domain:"Predicates",canonical:(e,n)=>e.fn("Not",[e.fn("Element",n)])}},Subset:{complexity:11200,signature:{domain:"Predicates"}},NotSubset:{complexity:11200,signature:{domain:"Predicates",canonical:(e,n)=>e.fn("Not",[e.fn("Subset",n)])}},Superset:{complexity:11200,signature:{domain:"Predicates"}},SupersetEqual:{complexity:11200,signature:{domain:"Predicates"}},NotSuperset:{complexity:11200,signature:{domain:"Predicates",canonical:(e,n)=>e.fn("Not",[e.fn("Superset",n)])}},NotSupersetEqual:{complexity:11200,signature:{domain:"Predicates",canonical:(e,n)=>e.fn("Not",[e.fn("SupersetEqual",n)])}},SubsetEqual:{complexity:11200,signature:{domain:"Predicates"}},NotSubsetNotEqual:{complexity:11200,signature:{domain:"Predicates",canonical:(e,n)=>e.fn("Not",[e.fn("SubsetEqual",n)])}},CartesianProduct:{wikidata:"Q173740",signature:{domain:["FunctionOf","Sets",["VarArg","Sets"],"Sets"]}},Complement:{wikidata:"Q242767",signature:{domain:["FunctionOf","Sets","Sets"]}},Intersection:{wikidata:"Q185837",associative:!0,commutative:!0,involution:!0,signature:{domain:["FunctionOf","Collections",["VarArg","Collections"],"Sets"],canonical:(e,n)=>n.length===0||n.length===1?e.symbol("EmptySet"):e._fn("Intersection",n),evaluate:gd}},Union:{wikidata:"Q185359",associative:!0,commutative:!0,involution:!0,signature:{domain:["FunctionOf","Collections",["VarArg","Collections"],"Sets"],canonical:(e,n)=>n.length===0?e.symbol("EmptySet"):e._fn("Union",n),evaluate:hd}},SetMinus:{wikidata:"Q18192442",signature:{domain:["FunctionOf","Sets","Values","Sets"],evaluate:xd}},SymmetricDifference:{wikidata:"Q1147242",signature:{domain:["FunctionOf","Sets",["VarArg","Sets"],"Sets"]}}};function hd(e,n){let i=[];for(let t of n)if(te(t))for(let r of H(t))i.every(o=>!o.isEqual(r))&&i.push(r);else i.every(r=>!r.isEqual(t))&&i.push(t);return i.length===0?e.symbol("EmptySet"):e._fn("Set",i)}function gd(e,n){let i=n[0].ops??[];for(let t of n.slice(1))te(t)?i=i.filter(r=>[...H(t)].some(o=>r.isEqual(o))):i=i.filter(r=>r.isEqual(t));return i.length===0?e.symbol("EmptySet"):e._fn("Set",i)}function xd(e,n){return e.symbol("EmptySet")}function bd(e,n){n.length;let[i,t]=n;if(t.string)return i.string&&t.string.includes(i.string)?e.True:e.False;if(t.keys){if(i.string){for(let r of t.keys)if(r===i.string)return e.True}return e.False}if(t.head==="List"){if(i.head==="List"){let o=!1;for(let s=0;s<1+(t.nops-i.nops);++s){o=!0;for(let a=0;a<i.nops;++a)if(!t.ops[s+a].isEqual(i.ops[a])){o=!1;break}if(o)return e.True}return e.False}let r=i.head==="Hold"?i.op1:i;for(let o of t.ops)if(r.isEqual(o))return e.True;return e.False}return an(t)&&i.domain?i.domain.isCompatible(e.domain(t))?e.True:e.False:e._fn("Element",[i,t])}var Mu=[{Mean:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Numbers"],evaluate:(e,n)=>{let i=0,t=0;for(let r of H(n[0])){let o=y(r);if(o===null)return;i+=o,t++}return t===0?e.NaN:e.number(i/t)}}},Median:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Numbers"],evaluate:(e,n)=>{let i=[];for(let r of H(n[0])){let o=y(r);if(o===null)return;i.push(o)}if(i.length===0)return e.NaN;i.sort((r,o)=>r-o);let t=Math.floor(i.length/2);return i.length%2===0?e.number((i[t-1]+i[t])/2):e.number(i[t])}}},Variance:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Numbers"],evaluate:(e,n)=>{let i=0,t=0,r=0;for(let o of H(n[0])){let s=y(o);if(s===null)return;i+=s,t+=s*s,r++}return r===0?e.NaN:e.number((t-i*i/r)/(r-1))}}},StandardDeviation:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Numbers"],evaluate:(e,n)=>{let i=0,t=0,r=0;for(let o of H(n[0])){let s=y(o);if(s===null)return;i+=s,t+=s*s,r++}return r===0?e.NaN:e.number(Math.sqrt((t-i*i/r)/(r-1)))}}},Kurtosis:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Numbers"],evaluate:(e,n)=>{let i=0,t=0,r=0,o=0;for(let u of H(n[0])){let l=y(u);if(l===null)return;i+=l,t+=l*l,r+=l*l*l*l,o++}if(o===0)return e.NaN;let s=(t-i*i/o)/(o-1),a=(r-t*t/o)/(o-1);return e.number((a/(s*s)-3)*(o*(o+1))/6)}}},Skewness:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Numbers"],evaluate:(e,n)=>{let i=0,t=0,r=0,o=0;for(let u of H(n[0])){let l=y(u);if(l===null)return;i+=l,t+=l*l,r+=l*l*l,o++}if(o===0)return e.NaN;let s=(t-i*i/o)/(o-1),a=(r-t*i/o)/(o-1);return e.number(a/Math.pow(s,3/2)*Math.sqrt(o*1))}}},Mode:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Numbers"],evaluate:(e,n)=>{let i=[];for(let s of H(n[0])){let a=y(s);if(a===null)return;i.push(a)}if(i.length===0)return e.NaN;i.sort((s,a)=>s-a);let t={};for(let s of i)t[s]=(t[s]??0)+1;let r=0,o=i[0];for(let s of i){let a=t[s];a>r&&(r=a,o=s)}return e.number(o)}}},Quartiles:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Lists"],evaluate:(e,n)=>{let i=[];for(let s of H(n[0])){let a=y(s);if(a===null)return;i.push(a)}if(i.length===0)return e.NaN;i.sort((s,a)=>s-a);let t=Math.floor(i.length/2),r=i.slice(0,t),o=i.slice(t+1);return e.box(["List",e.number(i[t]),e.number(r[Math.floor(r.length/2)]),e.number(o[Math.floor(o.length/2)])])}}},InterquartileRange:{complexity:1200,threadable:!1,signature:{domain:["FunctionOf","Collections","Numbers"],evaluate:(e,n)=>{let i=[];for(let s of H(n[0])){let a=y(s);if(a===null)return;i.push(a)}if(i.length===0)return e.NaN;i.sort((s,a)=>s-a);let t=Math.floor(i.length/2),r=i.slice(0,t),o=i.slice(t+1);return e.number(o[Math.floor(o.length/2)]-r[Math.floor(r.length/2)])}}},Erf:{complexity:7500,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>{let i=y(n[0]);if(i!==null)return e.number(mo(i))}}},Erfc:{complexity:7500,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>{let i=y(n[0]);if(i!==null)return e.number(1-mo(i))}}},ErfInv:{complexity:7500,signature:{domain:["FunctionOf","Numbers","Numbers"],evaluate:(e,n)=>{let i=y(n[0]);if(i!==null)return e.number(Ea(i))}}}}];var Sn=e=>["FunctionOf","Numbers","ExtendedRealNumbers"],Sr=e=>["FunctionOf","Numbers","Numbers"],Ln=e=>["FunctionOf","Numbers","Numbers"],Au=[{Pi:{domain:"TranscendentalNumbers",flags:{algebraic:!1},constant:!0,holdUntil:"N",wikidata:"Q167",value:e=>P(e)?e._BIGNUM_PI:Math.PI}},{Degrees:{signature:{domain:["FunctionOf","Numbers","Numbers"],canonical:(e,n)=>{if(n=Me(e,n,1),n.length!==1)return e._fn("Degrees",n);let i=n[0];if(i.numericValue===null||!i.isValid)return e._fn("Degrees",n);let t=y(i);if(t!==null){if(t=t%360,t<0&&(t+=360),Number.isInteger(t)){let r=En([t,180]);return r[0]===0?e.number(0):r[0]===1&&r[1]===1?e.Pi:r[0]===1?e.div(e.Pi,e.number(r[1])):e.mul([e.number(r),e.Pi])}return e.mul([e.div(e.number(t),e.number(180)),e.Pi])}return e.div(e.mul([i,e.Pi]),e.number(180))},evaluate:(e,n)=>e.mul([n[0],e.div(e.Pi,e.number(180))]).evaluate()}},Hypot:{threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers","NonNegativeNumbers"],simplify:(e,n)=>e.box(["Sqrt",["Add",["Square",n[0]],["Square",n[1]]]]).simplify(),evaluate:["Function",["Sqrt",["Add",["Square","_1"],["Square","_2"]]]]}},Sin:{complexity:5e3,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],simplify:(e,n)=>Ee(e,"Sin",n[0])?.simplify()??(K(e)?e.box(["Divide",["Subtract",["Exp",["Multiply","ImaginaryUnit",n[0]]],["Exp",["Multiply","ImaginaryUnit",["Negate",n[0]]]]],["Complex",0,2]]).simplify():void 0),evaluate:(e,n)=>I(e,"evaluate","Sin",n[0]),N:(e,n)=>I(e,"N","Sin",n[0])}}},{Arctan:{wikidata:"Q2257242",complexity:5200,threadable:!0,signature:{domain:Sn("Arctan"),simplify:(e,n)=>Ee(e,"Arctan",n[0])?.simplify(),evaluate:(e,n)=>I(e,"evaluate","Arctan",n[0]),N:(e,n)=>I(e,"N","Arctan",n[0])}},Arctan2:{wikidata:"Q776598",complexity:5200,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers","Numbers"],N:(e,n)=>Mn(n[0],n[1],Math.atan2,(i,t)=>v.atan2(i,t))}},Cos:{complexity:5050,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],simplify:(e,n)=>Ee(e,"Cos",n[0])?.simplify()??e.box(["Sin",["Add",n[0],["Multiply","Half","Pi"]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Cos",n[0]),N:(e,n)=>I(e,"N","Cos",n[0])}},Tan:{complexity:5100,threadable:!0,signature:{domain:Sr("Tan"),simplify:(e,n)=>Ee(e,"Tan",n[0])?.simplify()??e.box(["Divide",["Sin",n[0]],["Cos",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Tan",n[0]),N:(e,n)=>I(e,"N","Tan",n[0])}}},{Arcosh:{complexity:6200,threadable:!0,signature:{domain:Ln("Arcosh"),simplify:(e,n)=>Ee(e,"Arcosh",n[0])?.simplify()??e.box(["Ln",["Add",n[0],["Sqrt",["Subtract",["Square",n[0]],1]]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Arcosh",n[0]),N:(e,n)=>I(e,"N","Arcosh",n[0])}},Arcsin:{complexity:5500,threadable:!0,signature:{domain:Ln("Arcsin"),simplify:(e,n)=>Ee(e,"Arcsin",n[0])?.simplify()??e.box(["Multiply",2,["Arctan2",n[0],["Add",1,["Sqrt",["Subtract",1,["Square",n[0]]]]]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Arcsin",n[0]),N:(e,n)=>I(e,"N","Arcsin",n[0])}},Arsinh:{complexity:6100,threadable:!0,signature:{domain:Ln("Arsinh"),simplify:(e,n)=>Ee(e,"Arsinh",n[0])?.simplify()??e.box(["Ln",["Add",n[0],["Sqrt",["Add",["Square",n[0]],1]]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Arsinh",n[0]),N:(e,n)=>I(e,"N","Arsinh",n[0])}},Artanh:{complexity:6300,threadable:!0,signature:{domain:Ln("Artanh"),simplify:(e,n)=>Ee(e,"Artanh",n[0])?.simplify()??e.box(["Multiply","Half",["Ln",["Divide",["Add",1,n[0]],["Subtract",1,n[0]]]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Artanh",n[0]),N:(e,n)=>I(e,"N","Artanh",n[0])}},Cosh:{complexity:6050,threadable:!0,signature:{domain:Ln("Cosh"),simplify:(e,n)=>Ee(e,"Cosh",n[0])?.simplify()??e.box(["Multiply","Half",["Add",["Exp",n[0]],["Exp",["Negate",n[0]]]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Cosh",n[0]),N:(e,n)=>I(e,"N","Cosh",n[0])}},Cot:{complexity:5600,threadable:!0,signature:{domain:Sr("Cot"),simplify:(e,n)=>Ee(e,"Cot",n[0])?.simplify()??e.box(["Divide",["Cos",n[0]],["Sin",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Cot",n[0]),N:(e,n)=>I(e,"N","Cot",n[0])}},Csc:{description:"Cosecant",complexity:5600,threadable:!0,signature:{domain:Sr("Csc"),simplify:(e,n)=>Ee(e,"Csc",n[0])?.simplify()??e.box(["Divide",1,["Sin",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Csc",n[0]),N:(e,n)=>I(e,"N","Csc",n[0])}},Haversine:{wikidata:"Q2528380",threadable:!0,signature:{domain:["FunctionOf","ExtendedRealNumbers","Numbers"],evaluate:["Divide",["Subtract",1,["Cos","_1"]],2]}},InverseHaversine:{threadable:!0,signature:{domain:["FunctionOf","ExtendedRealNumbers","RealNumbers"],evaluate:["Multiply",2,["Arcsin",["Sqrt","_1"]]]}},Sec:{description:"Secant, inverse of cosine",complexity:5500,threadable:!0,signature:{domain:Sr("Sec"),simplify:(e,n)=>Ee(e,"Sec",n[0])?.simplify()??e.box(["Divide",1,["Cos",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Sec",n[0]),N:(e,n)=>I(e,"N","Sec",n[0])}},Sinh:{complexity:6e3,threadable:!0,signature:{domain:Ln("Sinh"),simplify:(e,n)=>Ee(e,"Sinh",n[0])?.simplify()??e.box(["Multiply","Half",["Subtract",["Exp",n[0]],["Exp",["Negate",n[0]]]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Sinh",n[0]),N:(e,n)=>I(e,"N","Sinh",n[0])}}},{Csch:{complexity:6200,threadable:!0,signature:{domain:Sn("Csch"),simplify:(e,n)=>Ee(e,"Csch",n[0])?.simplify()??e.box(["Divide",1,["Sinh",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Csch",n[0]),N:(e,n)=>I(e,"N","Csch",n[0])}},Sech:{complexity:6200,threadable:!0,signature:{domain:["FunctionOf","Numbers","Numbers"],simplify:(e,n)=>Ee(e,"Sech",n[0])?.simplify()??e.box(["Divide",1,["Cosh",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Sech",n[0]),N:(e,n)=>I(e,"N","Sech",n[0])}},Tanh:{complexity:6200,threadable:!0,signature:{domain:Ln("Tanh"),simplify:(e,n)=>Ee(e,"Tanh",n[0])?.simplify()??e.box(["Divide",["Sinh",n[0]],["Cosh",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Tanh",n[0]),N:(e,n)=>I(e,"N","Tanh",n[0])}}},{Arccos:{complexity:5550,threadable:!0,signature:{domain:Sn("Arccos"),simplify:(e,n)=>Ee(e,"Arccos",n[0])?.simplify()??e.box(["Subtract",["Divide","Pi",2],["Arcsin",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Arccos",n[0]),N:(e,n)=>I(e,"N","Arccos",n[0])}},Arccot:{numeric:!0,threadable:!0,signature:{domain:Sn("Arccot"),evaluate:(e,n)=>I(e,"evaluate","Arccot",n[0]),N:(e,n)=>I(e,"N","Arccot",n[0])}},Arcoth:{numeric:!0,threadable:!0,signature:{domain:Sn("Arcoth"),evaluate:(e,n)=>I(e,"evaluate","Arcoth",n[0]),N:(e,n)=>I(e,"N","Arcoth",n[0])}},Arcsch:{numeric:!0,threadable:!0,signature:{domain:Sn("Arcsch"),evaluate:(e,n)=>I(e,"evaluate","Arcsch",n[0]),N:(e,n)=>I(e,"N","Arcsch",n[0])}},Arcsec:{numeric:!0,threadable:!0,signature:{domain:Sn("Arcsec"),evaluate:(e,n)=>I(e,"evaluate","Arcsec",n[0]),N:(e,n)=>I(e,"N","Arcsec",n[0])}},Arsech:{numeric:!0,threadable:!0,signature:{domain:Sn("Arsech"),evaluate:(e,n)=>I(e,"evaluate","Arsech",n[0]),N:(e,n)=>I(e,"N","Arsech",n[0])}},Arccsc:{numeric:!0,threadable:!0,signature:{domain:Sn("Arccsc"),evaluate:(e,n)=>I(e,"evaluate","Arccsc",n[0]),N:(e,n)=>I(e,"N","Arccsc",n[0])}},Coth:{complexity:6300,threadable:!0,signature:{domain:Ln("Coth"),simplify:(e,n)=>Ee(e,"Coth",n[0])?.simplify()??e.box(["Divide",1,["Tanh",n[0]]]).simplify(),evaluate:(e,n)=>I(e,"evaluate","Coth",n[0]),N:(e,n)=>I(e,"N","Coth",n[0])}},InverseFunction:{signature:{domain:["FunctionOf","Functions","Functions"],canonical:(e,n)=>(n=Ne(e,n,1),Ko(e,n)??e._fn("InverseFunction",n)),simplify:(e,n)=>Ko(e,n),evaluate:(e,n)=>Ko(e,n)}}}],Rn=["Sqrt",2],wi=["Sqrt",3],Ci=["Sqrt",5],Tr=["Sqrt",6],yd=[[[0,1],{Sin:0,Cos:1,Tan:0,Cot:"ComplexInfinity",Sec:1,Csc:"ComplexInfinity"}],[[1,12],{Sin:["Divide",["Subtract",Tr,Rn],4],Cos:["Divide",["Add",Tr,Rn],4],Tan:["Subtract",2,wi],Cot:["Add",2,wi],Sec:["Subtract",Tr,Rn],Csc:["Add",Tr,Rn]}],[[1,10],{Sin:["Divide",["Subtract",Ci,1],4],Cos:["Divide",["Sqrt",["Add",10,["Multiply",2,Ci]]],4],Tan:["Divide",["Sqrt",["Subtract",25,["Multiply",10,Ci]]],5],Cot:["Sqrt",["Add",5,["Multiply",2,Ci]]],Sec:["Divide",["Sqrt",["Subtract",50,["Multiply",10,Ci]]],5],Csc:["Add",1,Ci]}],[[1,8],{Sin:"$\\frac{\\sqrt{2-\\sqrt2}}{2}$",Cos:"$\\frac{\\sqrt {2+{\\sqrt {2}}}}{2}$",Tan:"$\\sqrt{2} - 1$",Cot:"$\\sqrt{2} + 1$",Sec:"$\\sqrt{ 4 - 2\\sqrt{2}}$",Csc:"$\\sqrt{ 4 + 2\\sqrt{2}}$"}],[[1,6],{Sin:"$\\frac{1}{2}$",Cos:"$\\frac{\\sqrt{3}}{2}$",Tan:"$\\frac{\\sqrt{3}}{3}$",Cot:"$\\sqrt{3}$",Sec:"$\\frac{2\\sqrt{3}}{3}$",Csc:2}],[[1,5],{Sin:"$\\frac{\\sqrt{10- 2\\sqrt{5}}} {4}$",Cos:"$\\frac{1+ \\sqrt{5}} {4}$",Tan:"$\\sqrt{5-2\\sqrt5}$",Cot:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Sec:"$\\sqrt{5} - 1$",Csc:"$\\frac{\\sqrt{50+10\\sqrt{5}}} {5}$"}],[[1,4],{Sin:["Divide",Rn,2],Cos:["Divide",Rn,2],Tan:1,Cot:1,Sec:Rn,Csc:Rn}],[[3,10],{Sin:"$\\frac{1+ \\sqrt5} {4}$",Cos:"$\\frac{\\sqrt{10- 2\\sqrt5}} {4}$",Tan:"$\\frac{\\sqrt{25+10\\sqrt5}} {5}$",Cot:"$\\sqrt{5-2\\sqrt5}$",Sec:"$\\frac{\\sqrt{50+10\\sqrt5}} {5}$",Csc:"$\\sqrt5-1$"}],[[1,3],{Sin:["Divide",wi,2],Cos:"Half",Tan:wi,Cot:["Divide",wi,3],Sec:2,Csc:["Divide",["Multiply",2,wi],3]}],[[3,8],{Sin:"$\\frac{ \\sqrt{2 + \\sqrt{2}} } {2}$",Cos:"$\\frac{ \\sqrt{2 - \\sqrt{2}} } {2}$",Tan:"$\\sqrt{2} + 1$",Cot:"$\\sqrt{2} - 1$",Sec:"$\\sqrt{ 4 + 2 \\sqrt{2} }$",Csc:"$\\sqrt{ 4 - 2 \\sqrt{2} }$"}],[[2,5],{Sin:"$\\frac{\\sqrt{10+ 2\\sqrt{5}}} {4}$",Cos:"$\\frac{\\sqrt{5}-1} {4}$",Tan:"$\\sqrt{5+2\\sqrt{5}}$",Cot:"$\\frac{\\sqrt{25-10\\sqrt{5}}} {5}$",Sec:"$1 + \\sqrt{5}$",Csc:"$\\frac{\\sqrt{50-10\\sqrt{5}}} {5}$"}],[[5,12],{Sin:"$\\frac{\\sqrt{6} + \\sqrt{2}} {4}$",Cos:"$\\frac{ \\sqrt{6} - \\sqrt{2}} {4}$",Tan:"$2+\\sqrt{3}$",Cot:"$2-\\sqrt{3}$",Sec:"$\\sqrt{6}+\\sqrt{2}$",Csc:"$\\sqrt{6} - \\sqrt{2}$"}],[[1,2],{Sin:1,Cos:0,Tan:"ComplexInfinity",Cot:0,Sec:"ComplexInfinity",Csc:1}]],Ed={Sin:[[1,"Sin"],[1,"Cos"],[-1,"Sin"],[-1,"Cos"]],Cos:[[1,"Cos"],[-1,"Sin"],[-1,"Cos"],[1,"Sin"]],Sec:[[1,"Sec"],[-1,"Csc"],[-1,"Sec"],[1,"Csc"]],Csc:[[1,"Csc"],[1,"Sec"],[-1,"Csc"],[-1,"Sec"]],Tan:[[1,"Tan"],[-1,"Cot"],[1,"Tan"],[-1,"Cot"]],Cot:[[1,"Cot"],[-1,"Tan"],[1,"Cot"],[-1,"Tan"]]};function Ee(e,n,i){if(!i)return;let t=e.cache("constructible-trigonometric-values",()=>yd.map(([u,l])=>[u,Object.fromEntries(Object.entries(l).map(([f,d])=>[f,e.parse(Ei(d))??e.box(d)]))]),u=>{for(let[l,f]of u)for(let d of Object.values(f))d.reset();return u}),r=y(i.N());if(r===null)return;let o=n!=="Cos"&&n!=="Sec"?Math.sign(r):1;r=Math.abs(r%(2*Math.PI));let s=Math.floor(r*2/Math.PI);r=r%(Math.PI/2);let a;[a,n]=Ed[n]?.[s]??[1,n];for(let[[u,l],f]of t){let d=f[n];if(d&&e.chop(r-Math.PI*u/l)===0)return d.symbol==="ComplexInfinity"?d:o*a<0?re(d):d}}function Ko(e,n){if(n.length!==1||!n[0].isValid)return;let i=n[0],t=i.symbol;if(typeof t!="string")return;if(t==="InverseFunction")return i.op1;let r={Sin:"Arcsin",Cos:"Arccos",Tan:"Arctan",Sec:"Arcsec",Csc:" Arccsc",Sinh:"Arsinh",Cosh:"Arcosh",Tanh:"Artanh",Sech:"Arcsech",Csch:"Arcsch",Arcosh:"Cosh",Arccos:"Cos",Arccsc:"Csc",Arcsch:"Csch",Arcsec:"Sec",Arcsin:"Sin",Arsinh:"Sinh",Arctan:"Tan",Artanh:"Tanh"}[t];return r?e.symbol(r):void 0}function I(e,n,i,t){if(!t)return;let r=Ee(e,i,t)?.evaluate({numericMode:n==="N"});if(r)return r;if(!(n==="evaluate"&&t.isExact))switch(i){case"Arccos":return R(t,Math.acos,o=>o.acos(),o=>o.acos());case"Arccot":return R(t,o=>Math.atan2(1,o),o=>v.atan2(e._BIGNUM_ONE,o),o=>o.inverse().atan());case"Arccsc":return R(t,o=>Math.asin(1/o),o=>e._BIGNUM_ONE.div(o).asin(),o=>o.inverse().asin());case"Arcosh":return R(t,Math.acosh,o=>o.acosh(),o=>o.acosh());case"Arcoth":return R(t,o=>o,o=>o.acosh(),o=>o.acosh());case"Arcsch":return R(t,o=>Math.log(1/o+Math.sqrt(1/(o*o)+1)),o=>e._BIGNUM_ONE.div(o.mul(o)).add(e._BIGNUM_ONE).sqrt().add(e._BIGNUM_ONE.div(o)).log(),o=>o.mul(o).inverse().add(1).sqrt().add(o.inverse()).log());case"Arcsec":return R(t,o=>Math.acos(1/o),o=>e._BIGNUM_ONE.div(o).acos(),o=>o.inverse().acos());case"Arcsin":return R(t,Math.asin,o=>o.asin(),o=>o.asin());case"Arsech":return R(t,o=>Math.log((1+Math.sqrt(1-o*o))/o),o=>e._BIGNUM_ONE.sub(o.mul(o).add(e._BIGNUM_ONE).div(o)).log(),o=>e.complex(1).sub(o.mul(o)).add(1).div(o).log());case"Arsinh":return R(t,Math.asinh,o=>o.asinh(),o=>o.asinh());case"Arctan":return R(t,Math.atan,o=>o.atan(),o=>o.atan());case"Artanh":return R(t,Math.atanh,o=>o.atanh(),o=>o.atanh());case"Cos":return R(t,Math.cos,o=>o.toSignificantDigits(e.precision+4).cos().toSignificantDigits(e.precision),o=>o.cos());case"Cosh":return R(t,Math.cosh,o=>o.cosh(),o=>o.cosh());case"Cot":return R(t,o=>1/Math.tan(o),o=>e._BIGNUM_ONE.div(o.tan()),o=>o.tan().inverse());case"Coth":return R(t,o=>1/Math.tanh(o),o=>e._BIGNUM_ONE.div(o.tanh()),o=>o.tanh().inverse());case"Csc":return R(t,o=>1/Math.sin(o),o=>e._BIGNUM_ONE.div(o.sin()),o=>o.sin().inverse());case"Csch":return R(t,o=>1/Math.sinh(o),o=>e._BIGNUM_ONE.div(o.sinh()),o=>o.sinh().inverse());case"Sec":return R(t,o=>1/Math.cos(o),o=>e._BIGNUM_ONE.div(o.cos()),o=>o.cos().inverse());case"Sech":return R(t,o=>1/Math.cosh(o),o=>e._BIGNUM_ONE.div(o.cosh()),o=>o.cosh().inverse());case"Sin":return R(t,Math.sin,o=>o.toSignificantDigits(e.precision+4).sin().toSignificantDigits(e.precision),o=>o.sin());case"Sinh":return R(t,Math.sinh,o=>o.sinh(),o=>o.sinh());case"Tan":return R(t,Math.tan,o=>o.toSignificantDigits(e.precision+4).tan().toSignificantDigits(e.precision),o=>o.tan());case"Tanh":return R(t,Math.tanh,o=>o.tanh(),o=>o.tanh())}}var Ou=pe(le(),1);var ae=class{constructor(n,i,t){if(!n.context)throw Error("No context available");this.name=i,this.wikidata=t.wikidata,this.description=t.description,this.url=t.url,this._engine=n,this.scope=n.context,this.name=i,this._flags=t.flags?xt(t.flags):void 0,this._domain=t.domain?n.domain(t.domain):void 0,this.inferredDomain=t.inferred??!1,this.constant=t.constant??!1,this.holdUntil=t.holdUntil??"evaluate",this.constant?(this._defValue=t.value,this._value=null):(t.value?yi(t.value)?this._value=n.parse(t.value)??n.symbol("Undefined"):typeof t.value=="function"?this._value=n.box(t.value(n)??"Undefined"):t.value instanceof L?this._value=t.value:this._value=n.box(t.value):this._value=void 0,!this._value&&this._domain&&!t.flags&&(this._flags=Br(this._domain))),this._value&&!this._domain&&(this._domain=this._value.domain,this.inferredDomain=!0)}update(n){n.wikidata&&(this.wikidata=n.wikidata),n.description&&(this.description=n.description),n.url&&(this.url=n.url);let i=n?.flags,t=n?.domain?this._engine.domain(n.domain):void 0;t&&(i={...Br(t),...i??{}}),i&&(this._flags=xt(i)),t&&(this._domain=t,this.inferredDomain=!1),n.holdUntil&&(this.holdUntil=n.holdUntil),n.constant?(this.constant=n.constant,this._defValue=n.value,this._value=null):n.value&&(yi(n.value)?this._value=this._engine.parse(n.value)??this._engine.symbol("Undefined"):typeof n.value=="function"?this._value=this._engine.box(n.value(this._engine)??"Undefined"):n.value instanceof L?this._value=n.value:this._value=this._engine.box(n.value)),this._value&&!this._domain&&(this._domain=this._value.domain,this.inferredDomain=!0)}reset(){this.constant&&(this._value=null)}get value(){if(this._value===null){let n=this._engine;if(yi(this._defValue)?this._value=n.parse(this._defValue)??n.symbol("Undefined"):typeof this._defValue=="function"?this._value=n.box(this._defValue(n)??"Undefined"):this._defValue?this._value=n.box(this._defValue):this._value=void 0,this._value?.numericValue){let i=this._value.numericValue;!P(n)&&i instanceof v?this._value=n.number(i.toNumber()):!K(n)&&i instanceof Ou.Complex&&(this._value=n.NaN)}}return this._value??void 0}set value(n){if(this.constant)throw new Error(`The value of the constant "${this.name}" cannot be changed`);if(this._defValue,typeof n=="number")this._value=this._engine.number(n);else if(n){let i=this._engine.box(n);this.inferredDomain?(this._value=i,this._domain=On(this._domain,i.domain)):!this._domain||!i.domain||i.domain?.isCompatible(this._domain)?this._value=i:this._value=void 0}else this._value=void 0;this._value!==void 0?this._flags=void 0:this._flags=Br(this._domain)}get domain(){return this._domain??void 0}set domain(n){if(this.constant)throw new Error(`The domain of the constant "${this.name}" cannot be changed`);if(!this.inferredDomain)throw Error(`The domain of "${this.name}" cannot be changed because it has already been declared`);if(!n){this._defValue=void 0,this._value=void 0,this._flags=void 0,this._domain=void 0;return}if(n=this._engine.domain(n),this._domain&&!n.isCompatible(this._domain))throw Error(`The domain of "${this.name}" cannot be widened from "${this._domain.base}" to "${n.base}"`);if(this._value?.domain&&!this._value.domain.isCompatible(n))throw Error(`The domain of "${this.name}" cannot be changed to "${n.base}" because its value has a domain of "${this._value.domain.base}"`);this._domain=n,this._flags=void 0,this._value===void 0&&n.isNumeric&&(this._flags=Br(n))}get number(){return this.value?.isNumber??this._flags?.number}set number(n){this.updateFlags({number:n})}get integer(){return this.value?.isInteger??this._flags?.integer}set integer(n){this.updateFlags({integer:n})}get rational(){return this.value?.isRational??this._flags?.rational}set rational(n){this.updateFlags({rational:n})}get algebraic(){return this.value?.isAlgebraic??this._flags?.algebraic}set algebraic(n){this.updateFlags({algebraic:n})}get real(){return this.value?.isReal??this._flags?.real}set real(n){this.updateFlags({real:n})}get extendedReal(){return this.value?.isExtendedReal??this._flags?.extendedReal}set extendedReal(n){this.updateFlags({extendedReal:n})}get complex(){return this.value?.isComplex??this._flags?.complex}set complex(n){this.updateFlags({complex:n})}get extendedComplex(){return this.value?.isExtendedComplex??this._flags?.extendedComplex}set extendedComplex(n){this.updateFlags({extendedComplex:n})}get imaginary(){return this.value?.isImaginary??this._flags?.imaginary}set imaginary(n){this.updateFlags({imaginary:n})}get positive(){return this.value?.isPositive??this._flags?.positive}set positive(n){this.updateFlags({positive:n})}get nonPositive(){return this.value?.isNonPositive??this._flags?.nonPositive}set nonPositive(n){this.updateFlags({nonPositive:n})}get negative(){return this.value?.isNegative??this._flags?.negative}set negative(n){this.updateFlags({negative:n})}get nonNegative(){return this.value?.isNonNegative??this._flags?.nonNegative}set nonNegative(n){this.updateFlags({nonNegative:n})}get zero(){return this.value?.isZero??this._flags?.zero}set zero(n){this.updateFlags({zero:n})}get notZero(){return this.value?.isNotZero??this._flags?.notZero}set notZero(n){this.updateFlags({notZero:n})}get one(){return this.value?.isOne??this._flags?.one}set one(n){this.updateFlags({one:n})}get negativeOne(){return this.value?.isNegativeOne??this._flags?.negativeOne}set negativeOne(n){this.updateFlags({negativeOne:n})}get infinity(){return this.value?.isInfinity??this._flags?.infinity}set infinity(n){this.updateFlags({infinity:n})}get finite(){return this.value?.isFinite??this._flags?.finite}set finite(n){this.updateFlags({finite:n})}get NaN(){return this.value?.isNaN??this._flags?.NaN}set NaN(n){this.updateFlags({NaN:n})}get even(){return this.value?.isEven??this._flags?.even}set even(n){this.updateFlags({even:n})}get odd(){return this.value?.isOdd??this._flags?.odd}set odd(n){this.updateFlags({odd:n})}get prime(){let n=this._value;return n?!n.isInteger||n.isNonPositive?!1:Pn(y(n)??NaN):this._flags?.prime}set prime(n){this.updateFlags({prime:n})}get composite(){let n=this._value;return n?!n.isInteger||n.isNonPositive?!1:!Pn(y(n)??NaN):this._flags?.composite}set composite(n){this.updateFlags({composite:n})}updateFlags(n){if(this.constant)throw Error("The flags of constant cannot be changed");if(this.domain?.isNumeric===!1)throw Error("Flags only apply to numeric domains");let i=0,t=!0;for(let r in Object.keys(n))if(i+=1,this._value&&n[r]!==void 0)switch(r){case"number":t=this._value.isNumber===n.number;break;case"integer":t=this._value.isInteger===n.integer;break;case"rational":t=this._value.isRational===n.rational;break;case"algebraic":t=this._value.isAlgebraic===n.algebraic;break;case"real":t=this._value.isReal===n.real;break;case"extendedReal":t=this._value.isExtendedReal===n.extendedReal;break;case"complex":t=this._value.isComplex===n.complex;break;case"extendedComplex":t=this._value.isExtendedComplex===n.extendedComplex;break;case"imaginary":t=this._value.isImaginary===n.imaginary;break;case"positive":t=this._value.isPositive===n.positive;break;case"nonPositive":t=this._value.isNonPositive===n.nonPositive;break;case"negative":t=this._value.isNegative===n.negative;break;case"nonNegative":t=this._value.isNonNegative===n.nonNegative;break;case"zero":t=this._value.isZero===n.zero;break;case"notZero":t=this._value.isNotZero===n.notZero;break;case"one":t=this._value.isOne===n.one;break;case"negativeOne":t=this._value.isNegativeOne===n.negativeOne;break;case"infinity":t=this._value.isInfinity===n.infinity;break;case"NaN":t=this._value.isNaN===n.NaN;break;case"finite":t=this._value.isFinite===n.finite;break;case"even":t=this._value.isEven===n.even;break;case"odd":t=this._value.isOdd===n.odd;break;case"prime":t=this._value.isPrime===n.prime;break;case"composite":t=this._value.isComposite===n.composite;break}i>0&&(t||(this._defValue=void 0,this._value=void 0),this._domain=this._engine.Numbers,this._flags?this._flags={...this._flags,...xt(n)}:this._flags=xt(n))}};function vd(e){return Object.fromEntries(Object.entries(e).filter(([n,i])=>i!==void 0))}function xt(e){let n={...e};return(e.zero||e.one||e.negativeOne)&&(n.zero=e.zero&&!e.one&&!e.negativeOne,n.notZero=!e.zero||e.one||e.negativeOne,n.one=e.one&&!e.zero&&!e.negativeOne,n.negativeOne=e.negativeOne&&!e.zero&&!e.one,n.infinity=!1,n.NaN=!1,n.finite=!0,n.integer=!0,n.finite=!0,n.infinity=!1,n.NaN=!1,n.even=e.one,n.odd=!e.one,n.prime=!1,n.composite=!1),n.zero&&(n.positive=!1,n.negative=!1,n.nonPositive=!0,n.nonNegative=!0),n.notZero===!0&&(n.imaginary||(n.real=!0),n.zero=!1),n.one&&(n.positive=!0),n.negativeOne&&(n.nonPositive=!0),(n.positive||n.nonNegative)&&(n.negativeOne=!1),n.positive?(n.nonPositive=!1,n.negative=!1,n.nonNegative=!0):n.nonPositive?(n.positive=!1,n.negative=n.notZero,n.nonNegative=!n.zero):n.negative?(n.positive=!1,n.nonPositive=n.notZero,n.nonNegative=!1):n.nonNegative&&(n.positive=n.notZero,n.nonPositive=!n.zero,n.negative=!1),(n.positive||n.negative||n.nonPositive||n.nonNegative)&&(n.number=!0,n.finite?n.real=!0:n.finite||(n.complex=!0),n.imaginary=!1),n.finite&&(n.number=!0,n.complex=!0,n.infinity=!1,n.NaN=!1),n.infinity&&(n.finite=!1,n.NaN=!1),n.infinity===!1&&(n.extendedComplex=!1,n.extendedReal=!1),e.even&&(n.odd=!1),e.odd&&(n.even=!1),n.integer&&(n.rational=!0),n.rational&&(n.algebraic=!0),n.algebraic&&(n.real=!0),n.real&&(n.complex=!0),n.imaginary&&(n.complex=!0),n.complex&&(n.number=!0),n.real&&n.infinity!==!1&&(n.extendedReal=!0),n.complex&&n.infinity!==!1&&(n.extendedComplex=!0),(n.even||n.infinity||n.NaN||n.negative||n.imaginary||n.integer===!1)&&(n.prime=!1),n.number&&n.prime&&(n.composite=!1),n}function Br(e){if(!e)return{};let n={};if(!e.isNumeric)return n.number=!1,n.integer=!1,n.rational=!1,n.algebraic=!1,n.real=!1,n.extendedReal=!1,n.complex=!1,n.extendedComplex=!1,n.imaginary=!1,n.positive=!1,n.nonPositive=!1,n.negative=!1,n.nonNegative=!1,n.zero=!1,n.notZero=!1,n.one=!1,n.negativeOne=!1,n.infinity=!1,n.NaN=!1,n.odd=!1,n.even=!1,n.prime=!1,n.composite=!1,n;let i=e.base;return n.number=!0,i==="Integers"&&(n.integer=!0),i==="RationalNumbers"&&(n.rational=!0),i==="AlgebraicNumbers"&&(n.algebraic=!0),i==="TranscendentalNumbers"&&(n.algebraic=!1,n.real=!0),i==="ExtendedRealNumbers"&&(n.extendedReal=!0),i==="RealNumbers"&&(n.real=!0),i==="ImaginaryNumbers"&&(n.imaginary=!0),i==="ExtendedComplexNumbers"&&(n.extendedComplex=!0),i==="ComplexNumbers"&&(n.complex=!0),i==="PositiveNumbers"&&(n.notZero=!0,n.real=!0,n.positive=!0),i==="NegativeNumbers"&&(n.notZero=!0,n.real=!0,n.negative=!0),i==="NonNegativeNumbers"&&(n.real=!0,n.positive=!0),i==="NonPositiveNumbers"&&(n.real=!0,n.negative=!0),i==="PositiveIntegers"&&(n.notZero=!0,n.integer=!0,n.positive=!0),i==="NegativeNumbers"&&(n.notZero=!0,n.integer=!0,n.negative=!0),i==="NonNegativeNumbers"&&(n.integer=!0,n.positive=!0),i==="NonPositiveNumbers"&&(n.integer=!0,n.negative=!0),vd(xt(n))}var Ge=class{constructor(n,i,t){if(!n.context)throw Error("No context available");this.engine=n,this.scope=n.context;let r=t.idempotent??!1,o=t.involution??!1;if(r&&o)throw new Error(`Function Definition "${i}": the 'idempotent' and 'involution' flags are mutually exclusive`);if(this.name=i,this.description=t.description,this.wikidata=t.wikidata,this.threadable=t.threadable??!1,this.associative=t.associative??!1,this.commutative=t.commutative??!1,this.idempotent=r,this.involution=o,this.inert=t.inert??!1,this.numeric=t.numeric??!1,this.pure=t.pure??!0,this.complexity=t.complexity??sn,this.hold=t.hold??"none",t.at&&(this.at=t.at),t.iterator&&(this.iterator=t.iterator),t.size&&(this.size=t.size),t.keys&&(this.keys=t.keys),t.indexOf&&(this.indexOf=t.indexOf),t.at&&!t.size&&(this.size=s=>{let a=t.at,u=0;for(;a(s,u)!==void 0;)u++;return u}),t.at&&!t.iterator&&(this.iterator=(s,a=1,u=-1)=>{let l=t.at,f=a;return{next(){if(u>=0&&f>=a+u)return{done:!0,value:void 0};let d=l(s,f);return d===void 0?{done:!0,value:void 0}:(f++,{done:!1,value:d})}}}),this.iterator&&!t.indexOf&&(this.indexOf=(s,a)=>{let u=1,l=this.iterator(s),f=l.next();for(;!f.done;){if(a.isEqual(f.value))return u;u++,f=l.next()}}),this.inert){if(t.hold)throw Error(`Function Definition "${i}": an inert function should not have a hold`);if(this.hold="rest",t.signature){let s=t.signature;if("simplify"in s||"evaluate"in s||"N"in s||"evalDimension"in s||"sgn"in s||"compile"in s)throw Error(`Function Definition "${i}": an inert function should only have 'canonical' or 'codomain' handlers`)}if(this.threadable)throw Error(`Function Definition "${i}": an inert function should not be threadable`);if(this.associative)throw Error(`Function Definition "${i}": an inert function should not be associative`);if(this.commutative)throw Error(`Function Definition "${i}": an inert function should not be commutative`);if(this.idempotent)throw Error(`Function Definition "${i}": an inert function should not be idempotent`);if(this.involution)throw Error(`Function Definition "${i}": an inert function should not be involution`);if(!this.pure)throw Error(`Function Definition "${i}": an inert function should be pure`)}if(t.signature){let s=t.signature,a,u,l,f,d=!1;if(s.domain){let p=n.domain(s.domain);if(!p.isValid)throw Error(`Function Definition "${i}": invalid domain ${JSON.stringify(s.domain)}`);[a,u,l,f]=Hi(n.domain(p))}else s.params||s.result?(a=s.params?.map(p=>n.domain(p))??[],u=s.optParams?.map(p=>n.domain(p))??[],l=s.restParam?n.domain(s.restParam):void 0,typeof s.result=="function"?f=s.result:s.result?f=n.domain(s.result):t.numeric?f=n.Numbers:f=n.Anything):t.numeric?(d=!0,a=[],u=[],l=n.Numbers,f=n.Numbers):(d=!0,a=[],u=[],l=n.Anything,f=n.Anything);let c;if(s.evaluate&&typeof s.evaluate!="function"){let p=n.box(s.evaluate,{canonical:!1});if(!p.isValid)throw Error(`Invalid function ${p.toString()}`);let h=Kn(p);c=(g,E)=>h(E),c.toString=()=>p.toString()}else c=s.evaluate;this.signature={inferredSignature:d,params:a,optParams:u,restParam:l||void 0,result:f,canonical:s.canonical,simplify:s.simplify,evaluate:c,N:s.N,evalDimension:s.evalDimension,sgn:s.sgn,compile:s.compile}}else t.numeric?this.signature={inferredSignature:!0,params:[],optParams:[],restParam:n.Numbers,result:n.Numbers}:this.signature={inferredSignature:!0,params:[],optParams:[],restParam:n.Anything,result:n.Anything}}reset(){}};function Dr(e,n,i){return i instanceof Ge?i:new Ge(e,n,i)}function es(e){if(e==="all")return es(["core","control-structures","logic","collections","relop","numeric","arithmetic","trigonometry","algebra","calculus","polynomials","combinatorics","linear-algebra","statistics","dimensions","units","physics","other"]);typeof e=="string"&&(e=[e]);let n=[];for(let i of e){let t=Nd[i];if(!t)throw Error(`Unknown library category ${i}`);Array.isArray(t)?n.push(...t):n.push(t)}return Object.freeze(n)}var Nd={algebra:[],arithmetic:[...pu,...vu],calculus:gu,collections:[Cu,bu,Ma()],combinatorics:[],"control-structures":yu,core:au,dimensions:[],domains:[],"linear-algebra":Nu,logic:Iu,numeric:[],other:[],relop:wu,polynomials:ku,physics:{Mu0:{description:"Vaccum permeability",constant:!0,wikidata:"Q1515261",domain:"RealNumbers",value:125663706212e-17}},statistics:Mu,trigonometry:Au,units:[]};function _d(e){if(e=e.normalize(),xe(e))return e;throw new Error(`Invalid definition name "${e}": ${We(e)}`)}function ns(e,n){var t;if(!e.context)throw Error("No context available");(t=e.context).ids??(t.ids=new Map);let i=e.context.ids;e.strict;for(let[r,o]of Object.entries(n))if(r=_d(r),is(o)){let s=Dr(e,r,o);if(i.has(r))throw new Error(`Duplicate function definition ${r}:
${JSON.stringify(i.get(r))}
${JSON.stringify(o)}`);i.set(r,s)}else if(Ir(o)){let s=new ae(e,r,o);if(e.strict&&o.wikidata){for(let[a,u]of i)if(u.wikidata===o.wikidata)throw new Error(`Duplicate entries with wikidata "${o.wikidata}": "${r}" and "${u.name}"`)}if(i.has(r))throw new Error(`Duplicate symbol definition "${r}"`);i.set(r,s)}else{let s=new ae(e,r,{value:e.box(o)});i.set(r,s)}}function Ir(e){return e==null||typeof e!="object"||e instanceof L?!1:"domain"in e||"value"in e||"constant"in e}function is(e){return e==null||typeof e!="object"||e instanceof L?!1:"signature"in e||"complexity"in e}var Pu=pe(le(),1);function ei(e){return Number.isInteger(e)&&e!==0?Math.floor(Math.log2(Math.abs(e))/Math.log2(10))+(e>0?1:2):2}function ts(e){if(e.symbol)return 1;let n=e.numericValue;if(n!==null){if(e.isZero)return 1;if(e.isInteger)return ei(y(e));if(U(n))return q(n)?ei(n[0])+ei(n[1])+1:ei(Number(n[0]))+ei(Number(n[1]))+1;if(n instanceof Pu.Complex)return ei(n.re)+ei(n.im)+1;if(e.isNumber)return 2}let i=e.head,t=2;return typeof i=="string"?["Add","Divide"].includes(i)?t=3:["Subtract","Negate"].includes(i)?t=4:["Square","Sqrt","Multiply","Root"].includes(i)?t=5:["Power"].includes(i)?t=6:["Ln","Exp","Log"].includes(i)?t=7:["Arcsin","Arccos","Arctan","Arcsec"," Arccsc","Arsinh","Arcosh","Artanh","Arcsech","Arcsch","Cosh","Cos","Csc","Csch","Sec","Sin","Sinh","Tan","Tanh"].includes(i)?t=9:t=10:t=ts(i),t+(e.ops?.reduce((r,o)=>r+ts(o),0)??0)}var rs=ts;var Mi=class e{constructor(n){n?n instanceof e?this._items=new Map(n._items):this._items=new Map(n):this._items=new Map}has(n){for(let i of this._items.keys())if(i.isSame(n))return!0;return!1}get(n){for(let[i,t]of this._items)if(i.isSame(n))return t}clear(){this._items.clear()}set(n,i){for(let t of this._items.keys())if(t.isSame(n)){this._items.set(t,i);return}this._items.set(n,i)}delete(n){this._items.delete(n)}[Symbol.iterator](){return this._items.entries()}entries(){return this._items.entries()}};function Fu(e){let n=[],i=(t,r=[])=>{if(t.length===0)n.push(r);else for(let o=0;o<t.length;o++){let s=t.slice(),a=s.splice(o,1);i(s.slice(),r.concat(a))}};return i(e),n}var wr=class e extends L{constructor(i,t,r){super(i,r);this._pattern=yi(t)?i.parse(t,{canonical:!1}):i.box(t,{canonical:!1})}get hash(){return he("Pattern")^this._pattern.hash}reset(){this._pattern.reset()}get json(){return F(this.engine,"Pattern",[this._pattern])}get head(){return"Pattern"}get domain(){return this.engine.domain("Values")}get isCanonical(){return!0}set isCanonical(i){}isSame(i){return this===i?!0:i instanceof e&&this._pattern.isSame(i._pattern)}isEqual(i){return i instanceof e&&this._pattern.isEqual(i._pattern)}match(i,t){return Ru(i,this._pattern,{recursive:t?.recursive??!1,numericTolerance:t?.numericTolerance??0,substitution:t?.substitution??{},exact:t?.exact??!1})}test(i,t){return this.match(i,t)!==null}count(i,t){let r=0;for(let o of i)this.match(o,t)!==null&&(r+=1);return r}subs(i,t){return this._pattern.subs(i,t)}};function kr(e){if(typeof e=="string")return e.startsWith("_");if(e.symbol?.startsWith("_"))return!0;if(e.ops)return kr(e.head)||e.ops.some(kr);if(e.keys){for(let n of e.keys)if(kr(e.getKey(n)))return!0}return!1}function Cr(e,n,i){return e.startsWith("_"),e==="_"||e==="__"||e==="___"?i:e in i?n.isSame(i[e])?i:null:kr(n)?null:{...i,[e]:n}}function Fe(e,n,i,t){let r=t.exact??!1,o=e.engine;if(n.head==="Pattern")return n.match(e,{...t,...i});if(n instanceof oe)return e instanceof oe?t.numericTolerance===0?n.isSame(e)?i:null:n.isEqualWithTolerance(e,t.numericTolerance)?i:null:null;let s=n.string;if(s!==null)return e.string===s?i:null;let a=n.symbol;if(a!==null)return a.startsWith("_")?Cr(a,e,i):a===e.symbol?i:null;let u=n.keys;if(u!==null){let l=e.keys;if(l===null)return null;for(let f of u){let d=Fe(l[f],u[f],i,t);if(d===null)return null;i=d}return i}if(n.ops){let l=n.head;if(typeof l=="string"&&l.startsWith("_"))return Cr(l,o.box(e.head),i);let f;if(typeof l=="string"&&typeof e.head=="string"){if(l!==e.head){if(r)return null;if(l==="Add"){let d=Fe(o.box(["Add",0,e],{canonical:!1}),n,i,t);if(d!==null||(e.head==="Subtract"&&(d=Fe(o.box(["Add",e.op1,["Negate",e.op2]],{canonical:!1}),n,i,t)),d!==null))return d}if(l==="Subtract"){let d=Fe(o.box(["Subtract",e,0],{canonical:!1}),n,i,t);if(d!==null||(e.head==="Negate"&&(d=Fe(o.box(["Subtract",0,e.op1],{canonical:!1}),n,i,t)),d!==null))return d}if(l==="Multiply"){let d=Fe(o.box(["Multiply",1,e],{canonical:!1}),n,i,t);if(d!==null||e.head==="Negate"&&(d=Fe(o.box(["Multiply",-1,e.op1],{canonical:!1}),n,i,t),d!==null)||e.head==="Divide"&&(d=Fe(o.box(["Multiply",e.op1,["Divide",1,e.op2]],{canonical:!1}),n,i,t),d!==null))return d}if(l==="Divide"){let d=Fe(o.box(["Divide",e,1],{canonical:!1}),n,i,t);if(d!==null)return d}return null}f=o.lookupFunction(l)}else{let d=Fe(o.box(e.head,{canonical:!1}),o.box(l,{canonical:!1}),i,t);if(d===null)return null;i=d}return f?.commutative?Sd(e,n,i,t):Lu(e,n.ops,i,t)}return null}function Sd(e,n,i,t){let r=Fu(n.ops);for(let o of r){let s=Lu(e,o,i,t);if(s!==null)return s}return null}function Lu(e,n,i,t){if(n.length===0)return null;let r=n[0].engine,o={...i},s=[...e.ops],a=0;for(;a<n.length;){let u=n[a],l=u.symbol;if(l!==null){if(l.startsWith("__")){let f=0;if(n[a+1]===void 0)f=s.length+1;else{let c=!1;for(;!c&&f<s.length;)c=Fe(s[f],n[a+1],o,t)!==null,f+=1;if(!c&&l.startsWith("___"))return null}if(!l.startsWith("___")&&f<=1)return null;let d;f<=1?e.head==="Add"?d=r.number(0):e.head==="Multiply"?d=r.number(1):d=r.box(["Sequence"]):d=r.fn(e.head,s.splice(0,f-1)),o=Cr(l,d,o)}else if(l.startsWith("_"))o=Cr(l,s.shift(),o);else if(o=Fe(s.shift(),u,o,t),o===null)return null}else{let f=s.shift();if(!f||(o=Fe(f,u,o,t),o===null))return null}if(o===null)return null;a+=1}return s.length>0?null:o}function Ru(e,n,i){let t=Fe(e,n,i.substitution??{},{numericTolerance:i?.numericTolerance??Gi});if(t)return t;if(!i.recursive)return null;if(e.ops){let r=e.ops,o={};for(let s=0;s<r.length;s++){let a=Ru(r[s],n,i);if(a!==null)return a}return o}return null}var qn=class e extends L{constructor(i,t,r){super(i,r?.metadata);xe(t),`${t}${We(t)}`,this._id=t,this._def=r?.def??void 0,r?.canonical??!0?this._def?this._scope=i.context:this.bind():this._scope=null}get hash(){return this._hash===void 0&&(this._hash=he(this._id)),this._hash}get isPure(){return!0}get json(){let i=this._scope?this.wikidata:void 0;return ut(this.engine,this._id,{latex:this._latex,wikidata:i})}get scope(){return this._scope}get isConstant(){let i=this._def??this.engine.lookupSymbol(this._id,this.wikidata);return!(i instanceof ae)||i.constant}bind(){this._scope=this.engine.context;let i=this.engine.lookupSymbol(this._id)??this.engine.lookupFunction(this._id);if(i){this._def=i;return}this._def=this.engine.defineSymbol(this._id,{domain:void 0,inferred:!0}),this._id=this._def.name}reset(){this._def?.reset(),this._def=void 0}get isCanonical(){return this._scope!==null}set isCanonical(i){this._scope=i?this.engine.context:null,this._def=void 0}get canonical(){return this._scope?this:this.engine.box(this._id)}solve(i){return i.length!==1?null:i.includes(this.symbol)?[this.engine.Zero]:null}get complexity(){return 7}get head(){return"Symbol"}get symbol(){return this._id}get isNothing(){return this._id==="Nothing"}get baseDefinition(){return this._def===void 0&&this.bind(),this._def??void 0}get symbolDefinition(){return this._def===void 0&&this.bind(),this._def instanceof ae?this._def:void 0}get functionDefinition(){return this._def===void 0&&this.bind(),this._def instanceof Ge?this._def:void 0}infer(i){let t=this.engine.lookupSymbol(this._id)??this.engine.lookupFunction(this._id);if(!t){let r=this.engine.swapScope(this._scope??this.engine.context);return this._def=this.engine.defineSymbol(this._id,{domain:i,inferred:!0}),this.engine.swapScope(r),!0}return t instanceof ae&&t.inferredDomain?(t.domain=st(t.domain,i),!0):!1}get value(){let i=this._def;if(i&&i instanceof ae)return i.value?.value}set value(i){let t=this.engine;t.forget(this._id);let r;if(typeof i=="boolean"&&(i=i?t.True:t.False),typeof i=="string"&&(i=t.string(i)),typeof i=="object")if("re"in i&&"im"in i)i=t.complex(i.re,i.im);else if("num"in i&&"denom"in i)i=t.number([i.num,i.denom]);else if(Array.isArray(i))i=t._fn("List",i.map(s=>t.box(s)));else throw new Error(`Invalid value for symbol ${this._id}: ${i}`);if(i!==void 0&&(r=t.box(i).evaluate()),r?.domain?.isFunction){this.engine.lookupSymbol(this._id),this._def=t.defineFunction(this._id,{signature:{...Ji(r.domain),evaluate:r}});return}let o=this.engine.lookupSymbol(this._id);if(o&&o instanceof ae)o.value=r;else{let s=r?.domain;s?.isNumeric&&(s=t.Numbers),this._def=t.defineSymbol(this._id,{value:r,domain:s})}}get domain(){let i=this._def;if(i){if(i instanceof Ge)return Qt(this.engine,i.signature);if(i instanceof ae)return i.domain??void 0}}set domain(i){if(!this._def)return;if(this._id[0]==="_")throw new Error(`The domain of the wildcard "${this._id}" cannot be changed`);let t=this.engine.domain(i);t.isFunction?(this.engine.forget(this._id),this._def=this.engine.defineFunction(this._id,{signature:Ji(t)})):this._def instanceof ae?this._def.domain=t:(this.engine.forget(this._id),this._def=this.engine.defineSymbol(this._id,{domain:t}))}get sgn(){let i=this._def;if(!i||!(i instanceof ae))return null;let t=i.value;if(t&&t!==this){let r=t.sgn;if(r!==void 0)return r}if(i.zero===!0)return 0;if(i.positive===!0)return 1;if(i.negative===!0)return-1}has(i){return typeof i=="string"?this._id===i:i.includes(this._id)}isSame(i){return this===i?!0:i instanceof e?this._id===i._id:!1}match(i,t){return i instanceof e&&this._id===i._id?{}:null}isEqual(i){if(!this.isCanonical)return this.canonical.isEqual(i);if(i=i.canonical,this===i)return!0;if(i.symbol!==null)return i.symbol===this._id;let t=this.symbolDefinition?.value?.N();if(t)return t.isEqual(i.N());if(i.isZero){if(this.isZero)return!0;if(this.isNotZero)return!1}return this.isZero&&i.isNotZero?!1:this.engine.ask(["Equal",this,i]).length>0?!0:(this.engine.ask(["NotEqual",this,i]).length>0,!1)}isLess(i){if(i.symbol!==null&&i.symbol===this._id)return!1;let t=this.symbolDefinition?.value?.N();if(t)return t.isLess(i.N());if(i.isZero){let r=this.sgn;if(r===null)return!1;if(r!==void 0)return r<0}}isLessEqual(i){if(i.symbol!==null&&i.symbol===this._id)return!0;let t=this.symbolDefinition?.value?.N();if(t)return t.isLessEqual(i.N());if(i.isZero){let r=this.sgn;if(r===null)return!1;if(r!==void 0)return r<=0}return this.isLess(i)||this.isEqual(i)}isGreater(i){if(i.symbol!==null&&i.symbol===this._id)return!1;let t=this.symbolDefinition?.value?.N();if(t)return t.isGreater(i.N());if(i.isZero){let r=this.sgn;if(r===null)return!1;if(r!==void 0)return r>0}}isGreaterEqual(i){if(i.symbol!==null&&i.symbol===this._id)return!0;let t=this.symbolDefinition?.value?.N();if(t)return t.isGreaterEqual(i.N());if(i.isZero){let r=this.sgn;if(r===null)return!1;if(r!==void 0)return r>=0}return this.isGreater(i)||this.isEqual(i)}get isFunction(){return!!this.functionDefinition}get isZero(){return this.symbolDefinition?.zero}get isNotZero(){return this.symbolDefinition?.notZero}get isOne(){return this.symbolDefinition?.one}get isNegativeOne(){return this.symbolDefinition?.negativeOne}get isOdd(){return this.symbolDefinition?.odd}get isEven(){return this.symbolDefinition?.even}get isPrime(){return this.symbolDefinition?.prime}get isComposite(){return this.symbolDefinition?.composite}get isInfinity(){return this.symbolDefinition?.infinity}get isNaN(){return this.symbolDefinition?.NaN}get isPositive(){return this.symbolDefinition?.positive}get isNonPositive(){return this.symbolDefinition?.nonPositive}get isNegative(){return this.symbolDefinition?.negative}get isNonNegative(){return this.symbolDefinition?.nonNegative}get isNumber(){return this.symbolDefinition?.number}get isInteger(){return this.symbolDefinition?.integer}get isRational(){return this.symbolDefinition?.rational}get isAlgebraic(){return this.symbolDefinition?.rational}get isReal(){return this.symbolDefinition?.real}get isExtendedReal(){return this.symbolDefinition?.extendedReal}get isComplex(){return this.symbolDefinition?.complex}get isImaginary(){return this.symbolDefinition?.imaginary}simplify(i){let t=this.symbolDefinition;return t?.holdUntil==="simplify"&&t.value?t.value.simplify(i):i?.rules?this.replace(i.rules)??this:this}evaluate(i){let t=this.symbolDefinition;if(t){if(i?.numericMode)return t.holdUntil==="never"?this:t.value?.N(i)??this;if(t.holdUntil==="simplify"||t.holdUntil==="evaluate")return t.value?.evaluate(i)??this}return this}N(i){let t=this.symbolDefinition;return t&&t.holdUntil==="never"?this:t?.value?.N(i)??this}replace(i,t){return er(this,i,t)}subs(i,t){return i[this._id]===void 0?t?.canonical?this.canonical:this:this.engine.box(i[this._id],t)}};function os(e,n){let i=e.lookupSymbol(n);return i?.holdUntil==="never"&&i.value?i.value:new qn(e,n,{canonical:!0,def:i})}var bt="\x1B[0m";var qu="\x1B[33m";var Vu="\x1B[36;1m",ss="\x1B[101;97m";var Ai=class e{constructor(n){this._cache={};this._commonSymbols={True:null,False:null,All:null,Nothing:null,None:null,Undefined:null,Pi:null,ImaginaryUnit:null,ExponentialE:null};this._commonNumbers={"-5":null,"-4":null,"-3":null,"-2":null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,36:null};this._commonDomains={Anything:null,Void:null,NothingDomain:null,Booleans:null,Strings:null,Domains:null,Symbols:null,Integers:null,RationalNumbers:null,AlgebraicNumbers:null,RealNumbers:null,ExtendedRealNumbers:null,ImaginaryNumbers:null,ComplexNumbers:null,ExtendedComplexNumbers:null,Numbers:null,PositiveIntegers:null,TranscendentalNumbers:null,PositiveNumbers:null,Functions:null,NumericFunctions:null,RealFunctions:null,LogicOperators:null,Predicates:null};if(n!==void 0&&typeof n!="object")throw Error("Unexpected argument");this.strict=!0,this._jsonSerializationOptions={exclude:[],shorthands:["function","symbol","string","dictionary","number"],metadata:[],precision:"max",repeatingDecimals:!0},this._useRawJsonSerializationOptions=!1,this._rawJsonSerializationOptions={exclude:[],shorthands:["function","symbol","string","dictionary","number"],metadata:[],precision:"max",repeatingDecimals:!1},this._stats={highwaterMark:0,symbols:new Set,expressions:new Set},this._numericMode=n?.numericMode??"auto",this._precision=Math.max(n?.numericPrecision??100,Math.floor(Gn)),this._bignum=v.clone({precision:this._precision}),this.tolerance=n?.tolerance??Gi,this.Zero=new oe(this,0),this.One=new oe(this,1),this.Half=new oe(this,[1,2]),this.NegativeOne=new oe(this,-1),this.NaN=new oe(this,Number.NaN),this.PositiveInfinity=new oe(this,Number.POSITIVE_INFINITY),this.NegativeInfinity=new oe(this,Number.NEGATIVE_INFINITY),this.I=new oe(this,ni.Complex.I),this.ComplexInfinity=new oe(this,ni.Complex.INFINITY),this.reset(),this.context={assumptions:new Mi,timeLimit:2,memoryLimit:1,recursionLimit:1024,iterationLimit:Number.POSITIVE_INFINITY};for(let t of e.getStandardLibrary("domains"))ns(this,t);for(let t of Object.keys(this._commonDomains))this._commonDomains[t]&&!this._commonDomains[t].symbolDefinition?this._commonDomains[t].bind():this._commonDomains[t]=new Nn(this,nr[t]??t);this.Anything=this._commonDomains.Anything,this.Void=this._commonDomains.Void,this.Strings=this._commonDomains.Strings,this.Booleans=this._commonDomains.Booleans,this.Numbers=this._commonDomains.Numbers;let i=n?.ids??e.getStandardLibrary();for(let t of i)ns(this,t);for(let t of Object.keys(this._commonSymbols)){let r=new qn(this,t,{canonical:!0});r.bind(),this._commonSymbols[t]=r}this.True=this._commonSymbols.True,this.False=this._commonSymbols.False,this.Pi=this._commonSymbols.Pi,this.E=this._commonSymbols.ExponentialE,this.Nothing=this._commonSymbols.Nothing,this.pushScope()}static getStandardLibrary(n="all"){return es(n)}get latexDictionary(){return this.latexSyntax.dictionary}set latexDictionary(n){this.latexSyntax.dictionary=n}reset(){this._bignum,this._BIGNUM_NEGATIVE_ONE=this.bignum(-1),this._BIGNUM_NAN=this.bignum(NaN),this._BIGNUM_ZERO=this.bignum(0),this._BIGNUM_ONE=this.bignum(1),this._BIGNUM_TWO=this.bignum(2),this._BIGNUM_HALF=this._BIGNUM_ONE.div(this._BIGNUM_TWO),this._BIGNUM_PI=this._BIGNUM_NEGATIVE_ONE.acos();let n=this._stats.symbols.values(),i=this._stats.expressions.values();this._stats.symbols=new Set,this._stats.expressions=new Set;for(let r of n)r.reset();for(let r of i)r.reset();for(let r of Object.values(this._commonDomains))r?.reset();for(let r of Object.values(this._commonSymbols))r?.reset();let t=this.context;for(;t;){if(t.ids)for(let[r,o]of t.ids)o.reset();t=t.parentScope??null}for(let r of Object.keys(this._cache))this._cache[r].value&&(this._cache[r].purge?this._cache[r].value=this._cache[r].purge(this._cache[r].value):delete this._cache[r])}_register(n){this._stats.highwaterMark+=1}_unregister(n){}get stats(){let n=this._stats.expressions;return this._stats.expressions=null,this._stats.expressions=n,{...this._stats}}get precision(){return this._numericMode==="machine"||this._numericMode==="complex"?Math.floor(Gn):this._precision}set precision(n){n==="machine"&&(n=Math.floor(Gn));let i=this._precision;if(n!==i){if(typeof n!="number"||n<=0)throw Error('Expected "machine" or a positive number');this._latexSyntax?.updateOptions({precision:n,avoidExponentsInRange:[-6,n]}),this._precision=Math.max(n,Math.floor(Gn)),this.jsonSerializationOptions.precision>this._precision&&(this.jsonSerializationOptions={precision:this._precision}),this._numericMode!=="auto"&&this._numericMode!=="bignum"&&this._precision>Math.floor(Gn)&&(this._numericMode="auto"),this._bignum=this._bignum.config({precision:this._precision}),this.reset()}}get numericMode(){return this._numericMode}set numericMode(n){if(n!==this._numericMode){if(typeof n!="string")throw Error("Expected a string");this._numericMode=n,(n==="complex"||n==="machine")&&(this._precision=Math.floor(Gn)),this._latexSyntax&&this.latexSyntax.options.precision>this._precision&&this.latexSyntax.updateOptions({precision:this._precision}),this.jsonSerializationOptions.precision>this._precision&&(this.jsonSerializationOptions={precision:this._precision}),this.reset()}}get timeLimit(){let n=this.context;for(;n;){if(n.timeLimit!==void 0)return n.timeLimit;n=n.parentScope??null}return 2}get iterationLimit(){let n=this.context;for(;n;){if(n.iterationLimit!==void 0)return n.iterationLimit;n=n.parentScope??null}return 1024}get recursionLimit(){let n=this.context;for(;n;){if(n.recursionLimit!==void 0)return n.recursionLimit;n=n.parentScope??null}return 1024}get tolerance(){return this._tolerance}set tolerance(n){typeof n=="number"&&Number.isFinite(n)?this._tolerance=Math.max(n,0):this._tolerance=Gi,this._bignumTolerance=this.bignum(this._tolerance)}chop(n){return typeof n=="number"&&Math.abs(n)<=this._tolerance||n instanceof v&&n.abs().lte(this._bignumTolerance)||n instanceof ni.Complex&&Math.abs(n.re)<=this._tolerance&&Math.abs(n.im)<=this._tolerance?0:n}bignum(n){if(typeof n=="bigint")return new this._bignum(n.toString());try{return new this._bignum(n)}catch(i){console.error(i)}return this._BIGNUM_NAN}complex(n,i){return n instanceof v&&(n=n.toNumber()),i instanceof v&&(i=i.toNumber()),new ni.Complex(n,i)}isBignum(n){return n instanceof v}isComplex(n){return n instanceof ni.Complex}get latexSyntax(){if(!this._latexSyntax){let n=this.precision;this._latexSyntax=new Ui({computeEngine:this,precision:n,avoidExponentsInRange:[-6,n],onError:i=>{throw new Error(JSON.stringify(i[0].message))}})}return this._latexSyntax}static getLatexDictionary(n="all"){return Ui.getDictionary(n)}set costFunction(n){typeof n!="function"&&(this._cost=rs),this._cost=n}get costFunction(){return this._cost??rs}lookupSymbol(n,i,t){if(!this.strict){for(t??(t=this.context??void 0);t;){let o=t.ids?.get(n);if(o&&o instanceof ae)return o;t=t.parentScope}return}if(typeof n!="string")throw Error("Expected a string");if(n.length===0||!this.context)return;let r=t??this.context;if(i)for(t=r;t;){if(t.ids){for(let[o,s]of t.ids)if(s instanceof ae&&s.wikidata===i)return s}t=t.parentScope}for(t=r;t;){let o=t.ids?.get(n);if(o instanceof ae)return o;t=t.parentScope}}lookupFunction(n,i){if(typeof n=="string"&&this.context)for(i??(i=this.context);i;){let t=i.ids?.get(n);if(t instanceof Ge)return t;i=i.parentScope}}defineSymbol(n,i){if(!this.context)throw Error("Symbol cannot be defined: no scope available");if(n.length===0||!xe(n))throw Error(`Invalid identifier "${n}": ${We(n)}}`);return this._defineSymbol(n,i)}_defineSymbol(n,i){var r;(r=this.context).ids??(r.ids=new Map);let t=new ae(this,n,i);return t.name&&this.context.ids.set(t.name,t),t}defineFunction(n,i){if(!this.context)throw Error("Function cannot be defined: no scope available");if(n.length===0||!xe(n))throw Error(`Invalid identifier "${n}": ${We(n)}}`);return this._defineFunction(n,i)}_defineFunction(n,i){var r;(r=this.context).ids??(r.ids=new Map);let t=Dr(this,n,i);return t.name&&this.context.ids.set(t.name,t),t}pushScope(n){if(this.context===null)throw Error("No parent scope available");return this.context={timeLimit:this.context.timeLimit,memoryLimit:this.context.memoryLimit,recursionLimit:this.context.recursionLimit,iterationLimit:this.context.iterationLimit,...n??{},parentScope:this.context,assumptions:new Mi(this.context.assumptions)},this}popScope(){if(!this.context)throw Error("No scope available");return this.context=this.context.parentScope??null,this.context,this}swapScope(n){let i=this.context;return this.context=n,this.context,i}resetContext(){if(this.context){for(let[n,i]of this.context.ids??[])if(i instanceof ae)i.constant||(i.value=void 0);else if(i instanceof Ge){let t=i.signature;i.signature={...t,evaluate:void 0,N:void 0,simplify:void 0,canonical:void 0}}}}_printScope(n,i,t=0){if(n??(n={details:!1,maxDepth:1}),i??(i=this.context),!i||n.maxDepth&&t>n.maxDepth)return null;let r=`${qu}[undefined]${bt}`;if(t===0?console.group("current scope - level 0"):console.groupCollapsed(i.parentScope?`scope - level ${t}`:`root scope - level ${t}`),i.ids){let o=0;for(let[s,a]of i.ids){let u=`${Vu}${s}${bt}`;try{if(a instanceof ae){let l=a.value?.isValid?a.value.toString():a.value?`${ss}${a.value.toString()}${bt}`:r;console.info(`${u}: ${a.domain?.toString()??r} = ${l}`)}else a instanceof Ge&&(typeof a.signature.evaluate=="function"?console.info(`${u}(): ${n.details?a.signature.evaluate.toString():"[native-code]"}`):a.signature.evaluate===void 0?console.info(`${u}(): ${r}`):console.info(`${u}(): ${a.toString()}`));o===11&&console.groupCollapsed(`... and ${i.ids.size-o} more`),o+=1}catch(l){console.info(`${u}: ${ss}${l.message}${bt}`)}}o>=11&&console.groupEnd()}if(i.assumptions){let o=[...i.assumptions.entries()].map(([s,a])=>`${s}: ${a}`);if(o.length>0){console.groupCollapsed(`${o.length} assumptions)`);for(let s of o)console.info(s);console.groupEnd()}}return i.parentScope&&this._printScope(n,i.parentScope,t+1),console.groupEnd(),this.context}declare(n,i){if(typeof n!="string"||i===void 0){for(let[s,a]of Object.entries(n))this.declare(s,a);return this}let[t,r]=Oo(n);if(r!==void 0)throw Error(`Unexpected arguments with ${n}. Use 'ce.assign()' instead to assign a value, or a use a function definition with 'ce.declare()'.`);if(t==="Nothing")return this;if(this.context?.ids?.get(t)){let s=this.context.ids.get(t);if(s instanceof ae&&s.inferredDomain)return Ir(i)?s.update(i):(s.domain=this.domain(i),s.inferredDomain=!1),this;throw Error(`Symbol "${t}" has already been declared in the current scope`)}let o=i;if(!o)throw Error(`Expected a definition for ${t}`);if(Ir(o))return this.defineSymbol(t,o),this;if(is(o))return this.defineFunction(t,o),this;{let s=this.domain(o);if(s.isValid)if(s.isFunction)this.defineFunction(t,{signature:Ji(s)});else{if(r)throw Error(`Unexpected arguments with domain for "${t}"`);this.defineSymbol(t,{domain:s})}else throw Error(`Invalid argument for "${t}": use a domain, a FunctionDefinition or a SymbolDefinition`)}return this}assign(n,i){if(typeof n=="object"){for(let[u,l]of Object.entries(n))this.assign(u,l);return this}let[t,r]=Oo(n);if(t==="Nothing")return this;let o=i;if(typeof o=="boolean"&&(o=o?this.True:this.False),typeof o=="string"){let u=o.trim();u.startsWith("$")&&u.endsWith("$")?o=this.parse(u.slice(1,-1),{canonical:!1}):u.startsWith("$$")&&u.endsWith("$$")?o=this.parse(u.slice(2,-2),{canonical:!1}):o=this.string(o)}let s=this.lookupSymbol(t);if(s){if(s.constant)throw Error(`Cannot assign a value to the constant "${t}"`);if(!s.inferredDomain&&as(o))throw Error(`Cannot assign a function to symbol "${t}"`);let u=s.scope;if(u?.ids?.delete(s.name),!r&&!as(o))return o==null?s.value=void 0:s.value=this.box(o),u?.ids?.set(s.name,s),this}let a=this.lookupFunction(t);if(a){let u=a.scope;if(u?.ids?.delete(a.name),o==null)return this;if(typeof o=="function"){let d=this.swapScope(u);return this.defineFunction(t,{signature:{evaluate:o}}),this.swapScope(d),this}if(r&&as(o))throw Error(`Unexpected arguments for "${t}"`);let l=r?this.box(["Function",o,...r]):this.box(o),f=this.swapScope(u);return this.defineFunction(t,{signature:{evaluate:l}}),this.swapScope(f),this}if(o==null)return this.declare(t,{inferred:!0,domain:this.Anything}),this;if(typeof o=="function")return this.defineFunction(t,{signature:{evaluate:o}}),this;if(o instanceof L&&o.domain?.base==="Functions")return this.defineFunction(t,{signature:{evaluate:o}}),this;if(Array.isArray(o)||o instanceof L||r){let u=this.box(o,{canonical:!1});if(u.head==="Function")return u=this.box(["Function",...u.ops,...(r??[]).map(f=>this.symbol(f))]),this.defineFunction(t,{signature:{evaluate:u}}),this;let l=[...u.unknowns].sort();if(l.length===0){let f=u.evaluate();return this.defineSymbol(t,{value:f}),this}if(l.some(f=>/\_[\d]+/.test(f)))return u=this.box(["Function",u]),this.defineFunction(t,{signature:{evaluate:u}}),this;if(r&&r.length>0)return this.pushScope(),u=this.box(["Function",u,...r]),this.popScope(),this.defineFunction(t,{signature:{evaluate:u}}),this;this.pushScope(),o=u.evaluate(),this.popScope()}return this.defineSymbol(t,{value:o}),this}_assign(n,i){let t=this.lookupSymbol(n);if(t)return t.value=this.box(i).evaluate(),this;let r=this.lookupFunction(n);if(r){let o=r.signature;return r.signature={...o,N:void 0,simplify:void 0,canonical:void 0,evaluate:i},this}return`${n}`,this}get assumptions(){if(!this.context)throw Error("No scope available");return this.context.assumptions?this.context.assumptions:(this.context.assumptions=new Mi,this.context.assumptions)}shouldContinueExecution(){return this.deadline===void 0||this.deadline>=Date.now()}checkContinueExecution(){if(!this.shouldContinueExecution())throw new Error("timeout")}cache(n,i,t){if(this._cache[n]===void 0)try{this._cache[n]={build:i,purge:t,value:i()}}catch(r){console.error(`Fatal error building cache "${n}":
	 ${r.toString()}`)}return this._cache[n]?.value}box(n,i){return De(this,n,i)}canonical(n){if(!n.every(t=>t instanceof L))return n.map(t=>this.box(t));let i=n;return i.every(t=>t.isCanonical)?i:i.map(t=>t.canonical)}fn(n,i,t){return gt(this,n,i,t??{canonical:!0})}_fn(n,i,t){return new ye(this,n,i,{metadata:t,canonical:!0})}error(n,i){i instanceof L?i=this.rawJson(i):i&&Array.isArray(i)&&i[0]==="LatexString"&&((i[1]===void 0||!i[1])&&(i=""),typeof i[1]=="object"&&"str"in i[1]&&!i[1].str&&(i=""));let t;return typeof n=="string"&&(t=this.string(n)),!t&&typeof n!="string"&&(t=new ye(this,"ErrorCode",[this.string(n[0]),...n.slice(1).map(r=>this.box(r,{canonical:!1}))])),i?new ye(this,"Error",[t,this.box(i,{canonical:!1})],{canonical:!1}):new ye(this,"Error",[t],{canonical:!1})}domainError(n,i,t){let r=an(n)?this.domain(n):this.symbol(n),o=i||this.symbol("Undefined");return this.error(["incompatible-domain",r,o],t)}hold(n){return this._fn("Hold",[this.box(n,{canonical:!1})])}add(n,i){let t=or(this,ie(ce(n),"Add"));return i?.latex!==void 0&&(t.latex=i.latex),t}neg(n,i){return re(n,i)}mul(n,i){let t=pt(this,ie(ce(n)," Multiply"));return i?.latex!==void 0&&(t.latex=i.latex),t}div(n,i,t){let r=Ke(this,n,i);return t?.latex!==void 0&&(r.latex=t.latex),r}sqrt(n,i){return dt(this,n,this.Half,i)}pow(n,i,t){if(n.symbol==="ExponentialE"&&i instanceof ni.Complex){let s=i.im,a=i.re;if(a===0)return this.number(this.complex(Math.cos(s),Math.sin(s)));if(s===0)return this.number(Math.exp(a));let u=Math.exp(a);return this.number(this.complex(u*Math.cos(s),u*Math.sin(s)))}if(i instanceof L){let s=i.numericValue;s!==null&&(typeof s=="number"&&(i=s),U(s)&&(i=s))}let r=null;if(typeof i=="number")r=i;else if(U(i)){if(Ce(i))return this.One;if(fe(i))return n;q(i)&&i[1]===1?r=i[0]:J(i)&&i[1]===BigInt(1)&&(r=Number(i[0]))}if(r===0)return this.One;if(r===1)return n;let o=n.numericValue;if(r===-1&&o!==null){if(typeof o=="number"&&Number.isInteger(o))return this.number([1,o]);if(o instanceof v&&o.isInteger())return this.number([BigInt(1),C(o)]);if(U(o))return this.number([o[1],o[0]])}return(typeof i=="number"||U(i))&&(i=this.number(i)),dt(this,n,i,t)}inv(n,i){if(n.isOne)return this.One;if(n.isNegativeOne)return this.NegativeOne;if(n.isInfinity)return this.Zero;let t=n.numericValue;if(t!==null)return U(t)?this.number(yn(t),{metadata:i}):typeof t=="number"&&Number.isInteger(t)?this.number([1,t],{metadata:i}):t instanceof v&&t.isInteger()?this.number([BigInt(1),C(t)],{metadata:i}):this._fn("Divide",[this.One,n],i);if(n.head==="Sqrt")return this._fn("Sqrt",[this.inv(n.op1)],i);if(n.head==="Divide")return this._fn("Divide",[n.op1,n.op2],i);let r=this.NegativeOne;if(n.head==="Power"){if(n.op2.isNegativeOne)return n.op1;r=re(n.op2),n=n.op1}return r.isNegativeOne?this._fn("Divide",[this.One,n],i):this._fn("Power",[n,r],i)}pair(n,i,t){return new ye(this,"Tuple",[n,i],{metadata:t,canonical:!0})}tuple(n,i){return typeof n[0]=="number"?new ye(this,"Tuple",n.map(t=>this.number(t)),{metadata:i,canonical:!0}):new ye(this,"Tuple",ee(n),{metadata:i,canonical:!0})}array(n,i){return this.Nothing}string(n,i){return new ln(this,n,i)}symbol(n,i){if(i=i?{...i}:{},"canonical"in i||(i.canonical=!0),n=n.normalize(),n==="NaN")return this.NaN;if(n==="Infinity")return this.PositiveInfinity;if(n==="+Infinity")return this.PositiveInfinity;if(n==="-Infinity")return this.NegativeInfinity;if(n==="Half")return this.Half;if(this.strict&&!xe(n)){let r=i?.metadata?.latex,o=`'${n}'`;return this.error(["invalid-identifier",{str:We(n)}],r?["LatexString",`'${r}'`]:o)}if(i?.metadata?.latex!==void 0&&!i.canonical)return new qn(this,n,i);let t=this._commonSymbols[n];return t?!i?.metadata?.wikidata||!t.wikidata||t.wikidata===i.metadata.wikidata?t:i.canonical?os(this,n):new qn(this,n,i):i.canonical?os(this,n):new qn(this,n,i)}domain(n,i){if(n instanceof Nn)return n;if(typeof n=="string"){let r=this._commonDomains[n];if(r)return r}if(!this.strict){if(typeof n=="string"){let r=nr[n];if(r)return this.domain(r)}return new Nn(this,n,i)}if(Array.isArray(n)&&n[0]==="Domain"&&(n=n[1]),typeof n=="string"){let r=nr[n];if(r)return this.domain(r);if(!Yn(n))throw Error("Expected a domain literal, got "+n);return new Nn(this,n,i)}if(!Array.isArray(n)||n.length===0)throw Error("Expected a valid domain");let t=n[0];if(!Si.includes(t))throw Error("Expected a domain constructor, got "+t);return new Nn(this,n,i)}number(n,i){if(i=i?{...i}:{},"canonical"in i||(i.canonical=!0),i.metadata===void 0){if(typeof n=="bigint"){if(n===BigInt(1))return this.One;if(n===BigInt(0))return this.Zero;if(n===BigInt(-1))return this.NegativeOne}if(typeof n=="number"){let t=n;if(t===1)return this.One;if(t===0)return this.Zero;if(t===-1)return this.NegativeOne;if(Number.isInteger(t)&&this._commonNumbers[t]!==void 0)return this._commonNumbers[t]===null&&(this._commonNumbers[t]=br(this,n)??this.NaN),this._commonNumbers[t];if(Number.isNaN(t))return this.NaN;if(!Number.isFinite(t))return t<0?this.NegativeInfinity:this.PositiveInfinity}}return typeof n=="bigint"&&(n=this.bignum(n)),br(this,n,i)??this.NaN}rules(n){return Wn(this,n)}pattern(n){return new wr(this,n)}parse(n,i){if(typeof n!="string")return null;let t=this.latexSyntax.parse(Ei(n)??n);return this.box(t,i)}serialize(n,i){if(typeof n=="object"&&"json"in n){let t="engine"in n?n.engine:this;return this.latexSyntax.serialize(this.rawJson(t.box(n,{canonical:!1})),i)}return this.latexSyntax.serialize(n,i)}get latexOptions(){let n=this.latexSyntax;return new Proxy({...this.latexSyntax.options,...this.latexSyntax.serializer.options},{set(i,t,r){return t in i?(n.updateOptions({[t]:r}),!0):!1}})}set latexOptions(n){this.latexSyntax.updateOptions(n)}get jsonSerializationOptions(){if(this._useRawJsonSerializationOptions)return new Proxy(this._rawJsonSerializationOptions,{get(i,t){if(t in i)return i[t]}});let n=this;return new Proxy(this._jsonSerializationOptions,{get(i,t){if(t in i)return i[t]},set(i,t,r){return t in i?(n.jsonSerializationOptions={[t]:r},!0):!1}})}set jsonSerializationOptions(n){n.exclude&&(this._jsonSerializationOptions.exclude=[...n.exclude]),n.shorthands&&(n.shorthands==="all"||n.shorthands.includes("all")?this._jsonSerializationOptions.shorthands=["function","symbol","string","dictionary","number"]:this._jsonSerializationOptions.shorthands=[...n.shorthands]),n.metadata&&(n.metadata==="all"||n.metadata.includes("all")?this._jsonSerializationOptions.metadata=["latex","wikidata"]:this._jsonSerializationOptions.metadata=[...n.metadata]),typeof n.precision=="number"&&n.precision>0&&(this._jsonSerializationOptions.precision=n.precision),typeof n.repeatingDecimals=="boolean"&&(this._jsonSerializationOptions.repeatingDecimals=n.repeatingDecimals)}rawJson(n){let i=this._useRawJsonSerializationOptions;this._useRawJsonSerializationOptions=!0;let t=n.json;return this._useRawJsonSerializationOptions=i,t}ask(n){let i=this.pattern(n),t=[];for(let[r,o]of this.assumptions){let s=i.match(r,{numericTolerance:this._tolerance});s!==null&&o===!0&&t.push(s)}return t}verify(n){return!1}assume(n){try{return Ga(this.box(n,{canonical:!1}))}catch(i){return console.error(i.toString()),"internal-error"}}forget(n){if(!this.context)throw Error("No scope available");if(n===void 0){if(this.context.ids)for(let i of this.context.ids.keys())this.forget(i);this.assumptions.clear();return}if(Array.isArray(n)){for(let i of n)this.forget(i);return}if(typeof n=="string"){if(this.context.ids){let i=this.context.ids.get(n);if(i instanceof ae)i.value=void 0;else if(i instanceof Ge){let t=i.signature;i.signature={...t,evaluate:void 0,N:void 0,simplify:void 0,canonical:void 0}}}for(let[i,t]of this.assumptions)i.symbols.includes(n)&&this.assumptions.delete(i)}}};function as(e){return typeof e=="function"||e instanceof L&&e.domain?.base==="Functions"}var Td="0.22.0";globalThis[Symbol.for("io.cortexjs.compute-engine")]={ComputeEngine:Ai.prototype.constructor,version:"0.22.0"};return Ju(Bd);})();
/*! Bundled license information:

complex.js/complex.js:
  (**
   * @license Complex.js v2.1.1 12/05/2020
   *
   * Copyright (c) 2020, Robert Eisele (robert@xarg.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **)

decimal.js/decimal.mjs:
  (*!
   *  decimal.js v10.4.3
   *  An arbitrary-precision Decimal type for JavaScript.
   *  https://github.com/MikeMcl/decimal.js
   *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
   *  MIT Licence
   *)
*/
Object.assign(exports, ComputeEngine); Object.defineProperty(exports, '__esModule', { value: true });}));
